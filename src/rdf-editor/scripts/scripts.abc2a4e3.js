"use strict";angular.module("myApp",["ngRoute","angularSpinner","myApp.welcome","myApp.editor","myApp.fileBrowser"]).config(["$routeProvider",function(a){a.otherwise({redirectTo:"/welcome"})}]).run(["$rootScope",function(a){a.version="0.17_git158"}]).factory("Notification",function(){function a(a,b,c){"error"===a&&(a="danger");var d={type:a};"danger"===a&&(void 0===d.delay&&(d.delay=0),c||(c="fire")),c&&(d.icon="glyphicon glyphicon-"+c),$.notify(b,d)}return $.notifyDefaults({allow_dismiss:!0,placement:{from:"top",align:"center"},template:'       <div data-notify="container" class="col-xs-11 col-sm-6 alert alert-{0}" role="alert">      	<button type="button" aria-hidden="true" class="close" data-notify="dismiss">Ã—</button>      	<span data-notify="icon"></span>      	<span data-notify="title">{1}</span>      	<span data-notify="message">{2}</span>      	<div class="progress" data-notify="progressbar">      		<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>      	</div>      	<a href="{3}" target="{4}" data-notify="url"></a>      </div>',z_index:1050}),{notify:a}}).controller("AuthInfoDialogCtrl",["$scope","$uibModalInstance","url",function(a,b,c){a.username="",a.password="",a.url=c,a.ok=function(){b.close({username:a.username,password:a.password})},a.cancel=function(){b.dismiss()}}]).factory("DocumentTree",["$q","$uibModal","usSpinnerService","WebID","RDFEConfig",function(a,b,c,d,e){function f(d,e){var f=r[d];return f||"/"===d[d.length-1]||(f=r[d.substring(0,d.lastIndexOf("/")+1)]),e===!1||e!==!0&&f?a.when(f):a(function(a,e){c.stop("editor-spinner"),b.open({templateUrl:"tmpl/authinfodlg.html",controller:"AuthInfoDialogCtrl",resolve:{url:function(){return d}}}).result.then(function(b){r[d]=b,a(b)},e)})}function g(){var a=new RDFE.IO.Folder;return a.name=a.path="Recent Documents",a.ioType="recent",a.comment="Documents you recently opened",a.children=h(),a}function h(){var a=[],b=$.jStorage.get("rdfe:recentDocuments");if(b)for(var c=0;c<b.length&&10>c;c++){var d=b[c];if(d){var e=new RDFE.IO.File(d.url);e.ioType=d.ioType,e.name=d.title||d.name,e.sparqlEndpoint=d.sparqlEndpoint,a.push(e)}}return a}function i(){var a=[],b=$.jStorage.get("rdfe:recentLocations");if(b)for(var c=0;c<b.length&&10>c;c++){var d=b[c];if(d){var e;e="webdav"===d.ioType?new RDFE.IO.WebDavFolder(d.url):"ldp"===d.ioType?new RDFE.IO.LDPFolder(d.url):new RDFE.IO.Folder(d.url),a.push(e)}}return a}function j(){return p.length?a.when(p):(p=i(),p.unshift(g()),a(function(a,b){e.getConfig().then(function(b){var c=b.options.storage||[];c.length?RDFE.Utils.resolveStorageLocations(c,function(b){$.merge(p,b),a(p)}):a(p)},function(){a(p)})}))}function k(){return q.length?a.when(q):a(function(a,b){d.getWebID().then(function(){return d.getProfile()}).then(function(b){for(var c=[],d=b.storage||[],e=0;e<d.length;e++)_.isEmpty(_.where(c,{uri:d[e].uri}))&&(c=c.concat(d[e]));c.length?RDFE.Utils.resolveStorageLocations(c,function(b){$.merge(q,b),a(q)}):a(q)})})}function l(a,b){for(var c,d=!0,e=$.jStorage.get("rdfe:recentDocuments")||[],f=0;f<e.length;f++)if(c=e[f],c.url===a&&c.ioType===b){d=!1,e.splice(f,1),e.unshift(c);break}d&&(c=new RDFE.IO.File(a),c.ioType=b,e.unshift(c),e.length>10&&e.splice(e.length-1,1)),$.jStorage.set("rdfe:recentDocuments",e)}function m(a,b){if("recent"!==b){for(var c,d=!0,e=$.jStorage.get("rdfe:recentLocations")||[],f=0;f<e.length;f++)if(c=e[f],c.url===a&&c.ioType===b){d=!1,e.splice(f,1),e.unshift(c);break}d&&(c=new RDFE.IO.Folder(a),c.ioType=b,e.unshift(c),e.length>10&&e.splice(e.length-1,1)),$.jStorage.set("rdfe:recentLocations",e)}}function n(a,b){if("recent"!==b)for(var c=$.jStorage.get("rdfe:recentLocations")||[],d=0;d<c.length;d++)if(c[d].url===a&&c[d].ioType===b)return c.splice(d,1),void $.jStorage.set("rdfe:recentLocations",c)}function o(a,b){if("recent"!==b)for(var c,d=$.jStorage.get("rdfe:recentLocations")||[],e=0;e<d.length;e++)if(c=d[e],c.url===a&&c.ioType===b)return d.splice(e,1),d.unshift(c),void $.jStorage.set("rdfe:recentLocations",d)}var p=[],q=[],r={};return{getLocations:j,getStorages:k,getAuthInfo:f,getRecentDocs:h,addRecentDoc:l,getRecentLocations:i,addRecentLocation:m,deleteRecentLocation:n,selectRecentLocation:o}}]).factory("RDFEConfig",["$q","Notification",function(a,b){function c(){return d?a.when(d):a(function(a,c){var e=RDFE.Utils.uriParams(),f=e.config?e.config:"config.json";d=new RDFE.Config(f,function(b){a(b)},function(){b.notify("error","Failed to load Editor configuration")})})}var d=null;return{getConfig:c}}]).factory("WebID",["$q","Notification",function(a,b){function c(){return e?a.when(e):a(function(a,b){function c(b){var c;if(0===String(b.data).lastIndexOf("youid_rc:",0)){try{c=JSON.parse(b.data.substr(9))}catch(d){}c&&c.webid&&(e=c.webid,a(e))}}if("chrome-extension:"==location.protocol){var d=null;chrome.management.getAll(function(b){for(var c=0;c<b.length;c++)if("opl_youid"===b[c].shortName){d=b[c].id;break}d&&chrome.runtime.sendMessage(d,{getWebId:!0},function(b){b&&(e=JSON.parse(b.webid).id),e&&a(e)})})}else window.addEventListener("message",c,!1),window.postMessage('youid:{"getWebId": true}',"*")})}function d(){return e?f?a.when(f):a(function(a,b){$.get(e).done(function(c){new rdfstore.create(function(d,g){var h=e.split("#")[0];g.registerDefaultProfileNamespaces(),g.load("text/n3",c,{documentIRI:h},function(c,d){c&&b("Failed to load the profile contents."),g.execute("select ?uri ?name ?img ?nick where {?x foaf:topic ?uri . ?uri a foaf:Agent . optional { ?uri foaf:name ?name . } . optional { ?uri foaf:nick ?nick . } . optional { ?uri foaf:img ?img . } . }",function(c,d){c&&b("Failed to load the profile contents.");var h={uri:e};0!==d.length&&(d[0].name&&(h.name=d[0].name.value),d[0].img&&(h.image=d[0].img.value),d[0].nick&&(h.nick=d[0].nick.value)),g.execute("select ?storage where { <"+e+"> <http://www.w3.org/ns/pim/space#storage> ?storage . }",function(c,d){c&&b("Failed to load the profile contents.");for(var i=0;i<d.length;i++)d[i].storage&&(h.storage=h.storage||[]).push({uri:d[i].storage.value});g.execute("select ?namedGraph ?sparqlEndpoint where { <"+e+"> <http://www.openlinksw.com/schemas/cert#hasDBStorage> ?namedGraph . ?namedGraph <http://rdfs.org/ns/void#sparqlEndpoint> ?sparqlEndpoint . }",function(c,d){c&&b("Failed to load the profile contents.");for(var e=0;e<d.length;e++)d[e].namedGraph&&d[e].sparqlEndpoint&&(h.storage=h.storage||[]).push({uri:d[e].namedGraph.value,sparqlEndpoint:d[e].sparqlEndpoint.value});f=h,a(f)})})})})})}).fail(function(a,c,d){b("Failed to load the profile contents.")})}):a.reject()}var e=null,f=null;return{getWebID:c,getProfile:d}}]).controller("AuthHeaderCtrl",["$rootScope","$scope",function(a,b){}]),angular.module("myApp.welcome",["ngRoute"]).config(["$routeProvider",function(a){a.when("/welcome",{templateUrl:"views/welcome.html",controller:"WelcomeCtrl"})}]).controller("WelcomeCtrl",[function(){}]),angular.module("myApp.editor",["ngRoute"]).config(["$routeProvider",function(a){a.when("/editor",{templateUrl:"views/editor.html",controller:"EditorCtrl",reloadOnSearch:!1})}]).run(["$rootScope",function(a){a.eav2spo={statements:"triples",entities:"subjects",attributes:"predicates",values:"objects",triples:"triples",subjects:"subjects",predicates:"predicates",objects:"objects"},a.spo2eav={triples:"statements",subjects:"entities",predicates:"attributes",objects:"values",statements:"statements",entities:"entities",attributes:"attributes",values:"values"}}]).factory("RDFEditor",["$q","$rootScope","$location","$timeout","usSpinnerService","RDFEConfig","Notification","DocumentTree",function(a,b,c,d,e,f,g,h){function i(a){var d,e,f={"triple:subject":"statement:entity","triple:predicate":"statement:attribute","triple:object":"statement:value","spo:subject":"eav:attribute","spo:predicate":"eav:entity","spo:object":"eav:value","statement:entity":"triple:subject","statement:attribute":"triple:predicate","statement:value":"triple:object","eav:attribute":"spo:subject","eav:entity":"spo:predicate","eav:value":"spo:object"},g="",h=c.search();for(var i in h)d=i,e=h[i],"view"===i?e="EAV"===a?b.spo2eav[e]:b.eav2spo[e]:f[i]&&(d=f[i]),g+="&"+d+"="+e;return c.path()+"?"+g}function j(){return k?a.when(k):a(function(a,j){f.getConfig().then(function(f){var j={config:f,documentTree:h};new RDFE.Editor(j,function(f){$(f).on("rdf-editor-success",function(a,b){g.notify("success",b.message)}).on("rdf-editor-error",function(a,b){g.notify("error",b.message)}).on("rdf-editor-spinner-start",function(a,b){"editor-spinner"===b&&(f.spinner++,1===f.spinner&&e.spin(b)),"export-spinner"===b&&e.spin(b)}).on("rdf-editor-spinner-done",function(a,b){"editor-spinner"===b&&(f.spinner>0&&f.spinner--,0===f.spinner&&e.stop("editor-spinner")),"export-spinner"===b&&e.stop(b)}).on("rdf-editor-page",function(a,b){var e=f.config.options.pageSettings,g=c.search();b.view&&g.view!==b.view&&(c.search("view",b.view),c.search("pageNo",null),c.search("sortName",null),c.search("sortOrder",null),e.pageNo=null,e.sortName=null,e.sortOrder=null),b.pageNo&&e.pageNo!==b.pageNo&&(c.search("pageNo",b.pageNo),e.pageNo=b.pageNo),b.pageSize&&e.pageSize!==b.pageSize&&(c.search("pageSize",b.pageSize),e.pageSize=b.pageSize),b.sortName&&e.sortName!==b.sortName&&(c.search("sortName",b.sortName),e.sortName=b.sortName),b.sortOrder&&e.sortOrder!==b.sortOrder&&(c.search("sortOrder",b.sortOrder),e.sortOrder=b.sortOrder);var h="";g=c.search();for(var i in g)h+="&"+i+"="+encodeURIComponent(g[i]);var j=c.path()+"?"+h;d(function(){c.url(j)})}).on("rdf-editor-namingSchema",function(a,e){var f=e.uiMode,g=e.viewMode,h=i(f);b.uiMode=f,b.viewMode="EAV"===f?b.spo2eav[g]:b.eav2spo[g],b.radioViewMode=b.viewMode,d(function(){c.url(h)})}),a(f)})})})}var k=null;return{getEditor:j,prepareUrl:i}}]).filter("namingSchemaLabel",function(){return function(a,b,c,d){if(b.editor){var e=b.editor.namingSchema();return e[a][c===!0?1:0]}}}).filter("namingSchemaTitle",function(){return function(a,b){if(b.editor){var c=b.editor.namingSchema();switch(a){case"SPO":return"SPO"===c?"RDF Statement Graph Representation [Data]":"Entity Relationship Representation  [Data]";case"s":return"SPO"===c?"Items described by sentence Predicate & Object pairs in this document":"Items described by Attribute & Value pairs in this document";case"p":return"SPO"===c?"How Sentence Subjects and Objects are associated":"How Entities and their Attribute Values are associated";case"o":return"SPO"===c?"Objects & Data Types associated with a  Sentence Subject via its Predicate":"Values & Data Types associated with an Entity Attribute";default:return a}}}}).controller("EditorCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","usSpinnerService","RDFEditor","DocumentTree","Notification",function(a,b,c,d,e,f,g,h,i){function j(a,b,c,d){var e;h.getAuthInfo&&(e=function(a,b,c){h.getAuthInfo(a,!0).then(b,c)});var f=RDFE.IO.createIO(b,{sparqlEndpoint:c,gspEndpoint:$("#gspEndpoint").val(),ioTimeout:d,accept:a});return f.type=b,f.options.authFunction=e,f}function k(){var d,e=c["triple:subject"]||c["spo:subject"],f=c["triple:predicate"]||c["spo:predicate"],g=c["triple:object"]||c["spo:object"],h=c["statement:entity"]||c["eav:entity"],i=c["statement:attribute"]||c["eav:attribute"],j=c["statement:value"]||c["eav:value"],k=c.view,l=c.uiMode;if(e?d="triples"===k||"statements"===k?k:"subjects":f?d="triples"===k||"statements"===k?k:"predicates":g?d="triples"===k||"statements"===k?k:"objects":(e||f||g)&&(d="triples"),h?d="triples"===k||"statements"===k?k:"entities":i?d="triples"===k||"statements"===k?k:"entities":j?d="triples"===k||"statements"===k?k:"values":h||i||j?d="statements":k&&(d=k),!l){if(["triples","subjects","predicates","objects"].indexOf(d)>-1?l="SPO":["statements","entities","entities","values"].indexOf(d)>-1&&(l="EAV"),!l){var m=$.jStorage.get("rdfe:settings",{});l=m.namingSchema}l||(l=b.editor.config.options.namingSchema)}d||(d=b.editor.config.defaultView,d||(d="statements"));var n=b.editor.config.options.pageSettings;if(c.pageNo){var o=parseInt(c.pageNo);isNaN(o)||(n.pageNo=o)}if(c.pageSize){var o=parseInt(c.pageSize);isNaN(o)||(n.pageSize=o)}c.sortName&&(n.sortName=c.sortName),c.sortOrder&&(n.sortOrder=c.sortOrder),b.editor.config.options.namingSchema=l,a.uiMode=l,a.viewMode="EAV"===l?b.spo2eav[d]:b.eav2spo[d],a.radioViewMode=b.viewMode,b.editor.toggleView(b.viewMode,b.uiMode)}function l(){var a=c.newStatement,d=c["triple:subject"]||c["spo:subject"],e=c["triple:predicate"]||c["spo:predicate"],f=c["triple:object"]||c["spo:object"],g=c["statement:entity"]||c["eav:entity"],h=c["statement:attribute"]||c["eav:attribute"],i=c["statement:value"]||c["eav:value"],j=b.viewMode;!d&&!g||j&&"subjects"!==j&&"entities"!==j?!e&&!h||j&&"predicates"!==j&&"attributes"!==j?!f&&!i||j&&"objects"!==j&&"values"!==j?!(d||e||f||g||h||i||a)||j&&"statements"!==j&&"triples"!==j||b.editor.editTriple(d||g,e||h,f||i,a):b.editor.editObject(f||i,a):(e=b.editor.ontologyManager.uriDenormalize(e||h),b.editor.editPredicate(e,a)):(d=b.editor.ontologyManager.uriDenormalize(d||g),b.editor.editSubject(d,a))}function m(){var a={params:[],paramValues:[],paramMixed:[]},b=function(b,c){return b&&a.params.push(c),b},d=function(b,c){return b&&a.paramValues.push(c),b},e=function(b,c){return b&&a.paramValues.push(c),b},f={uiMode:{defaultValue:function(){var a;for(var b in c)if(c.hasOwnProperty(b)){var d=f[b];if(d){var g=d.paramReference;if(g&&"uiMode"===g){if("string"==typeof d.value){if(e(a&&a!==d.value,b))return;a=d.value}if("object"==typeof d.value)for(var h in d.value)for(var i=d.value[h],j=0;j<i.length;j++)if(c[b]===i[j]){if(e(a&&a!==h,b))return;a=h}}}}return a?a:"EAV"},value:["EAV","SPO"]},view:{paramReference:"uiMode",value:{EAV:["statements","entities","attributes","values"],SPO:["triples","subjects","predicates","objects"]}},"triple:subject":{paramReference:"uiMode",value:"SPO"},"spo:subject":{paramReference:"uiMode",value:"SPO"},"triple:predicate":{paramReference:"uiMode",value:"SPO"},"spo:predicate":{paramReference:"uiMode",value:"SPO"},"triple:object":{paramReference:"uiMode",value:"SPO"},"spo:object":{paramReference:"uiMode",value:"SPO"},"statement:entity":{paramReference:"uiMode",value:"EAV"},"eav:entity":{paramReference:"uiMode",value:"EAV"},"statement:attribute":{paramReference:"uiMode",value:"EAV"},"eav:attribute":{paramReference:"uiMode",value:"EAV"},"statement:value":{paramReference:"uiMode",value:"EAV"},"eav:value":{paramReference:"uiMode",value:"EAV"},pageNo:{},pageSize:{},sortName:{},sortOrder:{},uri:{},data:{},accept:["text/turtle","application/ld+json"],ioType:["http","ldp","dav","webdav","sparql"],ioTimeout:{},sparqlEndpoint:{},newDocument:["true","false"],saveDocument:["true","false"],newStatement:["true","false"],"error.msg":{}};for(var g in c)if(c.hasOwnProperty(g)){var h=c[g],j=f[g];if(!b(void 0===j,g))if(j instanceof Array){for(var k=0;k<j.length&&h!==j[k];k++);if(d(k===j.length,g))continue}else if("object"==typeof j){if($.isEmptyObject(j))continue;var l=j.paramReference;if(l){var m=c[l];if(!m&&(m=f[l].defaultValue(),!m))break;if("string"==typeof j.value){b(j.value!==m,g);continue}if("object"==typeof j.value){var n=j.value[m];if(!n)continue;for(var k=0;k<n.length&&h!==n[k];k++);if(d(k===n.length,g))continue}}}}if(a.params.length||a.paramValues.length||a.paramMixed.length){var o,p="Params validation errors:";if(a.params.length){p+=" <br/>&nbsp;&nbsp;Unsupported or mixed parameters: ",o="";for(var k=0;k<a.params.length;k++)p+=o+a.params[k],o=", "}if(a.paramValues.length){p+=" <br/>&nbsp;&nbsp;Bad values for parameters: ",o="";for(var k=0;k<a.paramValues.length;k++)p+=o+"["+a.paramValues[k]+"="+c[a.paramValues[k]]+"]",o=", "}if(a.paramMixed.length){p+=" <br/>&nbsp;&nbsp;Mixed parameters: ",o="";for(var k=0;k<a.paramMixed.length;k++)p+=o+a.paramMixed[k],o=", "}i.notify("error",p)}}function n(){var a=c.uri,f=c.data,m=c.accept;"turtle"===m?m="text/turtle":"jsonld"===m&&(m="application/ld+json");var n=c.ioType||"http",o=c.ioTimeout||b.editor.config.options.ioTimeout,p=c.sparqlEndpoint,q=c.newDocument;if(b.doc=b.editor.doc,b.editor.render($("#contents")),"true"===c.saveDocument){b.doc.url=a,b.doc.io=j(m,n,p,o),b.saveDocument(),b.editor.updateView(),d.search("saveDocument",null);var r=g.prepareUrl(b.uiMode);e(function(){d.url(r)})}else if("true"===q||"false"===q&&!a&&!f)b.doc["new"](function(){k(),b.editor.saveSubject=null,b.editor.updateView(),e(function(){"false"!==q&&a&&(b.doc.url=a,b.doc.io=j(m,n,p,o))}),l()},function(){i.notity("error","Failed to clear Document for unknown reasons.")});else if(a||f){var s=$.jStorage.get("rdfe:savedDocument",null);if(s)b.doc.store.clear(function(){b.doc.store.loadTurtle(s,b.doc.graph,b.doc.graph,null,function(c){c||(k(),b.editor.saveSubject=null,b.editor.updateView(),e(function(){b.doc.dirty=!0,"false"===q?b.doc.url=null:(b.doc.url=a,b.doc.io=j(m,n,p,o))}),l())})});else{var t=function(){if(a)try{var c=j(m,n,p,o),d=function(c,d){var e=function(c){k(),b.editor.updateView(),b.editor.toggleSpinner(!1),b.$apply(function(){c||b.newDocument(),c&&"false"!==q?(b.doc.url=a,b.doc.io=d):b.doc.url=null}),l(),b.editor.docChanged()};b.editor.toggleSpinner(!0),b.doc.load(c,d,function(){e(!0)},function(a,b,c,d){var f=a&&a.message?a.message:"Failed to load document";i.notify("error",f),e(!1)})};h.getAuthInfo?h.getAuthInfo(a,!1).then(function(b){b&&(c.options.username=b.username,c.options.password=b.password),d(a,c)}):d(a,c)}catch(e){i.notify("error",e)}};if(f){var u=function(a){b.editor.updateView(),b.editor.docChanged(),i.notify("success","Successfully imported RDF data."),t()},v=function(a){i.notify("error","Failed to import RDF data. <br /> "+a.message),t()};b.doc["import"](f,u,v)}else t()}}else k(),l();c["error.msg"]&&i.notify("error",c["error.msg"]),$.jStorage.deleteKey("rdfe:savedDocument"),b.ontologyView||(b.ontologyView=new RDFE.OntologyView(b.editor),b.ontologyView.render($("#container-ontologies")),$("#ontology-add").click(function(a){a.stopPropagation(),b.ontologyView.add()})),b.$watch(function(a){return a.radioViewMode},function(a){if(a){var c=b.viewMode;b.viewMode="EAV"===b.uiMode?b.spo2eav[a]:b.eav2spo[a],b.radioViewMode=b.eav2spo[b.radioViewMode],c!==b.viewMode&&b.editor.toggleView(b.viewMode,b.uiMode)}})}function o(a,c,d){c||(c=b.doc.url),d||(d=b.doc.io);var e=function(e,f,g){if("success"===f){if((!b.doc.url||b.doc.io&&b.doc.io!==d)&&e.length)return void bootbox.confirm("Target document exists. Do you really want to overwrite it?",function(b){b&&a(c,d)});if(b.doc.srcParams&&(b.doc.srcParams.length!==e.length||b.doc.srcParams.md5!==$.md5(e)))return void bootbox.confirm("Target document was updated after last open/save. Do you really want to overwrite it?",function(b){b&&a(c,d)})}a(c,d)};d.retrieve(c,{success:e,error:e})}b.newDocument=function(){b.doc["new"](function(){k(),b.editor.saveSubject=null,b.editor.updateView(),l(),d.search("uri",null),d.search("data",null),d.search("accept",null),d.search("ioType",null),d.search("ioTimeout",null),d.search("sparqlEndpoint",null);var a=g.prepareUrl(b.uiMode);e(function(){d.url(a)})},function(){i.notity("error","Failed to clear Document for unknown reasons.")})},b.openDocument=function(){function a(){d.url("/browser")}b.doc.dirty?bootbox.confirm("Your document has unsaved changes. Do you really want to open another document?",function(c){c&&b.$apply(a)}):a()},b.saveDocument=function(){if(b.doc.url){var a=function(){b.editor.toggleSpinner(!0),b.doc.save(function(){b.editor.toggleSpinner(!1),i.notify("success","Successfully saved document to <code>"+b.doc.url+"</code>")},function(a){b.editor.toggleSpinner(!1),i.notify("error",a?a.message||a:"An unknown error occured")})};o(a)}else b.saveDocumentAs()},b.saveDocumentAs=function(){d.url("/browser?mode=save")},b.downloadDocumentAs=function(){function a(a,b){var c=document.createElement("a");if(c.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(b)),c.setAttribute("download",a),document.createEvent){var d=document.createEvent("MouseEvents");d.initEvent("click",!0,!0),c.dispatchEvent(d)}else c.click()}b.doc.store.graph(b.doc.graph,function(c,d){var e=d.toNTBeatify(b.doc.store.rdf.prefixes);a("document.ttl",e)})},b.settings=function(){b.editor.settingsForm()},b.signDocument=function(){b.editor.signDocumentForm()},b.importInto=function(){b.editor.importForm()},b.exportInto=function(){b.editor.exportForm()},b.unsignDocument=function(){b.editor.unsignDocumentForm()},b.closeDocument=function(){function a(){d.url("/")}b.doc.dirty?bootbox.confirm("Your document has unsaved changes. Do you really want to close the document?",function(c){c&&b.$apply(a)}):a()},b.toggleOntologyView=function(){var a=$("#panel-ontologies").find(".panel-heading");a.find(".up").toggle(),a.find(".down").toggle(),$("#container-ontologies").toggle(),$("#ontology-add").toggle()},b.editor?n():g.getEditor().then(function(b){a.editor=b,m(),n()})}]),angular.module("myApp.fileBrowser",["ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/browser",{templateUrl:"views/browser.html",controller:"FileBrowserCtrl"})}]).filter("ioTypeLabel",function(){return function(a){switch(a){case"webdav":return"WebDAV Folder";case"ldp":return"LDP Location";case"sparql":return"SPARQL Endpoint";default:return a}}}).filter("httpStatusLabel",function(){return function(a){switch(a){case 0:return"Connection Refused";case 404:return"Not Found";case 401:return"Authorization Required";case 403:return"Access Denied";default:return a}}}).controller("FileBrowserCtrl",["$rootScope","$scope","$routeParams","$timeout","$location","usSpinnerService","DocumentTree","Notification",function(a,b,c,d,e,f,g,h){"save"===c.mode?(b.mode=c.mode,b.title="Save Your Document"):(b.mode="open",b.title="Open a Document"),b.locations=[],g.getLocations().then(function(c){b.locations=c;var d=0;if(a.currentLocation)for(var e=0;e<b.locations.length;e++)if(b.locations[e].url===a.currentLocation.url){d=e;break}b.updateCurrentLocation(b.locations[d]),b.updateCurrentFolder(b.currentLocation),f.stop("location-spinner")}),g.getStorages().then(function(a){b.locations=b.locations.concat(a)}),b.setCurrentLocation=function(a){if(b.resetUI(),a!==b.currentLocation){if(a.httpStatus){var c;g.getAuthInfo&&(c=function(a,b,c){g.getAuthInfo(a,!0).then(b,c)}),RDFE.IO.openUrl(a.url,{authFunction:c,checkForFiles:!0},function(c){b.$apply(function(){b.locations[b.locations.indexOf(a)]=c,b.updateCurrentLocation(c),b.updateCurrentFolder(c)})},function(c,e){a.httpStatus=e,a.errorMessage=c,d(function(){b.updateCurrentLocation(a),b.updateCurrentFolder(a)})})}else b.updateCurrentLocation(a),b.updateCurrentFolder(a);g.selectRecentLocation(a.url,a.ioType)}},b.updateCurrentLocation=function(c){b.currentLocation=c,a.currentLocation=c,b.orderProp="Recent Documents"===c.name?null:"name"},b.updateCurrentFolder=function(a){b.currentFolder=a,b.currentFolder&&b.currentFolder.dirty&&b.refresh()},b.changeDir=function(a){var c=function(){f.stop("refresh-spinner"),b.currentFolder=a};b.resetUI(),f.spin("refresh-spinner"),a.dirty?(a.httpStatus=null,a.errorMessage=null,a.update(function(){b.$apply(function(){c()})},function(a,d,e){a.httpStatus=e,a.errorMessage=d,b.$apply(function(){c()})})):c()},b.folderUp=function(){b.currentFolder.parent&&(b.updateCurrentFolder(b.currentFolder.parent),b.resetUI())},b.refresh=function(){b.resetUI(),"Recent Documents"===b.currentLocation.name?(b.currentLocation.children=g.getRecentDocs(),b.currentFolder=b.currentFolder):(f.spin("refresh-spinner"),b.currentFolder.httpStatus=null,b.currentFolder.errorMessage=null,b.currentFolder.update(!0,function(){b.$evalAsync(function(){b.currentFolder=b.currentFolder,d(function(){f.stop("refresh-spinner")},1e3)})},function(a,c,d){f.stop("refresh-spinner"),a.httpStatus=d,a.errorMessage=c,b.$apply()}))},b.openFile=function(a){var c="/editor?uri="+encodeURIComponent(a.url)+"&ioType="+encodeURIComponent(a.ioType);a.sparqlEndpoint&&(c+="&sparqlEndpoint="+encodeURIComponent(a.sparqlEndpoint)),"save"===b.mode?c+="&saveDocument=true":a.isNew&&(c+="&newDocument=true"),e.url(c)},b.open=function(a){"file"===a.type?b.openFile(a):b.changeDir(a)},b.addLocation=function(a){for(var c=0;c<b.locations.length;c++)if(b.locations[c].url===a.url)return void(b.locations[c]=a);b.locations.push(a),g.addRecentLocation(a.url,a.ioType)},b.removeLocation=function(a){for(var c=0;c<b.locations.length;c++)if(b.locations[c].url===a.url)return b.locations.splice(c,1),a===b.currentLocation&&b.setCurrentLocation(b.locations[0]),void g.deleteRecentLocation(a.url,a.ioType)},b.addingLocation=!1,b.showNewLocationUi=function(){b.addingLocation=!0,b.newLocationUrl=""},b.addNewLocation=function(){if(b.newLocationUrl&&b.newLocationUrl.length)if(b.newLocationIsSparql){var a=new RDFE.IO.Folder(b.newLocationUrl);a.ioType="sparql",a.sparqlEndpoint=b.newLocationUrl,b.addLocation(a),b.updateCurrentLocation(a),b.currentFolder=a,b.addingLocation=!1}else{f.spin("location-spinner");var c;g.getAuthInfo&&(c=function(a,b,c){g.getAuthInfo(a,!0).then(b,c)}),RDFE.IO.openUrl(b.newLocationUrl,{authFunction:c,checkForFiles:!0},function(a){b.$apply(function(){b.addingLocation=!1,b.addLocation(a),b.updateCurrentLocation(a),b.currentFolder=a}),f.stop("location-spinner")},function(a,b){h.notify("error",a),f.stop("location-spinner")})}},b.addingGraph=!1,b.showNewGraphUi=function(){b.addingGraph=!0,b.newGraphUri=""},b.addNewGraph=function(){if(b.newGraphUri&&b.newGraphUri.length){var a=new RDFE.IO.File(b.newGraphUri);a.parent=b.currentFolder,a.sparqlEndpoint=b.currentFolder.sparqlEndpoint,a.ioType="sparql",b.currentFolder.children.push(a),b.openFile(a)}},b.addingFile=!1,b.newFileName="myDocument.ttl",b.showNewFileUi=function(){b.addingFile=!0,b.newFileName="myDocument.ttl"},b.addNewFile=function(){if(b.newFileName&&b.newFileName.length){b.currentFolder.dirty=!0;var a=b.currentFolder.url+b.newFileName,c=new RDFE.IO.File(a);c.isNew=!0,c.ioType=b.currentFolder.ioType,b.openFile(c)}},b.resetUI=function(){b.addingFile=!1,b.addingGraph=!1,b.addingLocation=!1}}]);