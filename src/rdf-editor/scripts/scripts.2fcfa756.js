"use strict";angular.module("myApp",["ngRoute","angularSpinner","myApp.welcome","myApp.editor","myApp.fileBrowser"]).config(["$routeProvider",function(e){e.otherwise({redirectTo:"/welcome"})}]).config(["$locationProvider",function(e){e.hashPrefix("")}]).run(["$rootScope",function(e){e.version="0.18_git4"}]).factory("Notification",function(){return $.notifyDefaults({allow_dismiss:!0,placement:{from:"top",align:"center"},template:'       <div data-notify="container" class="col-xs-11 col-sm-6 alert alert-{0}" role="alert">      \t<button type="button" aria-hidden="true" class="close" data-notify="dismiss">Ã—</button>      \t<span data-notify="icon"></span>      \t<span data-notify="title">{1}</span>      \t<span data-notify="message">{2}</span>      \t<div class="progress" data-notify="progressbar">      \t\t<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>      \t</div>      \t<a href="{3}" target="{4}" data-notify="url"></a>      </div>',z_index:1050}),{notify:function(e,t,o){"error"===e&&(e="danger");var n={type:e};"danger"===e&&(void 0===n.delay&&(n.delay=0),o||(o="fire")),o&&(n.icon="glyphicon glyphicon-"+o),$.notify(t,n)}}}).controller("AuthInfoDialogCtrl",["$scope","$uibModalInstance","url",function(e,t,o){e.username="",e.password="",e.url=o,e.ok=function(){t.close({username:e.username,password:e.password})},e.cancel=function(){t.dismiss()}}]).factory("DocumentTree",["$q","$uibModal","usSpinnerService","WebID","RDFEConfig",function(n,r,i,t,a){var c=[],s=[],u={};function o(){var e=[],t=$.jStorage.get("rdfe:recentDocuments");if(t)for(var o=0;o<t.length&&o<10;o++){var n=t[o];if(n){var r=new RDFE.IO.File(n.url);r.ioType=n.ioType,r.name=n.title||n.name,r.sparqlEndpoint=n.sparqlEndpoint,e.push(r)}}return e}function l(){var e=[],t=$.jStorage.get("rdfe:recentLocations");if(t)for(var o=0;o<t.length&&o<10;o++){var n,r=t[o];if(r)"webdav"===r.ioType?n=new RDFE.IO.WebDavFolder(r.url):"ldp"===r.ioType?n=new RDFE.IO.LDPFolder(r.url):"sparql"===r.ioType?((n=new RDFE.IO.Folder(r.url)).ioType=r.ioType,n.sparqlEndpoint=r.sparqlEndpoint):(n=new RDFE.IO.Folder(r.url),r.type&&(n.type=r.type),n.ioType=r.ioType),e.push(n)}return e}return{getLocations:function(){return c.length?n.when(c):((c=l()).unshift(((e=new RDFE.IO.Folder).name=e.path="Recent Documents",e.ioType="recent",e.comment="Documents you recently opened",e.children=o(),e)),n(function(o,e){a.getConfig().then(function(e){var t=e.options.storage||[];t.length?RDFE.Utils.resolveStorageLocations(t,function(e){$.merge(c,e),o(c)}):o(c)},function(){o(c)})}));var e},getStorages:function(){return s.length?n.when(s):n(function(r,e){t.getWebID().then(function(){return t.getProfile()}).then(function(e){for(var t=[],o=e.storage||[],n=0;n<o.length;n++)_.isEmpty(_.where(t,{uri:o[n].uri}))&&(t=t.concat(o[n]));t.length?RDFE.Utils.resolveStorageLocations(t,function(e){$.merge(s,e),r(s)}):r(s)})})},getAuthInfo:function(o,e){var t=u[o];return t||"/"===o[o.length-1]||(t=u[o.substring(0,o.lastIndexOf("/")+1)]),!1===e||!0!==e&&t?n.when(t):n(function(t,e){i.stop("editor-spinner"),r.open({templateUrl:"tmpl/authinfodlg.html",controller:"AuthInfoDialogCtrl",resolve:{url:function(){return o}}}).result.then(function(e){u[o]=e,t(e)},e)})},getRecentDocs:o,addRecentDoc:function(e,t){for(var o,n=!0,r=$.jStorage.get("rdfe:recentDocuments")||[],i=0;i<r.length;i++)if((o=r[i]).url===e&&o.ioType===t){n=!1,r.splice(i,1),r.unshift(o);break}n&&((o=new RDFE.IO.File(e)).ioType=t,r.unshift(o),10<r.length&&r.splice(r.length-1,1)),$.jStorage.set("rdfe:recentDocuments",r)},getRecentLocations:l,addRecentLocation:function(e){if("recent"!==e.ioType){for(var t,o=!0,n=$.jStorage.get("rdfe:recentLocations")||[],r=0;r<n.length;r++)if((t=n[r]).url===e.url&&t.ioType===e.ioType){o=!1,n.splice(r,1),n.unshift(t);break}o&&((t=new RDFE.IO.Folder(e.url)).type=e.type,t.ioType=e.ioType,t.sparqlEndpoint=e.sparqlEndpoint,n.unshift(t),10<n.length&&n.splice(n.length-1,1)),$.jStorage.set("rdfe:recentLocations",n)}},deleteRecentLocation:function(e,t){if("recent"!==t)for(var o=$.jStorage.get("rdfe:recentLocations")||[],n=0;n<o.length;n++)if(o[n].url===e&&o[n].ioType===t)return o.splice(n,1),void $.jStorage.set("rdfe:recentLocations",o)},selectRecentLocation:function(e,t){if("recent"!==t)for(var o,n=$.jStorage.get("rdfe:recentLocations")||[],r=0;r<n.length;r++)if((o=n[r]).url===e&&o.ioType===t)return n.splice(r,1),n.unshift(o),void $.jStorage.set("rdfe:recentLocations",n)}}}]).factory("RDFEConfig",["$q","Notification",function(e,r){var i=null;return{getConfig:function(){return i?e.when(i):e(function(t,e){var o=RDFE.Utils.uriParams(),n=o.config?o.config:"config.json";i=new RDFE.Config(n,function(e){t(e)},function(){r.notify("error","Failed to load Editor configuration")})})}}}]).factory("WebID",["$q","Notification",function(t,e){var c=null,s=null;return{getWebID:function(e){return e&&(c=e),c?t.when(c):t(function(o,e){if("chrome-extension:"==location.protocol){var n=null;chrome.management.getAll(function(e){for(var t=0;t<e.length;t++)if("opl_youid"===e[t].shortName){n=e[t].id;break}n&&chrome.runtime.sendMessage(n,{getWebId:!0},function(e){e&&(c=JSON.parse(e.webid).id),c&&o(c)})})}else window.addEventListener("message",function(e){var t;if(0===String(e.data).lastIndexOf("youid_rc:",0)){try{t=JSON.parse(e.data.substr(9))}catch(e){}t&&t.webid&&(c=t.webid,o(c))}},!1),window.postMessage('youid:{"getWebId": true}',"*")})},getProfile:function(){return c?s?t.when(s):t(function(i,a){$.get(c).done(function(o){if(s)return i(s);new rdfstore.create(function(e,r){var t=c.split("#")[0];r.registerDefaultProfileNamespaces(),r.load("text/n3",o,{documentIRI:t},function(e,t){e&&a("Failed to load the profile contents."),r.execute("select ?uri ?name ?img ?nick where {?x foaf:primaryTopic ?uri . optional { ?uri foaf:name ?name . } . optional { ?uri foaf:nick ?nick . } . optional { ?uri foaf:img ?img . } . }",function(e,t){e&&a("Failed to load the profile contents.");var n={uri:c};0!==t.length&&(t[0].name&&(n.name=t[0].name.value),t[0].img&&(n.image=t[0].img.value),t[0].nick&&(n.nick=t[0].nick.value)),r.execute("select ?storage where { <"+c+"> <http://www.w3.org/ns/pim/space#storage> ?storage . }",function(e,t){e&&a("Failed to load the profile contents.");for(var o=0;o<t.length;o++)t[o].storage&&(n.storage=n.storage||[]).push({uri:t[o].storage.value});r.execute("select ?namedGraph ?sparqlEndpoint where { <"+c+"> <http://www.openlinksw.com/schemas/cert#hasDBStorage> ?namedGraph . ?namedGraph <http://rdfs.org/ns/void#sparqlEndpoint> ?sparqlEndpoint . }",function(e,t){e&&a("Failed to load the profile contents.");for(var o=0;o<t.length;o++)t[o].namedGraph&&t[o].sparqlEndpoint&&(n.storage=n.storage||[]).push({uri:t[o].namedGraph.value,sparqlEndpoint:t[o].sparqlEndpoint.value});i(s=n)})})})})})}).fail(function(e,t,o){a("Failed to load the profile contents.")})}):t.reject()}}}]).controller("AuthHeaderCtrl",["$rootScope","$scope","WebID",function(r,i,a){i.signIn=function(e){var o=this,n=$("#signinModal");n.modal(),n.find(".ok").off(),n.find(".ok").on("click",function(e){e.preventDefault(),n.modal("hide");var t=n.find("#signinValue").val();t?a.getWebID(t).then(function(){return a.getProfile()}).then(function(e){i.profile=e,r.$broadcast("signIn")}):$(o).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Please set a WebID value!"})})},a.getWebID().then(function(){return a.getProfile()}).then(function(e){i.profile=e})}]),angular.module("myApp.welcome",["ngRoute"]).config(["$routeProvider",function(e){e.when("/welcome",{templateUrl:"views/welcome.html",controller:"WelcomeCtrl"})}]).config(["$locationProvider",function(e){e.hashPrefix("")}]).controller("WelcomeCtrl",[function(){}]),angular.module("myApp.editor",["ngRoute"]).config(["$routeProvider",function(e){e.when("/editor",{templateUrl:"views/editor.html",controller:"EditorCtrl",reloadOnSearch:!1})}]).config(["$locationProvider",function(e){e.hashPrefix("")}]).run(["$rootScope",function(e){e.eav2spo={statements:"triples",entities:"subjects",attributes:"predicates",values:"objects",triples:"triples",subjects:"subjects",predicates:"predicates",objects:"objects"},e.spo2eav={triples:"statements",subjects:"entities",predicates:"attributes",objects:"values",statements:"statements",entities:"entities",attributes:"attributes",values:"values"}}]).factory("RDFEditor",["$q","$rootScope","$location","$timeout","usSpinnerService","RDFEConfig","Notification","DocumentTree",function(e,s,u,l,n,t,r,i){function a(e){var t,o,n={"triple:subject":"statement:entity","triple:predicate":"statement:attribute","triple:object":"statement:value","spo:subject":"eav:attribute","spo:predicate":"eav:entity","spo:object":"eav:value","statement:entity":"triple:subject","statement:attribute":"triple:predicate","statement:value":"triple:object","eav:attribute":"spo:subject","eav:entity":"spo:predicate","eav:value":"spo:object"},r="",i=u.search();for(var a in i)o=i[t=a],"view"===a?o="EAV"===e?s.spo2eav[o]:s.eav2spo[o]:n[a]&&(t=n[a]),r+="&"+t+"="+o;return u.path()+"?"+r}return{getEditor:function(){return e(function(o,e){t.getConfig().then(function(e){var t={config:e,documentTree:i};new RDFE.Editor(t,function(c){$(c).on("rdf-editor-success",function(e,t){r.notify("success",t.message),setTimeout(function(){s.$apply(function(){})})}).on("rdf-editor-error",function(e,t){r.notify("error",t.message),setTimeout(function(){s.$apply(function(){})})}).on("rdf-editor-spinner-start",function(e,t){"editor-spinner"===t&&(c.spinner++,n.spin(t)),"export-spinner"===t&&n.spin(t)}).on("rdf-editor-spinner-done",function(e,t){"editor-spinner"===t&&(0<c.spinner&&c.spinner--,0===c.spinner&&n.stop("editor-spinner")),"export-spinner"===t&&n.stop(t)}).on("rdf-editor-page",function(e,t){var o=c.config.options.pageSettings,n=u.search();t.view&&n.view!==t.view&&(u.search("view",t.view),u.search("pageNo",null),u.search("sortName",null),u.search("sortOrder",null),o.pageNo=null,o.sortName=null,o.sortOrder=null),t.pageNo&&o.pageNo!==t.pageNo&&(u.search("pageNo",t.pageNo),o.pageNo=t.pageNo),t.pageSize&&o.pageSize!==t.pageSize&&(u.search("pageSize",t.pageSize),o.pageSize=t.pageSize),t.sortName&&o.sortName!==t.sortName&&(u.search("sortName",t.sortName),o.sortName=t.sortName),t.sortOrder&&o.sortOrder!==t.sortOrder&&(u.search("sortOrder",t.sortOrder),o.sortOrder=t.sortOrder);var r="";for(var i in n=u.search())r+="&"+i+"="+encodeURIComponent(n[i]);var a=u.path()+"?"+r;l(function(){u.url(a)})}).on("rdf-editor-namingSchema",function(e,t){var o=t.uiMode,n=t.viewMode,r=a(o);s.uiMode=o,s.viewMode="EAV"===o?s.spo2eav[n]:s.eav2spo[n],s.radioViewMode=s.viewMode,l(function(){u.url(r)})}),o(c)})})})},prepareUrl:a}}]).filter("namingSchemaLabel",function(){return function(e,t,o,n){if(t.editor)return t.editor.namingSchema()[e][!0===o?1:0]}}).filter("namingSchemaTitle",function(){return function(e,t){if(t.editor){var o=t.editor.namingSchema();switch(e){case"SPO":return"SPO"===o?"RDF Statement Graph Representation [Data]":"Entity Relationship Representation  [Data]";case"s":return"SPO"===o?"Items described by sentence Predicate & Object pairs in this document":"Items described by Attribute & Value pairs in this document";case"p":return"SPO"===o?"How Sentence Subjects and Objects are associated":"How Entities and their Attribute Values are associated";case"o":return"SPO"===o?"Objects & Data Types associated with a  Sentence Subject via its Predicate":"Values & Data Types associated with an Entity Attribute";default:return e}}}}).controller("EditorCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","usSpinnerService","RDFEditor","DocumentTree","Notification",function(d,p,g,f,m,e,t,v,h){function w(e,t,o,n){var r;v.getAuthInfo&&(r=function(e,t,o){v.getAuthInfo(e,!0).then(t,o)});var i=RDFE.IO.createIO(t,{sparqlEndpoint:o,gspEndpoint:$("#gspEndpoint").val(),ioTimeout:n,accept:e});return i.type=t,i.options.authFunction=r,i}function y(){var e,t=g["triple:subject"]||g["spo:subject"],o=g["triple:predicate"]||g["spo:predicate"],n=g["triple:object"]||g["spo:object"],r=g["statement:entity"]||g["eav:entity"],i=g["statement:attribute"]||g["eav:attribute"],a=g["statement:value"]||g["eav:value"],c=g.view,s=g.uiMode;if(t?e="triples"===c||"statements"===c?c:"subjects":o?e="triples"===c||"statements"===c?c:"predicates":n?e="triples"===c||"statements"===c?c:"objects":(t||o||n)&&(e="triples"),r?e="triples"===c||"statements"===c?c:"entities":i?e="triples"===c||"statements"===c?c:"attributes":a?e="triples"===c||"statements"===c?c:"values":r||i||a?e="statements":c&&(e=c),!s){if(-1<["triples","subjects","predicates","objects"].indexOf(e)?s="SPO":-1<["statements","entities","attributes","values"].indexOf(e)&&(s="EAV"),!s)s=$.jStorage.get("rdfe:settings",{}).namingSchema;s||(s=p.editor.config.options.namingSchema)}e||(e=p.editor.config.defaultView)||(e="statements");var u=p.editor.config.options.pageSettings;if(g.pageNo){var l=parseInt(g.pageNo);isNaN(l)||(u.pageNo=l)}if(g.pageSize){l=parseInt(g.pageSize);isNaN(l)||(u.pageSize=l)}g.sortName&&(u.sortName=g.sortName),g.sortOrder&&(u.sortOrder=g.sortOrder),p.editor.config.options.namingSchema=s,d.uiMode=s,d.viewMode="EAV"===s?p.spo2eav[e]:p.eav2spo[e],d.radioViewMode=p.viewMode,p.editor.toggleView(p.viewMode,p.uiMode)}function b(){var e=g.newStatement,t=g["triple:subject"]||g["spo:subject"],o=g["triple:predicate"]||g["spo:predicate"],n=g["triple:object"]||g["spo:object"],r=g["statement:entity"]||g["eav:entity"],i=g["statement:attribute"]||g["eav:attribute"],a=g["statement:value"]||g["eav:value"],c=p.viewMode;!t&&!r||c&&"subjects"!==c&&"entities"!==c?!o&&!i||c&&"predicates"!==c&&"attributes"!==c?!n&&!a||c&&"objects"!==c&&"values"!==c?!(t||o||n||r||i||a||e)||c&&"statements"!==c&&"triples"!==c||p.editor.editTriple(t||r,o||i,n||a,e):p.editor.editObject(n||a,e):(o=p.editor.ontologyManager.uriDenormalize(o||i),p.editor.editPredicate(o,e)):(t=p.editor.ontologyManager.uriDenormalize(t||r),p.editor.editSubject(t,e))}function F(){var e=t.prepareUrl(p.uiMode);m(function(){f.url(e)})}function o(){var n=g.uri,e=g.data,r=g.accept;"turtle"===r?r="text/turtle":"jsonld"===r&&(r="application/ld+json");var i=g.ioType||"http",a=g.ioTimeout||p.editor.config.options.ioTimeout,c=g.sparqlEndpoint,s=g.newDocument;if(p.doc=p.editor.doc,p.editor.render($("#contents")),"true"===g.saveDocument){var t=w(r,i,c,a);p.saveDocumentInternal(n,t),p.editor.updateView(),f.search("saveDocument",null),F()}else if("true"===s||"false"===s&&!n&&!e)p.doc.new(function(){y(),p.editor.saveSubject=null,p.editor.updateView(),m(function(){"false"!==s&&n&&(p.doc.url=n,p.doc.io=w(r,i,c,a))}),b()},function(){h.notity("error","Failed to clear Document for unknown reasons.")});else if(n||e){var o=$.jStorage.get("rdfe:savedDocument",null);if(o)p.doc.store.clear(p.doc.graph,function(){p.doc.store.loadTurtle(o,p.doc.graph,p.doc.graph,null,function(e){e||(y(),p.editor.saveSubject=null,p.editor.updateView(),m(function(){p.doc.dirty=!0,"false"===s?p.doc.url=null:(p.doc.url=n,p.doc.io=w(r,i,c,a))}),b())})});else{p.doc.url=null;var u=function(){if(n)try{var t=w(r,i,c,a),o=function(i,t){var a=function(e){y(),p.editor.updateView(),p.editor.toggleSpinner(!1),p.$apply(function(){e||p.newDocument(),e&&"false"!==s?(p.doc.url=n,p.doc.io=t):p.doc.url=null}),b(),p.editor.docChanged()};p.editor.toggleSpinner(!0),p.doc.load(i,t,function(){a(!0)},function(e,t,o,n){var r=e&&e.message?e.httpCode+" - "+e.message:"Failed to load document";h.notify("error",r+": "+i),a(!1)})};if(v.getAuthInfo){var e=n;"sparql"===t.type&&t.options&&t.options.sparqlEndpoint&&(e=t.options.sparqlEndpoint),v.getAuthInfo(e,!1).then(function(e){e&&(t.options.username=e.username,t.options.password=e.password),o(n,t)})}else o(n,t)}catch(e){h.notify("error",e)}};if(e){var l=function(e){y(),p.editor.updateView(),p.editor.docChanged(),h.notify("success","Successfully imported RDF data."),u()},d=function(e){h.notify("error","Failed to import RDF data. <br /> "+e.message),u()};p.doc.store.clear(p.doc.graph,function(){p.doc.import(e,l,d)})}else p.doc.store.clear(p.doc.graph,function(){u()})}}else y(),b();g["error.msg"]&&h.notify("error",g["error.msg"]),$.jStorage.deleteKey("rdfe:savedDocument"),p.ontologyView||(p.ontologyView=new RDFE.OntologyView(p.editor),p.ontologyView.render($("#container-ontologies")),$("#ontology-add").click(function(e){e.stopPropagation(),p.ontologyView.add()})),p.$watch(function(e){return e.radioViewMode},function(e){if(e){var t=p.viewMode;p.viewMode="EAV"===p.uiMode?p.spo2eav[e]:p.eav2spo[e],p.radioViewMode=p.eav2spo[p.radioViewMode],t!==p.viewMode&&p.editor.toggleView(p.viewMode,p.uiMode)}})}p.newDocument=function(){p.doc.new(function(){y(),p.editor.saveSubject=null,p.editor.updateView(),b(),f.search("uri",null),f.search("data",null),f.search("accept",null),f.search("ioType",null),f.search("ioTimeout",null),f.search("sparqlEndpoint",null),F()},function(){h.notity("error","Failed to clear Document for unknown reasons.")})},p.openDocument=function(){function t(){f.url("/browser")}p.doc.dirty?bootbox.confirm("Your document has unsaved changes. Do you really want to open another document?",function(e){e&&p.$apply(t)}):t()},p.saveDocumentInternal=function(r,i){if(!r)return p.saveDocumentAs();var e=function(e,t,o){var n=function(e,t){p.editor.toggleSpinner(!0),p.doc.save(e,t,function(){F(),p.editor.toggleSpinner(!1),h.notify("success","Successfully saved document to <code>"+e+"</code>")},function(e){F(),p.editor.toggleSpinner(!1),h.notify("error",e?e.message||e:"An unknown error occured")})};if("success"===t){if((!p.doc.url||p.doc.io&&p.doc.io!==i)&&e.length)return void bootbox.confirm("Target document exists. Do you really want to overwrite it?",function(e){e&&n(r,i)});if(p.doc.srcParams&&(p.doc.srcParams.length!==e.length||p.doc.srcParams.md5!==$.md5(e)))return void bootbox.confirm("Target document was updated after last open/save. Do you really want to overwrite it?",function(e){e&&n(r,i)})}n(r,i)};i.retrieve(r,{success:e,error:e})},p.saveDocument=function(){p.saveDocumentInternal(p.doc.url,p.doc.io)},p.saveDocumentAs=function(){f.url("/browser?mode=save")},p.downloadDocumentAs=function(){p.doc.store.graph(p.doc.graph,function(e,t){!function(e,t){var o=document.createElement("a");if(o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),o.setAttribute("download",e),document.createEvent){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),o.dispatchEvent(n)}else o.click()}("document.ttl",t.toNTBeatify(p.doc.store.rdf.prefixes))})},p.settings=function(){p.editor.settingsForm()},p.signDocument=function(){p.editor.signDocumentForm()},p.localInto=function(){p.editor.localForm()},p.remoteInto=function(){p.editor.remoteForm()},p.importInto=function(){p.editor.importForm()},p.exportInto=function(){p.editor.exportForm()},p.undo=function(){p.editor.undo()},p.redo=function(){p.editor.redo()},p.unsignDocument=function(){p.editor.unsignDocumentForm()},p.closeDocument=function(){function t(){f.url("/")}p.doc.dirty?bootbox.confirm("Your document has unsaved changes. Do you really want to close the document?",function(e){e&&p.$apply(t)}):t()},p.toggleOntologyView=function(){var e=$("#panel-ontologies").find(".panel-heading");e.find(".up").toggle(),e.find(".down").toggle(),$("#container-ontologies").toggle(),$("#ontology-add").toggle()},p.editor?o():t.getEditor().then(function(e){d.editor=e,function(){var o={params:[],paramValues:[],paramMixed:[]},e=function(e,t){return e&&o.params.push(t),e},t=function(e,t){return e&&o.paramValues.push(t),e},c=function(e,t){return e&&o.paramValues.push(t),e},s={uiMode:{defaultValue:function(){var e;for(var t in g)if(g.hasOwnProperty(t)){var o=s[t];if(o){var n=o.paramReference;if(n&&"uiMode"===n){if("string"==typeof o.value){if(c(e&&e!==o.value,t))return;e=o.value}if("object"==typeof o.value)for(var r in o.value)for(var i=o.value[r],a=0;a<i.length;a++)if(g[t]===i[a]){if(c(e&&e!==r,t))return;e=r}}}}return e||"EAV"},value:["EAV","SPO"]},view:{paramReference:"uiMode",value:{EAV:["statements","entities","attributes","values"],SPO:["triples","subjects","predicates","objects"]}},"triple:subject":{paramReference:"uiMode",value:"SPO"},"spo:subject":{paramReference:"uiMode",value:"SPO"},"triple:predicate":{paramReference:"uiMode",value:"SPO"},"spo:predicate":{paramReference:"uiMode",value:"SPO"},"triple:object":{paramReference:"uiMode",value:"SPO"},"spo:object":{paramReference:"uiMode",value:"SPO"},"statement:entity":{paramReference:"uiMode",value:"EAV"},"eav:entity":{paramReference:"uiMode",value:"EAV"},"statement:attribute":{paramReference:"uiMode",value:"EAV"},"eav:attribute":{paramReference:"uiMode",value:"EAV"},"statement:value":{paramReference:"uiMode",value:"EAV"},"eav:value":{paramReference:"uiMode",value:"EAV"},pageNo:{},pageSize:{},sortName:{},sortOrder:{},uri:{},data:{},accept:["text/turtle","application/ld+json"],ioType:["http","ldp","dav","webdav","sparql"],ioTimeout:{},sparqlEndpoint:{},newDocument:["true","false"],saveDocument:["true","false"],newStatement:["true","false"],"error.msg":{}};for(var n in g)if(g.hasOwnProperty(n)){var r=g[n],i=s[n];if(!e(void 0===i,n))if(i instanceof Array){for(var a=0;a<i.length&&r!==i[a];a++);if(t(a===i.length,n))continue}else if("object"==typeof i){if($.isEmptyObject(i))continue;var u=i.paramReference;if(u){var l=g[u];if(!l&&!(l=s[u].defaultValue()))break;if("string"==typeof i.value){e(i.value!==l,n);continue}if("object"==typeof i.value){var d=i.value[l];if(!d)continue;for(a=0;a<d.length&&r!==d[a];a++);if(t(a===d.length,n))continue}}}}if(o.params.length||o.paramValues.length||o.paramMixed.length){var p,f="Params validation errors:";if(o.params.length)for(f+=" <br/>&nbsp;&nbsp;Unsupported or mixed parameters: ",p="",a=0;a<o.params.length;a++)f+=p+o.params[a],p=", ";if(o.paramValues.length)for(f+=" <br/>&nbsp;&nbsp;Bad values for parameters: ",p="",a=0;a<o.paramValues.length;a++)f+=p+"["+o.paramValues[a]+"="+g[o.paramValues[a]]+"]",p=", ";if(o.paramMixed.length)for(f+=" <br/>&nbsp;&nbsp;Mixed parameters: ",p="",a=0;a<o.paramMixed.length;a++)f+=p+o.paramMixed[a],p=", ";h.notify("error",f)}}(),o()})}]),angular.module("myApp.fileBrowser",["ngRoute","ui.bootstrap"]).config(["$routeProvider",function(e){e.when("/browser",{templateUrl:"views/browser.html",controller:"FileBrowserCtrl"})}]).config(["$locationProvider",function(e){e.hashPrefix("")}]).filter("ioTypeLabel",function(){return function(e){switch(e){case"webdav":return"WebDAV Folder";case"ldp":return"LDP Location";case"sparql":return"SPARQL Endpoint";default:return e}}}).filter("httpStatusLabel",function(){return function(e){switch(e){case 0:return"Connection Refused";case 404:return"Not Found";case 401:return"Authorization Required";case 403:return"Access Denied";default:return e}}}).controller("FileBrowserCtrl",["$rootScope","$scope","$routeParams","$timeout","$location","usSpinnerService","DocumentTree","Notification",function(n,r,e,i,o,a,c,s){"save"===e.mode?(r.mode=e.mode,r.title="Save Your Document"):(r.mode="open",r.title="Open a Document"),r.getLocations=function(){c.getLocations().then(function(e){r.locations=e;var t=0;if(n.currentLocation)for(var o=0;o<r.locations.length;o++)if(r.locations[o].url===n.currentLocation.url){t=o;break}r.updateCurrentLocation(r.locations[t]),r.updateCurrentFolder(r.currentLocation),a.stop("location-spinner")})},r.getStorages=function(){c.getStorages().then(function(e){var t,o,n=[];for(t=0;t<e.length;t++){for(o=0;o<r.locations.length&&r.locations[o].url!==e[t].url;o++);o===r.locations.length&&n.push(e[t])}r.locations=r.locations.concat(n)})},r.setCurrentLocation=function(o){if(r.resetUI(),o!==r.currentLocation){var e;if(o.httpStatus)c.getAuthInfo&&(e=function(e,t,o){c.getAuthInfo(e,!0).then(t,o)}),RDFE.IO.openUrl(o.url,{authFunction:e,checkForFiles:!0},function(e){r.$apply(function(){r.locations[r.locations.indexOf(o)]=e,r.updateCurrentLocation(e),r.updateCurrentFolder(e)})},function(e,t){o.httpStatus=t,o.errorMessage=e,i(function(){r.updateCurrentLocation(o),r.updateCurrentFolder(o)})});else r.updateCurrentLocation(o),r.updateCurrentFolder(o);c.selectRecentLocation(o.url,o.ioType)}},r.updateCurrentLocation=function(e){r.currentLocation=e,n.currentLocation=e,r.orderProp="Recent Documents"===e.name?null:"name"},r.updateCurrentFolder=function(e){r.currentFolder=e,r.currentFolder&&r.currentFolder.dirty&&r.refresh()},r.changeDir=function(e){var n=function(){a.stop("refresh-spinner"),r.currentFolder=e};r.resetUI(),a.spin("refresh-spinner"),e.dirty?(e.httpStatus=void 0,e.errorMessage=null,e.update(function(){r.$apply(function(){n()})},function(e,t,o){e.httpStatus=o,e.errorMessage=t,r.$apply(function(){n()})})):n()},r.folderUp=function(){r.currentFolder.parent&&(r.updateCurrentFolder(r.currentFolder.parent),r.resetUI())},r.refresh=function(){r.resetUI(),"Recent Documents"===r.currentLocation.name?(r.currentLocation.children=c.getRecentDocs(),r.currentFolder=r.currentFolder):(a.spin("refresh-spinner"),r.currentFolder.httpStatus=void 0,r.currentFolder.errorMessage=null,r.currentFolder.update(!0,function(){r.$evalAsync(function(){r.currentFolder=r.currentFolder,i(function(){a.stop("refresh-spinner")},1e3)})},function(e,t,o){a.stop("refresh-spinner"),e.httpStatus=o,e.errorMessage=t,r.$apply()}))},r.openFile=function(e){var t="/editor?uri="+encodeURIComponent(e.url)+"&ioType="+encodeURIComponent(e.ioType);e.sparqlEndpoint&&(t+="&sparqlEndpoint="+encodeURIComponent(e.sparqlEndpoint)),"save"===r.mode?t+="&saveDocument=true":e.isNew&&(t+="&newDocument=true"),o.url(t)},r.open=function(e){"file"===e.type?r.openFile(e):r.changeDir(e)},r.addLocation=function(e){for(var t=0;t<r.locations.length;t++)if(r.locations[t].url===e.url)return void(r.locations[t]=e);r.locations.push(e),c.addRecentLocation(e)},r.removeLocation=function(e){for(var t=0;t<r.locations.length;t++)if(r.locations[t].url===e.url)return r.locations.splice(t,1),e===r.currentLocation&&r.setCurrentLocation(r.locations[0]),void c.deleteRecentLocation(e.url,e.ioType)},r.addingLocation=!1,r.showNewLocationUi=function(){r.addingLocation=!0,r.newLocationUrl=""},r.addNewLocation=function(){if(r.newLocationUrl&&r.newLocationUrl.length){var e=RDFE.Utils.splitUrl(r.newLocationUrl);if("http:"===e.protocol||"https:"===e.protocol)if(r.newLocationIsSparql){var t=new RDFE.IO.Folder(r.newLocationUrl);t.ioType="sparql",t.sparqlEndpoint=r.newLocationUrl,r.addLocation(t),r.updateCurrentLocation(t),r.currentFolder=t,r.addingLocation=!1}else{var o;a.spin("location-spinner"),c.getAuthInfo&&(o=function(e,t,o){c.getAuthInfo(e,!0).then(t,o)}),RDFE.IO.openUrl(r.newLocationUrl,{authFunction:o,checkForFiles:!0},function(e){r.$apply(function(){r.addingLocation=!1,r.addLocation(e),r.updateCurrentLocation(e),r.currentFolder=e}),a.stop("location-spinner")},function(e,t){s.notify("error",e),a.stop("location-spinner")})}else s.notify("error","Only HTTP and HTTPS protocols are supported")}},r.locations=[],r.getLocations(),r.getStorages(),r.$on("signIn",function(e,t){r.getStorages()}),r.addingGraph=!1,r.showNewGraphUi=function(){r.addingGraph=!0,r.newGraphUri=""},r.addNewGraph=function(){if(r.newGraphUri&&r.newGraphUri.length){var e=new RDFE.IO.File(r.newGraphUri);e.parent=r.currentFolder,e.sparqlEndpoint=r.currentFolder.sparqlEndpoint,e.ioType="sparql",r.currentFolder.children.push(e),r.openFile(e)}},r.addingFile=!1,r.newFileName="myDocument.ttl",r.showNewFileUi=function(){r.addingFile=!0,r.newFileName="myDocument.ttl"},r.addNewFile=function(){if(r.newFileName&&r.newFileName.length){r.currentFolder.dirty=!0;var e=r.currentFolder.url+r.newFileName,t=new RDFE.IO.File(e);t.isNew=!0,t.ioType=r.currentFolder.ioType,r.openFile(t)}},r.resetUI=function(){r.addingFile=!1,r.addingGraph=!1,r.addingLocation=!1}}]);