!function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}a.md5=function(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}}("function"==typeof jQuery?jQuery:this),function(){var a=this,b=a._,c=Array.prototype,d=Object.prototype,e=Function.prototype,f=c.push,g=c.slice,h=c.concat,i=d.toString,j=d.hasOwnProperty,k=Array.isArray,l=Object.keys,m=e.bind,n=function(a){return a instanceof n?a:this instanceof n?void(this._wrapped=a):new n(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports._=n):a._=n,n.VERSION="1.7.0";var o=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}};n.iteratee=function(a,b,c){return null==a?n.identity:n.isFunction(a)?o(a,b,c):n.isObject(a)?n.matches(a):n.property(a)},n.each=n.forEach=function(a,b,c){if(null==a)return a;b=o(b,c);var d,e=a.length;if(e===+e)for(d=0;e>d;d++)b(a[d],d,a);else{var f=n.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},n.map=n.collect=function(a,b,c){if(null==a)return[];b=n.iteratee(b,c);for(var d,e=a.length!==+a.length&&n.keys(a),f=(e||a).length,g=Array(f),h=0;f>h;h++)d=e?e[h]:h,g[h]=b(a[d],d,a);return g};var p="Reduce of empty array with no initial value";n.reduce=n.foldl=n.inject=function(a,b,c,d){null==a&&(a=[]),b=o(b,d,4);var e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length,h=0;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[h++]:h++]}for(;g>h;h++)e=f?f[h]:h,c=b(c,a[e],e,a);return c},n.reduceRight=n.foldr=function(a,b,c,d){null==a&&(a=[]),b=o(b,d,4);var e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[--g]:--g]}for(;g--;)e=f?f[g]:g,c=b(c,a[e],e,a);return c},n.find=n.detect=function(a,b,c){var d;return b=n.iteratee(b,c),n.some(a,function(a,c,e){return b(a,c,e)?(d=a,!0):void 0}),d},n.filter=n.select=function(a,b,c){var d=[];return null==a?d:(b=n.iteratee(b,c),n.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d)},n.reject=function(a,b,c){return n.filter(a,n.negate(n.iteratee(b)),c)},n.every=n.all=function(a,b,c){if(null==a)return!0;b=n.iteratee(b,c);var d,e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,!b(a[e],e,a))return!1;return!0},n.some=n.any=function(a,b,c){if(null==a)return!1;b=n.iteratee(b,c);var d,e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,b(a[e],e,a))return!0;return!1},n.contains=n.include=function(a,b){return null==a?!1:(a.length!==+a.length&&(a=n.values(a)),n.indexOf(a,b)>=0)},n.invoke=function(a,b){var c=g.call(arguments,2),d=n.isFunction(b);return n.map(a,function(a){return(d?b:a[b]).apply(a,c)})},n.pluck=function(a,b){return n.map(a,n.property(b))},n.where=function(a,b){return n.filter(a,n.matches(b))},n.findWhere=function(a,b){return n.find(a,n.matches(b))},n.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=a.length===+a.length?a:n.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=n.iteratee(b,c),n.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},n.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=a.length===+a.length?a:n.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=n.iteratee(b,c),n.each(a,function(a,c,d){e=b(a,c,d),(g>e||1/0===e&&1/0===f)&&(f=a,g=e)});return f},n.shuffle=function(a){for(var b,c=a&&a.length===+a.length?a:n.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=n.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},n.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=n.values(a)),a[n.random(a.length-1)]):n.shuffle(a).slice(0,Math.max(0,b))},n.sortBy=function(a,b,c){return b=n.iteratee(b,c),n.pluck(n.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var q=function(a){return function(b,c,d){var e={};return c=n.iteratee(c,d),n.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};n.groupBy=q(function(a,b,c){n.has(a,c)?a[c].push(b):a[c]=[b]}),n.indexBy=q(function(a,b,c){a[c]=b}),n.countBy=q(function(a,b,c){n.has(a,c)?a[c]++:a[c]=1}),n.sortedIndex=function(a,b,c,d){c=n.iteratee(c,d,1);for(var e=c(b),f=0,g=a.length;g>f;){var h=f+g>>>1;c(a[h])<e?f=h+1:g=h}return f},n.toArray=function(a){return a?n.isArray(a)?g.call(a):a.length===+a.length?n.map(a,n.identity):n.values(a):[]},n.size=function(a){return null==a?0:a.length===+a.length?a.length:n.keys(a).length},n.partition=function(a,b,c){b=n.iteratee(b,c);var d=[],e=[];return n.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},n.first=n.head=n.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:g.call(a,0,b)},n.initial=function(a,b,c){return g.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},n.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:g.call(a,Math.max(a.length-b,0))},n.rest=n.tail=n.drop=function(a,b,c){return g.call(a,null==b||c?1:b)},n.compact=function(a){return n.filter(a,n.identity)};var r=function(a,b,c,d){if(b&&n.every(a,n.isArray))return h.apply(d,a);for(var e=0,g=a.length;g>e;e++){var i=a[e];n.isArray(i)||n.isArguments(i)?b?f.apply(d,i):r(i,b,c,d):c||d.push(i)}return d};n.flatten=function(a,b){return r(a,b,!1,[])},n.without=function(a){return n.difference(a,g.call(arguments,1))},n.uniq=n.unique=function(a,b,c,d){if(null==a)return[];n.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=n.iteratee(c,d));for(var e=[],f=[],g=0,h=a.length;h>g;g++){var i=a[g];if(b)g&&f===i||e.push(i),f=i;else if(c){var j=c(i,g,a);n.indexOf(f,j)<0&&(f.push(j),e.push(i))}else n.indexOf(e,i)<0&&e.push(i)}return e},n.union=function(){return n.uniq(r(arguments,!0,!0,[]))},n.intersection=function(a){if(null==a)return[];for(var b=[],c=arguments.length,d=0,e=a.length;e>d;d++){var f=a[d];if(!n.contains(b,f)){for(var g=1;c>g&&n.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},n.difference=function(a){var b=r(g.call(arguments,1),!0,!0,[]);return n.filter(a,function(a){return!n.contains(b,a)})},n.zip=function(a){if(null==a)return[];for(var b=n.max(arguments,"length").length,c=Array(b),d=0;b>d;d++)c[d]=n.pluck(arguments,d);return c},n.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},n.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=n.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}for(;e>d;d++)if(a[d]===b)return d;return-1},n.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=a.length;for("number"==typeof c&&(d=0>c?d+c+1:Math.min(d,c+1));--d>=0;)if(a[d]===b)return d;return-1},n.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var s=function(){};n.bind=function(a,b){var c,d;if(m&&a.bind===m)return m.apply(a,g.call(arguments,1));if(!n.isFunction(a))throw new TypeError("Bind must be called on a function");return c=g.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(g.call(arguments)));s.prototype=a.prototype;var e=new s;s.prototype=null;var f=a.apply(e,c.concat(g.call(arguments)));return n.isObject(f)?f:e}},n.partial=function(a){var b=g.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===n&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},n.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=n.bind(a[c],a);return a},n.memoize=function(a,b){var c=function(d){var e=c.cache,f=b?b.apply(this,arguments):d;return n.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},n.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},n.defer=function(a){return n.delay.apply(n,[a,1].concat(g.call(arguments,1)))},n.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:n.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=n.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},n.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=n.now()-g;b>j&&j>0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=n.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},n.wrap=function(a,b){return n.partial(b,a)},n.negate=function(a){return function(){return!a.apply(this,arguments)}},n.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},n.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},n.before=function(a,b){var c;return function(){return--a>0?c=b.apply(this,arguments):b=null,c}},n.once=n.partial(n.before,2),n.keys=function(a){if(!n.isObject(a))return[];if(l)return l(a);var b=[];for(var c in a)n.has(a,c)&&b.push(c);return b},n.values=function(a){for(var b=n.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},n.pairs=function(a){for(var b=n.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},n.invert=function(a){for(var b={},c=n.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},n.functions=n.methods=function(a){var b=[];for(var c in a)n.isFunction(a[c])&&b.push(c);return b.sort()},n.extend=function(a){if(!n.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)j.call(b,c)&&(a[c]=b[c])}return a},n.pick=function(a,b,c){var d,e={};if(null==a)return e;if(n.isFunction(b)){b=o(b,c);for(d in a){var f=a[d];b(f,d,a)&&(e[d]=f)}}else{var i=h.apply([],g.call(arguments,1));a=new Object(a);for(var j=0,k=i.length;k>j;j++)d=i[j],d in a&&(e[d]=a[d])}return e},n.omit=function(a,b,c){if(n.isFunction(b))b=n.negate(b);else{var d=n.map(h.apply([],g.call(arguments,1)),String);b=function(a,b){return!n.contains(d,b)}}return n.pick(a,b,c)},n.defaults=function(a){if(!n.isObject(a))return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)void 0===a[e]&&(a[e]=d[e])}return a},n.clone=function(a){return n.isObject(a)?n.isArray(a)?a.slice():n.extend({},a):a},n.tap=function(a,b){return b(a),a};var t=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof n&&(a=a._wrapped),b instanceof n&&(b=b._wrapped);var e=i.call(a);if(e!==i.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]===a)return d[f]===b;var g=a.constructor,h=b.constructor;if(g!==h&&"constructor"in a&&"constructor"in b&&!(n.isFunction(g)&&g instanceof g&&n.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var j,k;if("[object Array]"===e){if(j=a.length,k=j===b.length)for(;j--&&(k=t(a[j],b[j],c,d)););}else{var l,m=n.keys(a);if(j=m.length,k=n.keys(b).length===j)for(;j--&&(l=m[j],k=n.has(b,l)&&t(a[l],b[l],c,d)););}return c.pop(),d.pop(),k};n.isEqual=function(a,b){return t(a,b,[],[])},n.isEmpty=function(a){if(null==a)return!0;if(n.isArray(a)||n.isString(a)||n.isArguments(a))return 0===a.length;for(var b in a)if(n.has(a,b))return!1;return!0},n.isElement=function(a){return!(!a||1!==a.nodeType)},n.isArray=k||function(a){return"[object Array]"===i.call(a)},n.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},n.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){n["is"+a]=function(b){return i.call(b)==="[object "+a+"]"}}),n.isArguments(arguments)||(n.isArguments=function(a){return n.has(a,"callee")}),"function"!=typeof/./&&(n.isFunction=function(a){return"function"==typeof a||!1}),n.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},n.isNaN=function(a){return n.isNumber(a)&&a!==+a},n.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===i.call(a)},n.isNull=function(a){return null===a},n.isUndefined=function(a){return void 0===a},n.has=function(a,b){return null!=a&&j.call(a,b)},n.noConflict=function(){return a._=b,this},n.identity=function(a){return a},n.constant=function(a){return function(){return a}},n.noop=function(){},n.property=function(a){return function(b){return b[a]}},n.matches=function(a){var b=n.pairs(a),c=b.length;return function(a){if(null==a)return!c;a=new Object(a);for(var d=0;c>d;d++){var e=b[d],f=e[0];if(e[1]!==a[f]||!(f in a))return!1}return!0}},n.times=function(a,b,c){var d=Array(Math.max(0,a));b=o(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},n.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},n.now=Date.now||function(){return(new Date).getTime()};var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},v=n.invert(u),w=function(a){var b=function(b){return a[b]},c="(?:"+n.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};n.escape=w(u),n.unescape=w(v),n.result=function(a,b){if(null==a)return void 0;var c=a[b];return n.isFunction(c)?a[b]():c};var x=0;n.uniqueId=function(a){var b=++x+"";return a?a+b:b},n.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var y=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},A=/\\|'|\r|\n|\u2028|\u2029/g,B=function(a){return"\\"+z[a]};n.template=function(a,b,c){!b&&c&&(b=c),b=n.defaults({},b,n.templateSettings);var d=RegExp([(b.escape||y).source,(b.interpolate||y).source,(b.evaluate||y).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(A,B),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,n)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},n.chain=function(a){var b=n(a);return b._chain=!0,b};var C=function(a){return this._chain?n(a).chain():a};n.mixin=function(a){n.each(n.functions(a),function(b){var c=n[b]=a[b];n.prototype[b]=function(){var a=[this._wrapped];return f.apply(a,arguments),C.call(this,c.apply(n,a))}})},n.mixin(n),n.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=c[a];n.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],C.call(this,c)}}),n.each(["concat","join","slice"],function(a){var b=c[a];n.prototype[a]=function(){return C.call(this,b.apply(this._wrapped,arguments))}}),n.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return n})}.call(this),function(a,b){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){var e=a.Backbone,f=[],g=(f.push,f.slice);f.splice;b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){var e,f,g,h,i,k,l,m;if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(h=a?[a]:c.keys(this._events),i=0,k=h.length;k>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||d)for(l=0,m=g.length;m>l;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=c.uniqueId("l"));return f[g]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},L(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;L(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;f>e;e++)h=a[e]=this.get(a[e]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h,b));return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:c.clone(a);var e,f,g,h,i,j,k,l=b.at,n=this.model,o=this.comparator&&null==l&&b.sort!==!1,q=c.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!o&&u&&w?[]:!1;for(e=0,f=a.length;f>e;e++){if(i=a[e]||{},g=i instanceof m?h=i:i[n.prototype.idAttribute||"id"],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),o&&!k&&j.hasChanged(q)&&(k=!0)),a[e]=j;else if(u){if(h=a[e]=this._prepareModel(i,b),!h)continue;r.push(h),this._addReference(h,b)}h=j||h,!x||!h.isNew()&&t[h.id]||x.push(h),t[h.id]=!0}if(w){for(e=0,f=this.length;f>e;++e)t[(h=this.models[e]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(o&&(k=!0),this.length+=r.length,null!=l)for(e=0,f=r.length;f>e;e++)this.models.splice(l+e,0,r[e]);else{x&&(this.models.length=0);var y=x||r;for(e=0,f=y.length;f>e;e++)this.models.push(y[e])}if(k&&this.sort({silent:!0}),!b.silent){for(e=0,f=r.length;f>e;e++)(h=r[e]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a,b){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];c.each(r,function(a){o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,v)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(u),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===g?this.$el.on(f,d):this.$el.on(f,g,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{
var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className"));var d=b.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(d,!1)}}}),b.sync=function(a,d,e){var f=x[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||K()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&w&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,i,e),i};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var y=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,B=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(y.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g),f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(C,"\\$&").replace(z,"(?:$1)?").replace(A,function(a,b){return b?a:"([^/?]+)"}).replace(B,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var D=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/,I=/#.*$/;D.started=!1,c.extend(D.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(H,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(E,"")},start:function(a){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var d=this.getFragment(),e=document.documentMode,f=G.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e);if(this.root=("/"+this.root+"/").replace(F,"/"),f&&this._wantsHashChange){var g=b.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=g.hide().appendTo("body")[0].contentWindow,this.navigate(d)}this._hasPushState?b.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?b.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d;var h=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&h.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!D.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(I,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new D;var J=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=y.extend=t.extend=D.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),!function(a){!function(){function b(a,b){for(var d in f)b?a.prototype[d]=c(f[d]):a[d]=f[d];return a}function c(a){return function(b){return a(this,b)}}var d="http://www.w3.org/2001/XMLSchema#string",e="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",f={isIRI:function(a){if(!a)return a;var b=a[0];return'"'!==b&&"_"!==b},isLiteral:function(a){return a&&'"'===a[0]},isBlank:function(a){return a&&"_:"===a.substr(0,2)},getLiteralValue:function(a){var b=/^"([^]*)"/.exec(a);if(!b)throw new Error(a+" is not a literal");return b[1]},getLiteralType:function(a){var b=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(a);if(!b)throw new Error(a+" is not a literal");return b[1]||(b[2]?e:d)},getLiteralLanguage:function(a){var b=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(a);if(!b)throw new Error(a+" is not a literal");return b[1]?b[1].toLowerCase():""},isPrefixedName:function(a){return a&&/^[^:\/"']*:[^:\/"']+$/.test(a)},expandPrefixedName:function(a,b){var c=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]/.exec(a);if(!c)return a;var d=c[1],e=b[d],f=c.index;if(void 0===e)throw new Error("Unknown prefix: "+d);return 0===f?e+a.substr(d.length+1):a.substr(0,f+3)+e+a.substr(f+d.length+4)}};a.Util=b(b)}(),function(){function b(a){if(!(this instanceof b))return new b(a);if(a&&a.lineMode){this._tripleQuotedString=this._number=this._boolean=/$0^/;var c=this;this._tokenize=this.tokenize,this.tokenize=function(a,b){this._tokenize(a,function(a,d){!a&&/IRI|prefixed|literal|langcode|type|\.|eof/.test(d.type)?b&&b(a,d):b&&b(a||c._syntaxError(d.type,b=null))})}}}var c=String.fromCharCode,d="function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},e=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,f={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},g=/[\x00-\x20<>\\"\{\}\|\^\`]/;b.prototype={_iri:/^<((?:[^>\\]|\\[uU])+)>/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>/,_unescapedString:/^"[^"\\]+"(?=[^"\\])/,_singleQuotedString:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=\.?[,;\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=[.,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;:\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<:])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(a,b){function c(b){a(b._syntaxError(/^\S*/.exec(d)[0]))}for(var d=this._input;;){for(var e;e=this._newline.exec(d);)d=d.substr(e[0].length,d.length),this._line++;if((e=this._whitespace.exec(d))&&(d=d.substr(e[0].length,d.length)),this._endOfFile.test(d))return b&&a(d=null,{line:this._line,type:"eof",value:"",prefix:""}),this._input=d;var f,h=this._line,i="",j="",k="",l=d[0],m=null,n=0,o=!1;switch(l){case"^":if(1===d.length)break;if("^"!==d[1])return c(this);if(this._prevTokenType="^",d=d.substr(2),"<"!==d[0]){o=!0;break}case"<":if(m=this._unescapedIri.exec(d))i="IRI",j=m[1];else if(m=this._iri.exec(d)){if(f=this._unescape(m[1]),null===f||g.test(f))return c(this);i="IRI",j=f}break;case"_":((m=this._blank.exec(d))||b&&(m=this._blank.exec(d+" ")))&&(i="prefixed",k="_",j=m[1]);break;case'"':case"'":if(m=this._unescapedString.exec(d))i="literal",j=m[0];else if(m=this._singleQuotedString.exec(d)){if(f=this._unescape(m[0]),null===f)return c(this);i="literal",j=f.replace(/^'|'$/g,'"')}else if(m=this._tripleQuotedString.exec(d)){if(f=m[1]||m[2],this._line+=f.split(/\r\n|\r|\n/).length-1,f=this._unescape(f),null===f)return c(this);i="literal",j=f.replace(/^'|'$/g,'"')}break;case"@":"literal"===this._prevTokenType&&(m=this._langcode.exec(d))?(i="langcode",j=m[1]):(m=this._keyword.exec(d))&&(i=m[0]);break;case".":if(1===d.length?b:d[1]<"0"||d[1]>"9"){i=".",n=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(m=this._number.exec(d))&&(i="literal",j='"'+m[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(m[1]?"double":/^[+\-]?\d+$/.test(m[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(m=this._sparqlKeyword.exec(d))?i=m[0].toUpperCase():o=!0;break;case"f":case"t":(m=this._boolean.exec(d))?(i="literal",j='"'+m[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):o=!0;break;case"a":(m=this._shortPredicates.exec(d))?(i="abbreviation",j="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):o=!0;break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":n=1,i=l;break;default:o=!0}if(o&&("@prefix"!==this._prevTokenType&&"PREFIX"!==this._prevTokenType||!(m=this._prefix.exec(d))?((m=this._prefixed.exec(d))||b&&(m=this._prefixed.exec(d+" ")))&&(i="prefixed",k=m[1]||"",j=this._unescape(m[2])):(i="prefix",j=m[1]||"")),"^"===this._prevTokenType&&(i="IRI"===i||"prefixed"===i?"type":""),!i)return b||!/^'''|^"""/.test(d)&&/\n|\r/.test(d)?c(this):this._input=d;a(null,{line:h,type:i,value:j,prefix:k}),this._prevTokenType=i,d=d.substr(n||m[0].length,d.length)}},_unescape:function(a){try{return a.replace(e,function(a,b,d,e){var g;if(b){if(g=parseInt(b,16),isNaN(g))throw new Error;return c(g)}if(d){if(g=parseInt(d,16),isNaN(g))throw new Error;return 65535>=g?c(g):c(55296+(g-=65536)/1024,56320+(1023&g))}var h=f[e];if(!h)throw new Error;return h})}catch(b){return null}},_syntaxError:function(a){return this._input=null,new Error('Syntax error: unexpected "'+a+'" on line '+this._line+".")},tokenize:function(a,b){function c(a){null!==f._input&&(f._input+=a,f._tokenizeToEnd(b,!1))}function e(){null!==f._input&&f._tokenizeToEnd(b,!0)}var f=this;this._line=1,"string"==typeof a?(this._input=a,d(function(){f._tokenizeToEnd(b,!0)})):(this._input="",a&&"function"!=typeof a?("function"==typeof a.setEncoding&&a.setEncoding("utf8"),a.on("data",c),a.on("end",e)):(this.addChunk=c,this.end=e,b||(b=a)))}},a.Lexer=b}(),function(){function b(a){if(!(this instanceof b))return new b(a);if(this._tripleStack=[],this._graph=null,a=a||{},a.documentIRI){if(a.documentIRI.indexOf("#")>0)throw new Error("Invalid document IRI");this._baseIRI=a.documentIRI,this._baseIRIPath=this._baseIRI.replace(j,""),this._baseIRIRoot=this._baseIRI.match(k)[0]}else this._baseIRI=null,this._baseIRIPath=null;var e="string"==typeof a.format&&a.format.match(/\w*$/)[0].toLowerCase(),f="turtle"===e,g="trig"===e,h=/triple/.test(e),i=/quad/.test(e),l=h||i;(this._supportsNamedGraphs=!f)||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(f||g||h),l&&(this._baseIRI="",this._resolveIRI=function(a){return this._error("Disallowed relative IRI",a),this._callback=c,this._subject=null}),this._lexer=a.lexer||new d({lineMode:l})}function c(){}var d=a.Lexer,e="http://www.w3.org/1999/02/22-rdf-syntax-ns#",f=e+"nil",g=e+"first",h=e+"rest",i=/:/,j=/[^\/]*$/,k=/^(?:[^:]+:\/*)?[^\/]*/,l=0,m=0;b._resetBlankNodeIds=function(){l=m=0},b.prototype={_readInTopContext:function(a){switch(a.type){case"eof":return null!==this._graph?this._error("Unclosed graph",a):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"@prefix":return this._sparqlStyle=!1,this._readPrefix;case"PREFIX":return this._sparqlStyle=!0,this._readPrefix;case"@base":return this._sparqlStyle=!1,this._readBaseIRI;case"BASE":return this._sparqlStyle=!0,this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(a)}},_readSubject:function(a){switch(this._predicate=null,a.type){case"IRI":this._subject=null===this._baseIRI||i.test(a.value)?a.value:this._resolveIRI(a);break;case"prefixed":var b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._subject=b+a.value;break;case"[":return this._subject="_:b"+m++,this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"}),this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:f,predicate:null,object:null,type:"list"}),this._subject=null,this._readListItem;case"}":return this._readPunctuation(a);default:return this._error("Expected subject but got "+a.type,a)}return this._readPredicateOrNamedGraph},_readPredicate:function(a){switch(a.type){case"IRI":case"abbreviation":this._predicate=null===this._baseIRI||i.test(a.value)?a.value:this._resolveIRI(a);break;case"prefixed":if("_"===a.prefix)return this._error("Disallowed blank node as predicate",a);var b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._predicate=b+a.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+a.type,a):(this._subject=null,this._readBlankNodeTail(a));case";":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',a)}return this._readObject},_readObject:function(a){switch(a.type){case"IRI":this._object=null===this._baseIRI||i.test(a.value)?a.value:this._resolveIRI(a);break;case"prefixed":var b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._object=b+a.value;break;case"literal":return this._object=a.value,this._readDataTypeOrLang;case"[":var c="_:b"+m++;return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:c,type:"blank"}),this._subject=c,this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:f,type:"list"}),this._subject=null,this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',a)}return this._getTripleEndReader()},_readPredicateOrNamedGraph:function(a){return"{"===a.type?this._readGraph(a):this._readPredicate(a)},_readGraph:function(a){return"{"!==a.type?this._error("Expected graph but got "+a.type,a):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(a){return"]"===a.type?(this._subject=null,this._readBlankNodeTail(a)):(this._predicate=null,this._readPredicate(a))},_readBlankNodeTail:function(a){if("]"!==a.type)return this._readPunctuation(a);null!==this._subject&&this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""});var b=this._tripleStack.pop();return this._subject=b.subject,null!==b.object?(this._predicate=b.predicate,this._object=b.object,this._getTripleEndReader()):null!==this._predicate?this._readPredicate:this._readPredicateOrNamedGraph},_readDataTypeOrLang:function(a){switch(a.type){case"type":var b;if(""===a.prefix)b=null===this._baseIRI||i.test(a.value)?a.value:this._resolveIRI(a);else{var c=this._prefixes[a.prefix];if(void 0===c)return this._error('Undefined prefix "'+a.prefix+':"',a);b=c+a.value}return this._object+="^^"+b,this._getTripleEndReader();case"langcode":return this._object+="@"+a.value.toLowerCase(),this._getTripleEndReader();default:return this._getTripleEndReader().call(this,a)}},_readListItem:function(a){var b=null,c=null,d=this._subject,e=this._tripleStack,i=e[e.length-1],j=this._readListItem;switch(a.type){case"IRI":b=a.value;break;case"prefixed":var k=this._prefixes[a.prefix];if(void 0===k)return this._error('Undefined prefix "'+a.prefix+':"',a);b=k+a.value;break;case"literal":b=a.value,j=this._readDataTypeOrLang;break;case"[":c="_:b"+m++,b="_:b"+m++,e.push({subject:c,predicate:g,object:b,type:"blank"}),this._subject=b,j=this._readBlankNodeHead;break;case"(":c="_:b"+m++,e.push({subject:c,predicate:g,object:f,type:"list"}),this._subject=null,j=this._readListItem;break;case")":if(e.pop(),0!==e.length&&"list"===e[e.length-1].type&&this._callback(null,{subject:i.subject,predicate:i.predicate,object:i.object,graph:this._graph||""}),this._subject=i.subject,null===i.predicate){if(j=this._readPredicate,i.subject===f)return j}else if(this._predicate=i.predicate,this._object=i.object,j=this._getTripleEndReader(),i.object===f)return j;c=f;break;default:return this._error('Expected list item instead of "'+a.type+'"',a)}return null===c&&(this._subject=c="_:b"+m++),null===d?i.object===f?i.object=c:i.subject=c:this._callback(null,{subject:d,predicate:h,object:c,graph:this._graph||""}),null!==b&&this._callback(null,{subject:c,predicate:g,object:b,graph:this._graph||""}),j},_readPunctuation:function(a){var b,c=this._subject,d=this._graph;switch(a.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",a);this._graph=null;case".":this._subject=null,b=this._readInTopContext;break;case";":b=this._readPredicate;break;case",":b=this._readObject;break;case"IRI":if(this._supportsQuads&&null===this._graph){d=null===this._baseIRI||i.test(a.value)?a.value:this._resolveIRI(a),c=this._subject,b=this._readQuadPunctuation;break}case"prefixed":if(this._supportsQuads&&null===this._graph){var e=this._prefixes[a.prefix];if(void 0===e)return this._error('Undefined prefix "'+a.prefix+':"',a);d=e+a.value,b=this._readQuadPunctuation;break}default:return this._error('Expected punctuation to follow "'+this._object+'"',a)}return null!==c&&this._callback(null,{subject:c,predicate:this._predicate,object:this._object,graph:d||""}),b},_readQuadPunctuation:function(a){return"."!==a.type?this._error("Expected dot to follow quad",a):this._readInTopContext},_readPrefix:function(a){return"prefix"!==a.type?this._error("Expected prefix to follow @prefix",a):(this._prefix=a.value,this._readPrefixIRI)},_readPrefixIRI:function(a){if("IRI"!==a.type)return this._error('Expected IRI to follow prefix "'+this._prefix+':"',a);var b;return b=null===this._baseIRI||i.test(a.value)?a.value:this._resolveIRI(a),this._prefixes[this._prefix]=b,this._prefixCallback(this._prefix,b),this._readDeclarationPunctuation},_readBaseIRI:function(a){return"IRI"!==a.type?this._error("Expected IRI to follow base declaration",a):a.value.indexOf("#")>0?this._error("Invalid base IRI",a):(this._baseIRI=null===this._baseIRI||i.test(a.value)?a.value:this._resolveIRI(a),this._baseIRIPath=this._baseIRI.replace(j,""),this._baseIRIRoot=this._baseIRI.match(k)[0],this._readDeclarationPunctuation)},_readNamedGraphLabel:function(a){switch(a.type){case"IRI":case"prefixed":return this._readSubject(a),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",a)}},_readNamedGraphBlankLabel:function(a){return"]"!==a.type?this._error("Invalid graph label",a):(this._subject="_:b"+m++,this._readGraph)},_readDeclarationPunctuation:function(a){return this._sparqlStyle?this._readInTopContext(a):"."!==a.type?this._error("Expected declaration to end with a dot",a):this._readInTopContext},_getTripleEndReader:function(){var a=this._tripleStack;if(0===a.length)return this._readPunctuation;switch(a[a.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem}},_error:function(a,b){this._callback(new Error(a+" at line "+b.line+"."))},_resolveIRI:function(a){var b=a.value;switch(b[0]){case void 0:return this._baseIRI;case"#":return this._baseIRI+b;case"?":return this._baseIRI.replace(/(?:\?.*)?$/,b);case"/":return this._baseIRIRoot+b;default:return this._baseIRIPath+b}},parse:function(a,b,d){this._readCallback=this._readInTopContext,this._prefixes=Object.create(null),this._prefixes._="_:b"+l++ +"_","function"==typeof a&&(d=b,b=a,a=null),this._callback=b||c,this._prefixCallback=d||c;var e=this;this._lexer.tokenize(a,function(a,b){null!==a?(e._callback(a),e._callback=c):void 0!==e._readCallback&&(e._readCallback=e._readCallback(b))}),a||(this.addChunk=this._lexer.addChunk,this.end=this._lexer.end)}},a.Parser=b}(),function(){function b(a,c){return this instanceof b?(a&&"function"!=typeof a.write&&(c=a,a=null),a||(a=this,this._output="",this.write=function(a,b,c){this._output+=a,c&&c()}),this._outputStream=a,this._subject=null,c=c||{},void(/triple|quad/i.test(c.format)?this._writeTriple=this._writeTripleLine:(this._graph="",this._prefixIRIs=Object.create(null),c.prefixes&&this.addPrefixes(c.prefixes)))):new b(a,c)}function c(a){var b=i[a];return void 0===b&&(1===a.length?(b=a.charCodeAt(0).toString(16),b="\\u0000".substr(0,6-b.length)+b):(b=(1024*(a.charCodeAt(0)-55296)+a.charCodeAt(1)+9216).toString(16),b="\\U00000000".substr(0,10-b.length)+b)),b}var d=/^"([^]*)"(?:\^\^(.+)|@([\-a-z]+))?$/i,e="http://www.w3.org/1999/02/22-rdf-syntax-ns#",f=e+"type",g=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,h=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,i={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};b.prototype={_write:function(a,b){this._outputStream.write(a,"utf8",b)},_writeTriple:function(a,b,c,d,e){try{this._graph!==d&&(this._write((null===this._subject?"":this._graph?"\n}\n":".\n")+(d?this._encodeIriOrBlankNode(d)+" {\n":"")),this._graph=d,this._subject=null),this._subject===a?this._predicate===b?this._write(", "+this._encodeObject(c),e):this._write(";\n    "+this._encodePredicate(this._predicate=b)+" "+this._encodeObject(c),e):this._write((null===this._subject?"":".\n")+this._encodeSubject(this._subject=a)+" "+this._encodePredicate(this._predicate=b)+" "+this._encodeObject(c),e)}catch(f){e&&e(f)}},_writeTripleLine:function(a,b,c,d,e){delete this._prefixMatch;try{this._write(this._encodeIriOrBlankNode(a)+" "+this._encodeIriOrBlankNode(b)+" "+this._encodeObject(c)+(d?" "+this._encodeIriOrBlankNode(d)+".\n":".\n"),e)}catch(f){e&&e(f)}},_encodeIriOrBlankNode:function(a){if("_"===a[0]&&":"===a[1])return a;g.test(a)&&(a=a.replace(h,c));var b=this._prefixRegex.exec(a);return b?this._prefixIRIs[b[1]]+b[2]:"<"+a+">"},_encodeLiteral:function(a,b,d){return g.test(a)&&(a=a.replace(h,c)),d?'"'+a+'"@'+d:b?'"'+a+'"^^'+this._encodeIriOrBlankNode(b):'"'+a+'"'},_encodeSubject:function(a){if('"'===a[0])throw new Error("A literal as subject is not allowed: "+a);return this._encodeIriOrBlankNode(a)},_encodePredicate:function(a){if('"'===a[0])throw new Error("A literal as predicate is not allowed: "+a);return a===f?"a":this._encodeIriOrBlankNode(a)},_encodeObject:function(a){if('"'!==a[0])return this._encodeIriOrBlankNode(a);var b=d.exec(a);if(!b)throw new Error("Invalid literal: "+a);return this._encodeLiteral(b[1],b[2],b[3])},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(a,b,c,d,e){"string"!=typeof c?this._writeTriple(a.subject,a.predicate,a.object,a.graph||"",b):"string"!=typeof d?this._writeTriple(a,b,c,"",d):this._writeTriple(a,b,c,d,e)},addTriples:function(a){for(var b=0;b<a.length;b++)this.addTriple(a[b])},addPrefix:function(a,b,c){var d={};d[a]=b,this.addPrefixes(d,c)},addPrefixes:function(a,b){var c=!1;for(var d in a){var e=a[d];/[#\/]$/.test(e)&&this._prefixIRIs[e]!==(d+=":")&&(c=!0,this._prefixIRIs[e]=d,null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null,this._graph=""),this._write("@prefix "+d+" <"+e+">.\n"))}if(c){var f="";for(var g in this._prefixIRIs)f+=f?"|"+g:g;f=f.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^("+f+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(c?"\n":"",b)},_prefixRegex:/$0^/,end:function(a){if(null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null),this._write=this._blockedWrite,this===this._outputStream)return a&&a(null,this._output);var b=a&&function(){b=null,a()};try{this._outputStream.end(b)}catch(c){b&&b()}}},a.Writer=b}(),function(){function b(a,c){return this instanceof b?(this._size=0,this._graphs=Object.create(null),this._entities=Object.create(null),this._entities["><"]=0,this._entityCount=0,this._blankNodeIndex=0,c||!a||a[0]||(c=a,a=null),this._prefixes=Object.create(null),c&&c.prefixes&&this.addPrefixes(c.prefixes),void(a&&this.addTriples(a))):new b(a,c)}var c=a.Util.expandPrefixedName;b.prototype={get size(){var a=this._size;if(null!==a)return a;var b,c,d=this._graphs;for(var e in d)for(var f in b=d[e].subjects)for(var g in c=b[f])a+=Object.keys(c[g]).length;return this._size=a},_addToIndex:function(a,b,c,d){var e=a[b]||(a[b]={}),f=e[c]||(e[c]={});f[d]=null},_removeFromIndex:function(a,b,c,d){var e,f=a[b],g=f[c];delete g[d];for(e in g)return;delete f[c];for(e in f)return;delete a[b]},_findInIndex:function(a,b,c,d,e,f,g,h){var i,j,k,l=[],m=Object.keys(this._entities);b&&((i=a,a={})[b]=i[b]);for(var n in a){var o=m[n];if(j=a[n]){c&&((i=j,j={})[c]=i[c]);for(var p in j){var q=m[p];if(k=j[p])for(var r=(d?d in k?[d]:[]:Object.keys(k)),s=r.length-1;s>=0;s--){var t={subject:"",predicate:"",object:"",graph:h};t[e]=o,t[f]=q,t[g]=m[r[s]],l.push(t)}}}}return l},_countInIndex:function(a,b,c,d){var e,f,g,h=0;b&&((e=a,a={})[b]=e[b]);for(var i in a)if(f=a[i]){c&&((e=f,f={})[c]=e[c]);for(var j in f)(g=f[j])&&(d?d in g&&h++:h+=Object.keys(g).length)}return h},addTriple:function(a,b,c,d){b||(d=a.graph,c=a.object,b=a.predicate,a=a.subject),d=d||"";var e=this._graphs[d];e||(e=this._graphs[d]={subjects:{},predicates:{},objects:{}},Object.freeze(e));var f=this._entities;a=f[a]||(f[a]=++this._entityCount),b=f[b]||(f[b]=++this._entityCount),c=f[c]||(f[c]=++this._entityCount),this._addToIndex(e.subjects,a,b,c),this._addToIndex(e.predicates,b,c,a),this._addToIndex(e.objects,c,a,b),this._size=null},addTriples:function(a){for(var b=a.length-1;b>=0;b--)this.addTriple(a[b])},addPrefix:function(a,b){this._prefixes[a]=b},addPrefixes:function(a){for(var b in a)this.addPrefix(b,a[b])},removeTriple:function(a,b,c,d){b||(d=a.graph,c=a.object,b=a.predicate,a=a.subject),d=d||"";var e,f=this._entities,g=this._graphs;if((a=f[a])&&(b=f[b])&&(c=f[c])&&(e=g[d])){var h,i;if((h=e.subjects[a])&&(i=h[b])&&c in i){this._removeFromIndex(e.subjects,a,b,c),this._removeFromIndex(e.predicates,b,c,a),this._removeFromIndex(e.objects,c,a,b),null!==this._size&&this._size--;for(a in e.subjects)return;delete g[d]}}},removeTriples:function(a){for(var b=a.length-1;b>=0;b--)this.removeTriple(a[b])},find:function(a,b,d,e){var f=this._prefixes;return this.findByIRI(c(a,f),c(b,f),c(d,f),c(e,f))},findByIRI:function(a,b,c,d){d=d||"";var e=this._graphs[d],f=this._entities;return e?a&&!(a=f[a])?[]:b&&!(b=f[b])?[]:c&&!(c=f[c])?[]:a?c?this._findInIndex(e.objects,c,a,b,"object","subject","predicate",d):this._findInIndex(e.subjects,a,b,null,"subject","predicate","object",d):b?this._findInIndex(e.predicates,b,c,null,"predicate","object","subject",d):c?this._findInIndex(e.objects,c,null,null,"object","subject","predicate",d):this._findInIndex(e.subjects,null,null,null,"subject","predicate","object",d):[]},count:function(a,b,d,e){var f=this._prefixes;return this.countByIRI(c(a,f),c(b,f),c(d,f),c(e,f))},countByIRI:function(a,b,c,d){d=d||"";var e=this._graphs[d],f=this._entities;return e?a&&!(a=f[a])?0:b&&!(b=f[b])?0:c&&!(c=f[c])?0:a?c?this._countInIndex(e.objects,c,a,b):this._countInIndex(e.subjects,a,b,c):b?this._countInIndex(e.predicates,b,c,a):this._countInIndex(e.objects,c,a,b):0},createBlankNode:function(a){var b;if(a){b=a="_:"+a;for(var c=1;this._entities[b];)b=a+c++}else do b="_:b"+this._blankNodeIndex++;while(this._entities[b]);return this._entities[b]=this._entityCount++,b}},a.Store=b}()}("undefined"!=typeof exports?exports:this.N3={}),function(){function N3Lexer(a){if(!(this instanceof N3Lexer))return new N3Lexer(a);if(a&&a.lineMode){this._tripleQuotedString=this._number=this._boolean=/$0^/;var b=this;this._tokenize=this.tokenize,this.tokenize=function(a,c){this._tokenize(a,function(a,d){!a&&/IRI|prefixed|literal|langcode|type|\.|eof/.test(d.type)?c&&c(a,d):c&&c(a||b._syntaxError(d.type,c=null))})}}}function N3Parser(a){
if(!(this instanceof N3Parser))return new N3Parser(a);if(this._tripleStack=[],this._graph=null,a=a||{},a.documentIRI){if(a.documentIRI.indexOf("#")>0)throw new Error("Invalid document IRI");this._baseIRI=a.documentIRI,this._baseIRIPath=this._baseIRI.replace(documentPart,""),this._baseIRIRoot=this._baseIRI.match(rootIRI)[0]}else this._baseIRI=null,this._baseIRIPath=null;var b="string"==typeof a.format&&a.format.match(/\w*$/)[0].toLowerCase(),c="turtle"===b,d="trig"===b,e=/triple/.test(b),f=/quad/.test(b),g=e||f;(this._supportsNamedGraphs=!c)||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(c||d||e),g&&(this._baseIRI="",this._resolveIRI=function(a){return this._error("Disallowed relative IRI",a),this._callback=noop,this._subject=null}),this._lexer=a.lexer||new N3Lexer({lineMode:g})}function noop(){}function convertEntity(a){switch(a[0]){case'"':if(a.indexOf("^^")>0){var b=a.split("^^");return{literal:b[0]+"^^<"+b[1]+">"}}return{literal:a};case"_":return{blank:a.replace("b","")};default:return{token:"uri",value:a,prefix:null,suffix:null}}}"undefined"==typeof console&&(console={},console.log=function(a){}),window.process={},process.nextTick=function(a){setTimeout(a,0)};var Utils={};Utils["extends"]=function(a,b){b.prototype=new a},Utils.stackCounterLimit=1e3,Utils.stackCounter=0,Utils.recur=function(a){Utils.stackCounter===Utils.stackCounterLimit?(Utils.stackCounter=0,setTimeout(a,0)):(Utils.stackCounter++,a())},Utils.clone=function(a){return JSON.parse(JSON.stringify(a))},Utils.shuffle=function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},Utils.include=function(a,b){for(var c=arguments[2],d=a.length-1;d>=0;d--){var e=!1;if(e=null==c?a[d]===b:0===c(a[d],b),e===!0)return!0}return!1},Utils.remove=function(a,b){for(var c=[],d=0;d<a.length;d++)a[d]!==b&&c.push(a[d]);return c},Utils.repeat=function(a,b,c,d,e){4===arguments.length&&(e={}),b>a?(e._i=a,c(function(c,e){Utils.recur(function(){Utils.repeat(a+1,b,c,d,e)})},e)):d(e)},Utils.meanwhile=function(a,b,c,d){3===arguments.length&&(d={}),null==d._stack_counter&&(d._stack_counter=0),a===!0?b(function(a,b,d){d._stack_counter%40==39?(d._stack_counter=d._stack_counter+1,setTimeout(function(){Utils.neanwhile(a,b,c,d)},0)):(d._stack_counter=d._stack_counter+1,Utils.meanwhile(a,b,c,d))},d):c(d)},Utils.seq=function(){var a=arguments;return function(b){Utils.repeat(0,a.length,function(b,c){var d=arguments.callee;a[c._i](function(){b(d,c)})},function(){b()})}},Utils.partition=function(a,b){for(var c=a.length%b,d=[],e=0;c>e;e++)d.push(null);for(var f=[],e=0;e<a.length;e++)d.push(a[e]),d.length%b==0&&(f.push(d),d=[]);return f},Utils.keys=function(a){var b=[];for(var c in a)b.push(c);return b},Utils.iso8601=function(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z"},Utils.parseISO8601=function(a){var b="^([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",c=a.match(new RegExp(b)),d=0,e=new Date(c[1],0,1);c[3]&&e.setMonth(c[3]-1),c[5]&&e.setDate(c[5]),c[7]&&e.setHours(c[7]),c[8]&&e.setMinutes(c[8]),c[10]&&e.setSeconds(c[10]),c[12]&&e.setMilliseconds(1e3*Number("0."+c[12])),c[14]&&(d=60*Number(c[16])+Number(c[17]),d*="-"==c[15]?1:-1),d-=e.getTimezoneOffset();var f=Number(e)+60*d*1e3,g=new Date;return g.setTime(Number(f)),g},Utils.parseISO8601Components=function(a){var b,c,d,e,f,g,h,i,j="([0-9]{4})(-([0-9]{2}))(-([0-9]{2}))(T([0-9]{2}):([0-9]{2})(:([0-9]{2}))?(.([0-9]+))?)?(Z|([-+])([0-9]{2})(:([0-9]{2}))?)?",k=a.match(new RegExp(j));return b=Number(k[1]),c=k[3]-1,d=Number(k[5]),e=Number(k[7]),f=Number(k[8]),g=Number(k[10]),k[12]&&(h=1e3*Number("0."+k[12])),"Z"===k[13]?i=0:k[14]?(i=0,k[17]&&(i=Number(k[17])),i+=60*Number(k[15]),i*="-"==k[14]?-1:1):null==k[14]&&k[11]&&(i=60*Number(k[12])),{year:isNaN(b)?null:b,month:isNaN(c)?null:c,date:isNaN(d)?null:d,hours:isNaN(e)?null:e,minutes:isNaN(f)?null:f,seconds:isNaN(g)?null:g,millisecs:isNaN(h)?null:h,timezone:isNaN(i)?null:i}},Utils.compareDateComponents=function(a,b){var c=Utils.parseISO8601Components(a),d=Utils.parseISO8601Components(b);if(null==c.timezone&&null==d.timezone||null!=c.timezone&&null!=d.timezone){var e=Utils.parseISO8601(a),f=Utils.parseISO8601(b);return e.getTime()==f.getTime()?0:e.getTime()<f.getTime()?-1:1}if(null!=c.timezone&&null==d.timezone){e=Utils.parseISO8601(a),f=Utils.parseISO8601(b);var g=e.getTime(),h=f.getTime(),i=50400;return h>g&&h+i>g?-1:g>h&&g>h-i?1:null}e=Utils.parseISO8601(a),f=Utils.parseISO8601(b),g=e.getTime(),h=f.getTime();var i=50400;return h>g&&h>g+i?-1:g>h&&g+i>h?1:null},Utils.lexicalFormLiteral=function(a,b){var c=a.value,d=a.lang,e=a.type,f=null;if(null!=c&&null!=e&&"string"!=typeof e){var g=e.value;if(null==g){var h=e.prefix,i=e.suffix,j=b.namespaces[h];a.type=j+i,g=j+i}f=-1!=g.indexOf("hexBinary")?'"'+a.value.toLowerCase()+'"^^<'+g+">":'"'+a.value+'"^^<'+g+">"}else f=null==d&&null==e?'"'+c+'"':null==e?'"'+c+'"@'+d:-1!=e.indexOf("hexBinary")?'"'+a.value.toLowerCase()+'"^^<'+e+">":'"'+a.value+'"^^<'+e+">";return f},Utils.lexicalFormBaseUri=function(a,b){var c=null;if(b=b||{},null==a.value){var d=a.prefix,e=a.suffix,f=b.namespaces[d];c=null!=f?f+e:d+":"+e}else c=a.value;return null===c?null:(-1==c.indexOf(":")&&(c=(b.base||"")+c),c)},Utils.lexicalFormTerm=function(a,b){if("uri"===a.token)return{uri:Utils.lexicalFormBaseUri(a,b)};if("literal"===a.token)return{literal:Utils.lexicalFormLiteral(a,b)};if("blank"===a.token){var c="_:"+a.value;return{blank:c}}throw"Error, cannot get lexical form of unknown token: "+a.token},Utils.normalizeUnicodeLiterals=function(string){for(var escapedUnicode=string.match(/\\u[0-9abcdefABCDEF]{4,4}/g)||[],dups={},i=0;i<escapedUnicode.length;i++)null==dups[escapedUnicode[i]]&&(dups[escapedUnicode[i]]=!0,string=string.replace(new RegExp("\\"+escapedUnicode[i],"g"),eval("'"+escapedUnicode[i]+"'")));return string},Utils.hashTerm=function(a){try{if(null==a)return"";if("uri"===a.token)return"u"+a.value;if("blank"===a.token)return"b"+a.value;if("literal"===a.token){var b="l"+a.value;return b+=a.type||"",b+=a.lang||""}}catch(c){if("object"==typeof a){var d="";for(p in a)d=d+p+a[p];return d}return a}};var InMemoryBTree={},left=-1,right=1;InMemoryBTree.Tree=function(a){0!=arguments.length&&(this.order=a,this.root=this._allocateNode(),this.root.isLeaf=!0,this.root.level=0,this._diskWrite(this.root),this._updateRootNode(this.root),this.comparator=function(a,b){return b>a?-1:a>b?1:0},this.merger=null)},InMemoryBTree.Tree.prototype._allocateNode=function(){return new InMemoryBTree.Node},InMemoryBTree.Tree.prototype._diskWrite=function(a){},InMemoryBTree.Tree.prototype._diskRead=function(a){return a},InMemoryBTree.Tree.prototype._diskDelete=function(a){},InMemoryBTree.Tree.prototype._updateRootNode=function(a){return a},InMemoryBTree.Tree.prototype.clear=function(){this.root=this._allocateNode(),this.root.isLeaf=!0,this.root.level=0,this._updateRootNode(this.root)},InMemoryBTree.Tree.prototype.search=function(a,b){for(var c=!0,d=this.root;c;){for(var e=0;e<d.numberActives&&1===this.comparator(a,d.keys[e].key);)e++;if(e<d.numberActives&&0===this.comparator(d.keys[e].key,a))return null!=b&&1==b?!0:d.keys[e].data;d.isLeaf===!0?c=!1:d=this._diskRead(d.children[e])}return null},InMemoryBTree.Tree.prototype.walk=function(a){this._walk(a,this.root)},InMemoryBTree.Tree.prototype._walk=function(a,b){if(b.isLeaf)for(var c=0;c<b.numberActives;c++)a(b.keys[c]);else{for(var c=0;c<b.numberActives;c++)this._walk(a,this._diskRead(b.children[c])),a(b.keys[c]);this._walk(a,this._diskRead(b.children[b.numberActives]))}},InMemoryBTree.Tree.prototype.walkNodes=function(a){this._walkNodes(a,this.root)},InMemoryBTree.Tree.prototype._walkNodes=function(a,b){if(b.isLeaf)a(b);else{a(b);for(var c=0;c<b.numberActives;c++)this._walkNodes(a,this._diskRead(b.children[c]));this._walkNodes(a,this._diskRead(b.children[b.numberActives]))}},InMemoryBTree.Tree.prototype._splitChild=function(a,b,c){var d=this._allocateNode();d.isLeaf=c.isLeaf,d.level=c.level,d.numberActives=this.order-1;var e=c.keys[this.order-1];c.keys[this.order-1]=null;for(var f=0;f<this.order-1;f++)d.keys[f]=c.keys[f+this.order],c.keys[f+this.order]=null,c.isLeaf||(d.children[f]=c.children[f+this.order],c.children[f+this.order]=null);for(c.isLeaf||(d.children[f]=c.children[f+this.order],c.children[f+this.order]=null),c.numberActives=this.order-1,f=a.numberActives+1;f>b+1;f--)a.children[f]=a.children[f-1];for(a.children[b+1]=d,f=a.numberActives;f>b;f--)a.keys[f]=a.keys[f-1];a.keys[b]=e,a.numberActives++,this._diskWrite(d),this._diskWrite(a),this._diskWrite(c)},InMemoryBTree.Tree.prototype.insert=function(a,b){if(this.root.numberActives===2*this.order-1){var c=this._allocateNode();c.isLeaf=!1,c.level=this.root.level+1,c.numberActives=0,c.children[0]=this.root,this._splitChild(c,0,this.root),this.root=c,this._updateRootNode(this.root),this._insertNonFull(c,a,b)}else this._insertNonFull(this.root,a,b)},InMemoryBTree.Tree.prototype._insertNonFull=function(a,b,c){for(var d=a.numberActives-1;!a.isLeaf;){for(;d>=0&&-1===this.comparator(b,a.keys[d].key);)d--;d++;var e=this._diskRead(a.children[d]);e.numberActives===2*this.order-1&&(this._splitChild(a,d,e),1===this.comparator(b,a.keys[d].key)&&d++),a=this._diskRead(a.children[d]),d=a.numberActives-1}for(;d>=0&&-1===this.comparator(b,a.keys[d].key);)a.keys[d+1]=a.keys[d],d--;a.keys[d+1]={key:b,data:c},a.numberActives++,this._diskWrite(a)},InMemoryBTree.Tree.prototype["delete"]=function(a){for(var b=this.root,c=null,d=!0,e=null,f=null,g=null,h=!0;h===!0;){for(h=!1;d===!0;){if(m=0,0===b.numberActives)return!1;for(;m<b.numberActives&&1===this.comparator(a,b.keys[m].key);)m++;if(e=m,m<b.numberActives&&0===this.comparator(a,b.keys[m].key)&&(d=!1),d===!0){if(b.isLeaf===!0)return!1;if(c=b,b=this._diskRead(b.children[m]),null===b)return!1;e===c.numberActives?(f=this._diskRead(c.children[e-1]),g=null):0===e?(f=null,g=this._diskRead(c.children[1])):(f=this._diskRead(c.children[e-1]),g=this._diskRead(c.children[e+1])),b.numberActives===this.order-1&&null!=c&&(null!=g&&g.numberActives>this.order-1?this._moveKey(c,m,left):null!=f&&f.numberActives>this.order-1?this._moveKey(c,m,right):null!=f&&f.numberActives===this.order-1?b=this._mergeSiblings(c,m,left):null!=g&&g.numberActives===this.order-1&&(b=this._mergeSiblings(c,m,right)))}}if(b.isLeaf&&b.numberActives>this.order-1)return this._deleteKeyFromNode(b,e),!0;if(b.isLeaf&&b===this.root)return this._deleteKeyFromNode(b,e),!0;if(b.isLeaf===!1){var i=null,j=null;if((i=this._diskRead(b.children[e])).numberActives>this.order-1){var k=this._getMaxKeyPos(i);a=k.node.keys[k.index],b.keys[e]=a,this._diskWrite(b),b=i,a=a.key,h=!0,d=!0}else if((i=this._diskRead(b.children[e+1])).numberActives>this.order-1){var k=this._getMinKeyPos(i);a=k.node.keys[k.index],b.keys[e]=a,this._diskWrite(b),b=i,a=a.key,h=!0,d=!0}else if((i=this._diskRead(b.children[e])).numberActives===this.order-1&&(j=this._diskRead(b.children[e+1])).numberActives===this.order-1){var l=this._mergeNodes(i,b.keys[e],j);b.children[e]=l,e++;for(var m=e;m<b.numberActives;m++)b.children[m]=b.children[m+1],b.keys[m-1]=b.keys[m];b.children[m]=null,b.keys[m-1]=null,b.numberActives--,0===b.numberActives&&this.root===b&&(this.root=l),this._diskWrite(b),b=l,h=!0,d=!0}}if(b.isLeaf&&b.numberActives>this.order-1&&d===!1&&this._deleteKeyFromNode(b,e),h===!1)return!0}},InMemoryBTree.Tree.prototype._moveKey=function(a,b,c){c===right&&b--;var d=this._diskRead(a.children[b]),e=this._diskRead(a.children[b+1]);if(c==left){d.keys[d.numberActives]=a.keys[b],d.children[d.numberActives+1]=e.children[0],e.children[0]=null,d.numberActives++,a.keys[b]=e.keys[0];for(var f=1;f<e.numberActives;f++)e.keys[f-1]=e.keys[f],e.children[f-1]=e.children[f];e.children[e.numberActives-1]=e.children[e.numberActives],e.numberActives--}else{e.children[e.numberActives+1]=e.children[e.numberActives];for(var f=e.numberActives;f>0;f--)e.children[f]=e.children[f-1],e.keys[f]=e.keys[f-1];e.keys[0]=null,e.children[0]=null,e.children[0]=d.children[d.numberActives],e.keys[0]=a.keys[b],e.numberActives++,d.children[d.numberActives]=null,a.keys[b]=d.keys[d.numberActives-1],d.keys[d.numberActives-1]=null,d.numberActives--}this._diskWrite(d),this._diskWrite(e),this._diskWrite(a)},InMemoryBTree.Tree.prototype._mergeSiblings=function(a,b,c){var d,e,f,g;b===a.numberActives?(b--,f=this._diskRead(a.children[a.numberActives-1]),g=this._diskRead(a.children[a.numberActives])):(f=this._diskRead(a.children[b]),g=this._diskRead(a.children[b+1]));var h=this._allocateNode();for(h.isLeaf=f.isLeaf,h.level=f.level,e=0;e<this.order-1;e++)h.keys[e]=f.keys[e],h.children[e]=f.children[e];for(h.keys[this.order-1]=a.keys[b],h.children[this.order-1]=f.children[this.order-1],e=0;e<this.order-1;e++)h.keys[e+this.order]=g.keys[e],h.children[e+this.order]=g.children[e];for(h.children[2*this.order-1]=g.children[this.order-1],a.children[b]=h,e=b;e<a.numberActives;e++)a.keys[e]=a.keys[e+1],a.children[e+1]=a.children[e+2];for(h.numberActives=f.numberActives+g.numberActives+1,a.numberActives--,d=a.numberActives;d<2*this.order-1;d++)a.keys[d]=null;return 0===a.numberActives&&this.root===a&&(this.root=h,h.level?h.isLeaf=!1:h.isLeaf=!0),this._diskWrite(h),this.root===h&&this._updateRootNode(this.root),this._diskWrite(a),this._diskDelete(f),this._diskDelete(g),h},InMemoryBTree.Tree.prototype._deleteKeyFromNode=function(a,b){var c=2*this.order-1;a.numberActives<c&&(c=a.numberActives);var d;if(a.isLeaf===!1)return!1;a.keys[b];for(d=b;c-1>d;d++)a.keys[d]=a.keys[d+1];return a.keys.pop(),a.numberActives--,this._diskWrite(a),!0},InMemoryBTree.Tree.prototype._mergeNodes=function(a,b,c){var d,e;for(d=this._allocateNode(),d.isLeaf=!0,e=0;e<a.numberActives;e++)d.keys[e]=a.keys[e],d.children[e]=a.children[e];for(d.children[a.numberActives]=a.children[a.numberActives],d.keys[a.numberActives]=b,e=0;e<c.numberActives;e++)d.keys[e+a.numberActives+1]=c.keys[e],d.children[e+a.numberActives+1]=c.children[e];return d.children[2*this.order-1]=c.children[c.numberActives],d.numberActives=a.numberActives+c.numberActives+1,d.isLeaf=a.isLeaf,d.level=a.level,this._diskWrite(d),d},InMemoryBTree.Tree.prototype.audit=function(a){var b=[],c=[],d=this,e=function(e){for(var f=0;f<c.length;f++)if(0===d.comparator(c[f],e)){var g=" !!! duplicated key "+e;a===!0&&console.log(g),b.push(g)}},f=null,d=this;return this.walkNodes(function(g){a===!0&&(console.log("--- Node at "+g.level+" level"),console.log(" - leaf? "+g.isLeaf),console.log(" - num actives? "+g.numberActives),console.log(" - keys: "));for(var h=g.numberActives;h<g.keys.length;h++)null!=g.keys[h]&&a===!0&&(console.log(" * warning : redundant key data"),b.push(" * warning : redundant key data"));for(var h=g.numberActives+1;h<g.children.length;h++)null!=g.children[h]&&a===!0&&(console.log(" * warning : redundant children data"),b.push(" * warning : redundant key data"));if(g.isLeaf===!1)for(var h=0;h<g.numberActives;h++){var i=d._diskRead(g.children[h]).keys[d._diskRead(g.children[h]).numberActives-1].key,j=d._diskRead(g.children[h+1]).keys[0].key;if(a===!0&&console.log("   "+g.keys[h].key+"("+i+","+j+")"),-1===d.comparator(g.keys[h].key,i)){var k=" !!! value max left "+i+" > key "+g.keys[h].key;a===!0&&console.log(k),b.push(k)}if(1===d.comparator(g.keys[h].key,j)){var k=" !!! value min right "+j+" < key "+g.keys[h].key;a===!0&&console.log(k),b.push(k)}e(g.keys[h].key),c.push(g.keys[h].key)}else{if(null===f)f=g.level;else if(f!=g.level){var k=" !!! Leaf node with wrong level value";a===!0&&console.log(k),b.push(k)}for(var h=0;h<g.numberActives;h++)a===!0&&console.log(" "+g.keys[h].key),e(g.keys[h].key),c.push(g.keys[h].key)}if(g!=d.root){if(g.numberActives>2*d.order-1){if(a===!0)var k=" !!!! MAX num keys restriction violated ";console.log(k),b.push(k)}if(g.numberActives<d.order-1){if(a===!0)var k=" !!!! MIN num keys restriction violated ";console.log(k),b.push(k)}}}),b},InMemoryBTree.Tree.prototype._getMaxKeyPos=function(a){for(var b={};;){if(null===a)break;if(a.isLeaf===!0)return b.node=a,b.index=a.numberActives-1,b;b.node=a,b.index=a.numberActives-1,a=this._diskRead(a.children[a.numberActives])}return b},InMemoryBTree.Tree.prototype._getMinKeyPos=function(a){for(var b={};;){if(null===a)break;if(a.isLeaf===!0)return b.node=a,b.index=0,b;b.node=a,b.index=0,a=this._diskRead(a.children[0])}return b},InMemoryBTree.Node=function(){this.numberActives=0,this.isLeaf=null,this.keys=[],this.children=[],this.level=0};var QuadIndexCommon={};QuadIndexCommon.NodeKey=function(a,b){this.subject=a.subject,this.predicate=a.predicate,this.object=a.object,this.graph=a.graph,this.order=b},QuadIndexCommon.NodeKey.prototype.comparator=function(a){for(var b=0;b<this.order.length;b++){var c=this.order[b];if(null==a[c])return 0;if(this[c]<a[c])return-1;if(this[c]>a[c])return 1}return 0},QuadIndexCommon.Pattern=function(a){this.subject=a.subject,this.predicate=a.predicate,this.object=a.object,this.graph=a.graph,this.indexKey=[],this.keyComponents={};for(var b=[],c=[],a=["subject","predicate","object","graph"],d=0;d<a.length;d++)"string"==typeof this[a[d]]?(c.push(a[d]),this.keyComponents[a[d]]=null):(b.push(a[d]),this.keyComponents[a[d]]=this[a[d]],this.indexKey.push(a[d]));this.order=b.concat(c),this.key=new QuadIndexCommon.NodeKey(this.keyComponents,this.order)};var QuadIndex={},BaseTree=InMemoryBTree;QuadIndex.Tree=function(a,b){0!=arguments&&(this.componentOrder=a.componentOrder,BaseTree.Tree.call(this,a.order,a.name,a.persistent,a.cacheMaxSize),this.comparator=function(a,b){for(var c=0;c<this.componentOrder.length;c++){var d=this.componentOrder[c],e=a[d],f=b[d];if(f>e)return-1;if(e>f)return 1}return 0},this.rangeComparator=function(a,b){for(var c=0;c<this.componentOrder.length;c++){var d=this.componentOrder[c];if(null==b[d]||null==a[d])return 0;if(a[d]<b[d])return-1;if(a[d]>b[d])return 1}return 0},null!=b&&b(this))},Utils["extends"](BaseTree.Tree,QuadIndex.Tree),QuadIndex.Tree.prototype.insert=function(a,b){return BaseTree.Tree.prototype.insert.call(this,a,null),b&&b(!0),!0},QuadIndex.Tree.prototype.search=function(a,b){var c=BaseTree.Tree.prototype.search.call(this,a,!0);return b&&b(c),c},QuadIndex.Tree.prototype.range=function(a,b){var c=null;return c="string"==typeof this.root?this._rangeTraverse(this,this._diskRead(this.root),a):this._rangeTraverse(this,this.root,a),b&&b(c),c},QuadIndex.Tree.prototype._rangeTraverse=function(a,b,c){for(var b,d,e,f=c.key,g=[],h=[b];h.length>0;){for(b=h.shift(),d=0;d<b.numberActives&&-1===a.rangeComparator(b.keys[d].key,f);)d++;if(b.isLeaf===!0)for(e=d;e<b.numberActives&&0===a.rangeComparator(b.keys[e].key,f);)g.push(b.keys[e].key),e++;else{var i=b.children[d],j=a._diskRead(i);h.push(j);for(var e=d;;){if(!(e<b.numberActives&&0===a.rangeComparator(b.keys[e].key,f)))break;g.push(b.keys[e].key),e++,j=a._diskRead(b.children[e]),h.push(j)}}}return g};var QuadBackend={};QuadBackend.QuadBackend=function(a,b){if(0!=arguments){this.indexMap={},this.treeOrder=a.treeOrder,this.indices=["SPOG","GP","OGS","POG","GSP","OS"],this.componentOrders={SPOG:["subject","predicate","object","graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate","object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]};for(var c=0;c<this.indices.length;c++){var d=this.indices[c];this.indexMap[d]=new QuadIndex.Tree({order:this.treeOrder,componentOrder:this.componentOrders[d],persistent:a.persistent,name:(a.name||"")+d,cacheMaxSize:a.cacheMaxSize})}b&&b(this)}},QuadBackend.QuadBackend.prototype.clear=function(){for(var a=0;a<this.indices.length;a++){var b=this.indices[a];this.indexMap[b].clear()}},QuadBackend.QuadBackend.prototype._indexForPattern=function(a){for(var b=a.indexKey,c=this.indices,d=0;d<c.length;d++)for(var e=c[d],f=this.componentOrders[e],g=0;g<f.length&&Utils.include(b,f[g])!==!1;g++)if(g==b.length-1)return e;return"SPOG"},QuadBackend.QuadBackend.prototype.index=function(a,b){for(var c=0;c<this.indices.length;c++){var d=this.indices[c],e=this.indexMap[d];e.insert(a)}return b&&b(!0),!0},QuadBackend.QuadBackend.prototype.range=function(a,b){var c=this._indexForPattern(a),d=this.indexMap[c],e=d.range(a);return b&&b(e),e},QuadBackend.QuadBackend.prototype.search=function(a,b){var c=this.indices[0],d=this.indexMap[c],e=d.search(a);return b&&b(null!=e),null!=e},QuadBackend.QuadBackend.prototype["delete"]=function(a,b){for(var c,d,e=0;e<this.indices.length;e++)c=this.indices[e],d=this.indexMap[c],d["delete"](a);return b&&b(!0),!0};var Lexicon={};Lexicon.Lexicon=function(a){this.uriToOID={},this.OIDToUri={},this.literalToOID={},this.OIDToLiteral={},this.blankToOID={},this.OIDToBlank={},this.defaultGraphOid=0,this.defaultGraphUri="https://github.com/antoniogarrote/rdfstore-js#default_graph",this.defaultGraphUriTerm={token:"uri",prefix:null,suffix:null,value:this.defaultGraphUri,oid:this.defaultGraphOid},this.oidCounter=1,this.knownGraphs={},null!=a&&a(this)},Lexicon.Lexicon.prototype.registerGraph=function(a){return a!=this.defaultGraphOid&&(this.knownGraphs[a]=!0),!0},Lexicon.Lexicon.prototype.registeredGraphs=function(a){var b=[];for(var c in this.knownGraphs)a===!0?b.push(this.OIDToUri["u"+c]):b.push(c);return b},Lexicon.Lexicon.prototype.registerUri=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;if(null==this.uriToOID[a]){var b=this.oidCounter,c="u"+b;return this.oidCounter++,this.uriToOID[a]=[b,0],this.OIDToUri[c]=a,b}var d=this.uriToOID[a],b=d[0],e=d[1]+1;return this.uriToOID[a]=[b,e],b},Lexicon.Lexicon.prototype.resolveUri=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;var b=this.uriToOID[a];return null!=b?b[0]:-1},Lexicon.Lexicon.prototype.resolveUriCost=function(a){if(a===this.defaultGraphUri)return this.defaultGraphOid;var b=this.uriToOID[a];return null!=b?b[1]:-1},Lexicon.Lexicon.prototype.registerBlank=function(a){var b=this.oidCounter;this.oidCounter++;var c=""+b;return this.OIDToBlank[c]=!0,c},Lexicon.Lexicon.prototype.resolveBlank=function(a){var b=this.oidCounter;return this.oidCounter++,""+b},Lexicon.Lexicon.prototype.resolveBlankCost=function(a){return 0},Lexicon.Lexicon.prototype.registerLiteral=function(a){if(null==this.literalToOID[a]){var b=this.oidCounter,c="l"+b;return this.oidCounter++,this.literalToOID[a]=[b,0],this.OIDToLiteral[c]=a,b}var d=this.literalToOID[a],b=d[0],e=d[1]+1;return this.literalToOID[a]=[b,e],b},Lexicon.Lexicon.prototype.resolveLiteral=function(a){var b=this.literalToOID[a];return null!=b?b[0]:-1},Lexicon.Lexicon.prototype.resolveLiteralCost=function(a){var b=this.literalToOID[a];return null!=b?b[1]:0},Lexicon.Lexicon.prototype.parseLiteral=function(a){var b=a.lastIndexOf("@");if(-1!=b&&'"'===a[b-1]&&null!=a.substring(b,a.length).match(/^@[a-zA-Z\-]+$/g)){var c=a.substring(1,b-1),d=a.substring(b+1,a.length);return{token:"literal",value:c,lang:d}}var b=a.lastIndexOf("^^");if(-1!=b&&'"'===a[b-1]&&"<"===a[b+2]&&">"===a[a.length-1]){var c=a.substring(1,b-1),e=a.substring(b+3,a.length-1);return{token:"literal",value:c,type:e}}var c=a.substring(1,a.length-1);return{token:"literal",value:c}},Lexicon.Lexicon.prototype.parseUri=function(a){return{token:"uri",value:a}},Lexicon.Lexicon.prototype.retrieve=function(a){try{if(a===this.defaultGraphOid)return{token:"uri",value:this.defaultGraphUri,prefix:null,suffix:null,defaultGraph:!0};var b=this.OIDToUri["u"+a];if(null!=b)return this.parseUri(b);var c=this.OIDToLiteral["l"+a];if(null!=c)return this.parseLiteral(c);var d=this.OIDToBlank[""+a];if(null!=d)return{token:"blank",value:"_:"+a};throw"Null value for OID"}catch(e){throw console.log("error in lexicon retrieving OID:"),console.log(a),e.message||e.stack?(e.message&&console.log(e.message),e.stack&&console.log(e.stack)):console.log(e),new Error("Unknown retrieving OID in lexicon:"+a)}},Lexicon.Lexicon.prototype.clear=function(){this.uriToOID={},this.OIDToUri={},this.literalToOID={},this.OIDToLiteral={},this.blankToOID={},this.OIDToBlank={}},Lexicon.Lexicon.prototype.unregister=function(a,b){try{return this.unregisterTerm(a.subject.token,b.subject),this.unregisterTerm(a.predicate.token,b.predicate),this.unregisterTerm(a.object.token,b.object),null!=a.graph&&this.unregisterTerm(a.graph.token,b.graph),!0}catch(c){return console.log("Error unregistering quad"),console.log(c.message),!1}},Lexicon.Lexicon.prototype.unregisterTerm=function(a,b){if("uri"===a){if(b!=this.defaultGraphOid){var c="u"+b,d=this.OIDToUri[c],e=this.uriToOID[d],f=e[1];if(""+e[0]!=""+b)throw"Not matching OID : "+b+" vs "+e[0];0===f?(delete this.OIDToUri[c],delete this.uriToOID[d],delete this.knownGraphs[b]):this.uriToOID[d]=[b,f-1]}}else if("literal"===a){this.oidCounter++;var c="l"+b,g=this.OIDToLiteral[c],e=this.literalToOID[g],f=e[1];if(""+e[0]!=""+b)throw"Not matching OID : "+b+" vs "+e[0];0===f?(delete this.OIDToLiteral[c],delete this.literalToOID[g]):this.literalToOID[g]=[b,f-1]}else"blank"===a&&delete this.OIDToBlank[""+b]};var NetworkTransport={};NetworkTransport.load=function(a,b,c,d){var e=jQuery;e.ajax({url:a,headers:{Accept:b},success:function(a,b,d){if("2"==(""+d.status)[0]){for(var e=d.getAllResponseHeaders().split("\n"),f={},g=0;g<e.length;g++){var h=e[g].split(":");f[h[0]]=h[1]}c(!0,{headers:f,data:a})}},error:function(a,d,e){if("3"==(""+a.status)[0])if(0==redirection)c(!1,500);else{var f=a.getAllResponseHeaders().Location||a.getAllResponseHeaders().location;null!=f?NetworkTransport.load(f,b,c,redirection-1):c(!1,500)}else c(!1,a.statusCode())}})};var jsonldParser=null;!function(){var a=function(a,b){a.stack="";for(var c in b)a[c]=b[c]};if("undefined"!=typeof window){var b=window.jsonld=window.jsonld||{};Exception=function(b){a(this,b)},Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on non-object");var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments[1],f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d})}else if("undefined"!=typeof module&&module.exports){var b={};Exception=function(b){a(this,b),this.stack=(new Error).stack}}jsonldParser=b;var c={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#"},d={xsd:"http://www.w3.org/2001/XMLSchema#"},e={"boolean":d.xsd+"boolean","double":d.xsd+"double",integer:d.xsd+"integer"},f=function(a,b,c){b in a?a[b].constructor===Array?a[b].push(c):a[b]=[a[b],c]:a[b]=c},g=function(a){var b;if(a.constructor===Object){b={};var c=Object.keys(a).sort();for(var d in c){var e=c[d];b[e]=g(a[e])}}else if(a.constructor===Array){b=[];for(var d in a)b[d]=g(a[d])}else b=a;return b},h=function(a){var b={"@id":"@id","@language":"@language","@value":"@value","@type":"@type"};if(a){var c={};for(var d in a)a[d].constructor===String&&a[d]in b&&(c[a[d]]=d);for(var d in c)b[d]=c[d]}return b},i=function(a,b){var c=null;return b in a&&(a[b].constructor===String?c=a[b]:a[b].constructor===Object&&"@id"in a[b]&&(c=a[b]["@id"])),c},j=function(a,b,c){var d=null;for(var e in a)if(e.length>0&&"@"!==e[0]&&b===i(a,e)){d=e,null!==c&&(c[e]=g(a[e]));break}if(null===d&&"@type"===b&&(d=h(a)["@type"]),null===d)for(var e in a)if(e.length>0&&"@"!==e[0]){var f=i(a,e);if(null!==f){var j=b.indexOf(f);if(0===j&&b.length>f.length){d=e+":"+b.substr(f.length),null!==c&&(c[e]=g(a[e]));break}}}return null===d&&(d=b),d},k=function(a,b,c){var d=b,e=h(a),f=b.indexOf(":");if(-1!==f){var j=b.substr(0,f);if(j in a){var k=i(a,j);d=k+b.substr(f+1),null!==c&&(c[j]=g(a[j]))}}else if(b in a)d=i(a,b),null!==c&&(c[b]=g(a[b]));else for(var l in e)if(b===e[l]){d=l;break}return d},l=function(a){var b={},c=Object.keys(a).sort();for(var d in c){var e=c[d];b[e]=a[e]}return b},m=function(a){return null!==a&&a.constructor===Object&&"@id"in a&&1===Object.keys(a).length},n=function(a){var b=!1;if(null!==a&&a.constructor===Object&&!("@value"in a)){var c=Object.keys(a).length;b=c>1||!("@id"in a)}return b};b.normalize=function(a){return(new o).normalize(a)},b.expand=function(a){return(new o).expand({},null,a)},b.compact=function(a,c){var d=null;if(null!==c){c=b.expand(c);var e;c.constructor===Array?(d=[],e=c):e=[c],a.constructor===Array&&(a=b.mergeContexts({},a));for(var f in e){var h={},i=(new o).compact(g(a),null,e[f],h);if(Object.keys(h).length>0){h=l(h);var j=Object.keys(i);j.sort(),j.unshift("@context"),i["@context"]=h;var k={};for(var m in j){var n=j[m];k[n]=i[n]}i=k}null===d?d=i:d.push(i)}}return d},b.mergeContexts=function(a,c){a.constructor===Array&&(a=b.mergeContexts({},a));var d=g(a);if(c.constructor===Array)for(var e in c)d=b.mergeContexts(d,c[e]);else{for(var f in c)if(0!==f.indexOf("@"))for(var h in d)if(d[h]===c[f]){delete d[h];break}for(var f in c)d[f]=g(c[f])}return d},b.expandTerm=k,b.compactIri=function(a,b){return j(a,b,null)},b.frame=function(a,b,c){return(new o).frame(a,b,c)},b.toTriples=function(a,c,d){var e=null,f=b.normalize(a);d=d||null,null===d&&(e=[],d=function(a,b,d){e.push({subject:Utils.lexicalFormTerm(a),predicate:Utils.lexicalFormTerm(b),object:Utils.lexicalFormTerm(d),graph:c})});var g=!1;for(var h in f){var i=f[h],j=i["@id"];j="_"==j[0]?{token:"blank",value:j.split(":")[1]}:{token:"uri",value:j};for(var k in i)if("@id"!==k){var l=i[k];l.constructor!==Array&&(l=[l]);for(var m in l){var n=l[m];if("@type"===k||"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===k?(k="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",n={token:"uri",value:n}):"string"==typeof n?n={token:"literal",value:n}:null!=n["@id"]?n="_"==n["@id"][0]?{token:"blank",value:n["@id"].split(":")[1]}:{token:"uri",value:n["@id"]}:null!=n["@type"]?n={token:"literal",value:n["@value"],type:n["@type"]}:null!=n["@language"]&&(n={token:"literal",value:n["@value"],lang:n["@language"]}),g=d(j,{token:"uri",value:k},n)===!1)break}if(g)break}if(g)break}return e},b.resolve=function(a,b,c){var d={},e=function(a,b){if(a.constructor===Array)for(var c in a)e(a[c]);else if(a.constructor===Object)for(var f in a)if("@context"===f)if(a[f].constructor===Array){var g=a[f];for(var c in g)g[c].constructor===String&&(b?g[c]=d[g[c]]:d[g[c]]={})}else a[f].constructor===String&&(b?a[f]=d[a[f]]:d[a[f]]={})};e(a,!1);var f=Object.keys(d).length,g=null;if(0===f)c(a,g);else for(var h in d)b(h,function(b,i){if(--f,null===b)g=g||[],g.push({url:h,error:i});else try{b.constructor===String?d[h]=JSON.parse(b)["@context"]:d[h]=b["@context"]}catch(j){g=g||[],g.push({url:h,error:j})}0===f&&(null===g&&e(a,!0),c(a,g))})};var o=function(){};o.prototype.compact=function(a,b,c,d){var f,i=h(a);if(null===c)f=null,this.getCoerceType(a,b,d);else if(c.constructor===Array){f=[];for(var k in c)f.push(this.compact(a,b,c[k],d))}else if(c.constructor===Object&&"@id"in c&&c["@id"].constructor===Array)f={},f[i["@id"]]=this.compact(a,b,c["@id"],d);else if(n(c)){f={};for(var l in c)if("@context"!==c[l]){var m=j(a,l,d);m===l&&m in f||(f[m]=this.compact(a,l,c[l],d))}}else{var o=this.getCoerceType(a,b,d),p=null;if(c.constructor===Object?"@language"in c||(p="@type"in c?c["@type"]:"@id"in c?"@id":o):c.constructor===String&&(p=o),null!==o||p!==e["boolean"]&&p!==e.integer&&p!==e["double"]||(o=p),
null!==o){if(null===p)throw{message:"Cannot coerce type when a language is specified. The language information would be lost."};if(p!==o)throw new Exception({message:"Cannot coerce type because the type does not match.",type:p,expected:o});c.constructor===Object?"@id"in c?f=c["@id"]:"@value"in c&&(f=c["@value"]):f=c,o===e["boolean"]?f="true"===f||0!=f:o===e["double"]?f=parseFloat(f):o===e.integer&&(f=parseInt(f))}else if(c.constructor===Object){f={};for(var l in c)f[i[l]]=c[l]}else f=g(c);"@id"===p&&(f.constructor===Object?f[i["@id"]]=j(a,f[i["@id"]],d):f=j(a,f,d))}return f},o.prototype.expand=function(a,c,d){var i;if(null===d)i=null;else if(null===c&&d.constructor===String)i=k(a,d,null);else if(d.constructor===Array){i=[];for(var j in d)i.push(this.expand(a,c,d[j]))}else if(d.constructor===Object){"@context"in d&&(a=b.mergeContexts(a,d["@context"])),i={};for(var l in d)"@embed"===l||"@explicit"===l||"@default"===l||"@omitDefault"===l?f(i,l,g(d[l])):"@context"!==l&&f(i,k(a,l,null),this.expand(a,l,d[l]))}else{var m=this.getCoerceType(a,c,null),n=h(a);null!==m||d.constructor!==Number&&d.constructor!==Boolean||(m=d.constructor===Boolean?e["boolean"]:-1==(""+d).indexOf(".")?e.integer:e["double"]),c===n["@id"]||c===n["@type"]?i=k(a,d,null):null!==m?(i={},"@id"===m?i["@id"]=k(a,d,null):(i["@type"]=m,m===e["double"]&&(d=d.toExponential(6).replace(/(e(?:\+|-))([0-9])$/,"$10$2")),i["@value"]=""+d)):i=""+d}return i},o.prototype.normalize=function(a){var b=[];if(null!==a){this.ng={tmp:null,c14n:null};var d=this.expand(c,null,a);this.nameBlankNodes(d);var e={};y(null,null,d,e);for(var f in e){var g=e[f],h={},i=Object.keys(g).sort();for(var j in i){var k=i[j];h[k]=g[k]}b.push(h)}this.canonicalizeBlankNodes(b),b.sort(function(a,b){return s(a["@id"],b["@id"])})}return b},o.prototype.getCoerceType=function(a,b,c){var d=null,e=k(a,b,null);if("@id"===e||"@type"===e)d="@id";else if(e=j(a,e,null),e in a&&a[e].constructor===Object&&"@type"in a[e]){var f=a[e]["@type"];d=k(a,f,c),null!==c&&(c[e]=g(a[e]))}return d};var p=function(a){return 0===a.indexOf("_:")},q=function(a){return a.constructor===Object&&"@id"in a&&p(a["@id"])},r=function(a){return n(a)&&(!("@id"in a)||q(a))},s=function(a,b){var c=0;if(a.constructor===Array&&b.constructor===Array)for(var d=0;d<a.length&&0===c;++d)c=s(a[d],b[d]);else c=b>a?-1:a>b?1:0;return c},t=function(a,b,c){var d=0;return c in a?d=c in b?s(a[c],b[c]):-1:c in b&&(d=1),d},u=function(a,b){var c=0;return a.constructor===String?c=b.constructor!==String?-1:s(a,b):b.constructor===String?c=1:(c=t(a,b,"@value"),0===c&&("@value"in a?(c=t(a,b,"@type"),0===c&&(c=t(a,b,"@language"))):c=s(a["@id"],b["@id"]))),c},v=function(a,b){var c=0;for(var d in a)if("@id"!==d){var e=a[d].constructor===Array?a[d].length:1,f=b[d].constructor===Array?b[d].length:1;if(c=s(e,f),0===c){var g=a[d],h=b[d];g.constructor!==Array&&(g=[g],h=[h]),g=g.filter(function(a){return!q(a)}),h=h.filter(function(a){return!q(a)}),c=s(g.length,h.length)}if(0===c){g.sort(u),h.sort(u);for(var i=0;i<g.length&&0===c;++i)c=u(g[i],h[i])}if(0!==c)break}return c},w=function(a){var b=-1,c={next:function(){return++b,c.current()},current:function(){return"_:"+a+b},inNamespace:function(b){return 0===b.indexOf("_:"+a)}};return c},x=function(a,b,c){if(null===a);else if(a.constructor===Array)for(var d in a)x(a[d],b,c);else if(a.constructor===Object){"@id"in a?a["@id"].constructor==Array?x(a["@id"],b,c):n(a)&&(b[a["@id"]]=a):r(a)&&c.push(a);for(var e in a)x(a[e],b,c)}},y=function(a,b,c,d){var e=null;if(null===c);else if(c.constructor===Array)for(var f in c)y(a,b,c[f],d);else if(c.constructor===Object)if("@value"in c||"@type"===b)e=g(c);else if(c["@id"].constructor===Array){if(null!==a)throw{message:"Embedded graph literals cannot be flattened."};for(var h in c["@id"])y(a,b,c["@id"][h],d)}else{var i;c["@id"]in d?i=d[c["@id"]]:(i={"@id":c["@id"]},d[c["@id"]]=i),e={"@id":i["@id"]};for(var j in c){var k=c[j];null!==k&&"@id"!==j&&(j in i?i[j].constructor!==Array&&(i[j]=[i[j]]):i[j]=[],y(i[j],j,k,d),1===i[j].length&&(i[j]=i[j][0]))}}else e=c;if(null!==e&&null!==a)if(a.constructor===Array){var l=!1;e.constructor===Object&&"@id"in e&&(l=a.filter(function(a){return a.constructor===Object&&"@id"in a&&a["@id"]===e["@id"]}).length>0),l||a.push(e)}else a[b]=e};o.prototype.nameBlankNodes=function(a){var b=this.ng.tmp=w("tmp"),c={},d=[];x(a,c,d);for(var e in d){var f=d[e];if(!("@id"in f)){for(;b.next()in c;);f["@id"]=b.current(),c[b.current()]=f}}},o.prototype.renameBlankNode=function(a,b){var c=a["@id"];a["@id"]=b;var d=this.subjects;d[b]=d[c],delete d[c],this.edges.refs[b]=this.edges.refs[c],this.edges.props[b]=this.edges.props[c],delete this.edges.refs[c],delete this.edges.props[c];var e=this.edges.refs[b].all;for(var f in e){var g=e[f].s;g===c&&(g=b);var h=d[g],i=this.edges.props[g].all;for(var j in i)if(i[j].s===c){i[j].s=b;var k=i[j].p,l=h[k].constructor===Object?[h[k]]:h[k].constructor===Array?h[k]:[];for(var m in l)l[m].constructor===Object&&"@id"in l[m]&&l[m]["@id"]===c&&(l[m]["@id"]=b)}}var i=this.edges.props[b].all;for(var f in i){var g=i[f].s;e=this.edges.refs[g].all;for(var n in e)e[n].s===c&&(e[n].s=b)}},o.prototype.canonicalizeBlankNodes=function(a){this.renamed={},this.mappings={},this.serializations={};var b=this.edges={refs:{},props:{}},c=this.subjects={},d=[];for(var e in a){var f=a[e]["@id"];c[f]=a[e],b.refs[f]={all:[],bnodes:[]},b.props[f]={all:[],bnodes:[]},p(f)&&d.push(a[e])}this.collectEdges();var g=this.ng.c14n=w("c14n"),h=this.ng.tmp;for(var e in d){var i=d[e],f=i["@id"];if(g.inNamespace(f)){for(;h.next()in c;);this.renameBlankNode(i,h.current()),f=i["@id"]}this.serializations[f]={props:null,refs:null}}for(var j=!0,k=this;d.length>0;){j&&(j=!1,d.sort(function(a,b){return k.deepCompareBlankNodes(a,b)}));var i=d.shift(),f=i["@id"],l=["props","refs"];for(var m in l){var n=l[m];if(null===this.serializations[f][n]){var o={};o[f]="s1"}else o=this.serializations[f][n].m;var q=Object.keys(o);q.sort(function(a,b){return s(o[a],o[b])});var r=[];for(var e in q){var t=q[e];!g.inNamespace(f)&&t in c&&(this.renameBlankNode(c[t],g.next()),r.push(t))}var v=d;d=[];for(var e in v){var x=v[e],y=x["@id"];if(!g.inNamespace(y)){for(var z in r)this.markSerializationDirty(y,r[z],n)&&(j=!0);d.push(x)}}}}for(var A in b.props)if(b.props[A].bnodes.length>0){var i=c[A];for(var B in i)0!==B.indexOf("@")&&i[B].constructor===Array&&i[B].sort(u)}},MappingBuilder=function(){this.count=1,this.processed={},this.mapping={},this.adj={},this.keyStack=[{keys:["s1"],idx:0}],this.done={},this.s=""},MappingBuilder.prototype.copy=function(){var a=new MappingBuilder;return a.count=this.count,a.processed=g(this.processed),a.mapping=g(this.mapping),a.adj=g(this.adj),a.keyStack=g(this.keyStack),a.done=g(this.done),a.s=this.s,a},MappingBuilder.prototype.mapNode=function(a){return a in this.mapping||(0===a.indexOf("_:c14n")?this.mapping[a]="c"+a.substr(6):this.mapping[a]="s"+this.count++),this.mapping[a]};var z=function(a){var b="",c=!0;for(var d in a)if("@id"!==d){c?c=!1:b+="|",b+="<"+d+">";var e=a[d].constructor===Array?a[d]:[a[d]];for(var f in e){var g=e[f];g.constructor===Object?"@id"in g?b+=p(g["@id"])?"_:":"<"+g["@id"]+">":(b+='"'+g["@value"]+'"',"@type"in g?b+="^^<"+g["@type"]+">":"@language"in g&&(b+="@"+g["@language"])):b+='"'+g+'"'}}return b};MappingBuilder.prototype.serialize=function(a,b){if(this.keyStack.length>0)for(var c=this.keyStack.pop();c.idx<c.keys.length;++c.idx){var d=c.keys[c.idx];if(!(d in this.adj)){this.keyStack.push(c);break}if(d in this.done)this.s+="_"+d;else{this.done[d]=!0;var e=d,f=this.adj[d],g=f.i;if(g in a){var h=a[g];e+="["+z(h)+"]";var i=!0;e+="[";var j=b.refs[g].all;for(var k in j)i?i=!1:e+="|",e+="<"+j[k].p+">",e+=p(j[k].s)?"_:":"<"+j[k].s+">";e+="]"}e+=f.k.join(""),this.s+=e,this.keyStack.push({keys:f.k,idx:0}),this.serialize(a,b)}}},o.prototype.markSerializationDirty=function(a,b,c){var d=!1,e=this.serializations[a];return null!==e[c]&&b in e[c].m&&(e[c]=null,d=!0),d};var A=function(a){a.unshift.apply(a,a.splice(1,a.length))},B=function(a,b){var c=0;return c=a.length==b.length?s(a,b):a.length>b.length?s(a.substr(0,b.length),b):s(a,b.substr(0,a.length))};o.prototype.serializeCombos=function(a,b,c,d,e,f,h){if(h.length>0){f=g(f),f[d.mapNode(h[0].s)]=h[0].s;var i=d.copy();h=h.slice(1);for(var j=Math.max(1,h.length),k=0;j>k;++k){var l=0===k?d:i.copy();this.serializeCombos(a,b,c,l,e,f,h),A(h)}}else{var m=Object.keys(f).sort();if(d.adj[c]={i:b,k:m,m:f},d.serialize(this.subjects,this.edges),null===a[e]||B(d.s,a[e].s)<=0){for(var n in m){var o=m[n];this.serializeBlankNode(a,f[o],d,e)}d.serialize(this.subjects,this.edges),(null===a[e]||B(d.s,a[e].s)<=0&&d.s.length>=a[e].s.length)&&(a[e]={s:d.s,m:d.mapping})}}},o.prototype.serializeBlankNode=function(a,b,c,d){if(!(b in c.processed)){c.processed[b]=!0;var e=c.mapNode(b),f=c.copy(),g=this.edges[d][b].bnodes,h={},i=[];for(var j in g)g[j].s in c.mapping?h[c.mapping[g[j].s]]=g[j].s:i.push(g[j]);for(var k=Math.max(1,i.length),j=0;k>j;++j){var l=0===j?c:f.copy();this.serializeCombos(a,b,e,l,d,h,i)}}},o.prototype.deepCompareBlankNodes=function(a,b){var c=0,d=a["@id"],e=b["@id"];if(d===e)c=0;else if(c=this.shallowCompareBlankNodes(a,b),0===c)for(var f=["props","refs"],h=0;0===c&&h<f.length;++h){var i=f[h],j=this.serializations[d],k=this.serializations[e];if(null===j[i]){var l=new MappingBuilder;"refs"===i&&(l.mapping=g(j.props.m),l.count=Object.keys(l.mapping).length+1),this.serializeBlankNode(j,d,l,i)}if(null===k[i]){var l=new MappingBuilder;"refs"===i&&(l.mapping=g(k.props.m),l.count=Object.keys(l.mapping).length+1),this.serializeBlankNode(k,e,l,i)}c=s(j[i].s,k[i].s)}return c},o.prototype.shallowCompareBlankNodes=function(a,b){var c=0,d=Object.keys(a),e=Object.keys(b);if(c=s(d.length,e.length),0===c&&(c=s(d.sort(),e.sort())),0===c&&(c=v(a,b)),0===c){var f=this.edges.refs[a["@id"]].all,g=this.edges.refs[b["@id"]].all;c=s(f.length,g.length)}if(0===c)for(var h=0;h<f.length&&0===c;++h)c=this.compareEdges(f[h],g[h]);return c},o.prototype.compareEdges=function(a,b){var c=0,d=p(a.s),e=p(b.s),f=this.ng.c14n;if(d!=e)c=d?1:-1;else if(d||(c=s(a.s,b.s)),0===c&&(c=s(a.p,b.p)),0===c&&null!==f){var g=f.inNamespace(a.s),h=f.inNamespace(b.s);g!=h?c=g?1:-1:g&&(c=s(a.s,b.s))}return c},o.prototype.collectEdges=function(){var a=this.edges.refs,b=this.edges.props;for(var c in this.subjects){var d=this.subjects[c];for(var e in d)if("@id"!==e){var f=d[e],g=f.constructor!==Array?[f]:f;for(var h in g){var i=g[h];if(i.constructor===Object&&"@id"in i&&i["@id"]in this.subjects){var j=i["@id"];a[j].all.push({s:c,p:e}),b[c].all.push({s:j,p:e})}}}}var k=this;for(var c in a)a[c].all.sort(function(a,b){return k.compareEdges(a,b)}),a[c].bnodes=a[c].all.filter(function(a){return p(a.s)});for(var c in b)b[c].all.sort(function(a,b){return k.compareEdges(a,b)}),b[c].bnodes=b[c].all.filter(function(a){return p(a.s)})};var C=function(a,b){var c=!1,d="@type";if("@type"in b&&a.constructor===Object&&d in a)for(var e=a[d].constructor===Array?a[d]:[a[d]],f=b[d].constructor===Array?b[d]:[b[d]],g=0;g<f.length&&!c;++g){d=f[g];for(var h in e)if(e[h]===d){c=!0;break}}return c},D=function(a,b){var c=!1,d="@type";if(!(d in b)){var e=Object.keys(b).filter(function(a){return 0!==a.indexOf("@")});if(0===e.length)c=!0;else if(a.constructor===Object&&"@id"in a){c=!0;for(var f in e)if(!(e[f]in a)){c=!1;break}}}return c},E=function(a,b,c,d,e,f,g,h){var i=b["@id"],j=i in d?d[i]:null,k=("@embed"in c&&c["@embed"]||!("@embed"in c)&&h.defaults.embedOn)&&(null===j||j.autoembed&&!e);if(k){if(null===j)j={},d[i]=j;else if(null!==j.parent){if(j.parent[j.key].constructor===Array){var l=j.parent[j.key];for(var m in l)if(l[m].constructor===Object&&"@id"in l[m]&&l[m]["@id"]===i){l[m]={"@id":b["@id"]};break}}else j.parent[j.key]={"@id":b["@id"]};var n=function(a){var b=Object.keys(d);for(var c in b)c=b[c],c in d&&null!==d[c].parent&&d[c].parent["@id"]===a&&(delete d[c],n(c))};n(i)}j.autoembed=e,j.parent=f,j.key=g;var o=c["@explicit"]===!0||h.defaults.explicitOn;if(o)for(q in b)"@id"===q||q in c||delete b[q];var p=Object.keys(b);for(m in p){var q=p[m];if(0!==q.indexOf("@")){if(q in c)var r=c[q],s=!1;else var r=b[q].constructor===Array?[]:{},s=!0;var t=b[q],u=t.constructor===Array?t:[t];for(var v in u)u[v].constructor===Object&&"@id"in u[v]&&u[v]["@id"]in a&&(u[v]=a[u[v]["@id"]]);b[q]=F(a,u,r,d,s,b,q,h)}}for(q in c)if(!(0===q.indexOf("@")||q in b&&null!==b[q])){var r=c[q];if(r.constructor===Array)b[q]=[];else{r.constructor===Array&&(r=r.length>0?r[0]:{});var w=r["@omitDefault"]===!0||h.defaults.omitDefaultOn;w||("@default"in r?b[q]=r["@default"]:b[q]=null)}}}else b={"@id":b["@id"]};return b},F=function(a,b,c,d,e,f,g,h){var i,j=null,k=-1;c.constructor===Array?(j=[],i=c,0===i.length&&i.push({})):(i=[c],k=1);for(var l=[],o=0;o<i.length&&0!==k;++o){if(c=i[o],c.constructor!==Object)throw{message:"Invalid JSON-LD frame. Frame must be an object or an array.",frame:c};l[o]=[];for(var p=0;p<b.length&&0!==k;++p){var q=b[p];(C(q,c)||D(q,c))&&(l[o].push(q),--k)}}for(var r in l)for(var s in l[r]){c=i[r];var t=l[r][s];if(n(t)&&(t=E(a,t,c,d,e,f,g,h)),null===j)j=t;else{var u=m(t)&&t["@id"]in d;null===f&&u||j.push(t)}}return j};o.prototype.frame=function(a,c,d){var e;a=b.normalize(a);var f=null;if("@context"in c)f=g(c["@context"]),c=b.expand(c);else if(c.constructor===Array){c.length>0&&"@context"in c[0]&&(f=g(c[0]["@context"]));var h=[];for(var i in c)h.push(b.expand(c[i]));c=h}d={defaults:{embedOn:!0,explicitOn:!1,omitDefaultOn:!1}};var j={};for(var i in a)j[a[i]["@id"]]=a[i];return e=F(j,a,c,{},!1,null,null,d),null!==f&&null!==e&&(e=b.compact(f,e)),e}}();var JSONLDParser={};JSONLDParser.parser={},JSONLDParser.parser.parse=function(a,b){return"string"==typeof a&&(a=JSON.parse(a)),jsonldParser.toTriples(a,b)};var fromCharCode=String.fromCharCode,immediately="function"==typeof setImmediate?setImmediate:function(a){setTimeout(a,0)},escapeSequence=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,escapeReplacements={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},illegalIriChars=/[\x00-\x20<>\\"\{\}\|\^\`]/;N3Lexer.prototype={_iri:/^<((?:[^>\\]|\\[uU])+)>/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>/,_unescapedString:/^"[^"\\]+"(?=[^"\\])/,_singleQuotedString:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=\.?[,;\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=[.,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;:\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<:])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(a,b){function c(b){a(b._syntaxError(/^\S*/.exec(d)[0]))}for(var d=this._input;;){for(var e;e=this._newline.exec(d);)d=d.substr(e[0].length,d.length),this._line++;if((e=this._whitespace.exec(d))&&(d=d.substr(e[0].length,d.length)),this._endOfFile.test(d))return b&&a(d=null,{line:this._line,type:"eof",value:"",prefix:""}),this._input=d;var f,g=this._line,h="",i="",j="",k=d[0],l=null,m=0,n=!1;switch(k){case"^":if(1===d.length)break;if("^"!==d[1])return c(this);if(this._prevTokenType="^",d=d.substr(2),"<"!==d[0]){n=!0;break}case"<":if(l=this._unescapedIri.exec(d))h="IRI",i=l[1];else if(l=this._iri.exec(d)){if(f=this._unescape(l[1]),null===f||illegalIriChars.test(f))return c(this);h="IRI",i=f}break;case"_":((l=this._blank.exec(d))||b&&(l=this._blank.exec(d+" ")))&&(h="prefixed",j="_",i=l[1]);break;case'"':case"'":if(l=this._unescapedString.exec(d))h="literal",i=l[0];else if(l=this._singleQuotedString.exec(d)){if(f=this._unescape(l[0]),null===f)return c(this);h="literal",i=f.replace(/^'|'$/g,'"')}else if(l=this._tripleQuotedString.exec(d)){if(f=l[1]||l[2],this._line+=f.split(/\r\n|\r|\n/).length-1,f=this._unescape(f),null===f)return c(this);h="literal",i=f.replace(/^'|'$/g,'"')}break;case"@":"literal"===this._prevTokenType&&(l=this._langcode.exec(d))?(h="langcode",i=l[1]):(l=this._keyword.exec(d))&&(h=l[0]);break;case".":if(1===d.length?b:d[1]<"0"||d[1]>"9"){h=".",m=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(l=this._number.exec(d))&&(h="literal",i='"'+l[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(l[1]?"double":/^[+\-]?\d+$/.test(l[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(l=this._sparqlKeyword.exec(d))?h=l[0].toUpperCase():n=!0;break;case"f":case"t":(l=this._boolean.exec(d))?(h="literal",i='"'+l[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):n=!0;break;case"a":(l=this._shortPredicates.exec(d))?(h="abbreviation",i="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):n=!0;break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":m=1,h=k;break;default:n=!0}if(n&&("@prefix"!==this._prevTokenType&&"PREFIX"!==this._prevTokenType||!(l=this._prefix.exec(d))?((l=this._prefixed.exec(d))||b&&(l=this._prefixed.exec(d+" ")))&&(h="prefixed",j=l[1]||"",i=this._unescape(l[2])):(h="prefix",i=l[1]||"")),"^"===this._prevTokenType&&(h="IRI"===h||"prefixed"===h?"type":""),!h)return b||!/^'''|^"""/.test(d)&&/\n|\r/.test(d)?c(this):this._input=d;a(null,{line:g,type:h,value:i,prefix:j}),this._prevTokenType=h,d=d.substr(m||l[0].length,d.length)}},_unescape:function(a){try{return a.replace(escapeSequence,function(a,b,c,d){var e;if(b){if(e=parseInt(b,16),isNaN(e))throw new Error;return fromCharCode(e)}if(c){if(e=parseInt(c,16),isNaN(e))throw new Error;return 65535>=e?fromCharCode(e):fromCharCode(55296+(e-=65536)/1024,56320+(1023&e))}var f=escapeReplacements[d];if(!f)throw new Error;return f})}catch(b){return null}},_syntaxError:function(a){return this._input=null,new Error('Syntax error: unexpected "'+a+'" on line '+this._line+".")},tokenize:function(a,b){function c(a){null!==e._input&&(e._input+=a,e._tokenizeToEnd(b,!1))}function d(){null!==e._input&&e._tokenizeToEnd(b,!0)}var e=this;this._line=1,"string"==typeof a?(this._input=a,immediately(function(){e._tokenizeToEnd(b,!0)})):(this._input="",a&&"function"!=typeof a?("function"==typeof a.setEncoding&&a.setEncoding("utf8"),a.on("data",c),a.on("end",d)):(this.addChunk=c,this.end=d,b||(b=a)))}};var RDF_PREFIX="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDF_NIL=RDF_PREFIX+"nil",RDF_FIRST=RDF_PREFIX+"first",RDF_REST=RDF_PREFIX+"rest",absoluteIRI=/:/,documentPart=/[^\/]*$/,rootIRI=/^(?:[^:]+:\/*)?[^\/]*/,blankNodePrefix=0,blankNodeCount=0;N3Parser._resetBlankNodeIds=function(){blankNodePrefix=blankNodeCount=0},N3Parser.prototype={_readInTopContext:function(a){switch(a.type){case"eof":return null!==this._graph?this._error("Unclosed graph",a):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"@prefix":return this._sparqlStyle=!1,this._readPrefix;case"PREFIX":return this._sparqlStyle=!0,this._readPrefix;case"@base":return this._sparqlStyle=!1,this._readBaseIRI;case"BASE":return this._sparqlStyle=!0,this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(a)}},_readSubject:function(a){switch(this._predicate=null,a.type){case"IRI":null===this._baseIRI||absoluteIRI.test(a.value)?this._subject=a.value:this._subject=this._resolveIRI(a);break;case"prefixed":var b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._subject=b+a.value;break;case"[":return this._subject="_:b"+blankNodeCount++,this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"}),this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:RDF_NIL,predicate:null,object:null,type:"list"}),this._subject=null,this._readListItem;case"}":return this._readPunctuation(a);default:return this._error("Expected subject but got "+a.type,a)}return this._readPredicateOrNamedGraph},_readPredicate:function(a){var b=a.type;switch(b){case"IRI":case"abbreviation":null===this._baseIRI||absoluteIRI.test(a.value)?this._predicate=a.value:this._predicate=this._resolveIRI(a);break;case"prefixed":if("_"===a.prefix)return this._error("Disallowed blank node as predicate",a);var c=this._prefixes[a.prefix];if(void 0===c)return this._error('Undefined prefix "'+a.prefix+':"',a);this._predicate=c+a.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+b,a):(this._subject=null,"]"===b?this._readBlankNodeTail(a):this._readPunctuation(a));case";":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',a)}return this._readObject},_readObject:function(a){switch(a.type){case"IRI":null===this._baseIRI||absoluteIRI.test(a.value)?this._object=a.value:this._object=this._resolveIRI(a);break;case"prefixed":var b=this._prefixes[a.prefix];if(void 0===b)return this._error('Undefined prefix "'+a.prefix+':"',a);this._object=b+a.value;break;case"literal":return this._object=a.value,this._readDataTypeOrLang;case"[":var c="_:b"+blankNodeCount++;return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:c,type:"blank"}),this._subject=c,this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:RDF_NIL,type:"list"}),this._subject=null,this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',a)}return this._getTripleEndReader()},_readPredicateOrNamedGraph:function(a){return"{"===a.type?this._readGraph(a):this._readPredicate(a)},_readGraph:function(a){return"{"!==a.type?this._error("Expected graph but got "+a.type,a):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(a){return"]"===a.type?(this._subject=null,this._readBlankNodeTail(a)):(this._predicate=null,this._readPredicate(a))},_readBlankNodeTail:function(a){if("]"!==a.type)return this._readBlankNodePunctuation(a);null!==this._subject&&this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""});var b=this._tripleStack.pop();return this._subject=b.subject,null!==b.object?(this._predicate=b.predicate,this._object=b.object,this._getTripleEndReader()):null!==this._predicate?this._readPredicate:this._readPredicateOrNamedGraph},_readDataTypeOrLang:function(a){switch(a.type){case"type":var b;if(""===a.prefix)b=null===this._baseIRI||absoluteIRI.test(a.value)?a.value:this._resolveIRI(a);else{var c=this._prefixes[a.prefix];if(void 0===c)return this._error('Undefined prefix "'+a.prefix+':"',a);b=c+a.value}return this._object+="^^"+b,this._getTripleEndReader();case"langcode":return this._object+="@"+a.value.toLowerCase(),this._getTripleEndReader();default:return this._getTripleEndReader().call(this,a)}},_readListItem:function(a){var b=null,c=null,d=this._subject,e=this._tripleStack,f=e[e.length-1],g=this._readListItem;switch(a.type){case"IRI":b=a.value;break;case"prefixed":var h=this._prefixes[a.prefix];if(void 0===h)return this._error('Undefined prefix "'+a.prefix+':"',a);b=h+a.value;break;case"literal":b=a.value,g=this._readDataTypeOrLang;break;case"[":c="_:b"+blankNodeCount++,b="_:b"+blankNodeCount++,e.push({subject:c,predicate:RDF_FIRST,object:b,type:"blank"}),this._subject=b,g=this._readBlankNodeHead;break;case"(":c="_:b"+blankNodeCount++,e.push({subject:c,predicate:RDF_FIRST,object:RDF_NIL,type:"list"}),this._subject=null,g=this._readListItem;break;case")":if(e.pop(),0!==e.length&&"list"===e[e.length-1].type&&this._callback(null,{subject:f.subject,predicate:f.predicate,object:f.object,graph:this._graph||""}),this._subject=f.subject,null===f.predicate){if(g=this._readPredicate,f.subject===RDF_NIL)return g}else if(this._predicate=f.predicate,this._object=f.object,g=this._getTripleEndReader(),f.object===RDF_NIL)return g;c=RDF_NIL;break;default:return this._error('Expected list item instead of "'+a.type+'"',a)}return null===c&&(this._subject=c="_:b"+blankNodeCount++),null===d?f.object===RDF_NIL?f.object=c:f.subject=c:this._callback(null,{subject:d,predicate:RDF_REST,object:c,graph:this._graph||""}),null!==b&&this._callback(null,{subject:c,predicate:RDF_FIRST,object:b,graph:this._graph||""}),g},_readPunctuation:function(a){var b,c=this._subject,d=this._graph;switch(a.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",a);this._graph=null;case".":this._subject=null,b=this._readInTopContext;break;case";":b=this._readPredicate;break;case",":b=this._readObject;break;case"IRI":if(this._supportsQuads&&null===this._graph){d=null===this._baseIRI||absoluteIRI.test(a.value)?a.value:this._resolveIRI(a),c=this._subject,b=this._readQuadPunctuation;break}case"prefixed":if(this._supportsQuads&&null===this._graph){var e=this._prefixes[a.prefix];if(void 0===e)return this._error('Undefined prefix "'+a.prefix+':"',a);d=e+a.value,b=this._readQuadPunctuation;break}default:return this._error('Expected punctuation to follow "'+this._object+'"',a)}return null!==c&&this._callback(null,{subject:c,predicate:this._predicate,object:this._object,graph:d||""}),b},_readBlankNodePunctuation:function(a){var b;switch(a.type){case";":b=this._readPredicate;break;case",":b=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',a)}return this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""}),b},_readQuadPunctuation:function(a){return"."!==a.type?this._error("Expected dot to follow quad",a):this._readInTopContext},_readPrefix:function(a){return"prefix"!==a.type?this._error("Expected prefix to follow @prefix",a):(this._prefix=a.value,this._readPrefixIRI)},_readPrefixIRI:function(a){if("IRI"!==a.type)return this._error('Expected IRI to follow prefix "'+this._prefix+':"',a);var b;return b=null===this._baseIRI||absoluteIRI.test(a.value)?a.value:this._resolveIRI(a),this._prefixes[this._prefix]=b,this._prefixCallback(this._prefix,b),this._readDeclarationPunctuation},_readBaseIRI:function(a){return"IRI"!==a.type?this._error("Expected IRI to follow base declaration",a):a.value.indexOf("#")>0?this._error("Invalid base IRI",a):(null===this._baseIRI||absoluteIRI.test(a.value)?this._baseIRI=a.value:this._baseIRI=this._resolveIRI(a),this._baseIRIPath=this._baseIRI.replace(documentPart,""),this._baseIRIRoot=this._baseIRI.match(rootIRI)[0],this._readDeclarationPunctuation)},_readNamedGraphLabel:function(a){switch(a.type){case"IRI":case"prefixed":return this._readSubject(a),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",a)}},_readNamedGraphBlankLabel:function(a){return"]"!==a.type?this._error("Invalid graph label",a):(this._subject="_:b"+blankNodeCount++,this._readGraph)},_readDeclarationPunctuation:function(a){return this._sparqlStyle?this._readInTopContext(a):"."!==a.type?this._error("Expected declaration to end with a dot",a):this._readInTopContext},_getTripleEndReader:function(){var a=this._tripleStack;if(0===a.length)return this._readPunctuation;switch(a[a.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem}},_error:function(a,b){this._callback(new Error(a+" at line "+b.line+"."))},_resolveIRI:function(a){var b=a.value;switch(b[0]){case void 0:return this._baseIRI;case"#":return this._baseIRI+b;case"?":return this._baseIRI.replace(/(?:\?.*)?$/,b);case"/":return this._baseIRIRoot+b;default:return this._baseIRIPath+b}},parse:function(a,b,c){this._readCallback=this._readInTopContext,this._prefixes=Object.create(null),this._prefixes._="_:b"+blankNodePrefix++ +"_","function"==typeof a&&(c=b,b=a,a=null),this._callback=b||noop,this._prefixCallback=c||noop;var d=this;this._lexer.tokenize(a,function(a,b){null!==a?(d._callback(a),d._callback=noop):void 0!==d._readCallback&&(d._readCallback=d._readCallback(b))}),a||(this.addChunk=this._lexer.addChunk,this.end=this._lexer.end)}};var RVN3Parser={};RVN3Parser.parser={async:!0,parse:function(a,b,c,d){d||(d=c,c=b,b=null),b&&"string"==typeof b&&(b={token:"uri",value:b,prefix:null,suffix:null}),c&&c.baseURI&&(c.documentIRI=c.baseURI);var e=[];new N3Parser(c).parse(a,function(a,c){a?d(!1,a):c?e.push({subject:convertEntity(c.subject),predicate:convertEntity(c.predicate),object:convertEntity(c.object),graph:b}):d(!0,e)})},resetBlankNodeIds:function(){N3Parser._resetBlankNodeIds()}};var RDFLoader={};RDFLoader.RDFLoader=function(a){if(this.precedences=["text/turtle","text/n3","application/ld+json","application/json"],this.parsers={"text/turtle":RVN3Parser.parser,"text/n3":RVN3Parser.parser,"application/ld+json":JSONLDParser.parser,"application/json":JSONLDParser.parser},"undefined"!=typeof RDFXMLParser&&(this.precedences.push("application/rdf+xml"),this.parsers["application/rdf+xml"]=RDFXMLParser.parser),null!=a)for(var b in a.parsers)this.parsers[b]=a.parsers[b];if(a&&null!=a.precedences){this.precedences=a.precedences;for(var b in a.parsers)Utils.include(this.precedences,b)||this.precedences.push(b)}this.acceptHeaderValue="";for(var c=0;c<this.precedences.length;c++)0!=c?this.acceptHeaderValue=this.acceptHeaderValue+","+this.precedences[c]:this.acceptHeaderValue=this.acceptHeaderValue+this.precedences[c]},RDFLoader.RDFLoader.prototype.registerParser=function(a,b){this.parsers[a]=b,this.precedences.push(a)},RDFLoader.RDFLoader.prototype.unregisterParser=function(a){delete this.parsers[a];for(var b=[],c=0;c<this.precedences.length;c++)this.precedences[c]!=a&&b.push(this.precedences[c]);this.precedences=b},RDFLoader.RDFLoader.prototype.setAcceptHeaderPrecedence=function(a){this.precedences=a},RDFLoader.RDFLoader.prototype.load=function(a,b,c){var d=this;NetworkTransport.load(a,this.acceptHeaderValue,function(e,f){if(1==e){var g=f.headers["Content-Type"]||f.headers["content-type"],h=f.data;
if(null!=g){g=g.split(";")[0];for(var i in d.parsers)if(-1!=i.indexOf("/")){var j=i.split("/");if("*"===j[1]){if(-1!=g.indexOf(j[0]))return d.tryToParse(d.parsers[i],b,h,{documentURI:a},c)}else{if(-1!=g.indexOf(i))return d.tryToParse(d.parsers[i],b,h,{documentURI:a},c);if(-1!=g.indexOf(j[1]))return d.tryToParse(d.parsers[i],b,h,{documentURI:a},c)}}else if(-1!=g.indexOf(i))return d.tryToParse(d.parsers[i],b,h,{documentURI:a},c);c(!1,"Unknown media type : "+g)}else console.log("Unknown media type"),console.log(f.headers),c(!1,"Uknown media type")}else c(!1,"Network error: "+f)})},RDFLoader.RDFLoader.prototype.loadFromFile=function(a,b,c,d){try{var e=this,f=require("fs");f.readFile(c.split("file:/")[1],function(f,g){if(f)throw f;var g=g.toString("utf8");e.tryToParse(a,b,g,{documentURI:c},d)})}catch(g){d(!1,g)}},RDFLoader.RDFLoader.prototype.tryToParse=function(a,b,c,d,e){try{if("string"==typeof c&&(c=Utils.normalizeUnicodeLiterals(c)),a.async)a.parse(c,b,d,e);else{var f=a.parse(c,b,d);null!=f?e(!0,f):e(!1,"parsing error")}}catch(g){console.log(g.message),console.log(g.stack),e(!1,"parsing error with mime type : "+g)}};var AbstractQueryTree={};AbstractQueryTree.AbstractQueryTree=function(){},AbstractQueryTree.AbstractQueryTree.prototype.parseQueryString=function(a){return SparqlParser.parser.parse(a)},AbstractQueryTree.AbstractQueryTree.prototype.parseExecutableUnit=function(a){if("select"===a.kind)return this.parseSelect(a);if("ask"===a.kind)return this.parseSelect(a);if("modify"===a.kind)return this.parseSelect(a);if("construct"===a.kind)return this.parseSelect(a);if("insertdata"===a.kind)return this.parseInsertData(a);if("deletedata"===a.kind)return this.parseInsertData(a);if("load"===a.kind)return a;if("clear"===a.kind)return a;if("drop"===a.kind)return a;if("create"===a.kind)return a;throw new Error("unknown executable unit: "+a.kind)},AbstractQueryTree.AbstractQueryTree.prototype.parseSelect=function(a){if(null==a)return console.log("error parsing query"),null;var b={freshCounter:0};return a.pattern=this.build(a.pattern,b),a},AbstractQueryTree.AbstractQueryTree.prototype.parseInsertData=function(a){return null==a?(console.log("error parsing query"),null):a},AbstractQueryTree.AbstractQueryTree.prototype.build=function(a,b){if("groupgraphpattern"===a.token)return this._buildGroupGraphPattern(a,b);if("basicgraphpattern"===a.token){var c={kind:"BGP",value:a.triplesContext};return c=AbstractQueryTree.translatePathExpressionsInBGP(c,b)}if("graphunionpattern"===a.token){var d=this.build(a.value[0],b),e=this.build(a.value[1],b);return{kind:"UNION",value:[d,e]}}if("graphgraphpattern"===a.token){var f=this.build(a.value,b);return{kind:"GRAPH",value:f,graph:a.graph}}throw new Error("not supported token in query:"+a.token)},AbstractQueryTree.translatePathExpressionsInBGP=function(a,b){for(var c,d,e,f=[],g=0;g<a.value.length;g++)if(a.value[g].predicate&&"path"===a.value[g].predicate.token){c=a.value[g],d=a.value.slice(g+1);var h=AbstractQueryTree.translatePathExpression(c,b),i=null;if("BGP"!==h.kind){if("ZERO_OR_MORE_PATH"===h.kind||"ONE_OR_MORE_PATH"===h.kind){if(e=f.length>0?{kind:"JOIN",lvalue:{kind:"BGP",value:f},rvalue:h}:h,"ZERO_OR_MORE_PATH"===h.kind)if("var"===h.y.token&&0===h.y.value.indexOf("fresh:")&&"var"===h.x.token&&0===h.x.value.indexOf("fresh:"))for(var j=0;j<a.value.length;j++)a.value[j].object&&"var"===a.value[j].object.token&&a.value[j].object.value===h.x.value&&(i=Utils.clone(a.value[j]),i.object=h.y);else if("var"===h.y.token&&0===h.y.value.indexOf("fresh:"))for(var j=0;j<a.value.length;j++)a.value[j].subject&&"var"===a.value[j].subject.token&&a.value[j].subject.value===h.y.value&&(i=Utils.clone(a.value[j]),i.subject=h.x);if(d.length>0){var k=AbstractQueryTree.translatePathExpressionsInBGP({kind:"BGP",value:d},b);if(null!=i){var l=f.concat([i]).concat(d);return{kind:"UNION",value:[{kind:"JOIN",lvalue:e,rvalue:k},{kind:"BGP",value:l}]}}return{kind:"JOIN",lvalue:e,rvalue:k}}return e}return h}f=f.concat(h.value)}else f.push(a.value[g]);return a.value=f,a},AbstractQueryTree.translatePathExpression=function(a,b){if("element"===a.predicate.kind){if("+"===a.predicate.modifier){a.predicate.modifier=null;var c=AbstractQueryTree.translatePathExpression(a,b);return{kind:"ONE_OR_MORE_PATH",path:c,x:a.subject,y:a.object}}if("*"===a.predicate.modifier){a.predicate.modifier=null;var c=AbstractQueryTree.translatePathExpression(a,b);return{kind:"ZERO_OR_MORE_PATH",path:c,x:a.subject,y:a.object}}return a.predicate=a.predicate.value,{kind:"BGP",value:[a]}}if("sequence"===a.predicate.kind){for(var d,e,f=a.subject,g=a.object,h=a.graph,i=[],j=0;j<a.predicate.value.length;j++)j!=a.predicate.value.length-1?(d={token:"var",value:"fresh:"+b.freshCounter},b.freshCounter++):d=g,e={subject:f,predicate:a.predicate.value[j],object:d},null!=h&&(e.graph=Utils.clone(h)),i.push(e),j!=a.predicate.value.length-1&&(f=Utils.clone(d));var k={kind:"BGP",value:i};return AbstractQueryTree.translatePathExpressionsInBGP(k,b)}},AbstractQueryTree.AbstractQueryTree.prototype._buildGroupGraphPattern=function(a,b){for(var c=a.filters||[],d={kind:"EMPTY_PATTERN"},e=0;e<a.patterns.length;e++){var f=a.patterns[e];if("optionalgraphpattern"===f.token){var g=this.build(f.value,b);d="FILTER"===g.kind?{kind:"LEFT_JOIN",lvalue:d,rvalue:g.value,filter:g.filter}:{kind:"LEFT_JOIN",lvalue:d,rvalue:g,filter:!0}}else{var g=this.build(f,b);d="EMPTY_PATTERN"==d.kind?g:{kind:"JOIN",lvalue:d,rvalue:g}}}if(0!=c.length){if("EMPTY_PATTERN"===d.kind)return{kind:"FILTER",filter:c,value:d};if("LEFT_JOIN"===d.kind&&d.filter===!0)return{kind:"FILTER",filter:c,value:d};if("LEFT_JOIN"===d.kind)return{kind:"FILTER",filter:c,value:d};if("JOIN"===d.kind)return{kind:"FILTER",filter:c,value:d};if("UNION"===d.kind)return{kind:"FILTER",filter:c,value:d};if("GRAPH"===d.kind)return{kind:"FILTER",filter:c,value:d};if("BGP"===d.kind)return{kind:"FILTER",filter:c,value:d};throw new Error("Unknow kind of algebra expression: "+d.kind)}return d},AbstractQueryTree.AbstractQueryTree.prototype.collectBasicTriples=function(a,b){if(null==b&&(b=[]),"select"===a.kind)b=this.collectBasicTriples(a.pattern,b);else if("BGP"===a.kind)b=b.concat(a.value);else if("ZERO_OR_MORE_PATH"===a.kind)b=this.collectBasicTriples(a.path);else if("UNION"===a.kind)b=this.collectBasicTriples(a.value[0],b),b=this.collectBasicTriples(a.value[1],b);else if("GRAPH"===a.kind)b=this.collectBasicTriples(a.value,b);else if("LEFT_JOIN"===a.kind||"JOIN"===a.kind)b=this.collectBasicTriples(a.lvalue,b),b=this.collectBasicTriples(a.rvalue,b);else if("FILTER"===a.kind)b=this.collectBasicTriples(a.value,b);else if("construct"===a.kind)b=this.collectBasicTriples(a.pattern,b);else if("EMPTY_PATTERN"!==a.kind)throw"Unknown pattern: "+a.kind;return b},AbstractQueryTree.AbstractQueryTree.prototype.bind=function(a,b){if(null!=a.graph&&a.graph.token&&"var"===a.graph.token&&null!=b[a.graph.value]&&(a.graph=b[a.graph.value]),null!=a.filter){for(var c=[],d=0;d<a.filter.length;d++)a.filter[d].value=this._bindFilter(a.filter[d].value,b),c.push(a.filter[d]);a.filter=c}if("select"===a.kind)a.pattern=this.bind(a.pattern,b);else if("BGP"===a.kind)a.value=this._bindTripleContext(a.value,b);else if("ZERO_OR_MORE_PATH"===a.kind)a.path=this._bindTripleContext(a.path,b),a.x&&"var"===a.x.token&&null!=b[a.x.value]&&(a.x=b[a.x.value]),a.y&&"var"===a.y.token&&null!=b[a.y.value]&&(a.y=b[a.y.value]);else if("UNION"===a.kind)a.value[0]=this.bind(a.value[0],b),a.value[1]=this.bind(a.value[1],b);else if("GRAPH"===a.kind)a.value=this.bind(a.value,b);else if("LEFT_JOIN"===a.kind||"JOIN"===a.kind)a.lvalue=this.bind(a.lvalue,b),a.rvalue=this.bind(a.rvalue,b);else if("FILTER"===a.kind)a.filter=this._bindFilter(a.filter[d].value,b);else if("EMPTY_PATTERN"!==a.kind)throw"Unknown pattern: "+a.kind;return a},AbstractQueryTree.AbstractQueryTree.prototype._bindTripleContext=function(a,b){for(var c=0;c<a.length;c++){delete a[c].graph,delete a[c].variables;for(var d in a[c]){var e=a[c][d];"var"===e.token&&null!=b[e.value]&&(a[c][d]=b[e.value])}}return a},AbstractQueryTree.AbstractQueryTree.prototype._bindFilter=function(a,b){if(null!=a.expressionType){var c=a.expressionType;if("relationalexpression"==c)a.op1=this._bindFilter(a.op1,b),a.op2=this._bindFilter(a.op2,b);else if("conditionalor"==c||"conditionaland"==c)for(var d=0;d<a.operands.length;d++)a.operands[d]=this._bindFilter(a.operands[d],b);else if("additiveexpression"==c){a.summand=this._bindFilter(a.summand,b);for(var d=0;d<a.summands.length;d++)a.summands[d].expression=this._bindFilter(a.summands[d].expression,b)}else if("builtincall"==c)for(var d=0;d<a.args.length;d++)a.args[d]=this._bindFilter(a.args[d],b);else if("multiplicativeexpression"==c){a.factor=this._bindFilter(a.factor,b);for(var d=0;d<a.factors.length;d++)a.factors[d].expression=this._bindFilter(a.factors[d].expression,b)}else if("unaryexpression"==c)a.expression=this._bindFilter(a.expression,b);else if("irireforfunction"==c)for(var d=0;d<a.factors.args;d++)a.args[d]=this._bindFilter(a.args[d],b);else if("atomic"==c&&"var"==a.primaryexpression&&null!=b[a.value.value]){var e=b[a.value.value];"uri"===e.token?a.primaryexpression="iri":a.primaryexpression="literal",a.value=e}}return a},AbstractQueryTree.AbstractQueryTree.prototype.replace=function(a,b,c,d){if(null!=a.graph&&a.graph.token&&a.graph.token===b.token&&a.graph.value==b.value&&(a.graph=Utils.clone(c)),null!=a.filter){for(var e=[],f=0;f<a.filter.length;f++)a.filter[f].value=this._replaceFilter(a.filter[f].value,b,c,d),e.push(a.filter[f]);a.filter=e}if("select"===a.kind)a.pattern=this.replace(a.pattern,b,c,d);else if("BGP"===a.kind)a.value=this._replaceTripleContext(a.value,b,c,d);else if("ZERO_OR_MORE_PATH"===a.kind)a.path=this._replaceTripleContext(a.path,b,c,d),a.x&&a.x.token===b.token&&a.value===b.value&&(a.x=Utils.clone(c)),a.y&&a.y.token===b.token&&a.value===b.value&&(a.y=Utils.clone(c));else if("UNION"===a.kind)a.value[0]=this.replace(a.value[0],b,c,d),a.value[1]=this.replace(a.value[1],b,c,d);else if("GRAPH"===a.kind)a.value=this.replace(a.value,b,c);else if("LEFT_JOIN"===a.kind||"JOIN"===a.kind)a.lvalue=this.replace(a.lvalue,b,c,d),a.rvalue=this.replace(a.rvalue,b,c,d);else if("FILTER"===a.kind)a.value=this._replaceFilter(a.value,b,c,d);else if("EMPTY_PATTERN"!==a.kind)throw"Unknown pattern: "+a.kind;return a},AbstractQueryTree.AbstractQueryTree.prototype._replaceTripleContext=function(a,b,c,d){for(var e=0;e<a.length;e++)for(var f in a[e]){var g=a[e][f];"var"===g.token&&"var"===b.token&&g.value===b.value?a[e][f]=c:"blank"===g.token&&"blank"===b.token&&g.value===b.value?a[e][f]=c:"literal"!==g.token&&"uri"!==g.token||"literal"!==b.token&&"uri"!==b.token||g.token!==b.token||Utils.lexicalFormTerm(g,d)[g.token]!==Utils.lexicalFormTerm(b,d)[g.token]||(a[e][f]=c)}return a},AbstractQueryTree.AbstractQueryTree.prototype._replaceFilter=function(a,b,c,d){if(null!=a.expressionType){var e=a.expressionType;if("relationalexpression"==e)a.op1=this._replaceFilter(a.op1,b,c,d),a.op2=this._replaceFilter(a.op2,b,c,d);else if("conditionalor"==e||"conditionaland"==e)for(var f=0;f<a.operands.length;f++)a.operands[f]=this._replaceFilter(a.operands[f],b,c,d);else if("additiveexpression"==e){a.summand=this._replaceFilter(a.summand,b,c,d);for(var f=0;f<a.summands.length;f++)a.summands[f].expression=this._replaceFilter(a.summands[f].expression,b,c,d)}else if("builtincall"==e)for(var f=0;f<a.args.length;f++)a.args[f]=this._replaceFilter(a.args[f],b,c,d);else if("multiplicativeexpression"==e){a.factor=this._replaceFilter(a.factor,b,c,d);for(var f=0;f<a.factors.length;f++)a.factors[f].expression=this._replaceFilter(a.factors[f].expression,b,c,d)}else if("unaryexpression"==e)a.expression=this._replaceFilter(a.expression,b,c,d);else if("irireforfunction"==e)for(var f=0;f<a.factors.args;f++)a.args[f]=this._replaceFilter(a.args[f],b,c,d);else if("atomic"==e){var g=null;a.primaryexpression==b.token&&a.value==b.value?g=c.value:"iri"==a.primaryexpression&&"uri"==b.token&&a.value==b.value&&(g=c.value),null!=g&&("uri"===c.token?a.primaryexpression="iri":a.primaryexpression=c.token,a.value=g)}}return a},AbstractQueryTree.AbstractQueryTree.prototype.treeWithUnion=function(a){if(null==a)return!1;if(null==a.kind)return!1;if("select"===a.kind)return this.treeWithUnion(a.pattern);if("BGP"===a.kind)return this.treeWithUnion(a.value);if("ZERO_OR_MORE_PATH"===a.kind)return!1;if("UNION"===a.kind){if(null==a.value[0].value||null==a.value[0].value.variables||null==a.value[1].value||null==a.value[1].value.variables)return!0;if(a.value[0].variables.join("/")===a.values[1].variables.join("/"))return this.treeWithUnion(a.value[0])?!0:this.treeWithUnion(a.value[1])}else{if("GRAPH"===a.kind)return!1;if("LEFT_JOIN"!==a.kind&&"JOIN"!==a.kind)return"FILTER"===a.kind?!1:"EMPTY_PATTERN"===a.kind?!1:!1;var b=this.treeWithUnion(a.lvalue);if(b)return!0;this.treeWithUnion(a.rvalue)}};var SparqlParser={};SparqlParser.parser=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var b={parse:function(b,c){function d(a){Sb>Qb||(Qb>Sb&&(Sb=Qb,Tb=[]),Tb.push(a))}function e(){var a;return a=f(),null===a&&(a=E()),a}function f(){var a,b,c,e;return Rb++,c=Qb,e=Qb,a=g(),null!==a?(b=j(),null===b&&(b=m(),null===b&&(b=n(),null===b&&(b=o()))),null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e),null!==a&&(a=function(a,b,c){return{token:"query",kind:"query",prologue:b,units:[c]}}(c,a[0],a[1])),null===a&&(Qb=c),Rb--,0===Rb&&null===a&&d("[2] Query"),a}function g(){var a,b,c,e,f,g;if(Rb++,f=Qb,g=Qb,a=h(),a=null!==a?a:"",null!==a){for(b=[],c=Eb();null!==c;)b.push(c),c=Eb();if(null!==b){for(c=[],e=i();null!==e;)c.push(e),e=i();null!==c?a=[a,b,c]:(a=null,Qb=g)}else a=null,Qb=g}else a=null,Qb=g;return null!==a&&(a=function(a,b,c){return{token:"prologue",base:b,prefixes:c}}(f,a[0],a[2])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[3] Prologue"),a}function h(){var a,c,e,f,g,h;for(Rb++,g=Qb,h=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("BASE"===b.substr(Qb,4)?(c="BASE",Qb+=4):(c=null,0===Rb&&d('"BASE"')),null===c&&("base"===b.substr(Qb,4)?(c="base",Qb+=4):(c=null,0===Rb&&d('"base"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();null!==e?(f=hb(),null!==f?a=[a,c,e,f]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;else a=null,Qb=h;return null!==a&&(a=function(a,b){Yb(b);var c={};return c.token="base",c.value=b,c}(g,a[3])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[4] BaseDecl"),a}function i(){var a,c,e,f,g,h,i,j;for(Rb++,i=Qb,j=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("PREFIX"===b.substr(Qb,6)?(c="PREFIX",Qb+=6):(c=null,0===Rb&&d('"PREFIX"')),null===c&&("prefix"===b.substr(Qb,6)?(c="prefix",Qb+=6):(c=null,0===Rb&&d('"prefix"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=ib(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=hb(),null!==h?a=[a,c,e,f,g,h]:(a=null,Qb=j)):(a=null,Qb=j)}else a=null,Qb=j;else a=null,Qb=j}else a=null,Qb=j;else a=null,Qb=j;return null!==a&&(a=function(a,b,c){Xb(b,c);var d={};return d.token="prefix",d.prefix=b,d.local=c,d}(i,a[3],a[5])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[5] PrefixDecl"),a}function j(){var a,b,c,e,f,g,h,i,j,k,m;if(Rb++,k=Qb,m=Qb,a=l(),null!==a){for(b=[],c=Eb();null!==c;)b.push(c),c=Eb();if(null!==b){for(c=[],e=p();null!==e;)c.push(e),e=p();if(null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=s(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(h=t(),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?(j=C(),null!==j?a=[a,b,c,e,f,g,h,i,j]:(a=null,Qb=m)):(a=null,Qb=m)}else a=null,Qb=m;else a=null,Qb=m}else a=null,Qb=m;else a=null,Qb=m}else a=null,Qb=m}else a=null,Qb=m}else a=null,Qb=m;return null!==a&&(a=function(a,b,c,d,e){for(var f={named:[],implicit:[]},g=0;g<c.length;g++){var h=c[g];"default"===h.kind?f.implicit.push(h.graph):f.named.push(h.graph)}0===f.named.length&&0===f.implicit.length&&f.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});var i={};return i.kind="select",i.token="executableunit",i.dataset=f,i.projection=b.vars,i.modifier=b.modifier,i.pattern=d,null!=e&&null!=e.limit&&(i.limit=e.limit),null!=e&&null!=e.offset&&(i.offset=e.offset),null!=e&&null!=e.order&&""!=e.order&&(i.order=e.order),null!=e&&null!=e.group&&(i.group=e.group),i}(k,a[0],a[2],a[4],a[6])),null===a&&(Qb=k),Rb--,0===Rb&&null===a&&d("[6] SelectQuery"),a}function k(){var a,b,c,e;return Rb++,e=Qb,a=l(),null!==a?(b=s(),null!==b?(c=t(),null!==c?a=[a,b,c]:(a=null,Qb=e)):(a=null,Qb=e)):(a=null,Qb=e),Rb--,0===Rb&&null===a&&d("[7] SubSelect"),a}function l(){var a,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(Rb++,u=Qb,v=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("SELECT"===b.substr(Qb,6)?(c="SELECT",Qb+=6):(c=null,0===Rb&&d('"SELECT"')),null===c&&("select"===b.substr(Qb,6)?(c="select",Qb+=6):(c=null,0===Rb&&d('"select"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("DISTINCT"===b.substr(Qb,8)?(f="DISTINCT",Qb+=8):(f=null,0===Rb&&d('"DISTINCT"')),null===f&&("distinct"===b.substr(Qb,8)?(f="distinct",Qb+=8):(f=null,0===Rb&&d('"distinct"'))),null===f&&("REDUCED"===b.substr(Qb,7)?(f="REDUCED",Qb+=7):(f=null,0===Rb&&d('"REDUCED"')),null===f&&("reduced"===b.substr(Qb,7)?(f="reduced",Qb+=7):(f=null,0===Rb&&d('"reduced"')))),f=null!==f?f:"",null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g){for(w=Qb,i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(j=Ja(),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();null!==k?i=[i,j,k]:(i=null,Qb=w)}else i=null,Qb=w;else i=null,Qb=w;if(null===i){for(w=Qb,i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(40===b.charCodeAt(Qb)?(j="(",Qb++):(j=null,0===Rb&&d('"("')),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();if(null!==k)if(l=La(),null!==l){for(m=[],n=Eb();null!==n;)m.push(n),n=Eb();if(null!==m)if("AS"===b.substr(Qb,2)?(n="AS",Qb+=2):(n=null,0===Rb&&d('"AS"')),null===n&&("as"===b.substr(Qb,2)?(n="as",Qb+=2):(n=null,0===Rb&&d('"as"'))),null!==n){for(o=[],p=Eb();null!==p;)o.push(p),p=Eb();if(null!==o)if(p=Ja(),null!==p){for(q=[],r=Eb();null!==r;)q.push(r),r=Eb();if(null!==q)if(41===b.charCodeAt(Qb)?(r=")",Qb++):(r=null,0===Rb&&d('")"')),null!==r){for(s=[],t=Eb();null!==t;)s.push(t),t=Eb();null!==s?i=[i,j,k,l,m,n,o,p,q,r,s]:(i=null,Qb=w)}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}if(null!==i)for(h=[];null!==i;){for(h.push(i),w=Qb,i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(j=Ja(),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();null!==k?i=[i,j,k]:(i=null,Qb=w)}else i=null,Qb=w;else i=null,Qb=w;if(null===i){for(w=Qb,i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(40===b.charCodeAt(Qb)?(j="(",Qb++):(j=null,0===Rb&&d('"("')),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();if(null!==k)if(l=La(),null!==l){for(m=[],n=Eb();null!==n;)m.push(n),n=Eb();if(null!==m)if("AS"===b.substr(Qb,2)?(n="AS",Qb+=2):(n=null,0===Rb&&d('"AS"')),null===n&&("as"===b.substr(Qb,2)?(n="as",Qb+=2):(n=null,0===Rb&&d('"as"'))),null!==n){for(o=[],p=Eb();null!==p;)o.push(p),p=Eb();if(null!==o)if(p=Ja(),null!==p){for(q=[],r=Eb();null!==r;)q.push(r),r=Eb();if(null!==q)if(41===b.charCodeAt(Qb)?(r=")",Qb++):(r=null,0===Rb&&d('")"')),null!==r){for(s=[],t=Eb();null!==t;)s.push(t),t=Eb();null!==s?i=[i,j,k,l,m,n,o,p,q,r,s]:(i=null,Qb=w)}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}else i=null,Qb=w;else i=null,Qb=w}}else h=null;if(null===h){for(w=Qb,h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(42===b.charCodeAt(Qb)?(i="*",Qb++):(i=null,0===Rb&&d('"*"')),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();null!==j?h=[h,i,j]:(h=null,Qb=w)}else h=null,Qb=w;else h=null,Qb=w}null!==h?a=[a,c,e,f,g,h]:(a=null,Qb=v)}else a=null,Qb=v}else a=null,Qb=v;else a=null,Qb=v}else a=null,Qb=v;else a=null,Qb=v;return null!==a&&(a=function(a,b,c){var d=[];if(3===c.length&&"*"===c[1])return{vars:[{token:"variable",kind:"*"}],modifier:Zb(b)};for(var e=0;e<c.length;e++){var f=c[e];3===f.length?d.push({token:"variable",kind:"var",value:f[1]}):d.push({token:"variable",kind:"aliased",expression:f[3],alias:f[7]})}return{vars:d,modifier:Zb(b)}}(u,a[3],a[5])),null===a&&(Qb=u),Rb--,0===Rb&&null===a&&d("[8] SelectClause"),a}function m(){var a,c,e,f,g,h,i,j,k,l,m,n;for(Rb++,m=Qb,n=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("CONSTRUCT"===b.substr(Qb,9)?(c="CONSTRUCT",Qb+=9):(c=null,0===Rb&&d('"CONSTRUCT"')),null===c&&("construct"===b.substr(Qb,9)?(c="construct",Qb+=9):(c=null,0===Rb&&d('"construct"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=ka(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g){for(h=[],i=p();null!==i;)h.push(i),i=p();if(null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(j=s(),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();null!==k?(l=t(),null!==l?a=[a,c,e,f,g,h,i,j,k,l]:(a=null,Qb=n)):(a=null,Qb=n)}else a=null,Qb=n;else a=null,Qb=n}else a=null,Qb=n}else a=null,Qb=n}else a=null,Qb=n;else a=null,Qb=n}else a=null,Qb=n;else a=null,Qb=n;return null!==a&&(a=function(a,b,c,d,e){for(var f={named:[],implicit:[]},g=0;g<c.length;g++){var h=c[g];"default"===h.kind?f.implicit.push(h.graph):f.named.push(h.graph)}0===f.named.length&&0===f.implicit.length&&f.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});var i={};return i.kind="construct",i.token="executableunit",i.dataset=f,i.template=b,i.pattern=d,null!=e&&null!=e.limit&&(i.limit=e.limit),null!=e&&null!=e.offset&&(i.offset=e.offset),null!=e&&null!=e.order&&""!=e.order&&(i.order=e.order),i}(m,a[3],a[5],a[7],a[9])),null===a&&(Qb=m),Rb--,0===Rb&&null===a&&d("[9] ConstructQuery"),a}function n(){var a,c,e,f,g,h;if(Rb++,h=Qb,"DESCRIBE"===b.substr(Qb,8)?(a="DESCRIBE",Qb+=8):(a=null,0===Rb&&d('"DESCRIBE"')),null!==a){if(e=Ia(),null!==e)for(c=[];null!==e;)c.push(e),e=Ia();else c=null;if(null===c&&(42===b.charCodeAt(Qb)?(c="*",Qb++):(c=null,0===Rb&&d('"*"'))),null!==c){for(e=[],f=p();null!==f;)e.push(f),f=p();null!==e?(f=s(),f=null!==f?f:"",null!==f?(g=t(),null!==g?a=[a,c,e,f,g]:(a=null,Qb=h)):(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h}else a=null,Qb=h;return Rb--,0===Rb&&null===a&&d("[10] DescribeQuery"),a}function o(){var a,c,e,f,g,h,i,j;for(Rb++,i=Qb,j=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("ASK"===b.substr(Qb,3)?(c="ASK",Qb+=3):(c=null,0===Rb&&d('"ASK"')),null===c&&("ask"===b.substr(Qb,3)?(c="ask",Qb+=3):(c=null,0===Rb&&d('"ask"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e){for(f=[],g=p();null!==g;)f.push(g),g=p();if(null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=s(),null!==h?a=[a,c,e,f,g,h]:(a=null,Qb=j)):(a=null,Qb=j)}else a=null,Qb=j}else a=null,Qb=j}else a=null,Qb=j;else a=null,Qb=j;return null!==a&&(a=function(a,b,c){for(var d={named:[],implicit:[]},e=0;e<b.length;e++){var f=b[e];"implicit"===f.kind?d.implicit.push(f.graph):d.named.push(f.graph)}0===d.named.length&&0===d.implicit.length&&d.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});var g={};return g.kind="ask",g.token="executableunit",g.dataset=d,g.pattern=c,g}(i,a[3],a[5])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[11] AskQuery"),a}function p(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"FROM"===b.substr(Qb,4)?(a="FROM",Qb+=4):(a=null,0===Rb&&d('"FROM"')),null===a&&("from"===b.substr(Qb,4)?(a="from",Qb+=4):(a=null,0===Rb&&d('"from"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=q(),null===e&&(e=r()),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?a=[a,c,e,f]:(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){return b}(h,a[2])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[12] DatasetClause"),a}function q(){var a,b,c,e;for(Rb++,c=Qb,e=Qb,a=[],b=Eb();null!==b;)a.push(b),b=Eb();return null!==a?(b=eb(),null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e),null!==a&&(a=function(a,b){return{graph:b,kind:"default",token:"graphClause"}}(c,a[1])),null===a&&(Qb=c),Rb--,0===Rb&&null===a&&d("[13] DefaultGraphClause"),a}function r(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,"NAMED"===b.substr(Qb,5)?(a="NAMED",Qb+=5):(a=null,0===Rb&&d('"NAMED"')),null===a&&("named"===b.substr(Qb,5)?(a="named",Qb+=5):(a=null,0===Rb&&d('"named"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=eb(),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b){return{graph:b,kind:"named",token:"graphCluase"}}(f,a[2])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[14] NamedGraphClause"),a}function s(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"WHERE"===b.substr(Qb,5)?(a="WHERE",Qb+=5):(a=null,0===Rb&&d('"WHERE"')),null===a&&("where"===b.substr(Qb,5)?(a="where",Qb+=5):(a=null,0===Rb&&d('"where"'))),a=null!==a?a:"",null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=Y(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?a=[a,c,e,f]:(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){return b}(h,a[2])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[16] WhereClause"),a}function t(){var a,b,c,e,f,g;return Rb++,f=Qb,g=Qb,a=u(),a=null!==a?a:"",null!==a?(b=w(),b=null!==b?b:"",null!==b?(c=x(),c=null!==c?c:"",null!==c?(e=z(),e=null!==e?e:"",null!==e?a=[a,b,c,e]:(a=null,Qb=g)):(a=null,Qb=g)):(a=null,Qb=g)):(a=null,Qb=g),null!==a&&(a=function(a,b,c,d){var e={};return null!=d&&(null!=d.limit&&(e.limit=d.limit),null!=d.offset&&(e.offset=d.offset)),null!=b&&(e.group=b),e.order=c,e}(f,a[0],a[2],a[3])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[17] SolutionModifier"),a}function u(){var a,c,e,f,g,h,i,j;if(Rb++,i=Qb,j=Qb,"GROUP"===b.substr(Qb,5)?(a="GROUP",Qb+=5):(a=null,0===Rb&&d('"GROUP"')),null===a&&("group"===b.substr(Qb,5)?(a="group",Qb+=5):(a=null,0===Rb&&d('"group"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("BY"===b.substr(Qb,2)?(e="BY",Qb+=2):(e=null,0===Rb&&d('"BY"')),null===e&&("by"===b.substr(Qb,2)?(e="by",Qb+=2):(e=null,0===Rb&&d('"by"'))),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f){if(h=v(),null!==h)for(g=[];null!==h;)g.push(h),h=v();else g=null;null!==g?a=[a,c,e,f,g]:(a=null,Qb=j)}else a=null,Qb=j}else a=null,Qb=j;else a=null,Qb=j}else a=null,Qb=j;return null!==a&&(a=function(a,b){return b}(i,a[4])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[18] GroupClause"),a}function v(){var a,c,e,f,g,h,i,j,k,l,m,n,o;for(Rb++,m=Qb,n=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(c=Ta(),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();null!==e?a=[a,c,e]:(a=null,Qb=n)}else a=null,Qb=n;else a=null,Qb=n;if(null!==a&&(a=function(a,b){return b}(m,a[1])),null===a&&(Qb=m),null===a){for(m=Qb,n=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(c=ha(),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();null!==e?a=[a,c,e]:(a=null,Qb=n)}else a=null,Qb=n;else a=null,Qb=n;if(null!==a&&(a=function(a,b){return b}(m,a[1])),null===a&&(Qb=m),null===a){for(m=Qb,n=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(40===b.charCodeAt(Qb)?(c="(",Qb++):(c=null,0===Rb&&d('"("')),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=La(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g){if(o=Qb,"AS"===b.substr(Qb,2)?(h="AS",Qb+=2):(h=null,0===Rb&&d('"AS"')),null===h&&("as"===b.substr(Qb,2)?(h="as",Qb+=2):(h=null,0===Rb&&d('"as"'))),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?(j=Ja(),null!==j?h=[h,i,j]:(h=null,Qb=o)):(h=null,Qb=o)}else h=null,Qb=o;if(h=null!==h?h:"",null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(41===b.charCodeAt(Qb)?(j=")",Qb++):(j=null,0===Rb&&d('")"')),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();null!==k?a=[a,c,e,f,g,h,i,j,k]:(a=null,Qb=n)}else a=null,Qb=n;else a=null,Qb=n}else a=null,Qb=n}else a=null,Qb=n}else a=null,Qb=n;else a=null,Qb=n}else a=null,Qb=n;else a=null,Qb=n;if(null!==a&&(a=function(a,b,c){return 0!=c.length?{token:"aliased_expression",expression:b,alias:c[2]}:b}(m,a[3],a[5])),null===a&&(Qb=m),null===a){for(m=Qb,n=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(c=Ja(),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();null!==e?a=[a,c,e]:(a=null,Qb=n)}else a=null,Qb=n;else a=null,Qb=n;null!==a&&(a=function(a,b){return b}(m,a[1])),null===a&&(Qb=m)}}}return Rb--,0===Rb&&null===a&&d("[19] GroupCondition"),a}function w(){var a,c,e,f;if(Rb++,f=Qb,"HAVING"===b.substr(Qb,6)?(a="HAVING",Qb+=6):(a=null,0===Rb&&d('"HAVING"')),null!==a){if(e=ga(),null!==e)for(c=[];null!==e;)c.push(e),e=ga();else c=null;null!==c?a=[a,c]:(a=null,Qb=f)}else a=null,Qb=f;return Rb--,0===Rb&&null===a&&d("[20] HavingClause"),a}function x(){var a,c,e,f,g,h,i,j,k;if(Rb++,j=Qb,k=Qb,"ORDER"===b.substr(Qb,5)?(a="ORDER",Qb+=5):(a=null,0===Rb&&d('"ORDER"')),null===a&&("order"===b.substr(Qb,5)?(a="order",Qb+=5):(a=null,0===Rb&&d('"order"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("BY"===b.substr(Qb,2)?(e="BY",Qb+=2):(e=null,0===Rb&&d('"BY"')),null===e&&("by"===b.substr(Qb,2)?(e="by",Qb+=2):(e=null,0===Rb&&d('"by"'))),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f){if(h=y(),null!==h)for(g=[];null!==h;)g.push(h),h=y();else g=null;if(null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?a=[a,c,e,f,g,h]:(a=null,Qb=k)}else a=null,Qb=k}else a=null,Qb=k}else a=null,Qb=k;else a=null,Qb=k}else a=null,Qb=k;return null!==a&&(a=function(a,b){return b}(j,a[4])),null===a&&(Qb=j),Rb--,0===Rb&&null===a&&d("[22] OrderClause"),a}function y(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"ASC"===b.substr(Qb,3)?(a="ASC",Qb+=3):(a=null,0===Rb&&d('"ASC"')),null===a&&("asc"===b.substr(Qb,3)?(a="asc",Qb+=3):(a=null,0===Rb&&d('"asc"')),null===a&&("DESC"===b.substr(Qb,4)?(a="DESC",Qb+=4):(a=null,0===Rb&&d('"DESC"')),null===a&&("desc"===b.substr(Qb,4)?(a="desc",Qb+=4):(a=null,0===Rb&&d('"desc"'))))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=Sa(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?a=[a,c,e,f]:(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;if(null!==a&&(a=function(a,b,c){return{direction:b.toUpperCase(),expression:c}}(h,a[0],a[2])),null===a&&(Qb=h),null===a){if(h=Qb,i=Qb,a=ga(),null===a&&(a=Ja()),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?a=[a,c]:(a=null,Qb=i)}else a=null,Qb=i;null!==a&&(a=function(a,b){if("var"===b.token)var b={token:"expression",expressionType:"atomic",primaryexpression:"var",value:b};return{direction:"ASC",expression:b}}(h,a[0])),null===a&&(Qb=h)}return Rb--,0===Rb&&null===a&&d("[23] OrderCondition"),a}function z(){var a,b,c,e;return Rb++,c=Qb,e=Qb,a=A(),null!==a?(b=B(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e),null===a&&(e=Qb,a=B(),null!==a?(b=A(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e)),null!==a&&(a=function(a,b){for(var c={},d=0;d<b.length;d++){var e=b[d];null!=e.limit?c.limit=e.limit:null!=e.offset&&(c.offset=e.offset)}return c}(c,a)),null===a&&(Qb=c),Rb--,0===Rb&&null===a&&d("[24] LimitOffsetClauses"),a}function A(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"LIMIT"===b.substr(Qb,5)?(a="LIMIT",Qb+=5):(a=null,0===Rb&&d('"LIMIT"')),null===a&&("limit"===b.substr(Qb,5)?(a="limit",Qb+=5):(a=null,0===Rb&&d('"limit"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=ob(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?a=[a,c,e,f]:(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){return{limit:parseInt(b.value)
}}(h,a[2])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[25] LimitClause"),a}function B(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"OFFSET"===b.substr(Qb,6)?(a="OFFSET",Qb+=6):(a=null,0===Rb&&d('"OFFSET"')),null===a&&("offset"===b.substr(Qb,6)?(a="offset",Qb+=6):(a=null,0===Rb&&d('"offset"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=ob(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?a=[a,c,e,f]:(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){return{offset:parseInt(b.value)}}(h,a[2])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[26] OffsetClause"),a}function C(){var a,c,e,f,g,h,i,j,k;if(Rb++,j=Qb,"BINDINGS"===b.substr(Qb,8)?(a="BINDINGS",Qb+=8):(a=null,0===Rb&&d('"BINDINGS"')),null!==a){for(c=[],e=Ja();null!==e;)c.push(e),e=Ja();if(null!==c)if(123===b.charCodeAt(Qb)?(e="{",Qb++):(e=null,0===Rb&&d('"{"')),null!==e){if(f=[],k=Qb,40===b.charCodeAt(Qb)?(g="(",Qb++):(g=null,0===Rb&&d('"("')),null!==g){if(i=D(),null!==i)for(h=[];null!==i;)h.push(i),i=D();else h=null;null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?g=[g,h,i]:(g=null,Qb=k)):(g=null,Qb=k)}else g=null,Qb=k;for(null===g&&(g=Db());null!==g;){if(f.push(g),k=Qb,40===b.charCodeAt(Qb)?(g="(",Qb++):(g=null,0===Rb&&d('"("')),null!==g){if(i=D(),null!==i)for(h=[];null!==i;)h.push(i),i=D();else h=null;null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?g=[g,h,i]:(g=null,Qb=k)):(g=null,Qb=k)}else g=null,Qb=k;null===g&&(g=Db())}null!==f?(125===b.charCodeAt(Qb)?(g="}",Qb++):(g=null,0===Rb&&d('"}"')),null!==g?a=[a,c,e,f,g]:(a=null,Qb=j)):(a=null,Qb=j)}else a=null,Qb=j;else a=null,Qb=j}else a=null,Qb=j;return a=null!==a?a:"",Rb--,0===Rb&&null===a&&d("[27] BindingsClause"),a}function D(){var a;return Rb++,a=eb(),null===a&&(a=Za(),null===a&&(a=$a(),null===a&&(a=cb(),null===a&&("UNDEF"===b.substr(Qb,5)?(a="UNDEF",Qb+=5):(a=null,0===Rb&&d('"UNDEF"')))))),Rb--,0===Rb&&null===a&&d("[28] BindingValue"),a}function E(){var a,c,e,f,h,i,j,k,l,m;if(Rb++,k=Qb,l=Qb,a=g(),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=F(),null!==e){for(m=Qb,f=[],h=Eb();null!==h;)f.push(h),h=Eb();if(null!==f)if(59===b.charCodeAt(Qb)?(h=";",Qb++):(h=null,0===Rb&&d('";"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?(j=E(),j=null!==j?j:"",null!==j?f=[f,h,i,j]:(f=null,Qb=m)):(f=null,Qb=m)}else f=null,Qb=m;else f=null,Qb=m;f=null!==f?f:"",null!==f?a=[a,c,e,f]:(a=null,Qb=l)}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l;return null!==a&&(a=function(a,b,c,d){var e={};e.token="query",e.kind="update",e.prologue=b;var f=[c];return null!=d.length&&null!=d[3]&&null!=d[3].units&&(f=f.concat(d[3].units)),e.units=f,e}(k,a[0],a[2],a[3])),null===a&&(Qb=k),Rb--,0===Rb&&null===a&&d("[30] Update"),a}function F(){var a;return Rb++,a=G(),null===a&&(a=H(),null===a&&(a=I(),null===a&&(a=J(),null===a&&(a=K(),null===a&&(a=L(),null===a&&(a=M(),null===a&&(a=N()))))))),Rb--,0===Rb&&null===a&&d("[31] Update1"),a}function G(){var a,c,e,f,g,h,i,j,k,l;if(Rb++,j=Qb,k=Qb,"LOAD"===b.substr(Qb,4)?(a="LOAD",Qb+=4):(a=null,0===Rb&&d('"LOAD"')),null===a&&("load"===b.substr(Qb,4)?(a="load",Qb+=4):(a=null,0===Rb&&d('"load"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=eb(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f){if(l=Qb,"INTO"===b.substr(Qb,4)?(g="INTO",Qb+=4):(g=null,0===Rb&&d('"INTO"')),null===g&&("into"===b.substr(Qb,4)?(g="into",Qb+=4):(g=null,0===Rb&&d('"into"'))),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=R(),null!==i?g=[g,h,i]:(g=null,Qb=l)):(g=null,Qb=l)}else g=null,Qb=l;g=null!==g?g:"",null!==g?a=[a,c,e,f,g]:(a=null,Qb=k)}else a=null,Qb=k}else a=null,Qb=k;else a=null,Qb=k}else a=null,Qb=k;return null!==a&&(a=function(a,b,c){var d={};return d.kind="load",d.token="executableunit",d.sourceGraph=b,d.destinyGraph=c[2],d}(j,a[2],a[4])),null===a&&(Qb=j),Rb--,0===Rb&&null===a&&d("[32] Load"),a}function H(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"CLEAR"===b.substr(Qb,5)?(a="CLEAR",Qb+=5):(a=null,0===Rb&&d('"CLEAR"')),null===a&&("clear"===b.substr(Qb,5)?(a="clear",Qb+=5):(a=null,0===Rb&&d('"clear"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("SILENT"===b.substr(Qb,6)?(e="SILENT",Qb+=6):(e=null,0===Rb&&d('"SILENT"')),null===e&&("silent"===b.substr(Qb,6)?(e="silent",Qb+=6):(e=null,0===Rb&&d('"silent"'))),e=null!==e?e:"",null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=S(),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){var c={};return c.kind="clear",c.token="executableunit",c.destinyGraph=b,c}(h,a[4])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[33] Clear"),a}function I(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"DROP"===b.substr(Qb,4)?(a="DROP",Qb+=4):(a=null,0===Rb&&d('"DROP"')),null===a&&("drop"===b.substr(Qb,4)?(a="drop",Qb+=4):(a=null,0===Rb&&d('"drop"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("SILENT"===b.substr(Qb,6)?(e="SILENT",Qb+=6):(e=null,0===Rb&&d('"SILENT"')),null===e&&("silent"===b.substr(Qb,6)?(e="silent",Qb+=6):(e=null,0===Rb&&d('"silent"'))),e=null!==e?e:"",null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=S(),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){var c={};return c.kind="drop",c.token="executableunit",c.destinyGraph=b,c}(h,a[4])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[34] Drop"),a}function J(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"CREATE"===b.substr(Qb,6)?(a="CREATE",Qb+=6):(a=null,0===Rb&&d('"CREATE"')),null===a&&("create"===b.substr(Qb,6)?(a="create",Qb+=6):(a=null,0===Rb&&d('"create"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("SILENT"===b.substr(Qb,6)?(e="SILENT",Qb+=6):(e=null,0===Rb&&d('"SILENT"')),null===e&&("silent"===b.substr(Qb,6)?(e="silent",Qb+=6):(e=null,0===Rb&&d('"silent"'))),e=null!==e?e:"",null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=R(),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){var c={};return c.kind="create",c.token="executableunit",c.destinyGraph=b,c}(h,a[4])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[35] Create"),a}function K(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"INSERT"===b.substr(Qb,6)?(a="INSERT",Qb+=6):(a=null,0===Rb&&d('"INSERT"')),null===a&&("insert"===b.substr(Qb,6)?(a="insert",Qb+=6):(a=null,0===Rb&&d('"insert"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("DATA"===b.substr(Qb,4)?(e="DATA",Qb+=4):(e=null,0===Rb&&d('"DATA"')),null===e&&("data"===b.substr(Qb,4)?(e="data",Qb+=4):(e=null,0===Rb&&d('"data"'))),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=U(),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){var c={};return c.kind="insertdata",c.token="executableunit",c.quads=b,c}(h,a[4])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[36] InsertData"),a}function L(){var a,c,e,f,g,h;if(Rb++,g=Qb,h=Qb,"DELETE"===b.substr(Qb,6)?(a="DELETE",Qb+=6):(a=null,0===Rb&&d('"DELETE"')),null===a&&("delete"===b.substr(Qb,6)?(a="delete",Qb+=6):(a=null,0===Rb&&d('"delete"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?("DATA"===b.substr(Qb,4)?(e="DATA",Qb+=4):(e=null,0===Rb&&d('"DATA"')),null===e&&("data"===b.substr(Qb,4)?(e="data",Qb+=4):(e=null,0===Rb&&d('"data"'))),null!==e?(f=U(),null!==f?a=[a,c,e,f]:(a=null,Qb=h)):(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;return null!==a&&(a=function(a,b){var c={};return c.kind="deletedata",c.token="executableunit",c.quads=b,c}(g,a[3])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[37] DeleteData"),a}function M(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"DELETE"===b.substr(Qb,6)?(a="DELETE",Qb+=6):(a=null,0===Rb&&d('"DELETE"')),null===a&&("delete"===b.substr(Qb,6)?(a="delete",Qb+=6):(a=null,0===Rb&&d('"delete"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("WHERE"===b.substr(Qb,5)?(e="WHERE",Qb+=5):(e=null,0===Rb&&d('"WHERE"')),null===e&&("where"===b.substr(Qb,5)?(e="where",Qb+=5):(e=null,0===Rb&&d('"where"'))),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=Y(),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){var c={};c.kind="modify",c.pattern=b,c["with"]=null,c.using=null;var d=[],e=b.patterns[0];e=null==e.triplesContext&&null!=e.patterns?e.patterns[0].triplesContext:e.triplesContext;for(var f=0;f<e.length;f++){var g={},h=e[f];g.subject=h.subject,g.predicate=h.predicate,g.object=h.object,g.graph=h.graph,d.push(g)}return c["delete"]=d,c}(h,a[4])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[38] DeleteWhere"),a}function N(){var a,c,e,f,g,h,i,j,k,l,m,n,o,p;if(Rb++,n=Qb,o=Qb,p=Qb,"WITH"===b.substr(Qb,4)?(a="WITH",Qb+=4):(a=null,0===Rb&&d('"WITH"')),null===a&&("with"===b.substr(Qb,4)?(a="with",Qb+=4):(a=null,0===Rb&&d('"with"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=eb(),null!==e?a=[a,c,e]:(a=null,Qb=p)):(a=null,Qb=p)}else a=null,Qb=p;if(a=null!==a?a:"",null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c){if(p=Qb,e=O(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=P(),g=null!==g?g:"",null!==g?e=[e,f,g]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;if(null===e&&(e=P()),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f){for(g=[],h=Q();null!==h;)g.push(h),h=Q();if(null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if("WHERE"===b.substr(Qb,5)?(i="WHERE",Qb+=5):(i=null,0===Rb&&d('"WHERE"')),null===i&&("where"===b.substr(Qb,5)?(i="where",Qb+=5):(i=null,0===Rb&&d('"where"'))),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(k=Y(),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?a=[a,c,e,f,g,h,i,j,k,l]:(a=null,Qb=o)}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o}else a=null,Qb=o}else a=null,Qb=o}else a=null,Qb=o}else a=null,Qb=o;return null!==a&&(a=function(a,b,c,d,e){var f={};return f.kind="modify",""!=b?f["with"]=b[2]:f["with"]=null,3===c.length&&""===c[2]?(f["delete"]=c[0],f.insert=null):3===c.length&&null!=c[0].length&&null!=c[1].length&&null!=c[2].length?(f["delete"]=c[0],f.insert=c[2]):(f.insert=c,f["delete"]=null),""!=d&&(f.using=d),f.pattern=e,f}(n,a[0],a[2],a[4],a[8])),null===a&&(Qb=n),Rb--,0===Rb&&null===a&&d("[39] Modify"),a}function O(){var a,c,e,f;return Rb++,e=Qb,f=Qb,"DELETE"===b.substr(Qb,6)?(a="DELETE",Qb+=6):(a=null,0===Rb&&d('"DELETE"')),null===a&&("delete"===b.substr(Qb,6)?(a="delete",Qb+=6):(a=null,0===Rb&&d('"delete"'))),null!==a?(c=T(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[40] DeleteClause"),a}function P(){var a,c,e,f;return Rb++,e=Qb,f=Qb,"INSERT"===b.substr(Qb,6)?(a="INSERT",Qb+=6):(a=null,0===Rb&&d('"INSERT"')),null===a&&("insert"===b.substr(Qb,6)?(a="insert",Qb+=6):(a=null,0===Rb&&d('"insert"'))),null!==a?(c=T(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[41] InsertClause"),a}function Q(){var a,c,e,f,g,h,i,j,k;for(Rb++,i=Qb,j=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("USING"===b.substr(Qb,5)?(c="USING",Qb+=5):(c=null,0===Rb&&d('"USING"')),null===c&&("using"===b.substr(Qb,5)?(c="using",Qb+=5):(c=null,0===Rb&&d('"using"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e){if(f=eb(),null===f)if(k=Qb,"NAMED"===b.substr(Qb,5)?(f="NAMED",Qb+=5):(f=null,0===Rb&&d('"NAMED"')),null===f&&("named"===b.substr(Qb,5)?(f="named",Qb+=5):(f=null,0===Rb&&d('"named"'))),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=eb(),null!==h?f=[f,g,h]:(f=null,Qb=k)):(f=null,Qb=k)}else f=null,Qb=k;null!==f?a=[a,c,e,f]:(a=null,Qb=j)}else a=null,Qb=j}else a=null,Qb=j;else a=null,Qb=j;return null!==a&&(a=function(a,b){return null!=b.length?{kind:"named",uri:b[2]}:{kind:"default",uri:b}}(i,a[3])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[42] UsingClause"),a}function R(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,"GRAPH"===b.substr(Qb,5)?(a="GRAPH",Qb+=5):(a=null,0===Rb&&d('"GRAPH"')),null===a&&("graph"===b.substr(Qb,5)?(a="graph",Qb+=5):(a=null,0===Rb&&d('"graph"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=eb(),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b){return b}(f,a[2])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[43] GraphRef"),a}function S(){var a,c;return Rb++,c=Qb,a=R(),null!==a&&(a=function(a,b){return b}(c,a)),null===a&&(Qb=c),null===a&&(c=Qb,"DEFAULT"===b.substr(Qb,7)?(a="DEFAULT",Qb+=7):(a=null,0===Rb&&d('"DEFAULT"')),null===a&&("default"===b.substr(Qb,7)?(a="default",Qb+=7):(a=null,0===Rb&&d('"default"'))),null!==a&&(a=function(a){return"default"}(c)),null===a&&(Qb=c),null===a&&(c=Qb,"NAMED"===b.substr(Qb,5)?(a="NAMED",Qb+=5):(a=null,0===Rb&&d('"NAMED"')),null===a&&("named"===b.substr(Qb,5)?(a="named",Qb+=5):(a=null,0===Rb&&d('"named"'))),null!==a&&(a=function(a){return"named"}(c)),null===a&&(Qb=c),null===a&&(c=Qb,"ALL"===b.substr(Qb,3)?(a="ALL",Qb+=3):(a=null,0===Rb&&d('"ALL"')),null===a&&("all"===b.substr(Qb,3)?(a="all",Qb+=3):(a=null,0===Rb&&d('"all"'))),null!==a&&(a=function(a){return"all"}(c)),null===a&&(Qb=c)))),Rb--,0===Rb&&null===a&&d("[44] GraphRefAll"),a}function T(){var a,c,e,f,g,h,i,j,k,l;for(Rb++,k=Qb,l=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(123===b.charCodeAt(Qb)?(c="{",Qb++):(c=null,0===Rb&&d('"{"')),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=V(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(125===b.charCodeAt(Qb)?(h="}",Qb++):(h=null,0===Rb&&d('"}"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=l)}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l;else a=null,Qb=l;return null!==a&&(a=function(a,b){return b.quadsContext}(k,a[3])),null===a&&(Qb=k),Rb--,0===Rb&&null===a&&d("[45] QuadPattern"),a}function U(){var a,c,e,f,g,h,i,j,k,l;for(Rb++,k=Qb,l=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(123===b.charCodeAt(Qb)?(c="{",Qb++):(c=null,0===Rb&&d('"{"')),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=V(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(125===b.charCodeAt(Qb)?(h="}",Qb++):(h=null,0===Rb&&d('"}"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=l)}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l;else a=null,Qb=l;return null!==a&&(a=function(a,b){return b.quadsContext}(k,a[3])),null===a&&(Qb=k),Rb--,0===Rb&&null===a&&d("[46] QuadData"),a}function V(){var a,c,e,f,g,h,i,j;if(Rb++,h=Qb,i=Qb,a=X(),a=null!==a?a:"",null!==a){for(c=[],j=Qb,e=W(),null!==e?(46===b.charCodeAt(Qb)?(f=".",Qb++):(f=null,0===Rb&&d('"."')),f=null!==f?f:"",null!==f?(g=X(),g=null!==g?g:"",null!==g?e=[e,f,g]:(e=null,Qb=j)):(e=null,Qb=j)):(e=null,Qb=j);null!==e;)c.push(e),j=Qb,e=W(),null!==e?(46===b.charCodeAt(Qb)?(f=".",Qb++):(f=null,0===Rb&&d('"."')),f=null!==f?f:"",null!==f?(g=X(),g=null!==g?g:"",null!==g?e=[e,f,g]:(e=null,Qb=j)):(e=null,Qb=j)):(e=null,Qb=j);null!==c?a=[a,c]:(a=null,Qb=i)}else a=null,Qb=i;return null!==a&&(a=function(a,b,c){var d=[];if(null!=b.triplesContext&&null!=b.triplesContext)for(var e=0;e<b.triplesContext.length;e++){var f=b.triplesContext[e];f.graph=null,d.push(f)}if(c&&c.length>0&&c[0].length>0&&(d=d.concat(c[0][0].quadsContext),null!=c[0][2]&&null!=c[0][2].triplesContext))for(var e=0;e<c[0][2].triplesContext.length;e++){var f=c[0][2].triplesContext[e];f.graph=null,d.push(f)}return{token:"quads",quadsContext:d}}(h,a[0],a[1])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[47] Quads"),a}function W(){var a,c,e,f,g,h,i,j,k,l,m,n,o,p;for(Rb++,o=Qb,p=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("GRAPH"===b.substr(Qb,5)?(c="GRAPH",Qb+=5):(c=null,0===Rb&&d('"GRAPH"')),null===c&&("graph"===b.substr(Qb,5)?(c="graph",Qb+=5):(c=null,0===Rb&&d('"graph"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=Ia(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(123===b.charCodeAt(Qb)?(h="{",Qb++):(h=null,0===Rb&&d('"{"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(j=X(),j=null!==j?j:"",null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();if(null!==k)if(125===b.charCodeAt(Qb)?(l="}",Qb++):(l=null,0===Rb&&d('"}"')),null!==l){for(m=[],n=Eb();null!==n;)m.push(n),n=Eb();null!==m?a=[a,c,e,f,g,h,i,j,k,l,m]:(a=null,Qb=p)}else a=null,Qb=p;else a=null,Qb=p}else a=null,Qb=p;else a=null,Qb=p}else a=null,Qb=p;else a=null,Qb=p}else a=null,Qb=p;else a=null,Qb=p}else a=null,Qb=p;else a=null,Qb=p;return null!==a&&(a=function(a,b,c){for(var d=[],e=0;e<c.triplesContext.length;e++){var f=c.triplesContext[e];f.graph=b,d.push(f)}return{token:"quadsnottriples",quadsContext:d}}(o,a[3],a[7])),null===a&&(Qb=o),Rb--,0===Rb&&null===a&&d("[48] QuadsNotTriples"),a}function X(){var a,c,e,f,g,h,i,j;if(Rb++,h=Qb,i=Qb,a=ma(),null!==a){for(j=Qb,c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(46===b.charCodeAt(Qb)?(e=".",Qb++):(e=null,0===Rb&&d('"."')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=X(),g=null!==g?g:"",null!==g?c=[c,e,f,g]:(c=null,Qb=j)):(c=null,Qb=j)}else c=null,Qb=j;else c=null,Qb=j;c=null!==c?c:"",null!==c?a=[a,c]:(a=null,Qb=i)}else a=null,Qb=i;return null!==a&&(a=function(a,b,c){var d=b.triplesContext;return"object"==typeof c&&null!=c.length&&null!=c[3].triplesContext&&(d=d.concat(c[3].triplesContext)),{token:"triplestemplate",triplesContext:d}}(h,a[0],a[1])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[49] TriplesTemplate"),a}function Y(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,123===b.charCodeAt(Qb)?(a="{",Qb++):(a=null,0===Rb&&d('"{"')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=k(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(125===b.charCodeAt(Qb)?(g="}",Qb++):(g=null,0===Rb&&d('"}"')),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;if(null!==a&&(a=function(a,b){return b}(h,a[2])),null===a&&(Qb=h),null===a){if(h=Qb,i=Qb,123===b.charCodeAt(Qb)?(a="{",Qb++):(a=null,0===Rb&&d('"{"')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=Z(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(125===b.charCodeAt(Qb)?(g="}",Qb++):(g=null,0===Rb&&d('"}"')),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;null!==a&&(a=function(a,b){return b}(h,a[2])),null===a&&(Qb=h)}return Rb--,0===Rb&&null===a&&d("[50] GroupGraphPattern"),a}function Z(){var a,c,e,f,g,h,i,j,k,l,m;if(Rb++,k=Qb,l=Qb,a=$(),a=null!==a?a:"",null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c){if(e=[],m=Qb,f=_(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(46===b.charCodeAt(Qb)?(h=".",Qb++):(h=null,0===Rb&&d('"."')),h=null!==h?h:"",null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?(j=$(),j=null!==j?j:"",null!==j?f=[f,g,h,i,j]:(f=null,Qb=m)):(f=null,Qb=m)}else f=null,Qb=m;else f=null,Qb=m}else f=null,Qb=m;for(;null!==f;)if(e.push(f),m=Qb,f=_(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(46===b.charCodeAt(Qb)?(h=".",Qb++):(h=null,0===Rb&&d('"."')),h=null!==h?h:"",null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?(j=$(),j=null!==j?j:"",null!==j?f=[f,g,h,i,j]:(f=null,Qb=m)):(f=null,Qb=m)}else f=null,Qb=m;else f=null,Qb=m}else f=null,Qb=m;null!==e?a=[a,c,e]:(a=null,Qb=l)}else a=null,Qb=l}else a=null,Qb=l;return null!==a&&(a=function(a,b,c){var d=[];null!=b&&b!=[]&&d.push(b);for(var e=0;e<c.length;e++)for(var f=0;f<c[e].length;f++)null!=c[e][f].token&&d.push(c[e][f]);for(var g=[],h=[],i=[],e=0;e<d.length;e++)if("triplespattern"!=d[e].token&&"filter"!=d[e].token){if(0!=h.length||0!=i.length){for(var j=[],f=0;f<h.length;f++)j=j.concat(h[f].triplesContext);j.length>0&&g.push({token:"basicgraphpattern",triplesContext:j}),h=[]}g.push(d[e])}else"triplespattern"===d[e].token?h.push(d[e]):i.push(d[e]);if(0!=h.length||0!=i.length){for(var j=[],f=0;f<h.length;f++)j=j.concat(h[f].triplesContext);j.length>0&&g.push({token:"basicgraphpattern",triplesContext:j})}return{token:"groupgraphpattern",patterns:g,filters:i}}(k,a[0],a[2])),null===a&&(Qb=k),Rb--,0===Rb&&null===a&&d("[51] GroupGraphPatternSub"),a}function $(){var a,c,e,f,g,h,i;if(Rb++,g=Qb,h=Qb,a=ra(),null!==a){for(i=Qb,c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(46===b.charCodeAt(Qb)?(e=".",Qb++):(e=null,0===Rb&&d('"."')),null!==e?(f=$(),f=null!==f?f:"",null!==f?c=[c,e,f]:(c=null,Qb=i)):(c=null,Qb=i)):(c=null,Qb=i),c=null!==c?c:"",null!==c?a=[a,c]:(a=null,Qb=h)}else a=null,Qb=h;return null!==a&&(a=function(a,b,c){var d=b.triplesContext;return"object"==typeof c&&null!=c.length&&null!=c[2].triplesContext&&(d=d.concat(c[2].triplesContext)),{token:"triplespattern",triplesContext:d}}(g,a[0],a[1])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[54] TriplesBlock"),a}function _(){var a;return Rb++,a=ea(),null===a&&(a=aa(),null===a&&(a=da(),null===a&&(a=ba(),null===a&&(a=ca(),null===a&&(a=fa()))))),Rb--,0===Rb&&null===a&&d("[53] GraphPatternNotTriples"),a}function aa(){var a,c,e,f,g,h;for(Rb++,g=Qb,h=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("OPTIONAL"===b.substr(Qb,8)?(c="OPTIONAL",Qb+=8):(c=null,0===Rb&&d('"OPTIONAL"')),null===c&&("optional"===b.substr(Qb,8)?(c="optional",Qb+=8):(c=null,0===Rb&&d('"optional"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();null!==e?(f=Y(),null!==f?a=[a,c,e,f]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;else a=null,Qb=h;return null!==a&&(a=function(a,b){return{token:"optionalgraphpattern",value:b}}(g,a[3])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[54] OptionalGraphPattern"),a}function ba(){var a,c,e,f,g,h,i,j;for(Rb++,i=Qb,j=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("GRAPH"===b.substr(Qb,5)?(c="GRAPH",Qb+=5):(c=null,0===Rb&&d('"GRAPH"')),null===c&&("graph"===b.substr(Qb,5)?(c="graph",Qb+=5):(c=null,0===Rb&&d('"graph"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=Ia(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Y(),null!==h?a=[a,c,e,f,g,h]:(a=null,Qb=j)):(a=null,Qb=j)}else a=null,Qb=j;else a=null,Qb=j}else a=null,Qb=j;else a=null,Qb=j;return null!==a&&(a=function(a,b,c){for(var d=0;d<c.patterns.length;d++)for(var e=c.patterns[d],f=0;f<e.triplesContext.length;f++){var g=e.triplesContext[f];g.graph=b}return c.token="groupgraphpattern",c}(i,a[3],a[5])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[55] GraphGraphPattern"),a}function ca(){var a,c,e,f,g;return Rb++,f=Qb,g=Qb,"SERVICE"===b.substr(Qb,7)?(a="SERVICE",Qb+=7):(a=null,0===Rb&&d('"SERVICE"')),null!==a?(c=Ia(),null!==c?(e=Y(),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)):(a=null,Qb=g),null!==a&&(a=function(a,b,c){return{token:"servicegraphpattern",status:"todo",value:[b,c]}}(f,a[1],a[2])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[56] ServiceGraphPattern"),a}function da(){var a,c,e,f;return Rb++,e=Qb,f=Qb,"MINUS"===b.substr(Qb,5)?(a="MINUS",Qb+=5):(a=null,0===Rb&&d('"MINUS"')),null!==a?(c=Y(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return{token:"minusgraphpattern",status:"todo",value:b}}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[57] MinusGraphPattern"),a}function ea(){var a,c,e,f,g,h,i,j,k;if(Rb++,i=Qb,j=Qb,a=Y(),null!==a){for(c=[],k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("UNION"===b.substr(Qb,5)?(f="UNION",Qb+=5):(f=null,0===Rb&&d('"UNION"')),null===f&&("union"===b.substr(Qb,5)?(f="union",Qb+=5):(f=null,0===Rb&&d('"union"'))),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Y(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k;for(;null!==e;){for(c.push(e),k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("UNION"===b.substr(Qb,5)?(f="UNION",Qb+=5):(f=null,0===Rb&&d('"UNION"')),null===f&&("union"===b.substr(Qb,5)?(f="union",Qb+=5):(f=null,0===Rb&&d('"union"'))),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Y(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k}null!==c?a=[a,c]:(a=null,Qb=j)}else a=null,Qb=j;return null!==a&&(a=function(a,b,c){if(0===c.length)return b;for(var d={token:"graphunionpattern",value:[b]},e=0;e<c.length;e++)if(e==c.length-1)d.value.push(c[e][3]);else{d.value.push(c[e][3]);var f={token:"graphunionpattern",value:[d]};d=f}return d}(i,a[0],a[1])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[58] GroupOrUnionGraphPattern"),a}function fa(){var a,c,e,f,g,h;for(Rb++,g=Qb,h=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if("FILTER"===b.substr(Qb,6)?(c="FILTER",Qb+=6):(c=null,0===Rb&&d('"FILTER"')),null===c&&("filter"===b.substr(Qb,6)?(c="filter",Qb+=6):(c=null,0===Rb&&d('"filter"'))),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();null!==e?(f=ga(),null!==f?a=[a,c,e,f]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;else a=null,Qb=h;return null!==a&&(a=function(a,b){return{token:"filter",value:b}}(g,a[3])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[59] Filter"),a}function ga(){var a;return Rb++,a=Sa(),null===a&&(a=Ta(),null===a&&(a=ha())),Rb--,0===Rb&&null===a&&d("[60] Constraint"),a}function ha(){var a,b,c,e;return Rb++,c=Qb,e=Qb,a=eb(),null!==a?(b=ia(),null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e),null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="irireforfunction",d.iriref=b,d.args=c.value,d}(c,a[0],a[1])),null===a&&(Qb=c),Rb--,0===Rb&&null===a&&d("[61] FunctionCall"),a}function ia(){var a,c,e,f,g,h,i,j,k;if(Rb++,i=Qb,a=Db(),null!==a&&(a=function(a){var b={};return b.token="args",b.value=[],b}(i)),null===a&&(Qb=i),null===a){if(i=Qb,j=Qb,40===b.charCodeAt(Qb)?(a="(",Qb++):(a=null,0===Rb&&d('"("')),null!==a)if("DISTINCT"===b.substr(Qb,8)?(c="DISTINCT",Qb+=8):(c=null,0===Rb&&d('"DISTINCT"')),null===c&&("distinct"===b.substr(Qb,8)?(c="distinct",Qb+=8):(c=null,0===Rb&&d('"distinct"'))),c=null!==c?c:"",null!==c)if(e=La(),null!==e){for(f=[],k=Qb,44===b.charCodeAt(Qb)?(g=",",Qb++):(g=null,0===Rb&&d('","')),null!==g?(h=La(),null!==h?g=[g,h]:(g=null,Qb=k)):(g=null,Qb=k);null!==g;)f.push(g),k=Qb,44===b.charCodeAt(Qb)?(g=",",Qb++):(g=null,0===Rb&&d('","')),null!==g?(h=La(),null!==h?g=[g,h]:(g=null,Qb=k)):(g=null,Qb=k);null!==f?(41===b.charCodeAt(Qb)?(g=")",Qb++):(g=null,0===Rb&&d('")"')),null!==g?a=[a,c,e,f,g]:(a=null,Qb=j)):(a=null,Qb=j)}else a=null,Qb=j;else a=null,Qb=j;else a=null,Qb=j;null!==a&&(a=function(a,b,c,d){for(var e=[],f=0;f<d.length;f++)e.push(d[f][1]);var g={};return g.token="args",g.value=[c].concat(e),null!=b&&"DISTINCT"===b.toUpperCase()?g.distinct=!0:g.distinct=!1,g}(i,a[1],a[2],a[3])),null===a&&(Qb=i)}return Rb--,0===Rb&&null===a&&d("[62] ArgList"),a}function ja(){var a,c,e,f,g,h,i,j,k,l;if(Rb++,j=Qb,a=Db(),null!==a&&(a=function(a){var b={};return b.token="args",b.value=[],b}(j)),null===a&&(Qb=j),null===a){if(j=Qb,k=Qb,40===b.charCodeAt(Qb)?(a="(",Qb++):(a=null,0===Rb&&d('"("')),null!==a)if(c=La(),null!==c){for(e=[],l=Qb,f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(44===b.charCodeAt(Qb)?(g=",",Qb++):(g=null,0===Rb&&d('","')),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=La(),null!==i?f=[f,g,h,i]:(f=null,Qb=l)):(f=null,Qb=l)}else f=null,Qb=l;else f=null,Qb=l;for(;null!==f;){for(e.push(f),l=Qb,f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(44===b.charCodeAt(Qb)?(g=",",Qb++):(g=null,0===Rb&&d('","')),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=La(),null!==i?f=[f,g,h,i]:(f=null,Qb=l)):(f=null,Qb=l)}else f=null,Qb=l;else f=null,Qb=l}null!==e?(41===b.charCodeAt(Qb)?(f=")",Qb++):(f=null,0===Rb&&d('")"')),null!==f?a=[a,c,e,f]:(a=null,Qb=k)):(a=null,Qb=k)}else a=null,Qb=k;else a=null,Qb=k;null!==a&&(a=function(a,b,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e][3]);var f={};return f.token="args",f.value=[b].concat(d),f}(j,a[1],a[2])),null===a&&(Qb=j)}return Rb--,0===Rb&&null===a&&d("[63] ExpressionList"),a}function ka(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,123===b.charCodeAt(Qb)?(a="{",Qb++):(a=null,0===Rb&&d('"{"')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=la(),e=null!==e?e:"",null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(125===b.charCodeAt(Qb)?(g="}",Qb++):(g=null,0===Rb&&d('"}"')),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){return b}(h,a[2])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[64] ConstructTemplate"),a}function la(){var a,c,e,f,g,h,i,j;if(Rb++,h=Qb,i=Qb,a=ma(),null!==a){for(j=Qb,c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(46===b.charCodeAt(Qb)?(e=".",Qb++):(e=null,0===Rb&&d('"."')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=la(),g=null!==g?g:"",null!==g?c=[c,e,f,g]:(c=null,Qb=j)):(c=null,Qb=j)}else c=null,Qb=j;else c=null,Qb=j;c=null!==c?c:"",null!==c?a=[a,c]:(a=null,Qb=i)}else a=null,Qb=i;return null!==a&&(a=function(a,b,c){var d=b.triplesContext;return"object"==typeof c&&null!=c.length&&null!=c[3].triplesContext&&(d=d.concat(c[3].triplesContext)),{token:"triplestemplate",triplesContext:d}}(h,a[0],a[1])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[65] ConstructTriples"),a}function ma(){var a,b,c,e,f,g;for(Rb++,f=Qb,g=Qb,a=[],b=Eb();null!==b;)a.push(b),b=Eb();if(null!==a)if(b=Ha(),null!==b){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=na(),null!==e?a=[a,b,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;else a=null,Qb=g;if(null!==a&&(a=function(a,b,c){var d=c.triplesContext,e=b;if(c.pairs)for(var f=0;f<c.pairs.length;f++){var g=c.pairs[f],h=null;null!=g[1].length&&(g[1]=g[1][0]),e.token&&"triplesnodecollection"===e.token?(h={subject:e.chainSubject[0],predicate:g[0],object:g[1]},d.push(h),d=d.concat(e.triplesContext)):(h={subject:e,predicate:g[0],object:g[1]},d.push(h))}var i={};return i.token="triplessamesubject",i.triplesContext=d,i.chainSubject=e,i}(f,a[1],a[3])),null===a&&(Qb=f),null===a){for(f=Qb,g=Qb,a=[],b=Eb();null!==b;)a.push(b),b=Eb();if(null!==a)if(b=Da(),null!==b){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=oa(),null!==e?a=[a,b,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;else a=null,Qb=g;null!==a&&(a=function(a,b,c){var d=b.triplesContext,e=b.chainSubject;if(c.pairs)for(var f=0;f<c.pairs.length;f++){var g=c.pairs[f];if(null!=g[1].length&&(g[1]=g[1][0]),"triplesnodecollection"===b.token)for(var h=0;h<e.length;h++){var i=e[h];if(null!=i.triplesContext){var j={subject:i.chainSubject,predicate:g[0],object:g[1]};d.concat(i.triplesContext)}else{var j={subject:e[h],predicate:g[0],object:g[1]};d.push(j)}}else{var j={subject:e,predicate:g[0],object:g[1]};d.push(j)}}var k={};return k.token="triplessamesubject",k.triplesContext=d,k.chainSubject=e,k}(f,a[1],a[3])),null===a&&(Qb=f)}return Rb--,0===Rb&&null===a&&d("[66] TriplesSameSubject"),a}function na(){var a,c,e,f,g,h,i,j,k,l,m,n,o,p;if(Rb++,m=Qb,n=Qb,a=qa(),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=pa(),null!==e){for(f=[],o=Qb,g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(59===b.charCodeAt(Qb)?(h=";",Qb++):(h=null,0===Rb&&d('";"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i){if(p=Qb,j=qa(),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();null!==k?(l=pa(),null!==l?j=[j,k,l]:(j=null,Qb=p)):(j=null,Qb=p)}else j=null,Qb=p;j=null!==j?j:"",null!==j?g=[g,h,i,j]:(g=null,Qb=o)}else g=null,Qb=o}else g=null,Qb=o;else g=null,Qb=o;for(;null!==g;){for(f.push(g),o=Qb,g=[],h=Eb();null!==h;)g.push(h),
h=Eb();if(null!==g)if(59===b.charCodeAt(Qb)?(h=";",Qb++):(h=null,0===Rb&&d('";"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i){if(p=Qb,j=qa(),null!==j){for(k=[],l=Eb();null!==l;)k.push(l),l=Eb();null!==k?(l=pa(),null!==l?j=[j,k,l]:(j=null,Qb=p)):(j=null,Qb=p)}else j=null,Qb=p;j=null!==j?j:"",null!==j?g=[g,h,i,j]:(g=null,Qb=o)}else g=null,Qb=o}else g=null,Qb=o;else g=null,Qb=o}null!==f?a=[a,c,e,f]:(a=null,Qb=n)}else a=null,Qb=n;else a=null,Qb=n}else a=null,Qb=n;return null!==a&&(a=function(a,b,c,d){var e={};e.token="propertylist";for(var f=[],g=[],h=0;h<c.length;h++)null!=c[h].triplesContext?(f=f.concat(c[h].triplesContext),"triplesnodecollection"===c[h].token&&null!=c[h].chainSubject.length?g.push([b,c[h].chainSubject[0]]):g.push([b,c[h].chainSubject])):g.push([b,c[h]]);for(var h=0;h<d.length;h++)for(var i=d[h][3],j=i[0],k=i[2]||[],l=0;l<k.length;l++)null!=k[l].triplesContext?(f=f.concat(k[l].triplesContext),g.push([j,k[l].chainSubject])):g.push([j,k[l]]);return e.pairs=g,e.triplesContext=f,e}(m,a[0],a[2],a[3])),null===a&&(Qb=m),Rb--,0===Rb&&null===a&&d("[67] PropertyListNotEmpty"),a}function oa(){var a;return Rb++,a=na(),a=null!==a?a:"",Rb--,0===Rb&&null===a&&d("[68] PropertyList"),a}function pa(){var a,c,e,f,g,h,i,j,k;if(Rb++,i=Qb,j=Qb,a=Ga(),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c){if(e=[],k=Qb,44===b.charCodeAt(Qb)?(f=",",Qb++):(f=null,0===Rb&&d('","')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Ga(),null!==h?f=[f,g,h]:(f=null,Qb=k)):(f=null,Qb=k)}else f=null,Qb=k;for(;null!==f;)if(e.push(f),k=Qb,44===b.charCodeAt(Qb)?(f=",",Qb++):(f=null,0===Rb&&d('","')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Ga(),null!==h?f=[f,g,h]:(f=null,Qb=k)):(f=null,Qb=k)}else f=null,Qb=k;null!==e?a=[a,c,e]:(a=null,Qb=j)}else a=null,Qb=j}else a=null,Qb=j;return null!==a&&(a=function(a,b,c){var d=[];d.push(b);for(var e=0;e<c.length;e++)for(var f=0;f<c[e].length;f++)"object"==typeof c[e][f]&&null!=c[e][f].token&&d.push(c[e][f]);return d}(i,a[0],a[2])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[69] ObjectList"),a}function qa(){var a,c;return Rb++,a=Ia(),null===a&&(c=Qb,97===b.charCodeAt(Qb)?(a="a",Qb++):(a=null,0===Rb&&d('"a"')),null!==a&&(a=function(a){return{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}}(c)),null===a&&(Qb=c)),Rb--,0===Rb&&null===a&&d("[71] Verb"),a}function ra(){var a,b,c,e,f,g;for(Rb++,f=Qb,g=Qb,a=[],b=Eb();null!==b;)a.push(b),b=Eb();if(null!==a)if(b=Ha(),null!==b){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=sa(),null!==e?a=[a,b,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;else a=null,Qb=g;if(null!==a&&(a=function(a,b,c){var d=c.triplesContext,e=b;if(c.pairs)for(var f=0;f<c.pairs.length;f++){var g=c.pairs[f],h=null;null!=g[1].length&&(g[1]=g[1][0]),e.token&&"triplesnodecollection"===e.token?(h={subject:e.chainSubject[0],predicate:g[0],object:g[1]},d.push(h),d=d.concat(e.triplesContext)):(h={subject:e,predicate:g[0],object:g[1]},d.push(h))}var i={};return i.token="triplessamesubject",i.triplesContext=d,i.chainSubject=e,i}(f,a[1],a[3])),null===a&&(Qb=f),null===a){for(f=Qb,g=Qb,a=[],b=Eb();null!==b;)a.push(b),b=Eb();if(null!==a)if(b=Da(),null!==b){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=ta(),null!==e?a=[a,b,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;else a=null,Qb=g;null!==a&&(a=function(a,b,c){var d=b.triplesContext,e=b.chainSubject;if(c.pairs)for(var f=0;f<c.pairs.length;f++){var g=c.pairs[f];if(null!=g[1].length&&(g[1]=g[1][0]),"triplesnodecollection"===b.token)for(var h=0;h<e.length;h++){var i=e[h];if(null!=i.triplesContext){var j={subject:i.chainSubject,predicate:g[0],object:g[1]};d.concat(i.triplesContext)}else{var j={subject:e[h],predicate:g[0],object:g[1]};d.push(j)}}else{var j={subject:e,predicate:g[0],object:g[1]};d.push(j)}}var k={};return k.token="triplessamesubject",k.triplesContext=d,k.chainSubject=e,k}(f,a[1],a[3])),null===a&&(Qb=f)}return Rb--,0===Rb&&null===a&&d("[72] TriplesSameSubjectPath"),a}function sa(){var a,c,e,f,g,h,i,j,k,l,m,n,o;if(Rb++,l=Qb,m=Qb,a=ua(),null===a&&(a=Ja()),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=pa(),null!==e){for(f=[],n=Qb,g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(59===b.charCodeAt(Qb)?(h=";",Qb++):(h=null,0===Rb&&d('";"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?(o=Qb,j=ua(),null===j&&(j=Ja()),null!==j?(k=pa(),null!==k?j=[j,k]:(j=null,Qb=o)):(j=null,Qb=o),j=null!==j?j:"",null!==j?g=[g,h,i,j]:(g=null,Qb=n)):(g=null,Qb=n)}else g=null,Qb=n;else g=null,Qb=n;for(;null!==g;){for(f.push(g),n=Qb,g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(59===b.charCodeAt(Qb)?(h=";",Qb++):(h=null,0===Rb&&d('";"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?(o=Qb,j=ua(),null===j&&(j=Ja()),null!==j?(k=pa(),null!==k?j=[j,k]:(j=null,Qb=o)):(j=null,Qb=o),j=null!==j?j:"",null!==j?g=[g,h,i,j]:(g=null,Qb=n)):(g=null,Qb=n)}else g=null,Qb=n;else g=null,Qb=n}null!==f?a=[a,c,e,f]:(a=null,Qb=m)}else a=null,Qb=m;else a=null,Qb=m}else a=null,Qb=m;return null!==a&&(a=function(a,b,c,d){token={},token.token="propertylist";for(var e=[],f=[],g=0;g<c.length;g++)null!=c[g].triplesContext?(e=e.concat(c[g].triplesContext),"triplesnodecollection"===c[g].token&&null!=c[g].chainSubject.length?f.push([b,c[g].chainSubject[0]]):f.push([b,c[g].chainSubject])):f.push([b,c[g]]);for(var g=0;g<d.length;g++)for(var h=d[g][3],i=h[0],j=h[1]||[],k=0;k<j.length;k++)null!=j[k].triplesContext?(e=e.concat(j[k].triplesContext),f.push([i,j[k].chainSubject])):f.push([i,j[k]]);return token.pairs=f,token.triplesContext=e,token}(l,a[0],a[2],a[3])),null===a&&(Qb=l),Rb--,0===Rb&&null===a&&d("[73] PropertyListNotEmptyPath"),a}function ta(){var a;return Rb++,a=na(),a=null!==a?a:"",Rb--,0===Rb&&null===a&&d("[74] PropertyListPath"),a}function ua(){var a,b;return Rb++,b=Qb,a=va(),null!==a&&(a=function(a,b){var c={};return c.token="path",c.kind="element",c.value=b,b}(b,a)),null===a&&(Qb=b),Rb--,0===Rb&&null===a&&d("[75]"),a}function va(){var a,c,e,f,g,h,i;if(Rb++,g=Qb,h=Qb,a=wa(),null!==a){for(c=[],i=Qb,124===b.charCodeAt(Qb)?(e="|",Qb++):(e=null,0===Rb&&d('"|"')),null!==e?(f=wa(),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i);null!==e;)c.push(e),i=Qb,124===b.charCodeAt(Qb)?(e="|",Qb++):(e=null,0===Rb&&d('"|"')),null!==e?(f=wa(),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i);null!==c?a=[a,c]:(a=null,Qb=h)}else a=null,Qb=h;return null!==a&&(a=function(a,b,c){if(null==c||0===c.length)return b;for(var d=[],e=0;e<c.length;e++)d.push(c[1]);var f={};return f.token="path",f.kind="alternative",f.value=d,f}(g,a[0],a[1])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[78] PathAlternative"),a}function wa(){var a,c,e,f,g,h,i;if(Rb++,g=Qb,h=Qb,a=ya(),null!==a){for(c=[],i=Qb,47===b.charCodeAt(Qb)?(e="/",Qb++):(e=null,0===Rb&&d('"/"')),null!==e?(f=ya(),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i);null!==e;)c.push(e),i=Qb,47===b.charCodeAt(Qb)?(e="/",Qb++):(e=null,0===Rb&&d('"/"')),null!==e?(f=ya(),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i);null!==c?a=[a,c]:(a=null,Qb=h)}else a=null,Qb=h;return null!==a&&(a=function(a,b,c){if(null==c||0===c.length)return b;for(var d=[b],e=0;e<c.length;e++)d.push(c[e][1]);var f={};return f.token="path",f.kind="sequence",f.value=d,f}(g,a[0],a[1])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[79] PathSequence"),a}function xa(){var a,b,c,e;return Rb++,c=Qb,e=Qb,a=Aa(),null!==a?(b=za(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e),null!==a&&(a=function(a,b,c){if(b.token&&"path"!=b.token&&""==c)return b;if(b.token&&b.token!=d&&""!=c){var d={};return d.token="path",d.kind="element",d.value=b,d.modifier=c,d}return b.modifier=c,b}(c,a[0],a[1])),null===a&&(Qb=c),Rb--,0===Rb&&null===a&&d("[88] PathElt"),a}function ya(){var a,c,e,f;return Rb++,a=xa(),null===a&&(e=Qb,f=Qb,94===b.charCodeAt(Qb)?(a="^",Qb++):(a=null,0===Rb&&d('"^"')),null!==a?(c=xa(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){var c={};return c.token="path",c.kind="inversePath",c.value=b,c}(e,a[1])),null===a&&(Qb=e)),Rb--,0===Rb&&null===a&&d("[81] PathEltOrInverse"),a}function za(){var a,c,e,f,g,h,i,j,k;return Rb++,42===b.charCodeAt(Qb)?(a="*",Qb++):(a=null,0===Rb&&d('"*"')),null===a&&(63===b.charCodeAt(Qb)?(a="?",Qb++):(a=null,0===Rb&&d('"?"')),null===a&&(43===b.charCodeAt(Qb)?(a="+",Qb++):(a=null,0===Rb&&d('"+"')),null===a&&(h=Qb,123===b.charCodeAt(Qb)?(a="{",Qb++):(a=null,0===Rb&&d('"{"')),null!==a?(i=Qb,c=ob(),null!==c?(j=Qb,44===b.charCodeAt(Qb)?(e=",",Qb++):(e=null,0===Rb&&d('","')),null!==e?(125===b.charCodeAt(Qb)?(f="}",Qb++):(f=null,0===Rb&&d('"}"')),null===f&&(k=Qb,f=ob(),null!==f?(125===b.charCodeAt(Qb)?(g="}",Qb++):(g=null,0===Rb&&d('"}"')),null!==g?f=[f,g]:(f=null,Qb=k)):(f=null,Qb=k)),null!==f?e=[e,f]:(e=null,Qb=j)):(e=null,Qb=j),null===e&&(125===b.charCodeAt(Qb)?(e="}",Qb++):(e=null,0===Rb&&d('"}"'))),null!==e?c=[c,e]:(c=null,Qb=i)):(c=null,Qb=i),null===c&&(i=Qb,44===b.charCodeAt(Qb)?(c=",",Qb++):(c=null,0===Rb&&d('","')),null!==c?(e=ob(),null!==e?(125===b.charCodeAt(Qb)?(f="}",Qb++):(f=null,0===Rb&&d('"}"')),null!==f?c=[c,e,f]:(c=null,Qb=i)):(c=null,Qb=i)):(c=null,Qb=i)),null!==c?a=[a,c]:(a=null,Qb=h)):(a=null,Qb=h)))),Rb--,0===Rb&&null===a&&d("[82] PathMod"),a}function Aa(){var a,c,e,f,g;return Rb++,a=eb(),null===a&&(f=Qb,97===b.charCodeAt(Qb)?(a="a",Qb++):(a=null,0===Rb&&d('"a"')),null!==a&&(a=function(a){return{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}}(f)),null===a&&(Qb=f),null===a&&(f=Qb,33===b.charCodeAt(Qb)?(a="!",Qb++):(a=null,0===Rb&&d('"!"')),null!==a?(c=Ba(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null===a&&(f=Qb,g=Qb,40===b.charCodeAt(Qb)?(a="(",Qb++):(a=null,0===Rb&&d('"("')),null!==a?(c=va(),null!==c?(41===b.charCodeAt(Qb)?(e=")",Qb++):(e=null,0===Rb&&d('")"')),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)):(a=null,Qb=g),null!==a&&(a=function(a,b){return b}(f,a[1])),null===a&&(Qb=f)))),Rb--,0===Rb&&null===a&&d("[83] PathPrimary"),a}function Ba(){var a,c,e,f,g,h,i,j;if(a=Ca(),null===a)if(h=Qb,40===b.charCodeAt(Qb)?(a="(",Qb++):(a=null,0===Rb&&d('"("')),null!==a){if(i=Qb,c=Ca(),null!==c){for(e=[],j=Qb,124===b.charCodeAt(Qb)?(f="|",Qb++):(f=null,0===Rb&&d('"|"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,Qb=j)):(f=null,Qb=j);null!==f;)e.push(f),j=Qb,124===b.charCodeAt(Qb)?(f="|",Qb++):(f=null,0===Rb&&d('"|"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,Qb=j)):(f=null,Qb=j);null!==e?c=[c,e]:(c=null,Qb=i)}else c=null,Qb=i;c=null!==c?c:"",null!==c?(41===b.charCodeAt(Qb)?(e=")",Qb++):(e=null,0===Rb&&d('")"')),null!==e?a=[a,c,e]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;return a}function Ca(){var a,c,e;return Rb++,a=eb(),null===a&&(97===b.charCodeAt(Qb)?(a="a",Qb++):(a=null,0===Rb&&d('"a"')),null===a&&(e=Qb,94===b.charCodeAt(Qb)?(a="^",Qb++):(a=null,0===Rb&&d('"^"')),null!==a?(c=eb(),null===c&&(97===b.charCodeAt(Qb)?(c="a",Qb++):(c=null,0===Rb&&d('"a"'))),null!==c?a=[a,c]:(a=null,Qb=e)):(a=null,Qb=e))),Rb--,0===Rb&&null===a&&d("[85] PathOneInPropertySet"),a}function Da(){var a,b;return Rb++,b=Qb,a=Fa(),null!==a&&(a=function(a,b){for(var c=[],d=[],e=null,f=0;f<b.length;f++){Vb++;var g=null;null==b[f].chainSubject&&null==b[f].triplesContext?g=b[f]:(g=b[f].chainSubject,c=c.concat(nextSubject.triplesContext));e={subject:{token:"blank",value:"_:"+Vb},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first"},object:g},0==f&&d.push(e.subject),c.push(e),e=f===b.length-1?{subject:{token:"blank",value:"_:"+Vb},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}}:{subject:{token:"blank",value:"_:"+Vb},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"blank",value:"_:"+(Vb+1)}},c.push(e)}return{token:"triplesnodecollection",triplesContext:c,chainSubject:d}}(b,a)),null===a&&(Qb=b),null===a&&(a=Ea()),Rb--,0===Rb&&null===a&&d("[87] TriplesNode"),a}function Ea(){var a,c,e,f,g,h,i,j,k,l;for(Rb++,k=Qb,l=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(91===b.charCodeAt(Qb)?(c="[",Qb++):(c=null,0===Rb&&d('"["')),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(f=na(),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(93===b.charCodeAt(Qb)?(h="]",Qb++):(h=null,0===Rb&&d('"]"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=l)}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l;else a=null,Qb=l;return null!==a&&(a=function(a,b){Vb++;for(var c={token:"blank",value:"_:"+Vb},d=[],e=0;e<b.pairs.length;e++){var f=b.pairs[e],g={};g.subject=c,g.predicate=f[0],null!=f[1].length&&(f[1]=f[1][0]),g.object=f[1],d.push(g)}return{token:"triplesnode",kind:"blanknodepropertylist",triplesContext:b.triplesContext.concat(d),chainSubject:c}}(k,a[3])),null===a&&(Qb=k),Rb--,0===Rb&&null===a&&d("[88] BlankNodePropertyList"),a}function Fa(){var a,c,e,f,g,h,i,j,k,l;for(Rb++,k=Qb,l=Qb,a=[],c=Eb();null!==c;)a.push(c),c=Eb();if(null!==a)if(40===b.charCodeAt(Qb)?(c="(",Qb++):(c=null,0===Rb&&d('"("')),null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e){if(g=Ga(),null!==g)for(f=[];null!==g;)f.push(g),g=Ga();else f=null;if(null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();if(null!==g)if(41===b.charCodeAt(Qb)?(h=")",Qb++):(h=null,0===Rb&&d('")"')),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=l)}else a=null,Qb=l;else a=null,Qb=l}else a=null,Qb=l}else a=null,Qb=l}else a=null,Qb=l;else a=null,Qb=l;return null!==a&&(a=function(a,b){return b}(k,a[3])),null===a&&(Qb=k),Rb--,0===Rb&&null===a&&d("[89] Collection"),a}function Ga(){var a,b,c,e,f,g;for(Rb++,f=Qb,g=Qb,a=[],b=Eb();null!==b;)a.push(b),b=Eb();if(null!==a)if(b=Ha(),null!==b){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?a=[a,b,c]:(a=null,Qb=g)}else a=null,Qb=g;else a=null,Qb=g;if(null===a){for(g=Qb,a=[],b=Eb();null!==b;)a.push(b),b=Eb();if(null!==a)if(b=Da(),null!==b){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?a=[a,b,c]:(a=null,Qb=g)}else a=null,Qb=g;else a=null,Qb=g}return null!==a&&(a=function(a,b){return b[1]}(f,a)),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[90] GraphNode"),a}function Ha(){var a;return Rb++,a=Ja(),null===a&&(a=Ka()),Rb--,0===Rb&&null===a&&d("[91] VarOrTerm"),a}function Ia(){var a;return Rb++,a=Ja(),null===a&&(a=eb()),Rb--,0===Rb&&null===a&&d("[92] VarOrIRIref"),a}function Ja(){var a,b;return Rb++,b=Qb,a=lb(),null===a&&(a=mb()),null!==a&&(a=function(a,b){var c={};return c.token="var",c.value=b,c}(b,a)),null===a&&(Qb=b),Rb--,0===Rb&&null===a&&d("[93] Var"),a}function Ka(){var a;return Rb++,a=eb(),null===a&&(a=Za(),null===a&&(a=$a(),null===a&&(a=cb(),null===a&&(a=gb(),null===a&&(a=Db()))))),Rb--,0===Rb&&null===a&&d("[94] GraphTerm"),a}function La(){var a,c,e,f,g,h,i,j,k;if(Rb++,i=Qb,j=Qb,a=Ma(),null!==a){for(c=[],k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("||"===b.substr(Qb,2)?(f="||",Qb+=2):(f=null,0===Rb&&d('"||"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Ma(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k;for(;null!==e;){for(c.push(e),k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("||"===b.substr(Qb,2)?(f="||",Qb+=2):(f=null,0===Rb&&d('"||"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Ma(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k}null!==c?a=[a,c]:(a=null,Qb=j)}else a=null,Qb=j;return null!==a&&(a=function(a,b,c){if(0===c.length)return b;var d={};d.token="expression",d.expressionType="conditionalor";for(var e=[b],f=0;f<c.length;f++)e.push(c[f][3]);return d.operands=e,d}(i,a[0],a[1])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[96] ConditionalOrExpression"),a}function Ma(){var a,c,e,f,g,h,i,j,k;if(Rb++,i=Qb,j=Qb,a=Na(),null!==a){for(c=[],k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("&&"===b.substr(Qb,2)?(f="&&",Qb+=2):(f=null,0===Rb&&d('"&&"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Na(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k;for(;null!==e;){for(c.push(e),k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("&&"===b.substr(Qb,2)?(f="&&",Qb+=2):(f=null,0===Rb&&d('"&&"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Na(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k}null!==c?a=[a,c]:(a=null,Qb=j)}else a=null,Qb=j;return null!==a&&(a=function(a,b,c){if(0===c.length)return b;var d={};d.token="expression",d.expressionType="conditionaland";for(var e=[b],f=0;f<c.length;f++)e.push(c[f][3]);return d.operands=e,d}(i,a[0],a[1])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[97] ConditionalAndExpression"),a}function Na(){var a,c,e,f,g,h,i,j,k,l,m,n,o,p;if(Rb++,n=Qb,o=Qb,a=Oa(),null!==a){for(c=[],p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(61===b.charCodeAt(Qb)?(f="=",Qb++):(f=null,0===Rb&&d('"="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("!="===b.substr(Qb,2)?(f="!=",Qb+=2):(f=null,0===Rb&&d('"!="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(60===b.charCodeAt(Qb)?(f="<",Qb++):(f=null,0===Rb&&d('"<"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(62===b.charCodeAt(Qb)?(f=">",Qb++):(f=null,0===Rb&&d('">"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("<="===b.substr(Qb,2)?(f="<=",Qb+=2):(f=null,0===Rb&&d('"<="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(">="===b.substr(Qb,2)?(f=">=",Qb+=2):(f=null,0===Rb&&d('">="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(73===b.charCodeAt(Qb)?(f="I",Qb++):(f=null,0===Rb&&d('"I"')),null===f&&(105===b.charCodeAt(Qb)?(f="i",Qb++):(f=null,0===Rb&&d('"i"'))),null!==f)if(78===b.charCodeAt(Qb)?(g="N",Qb++):(g=null,0===Rb&&d('"N"')),null===g&&(110===b.charCodeAt(Qb)?(g="n",Qb++):(g=null,0===Rb&&d('"n"'))),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=ja(),null!==i?e=[e,f,g,h,i]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(78===b.charCodeAt(Qb)?(f="N",Qb++):(f=null,0===Rb&&d('"N"')),null===f&&(110===b.charCodeAt(Qb)?(f="n",Qb++):(f=null,0===Rb&&d('"n"'))),null!==f)if(79===b.charCodeAt(Qb)?(g="O",Qb++):(g=null,0===Rb&&d('"O"')),null===g&&(111===b.charCodeAt(Qb)?(g="o",Qb++):(g=null,0===Rb&&d('"o"'))),null!==g)if(84===b.charCodeAt(Qb)?(h="T",Qb++):(h=null,0===Rb&&d('"T"')),null===h&&(116===b.charCodeAt(Qb)?(h="t",Qb++):(h=null,0===Rb&&d('"t"'))),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(73===b.charCodeAt(Qb)?(j="I",Qb++):(j=null,0===Rb&&d('"I"')),null===j&&(105===b.charCodeAt(Qb)?(j="i",Qb++):(j=null,0===Rb&&d('"i"'))),null!==j)if(78===b.charCodeAt(Qb)?(k="N",Qb++):(k=null,0===Rb&&d('"N"')),null===k&&(110===b.charCodeAt(Qb)?(k="n",Qb++):(k=null,0===Rb&&d('"n"'))),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?(m=ja(),null!==m?e=[e,f,g,h,i,j,k,l,m]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p}else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p}}}}}}}for(;null!==e;){for(c.push(e),p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(61===b.charCodeAt(Qb)?(f="=",Qb++):(f=null,0===Rb&&d('"="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("!="===b.substr(Qb,2)?(f="!=",Qb+=2):(f=null,0===Rb&&d('"!="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(60===b.charCodeAt(Qb)?(f="<",Qb++):(f=null,0===Rb&&d('"<"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(62===b.charCodeAt(Qb)?(f=">",Qb++):(f=null,0===Rb&&d('">"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if("<="===b.substr(Qb,2)?(f="<=",Qb+=2):(f=null,0===Rb&&d('"<="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(">="===b.substr(Qb,2)?(f=">=",Qb+=2):(f=null,0===Rb&&d('">="')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Oa(),null!==h?e=[e,f,g,h]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(73===b.charCodeAt(Qb)?(f="I",Qb++):(f=null,0===Rb&&d('"I"')),null===f&&(105===b.charCodeAt(Qb)?(f="i",Qb++):(f=null,0===Rb&&d('"i"'))),null!==f)if(78===b.charCodeAt(Qb)?(g="N",Qb++):(g=null,0===Rb&&d('"N"')),null===g&&(110===b.charCodeAt(Qb)?(g="n",Qb++):(g=null,0===Rb&&d('"n"'))),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=ja(),null!==i?e=[e,f,g,h,i]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p;if(null===e){for(p=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(78===b.charCodeAt(Qb)?(f="N",Qb++):(f=null,0===Rb&&d('"N"')),null===f&&(110===b.charCodeAt(Qb)?(f="n",Qb++):(f=null,0===Rb&&d('"n"'))),null!==f)if(79===b.charCodeAt(Qb)?(g="O",Qb++):(g=null,0===Rb&&d('"O"')),null===g&&(111===b.charCodeAt(Qb)?(g="o",Qb++):(g=null,0===Rb&&d('"o"'))),null!==g)if(84===b.charCodeAt(Qb)?(h="T",Qb++):(h=null,0===Rb&&d('"T"')),null===h&&(116===b.charCodeAt(Qb)?(h="t",Qb++):(h=null,0===Rb&&d('"t"'))),null!==h){for(i=[],j=Eb();null!==j;)i.push(j),j=Eb();if(null!==i)if(73===b.charCodeAt(Qb)?(j="I",Qb++):(j=null,0===Rb&&d('"I"')),null===j&&(105===b.charCodeAt(Qb)?(j="i",Qb++):(j=null,0===Rb&&d('"i"'))),null!==j)if(78===b.charCodeAt(Qb)?(k="N",Qb++):(k=null,0===Rb&&d('"N"')),null===k&&(110===b.charCodeAt(Qb)?(k="n",Qb++):(k=null,0===Rb&&d('"n"'))),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?(m=ja(),null!==m?e=[e,f,g,h,i,j,k,l,m]:(e=null,Qb=p)):(e=null,Qb=p)}else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p}else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p;else e=null,Qb=p}}}}}}}}null!==c?a=[a,c]:(a=null,Qb=o)}else a=null,Qb=o;return null!==a&&(a=function(a,b,c){if(0===c.length)return b;if("i"===c[0][1]||"I"===c[0][1]||"n"===c[0][1]||"N"===c[0][1]){var d={};if("i"===c[0][1]||"I"===c[0][1]){var e="=";d.expressionType="conditionalor"}else{var e="!=";d.expressionType="conditionaland"}for(var f=b,g=[],h=0;h<c[0].length;h++)if("args"===c[0][h].token){g=c[0][h].value;break}d.token="expression",d.operands=[];for(var i=0;i<g.length;i++){var j={};j.token="expression",j.expressionType="relationalexpression",j.operator=e,j.op1=f,j.op2=g[i],d.operands.push(j)}return d}var d={};return d.expressionType="relationalexpression",d.operator=c[0][1],d.op1=b,d.op2=c[0][3],d.token="expression",d}(n,a[0],a[1])),null===a&&(Qb=n),Rb--,0===Rb&&null===a&&d("[99] RelationalExpression"),a}function Oa(){var a,c,e,f,g,h,i,j,k,l,m;if(Rb++,j=Qb,k=Qb,a=Pa(),null!==a){for(c=[],l=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(43===b.charCodeAt(Qb)?(f="+",Qb++):(f=null,0===Rb&&d('"+"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Pa(),null!==h?e=[e,f,g,h]:(e=null,Qb=l)):(e=null,Qb=l)}else e=null,Qb=l;else e=null,Qb=l;if(null===e){for(l=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(45===b.charCodeAt(Qb)?(f="-",Qb++):(f=null,0===Rb&&d('"-"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Pa(),null!==h?e=[e,f,g,h]:(e=null,Qb=l)):(e=null,Qb=l)}else e=null,Qb=l;else e=null,Qb=l;if(null===e)if(l=Qb,e=bb(),null===e&&(e=bb()),null!==e){for(m=Qb,f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(42===b.charCodeAt(Qb)?(g="*",Qb++):(g=null,0===Rb&&d('"*"')),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=Qa(),null!==i?f=[f,g,h,i]:(f=null,Qb=m)):(f=null,Qb=m)}else f=null,Qb=m;else f=null,Qb=m;if(null===f){for(m=Qb,f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(47===b.charCodeAt(Qb)?(g="/",Qb++):(g=null,0===Rb&&d('"/"')),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=Qa(),null!==i?f=[f,g,h,i]:(f=null,Qb=m)):(f=null,Qb=m)}else f=null,Qb=m;else f=null,Qb=m}f=null!==f?f:"",null!==f?e=[e,f]:(e=null,Qb=l)}else e=null,Qb=l}for(;null!==e;){for(c.push(e),l=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(43===b.charCodeAt(Qb)?(f="+",Qb++):(f=null,0===Rb&&d('"+"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Pa(),null!==h?e=[e,f,g,h]:(e=null,Qb=l)):(e=null,Qb=l)}else e=null,Qb=l;else e=null,Qb=l;if(null===e){for(l=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(45===b.charCodeAt(Qb)?(f="-",Qb++):(f=null,0===Rb&&d('"-"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Pa(),null!==h?e=[e,f,g,h]:(e=null,Qb=l)):(e=null,Qb=l)}else e=null,Qb=l;else e=null,Qb=l;if(null===e)if(l=Qb,e=bb(),null===e&&(e=bb()),null!==e){for(m=Qb,f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(42===b.charCodeAt(Qb)?(g="*",Qb++):(g=null,0===Rb&&d('"*"')),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=Qa(),null!==i?f=[f,g,h,i]:(f=null,Qb=m)):(f=null,Qb=m)}else f=null,Qb=m;else f=null,Qb=m;if(null===f){for(m=Qb,f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(47===b.charCodeAt(Qb)?(g="/",Qb++):(g=null,0===Rb&&d('"/"')),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=Qa(),null!==i?f=[f,g,h,i]:(f=null,Qb=m)):(f=null,Qb=m)}else f=null,Qb=m;else f=null,Qb=m}f=null!==f?f:"",null!==f?e=[e,f]:(e=null,Qb=l)}else e=null,Qb=l}}null!==c?a=[a,c]:(a=null,Qb=k)}else a=null,Qb=k;return null!==a&&(a=function(a,b,c){if(0===c.length)return b;var d={};d.token="expression",d.expressionType="additiveexpression",d.summand=b,d.summands=[];for(var e=0;e<c.length;e++){var f=c[e],g={};if(4==f.length&&"string"==typeof f[1])g.operator=f[1],g.expression=f[3];else{var h={},i=g[0],j=g[1][1],k=g[1][3],j=null;i.value<0?(g.operator="-",i.value=-i.value):g.operator="+",h.token="expression",h.expressionType="multiplicativeexpression",h.operator=i,h.factors=[{operator:j,expression:k}],g.expression=h}d.summands.push(g)}return d}(j,a[0],a[1])),null===a&&(Qb=j),Rb--,0===Rb&&null===a&&d("[101] AdditiveExpression"),a}function Pa(){var a,c,e,f,g,h,i,j,k;if(Rb++,i=Qb,j=Qb,a=Qa(),null!==a){for(c=[],k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(42===b.charCodeAt(Qb)?(f="*",Qb++):(f=null,0===Rb&&d('"*"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Qa(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k;if(null===e){for(k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(47===b.charCodeAt(Qb)?(f="/",Qb++):(f=null,0===Rb&&d('"/"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Qa(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k}for(;null!==e;){for(c.push(e),k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(42===b.charCodeAt(Qb)?(f="*",Qb++):(f=null,0===Rb&&d('"*"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Qa(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k;if(null===e){for(k=Qb,e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(47===b.charCodeAt(Qb)?(f="/",Qb++):(f=null,0===Rb&&d('"/"')),null!==f){for(g=[],h=Eb();null!==h;)g.push(h),h=Eb();null!==g?(h=Qa(),null!==h?e=[e,f,g,h]:(e=null,Qb=k)):(e=null,Qb=k)}else e=null,Qb=k;else e=null,Qb=k}}null!==c?a=[a,c]:(a=null,Qb=j)}else a=null,Qb=j;return null!==a&&(a=function(a,b,c){if(0===c.length)return b;var d={};d.token="expression",d.expressionType="multiplicativeexpression",d.factor=b,d.factors=[];for(var e=0;e<c.length;e++){var f=c[e],g={};g.operator=f[1],g.expression=f[3],d.factors.push(g)}return d}(i,a[0],a[1])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[102] MultiplicativeExpression"),a}function Qa(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,33===b.charCodeAt(Qb)?(a="!",Qb++):(a=null,0===Rb&&d('"!"')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=Ra(),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="unaryexpression",c.unaryexpression="!",c.expression=b,c}(f,a[2])),null===a&&(Qb=f),null===a){if(f=Qb,g=Qb,43===b.charCodeAt(Qb)?(a="+",Qb++):(a=null,0===Rb&&d('"+"')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=Ra(),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="unaryexpression",c.unaryexpression="+",c.expression=b,c}(f,a[2])),null===a&&(Qb=f),null===a){if(f=Qb,g=Qb,45===b.charCodeAt(Qb)?(a="-",Qb++):(a=null,0===Rb&&d('"-"')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=Ra(),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="unaryexpression",c.unaryexpression="-",c.expression=b,c}(f,a[2])),null===a&&(Qb=f),null===a&&(a=Ra())}}return Rb--,0===Rb&&null===a&&d("[103] UnaryExpression"),a}function Ra(){var a,b;return Rb++,a=Sa(),null===a&&(a=Ta(),null===a&&(a=Ya(),null===a&&(b=Qb,a=Za(),null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="atomic",c.primaryexpression="rdfliteral",c.value=b,c}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=$a(),null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="atomic",c.primaryexpression="numericliteral",c.value=b,c}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=cb(),null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="atomic",c.primaryexpression="booleanliteral",c.value=b,c}(b,a)),null===a&&(Qb=b),null===a&&(a=Xa(),null===a&&(b=Qb,a=Ja(),null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="atomic",c.primaryexpression="var",c.value=b,c}(b,a)),null===a&&(Qb=b)))))))),Rb--,0===Rb&&null===a&&d("[104] PrimaryExpression"),a}function Sa(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,40===b.charCodeAt(Qb)?(a="(",Qb++):(a=null,0===Rb&&d('"("')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(e=La(),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),
g=Eb();null!==f?(41===b.charCodeAt(Qb)?(g=")",Qb++):(g=null,0===Rb&&d('")"')),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){return b}(h,a[2])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[105] BrackettedExpression"),a}function Ta(){var a,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(Rb++,r=Qb,s=Qb,"STR"===b.substr(Qb,3)?(a="STR",Qb+=3):(a=null,0===Rb&&d('"STR"')),null===a&&("str"===b.substr(Qb,3)?(a="str",Qb+=3):(a=null,0===Rb&&d('"str"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="str",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"LANG"===b.substr(Qb,4)?(a="LANG",Qb+=4):(a=null,0===Rb&&d('"LANG"')),null===a&&("lang"===b.substr(Qb,4)?(a="lang",Qb+=4):(a=null,0===Rb&&d('"lang"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="lang",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"LANGMATCHES"===b.substr(Qb,11)?(a="LANGMATCHES",Qb+=11):(a=null,0===Rb&&d('"LANGMATCHES"')),null===a&&("langmatches"===b.substr(Qb,11)?(a="langmatches",Qb+=11):(a=null,0===Rb&&d('"langmatches"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(44===b.charCodeAt(Qb)?(i=",",Qb++):(i=null,0===Rb&&d('","')),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(k=La(),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?(41===b.charCodeAt(Qb)?(m=")",Qb++):(m=null,0===Rb&&d('")"')),null!==m?a=[a,c,e,f,g,h,i,j,k,l,m]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="builtincall",d.builtincall="langmatches",d.args=[b,c],d}(r,a[4],a[8])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"DATATYPE"===b.substr(Qb,8)?(a="DATATYPE",Qb+=8):(a=null,0===Rb&&d('"DATATYPE"')),null===a&&("datatype"===b.substr(Qb,8)?(a="datatype",Qb+=8):(a=null,0===Rb&&d('"datatype"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="datatype",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"BOUND"===b.substr(Qb,5)?(a="BOUND",Qb+=5):(a=null,0===Rb&&d('"BOUND"')),null===a&&("bound"===b.substr(Qb,5)?(a="bound",Qb+=5):(a=null,0===Rb&&d('"bound"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=Ja(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="bound",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"IRI"===b.substr(Qb,3)?(a="IRI",Qb+=3):(a=null,0===Rb&&d('"IRI"')),null===a&&("iri"===b.substr(Qb,3)?(a="iri",Qb+=3):(a=null,0===Rb&&d('"iri"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="iri",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"URI"===b.substr(Qb,3)?(a="URI",Qb+=3):(a=null,0===Rb&&d('"URI"')),null===a&&("uri"===b.substr(Qb,3)?(a="uri",Qb+=3):(a=null,0===Rb&&d('"uri"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="uri",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"BNODE"===b.substr(Qb,5)?(a="BNODE",Qb+=5):(a=null,0===Rb&&d('"BNODE"')),null===a&&("bnode"===b.substr(Qb,5)?(a="bnode",Qb+=5):(a=null,0===Rb&&d('"bnode"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c){if(t=Qb,40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?e=[e,f,g,h,i]:(e=null,Qb=t)):(e=null,Qb=t)}else e=null,Qb=t;else e=null,Qb=t}else e=null,Qb=t;null===e&&(e=Db()),null!==e?a=[a,c,e]:(a=null,Qb=s)}else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="bnode",5===b.length?c.args=[b[2]]:c.args=null,c}(r,a[2])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"COALESCE"===b.substr(Qb,8)?(a="COALESCE",Qb+=8):(a=null,0===Rb&&d('"COALESCE"')),null===a&&("coalesce"===b.substr(Qb,8)?(a="coalesce",Qb+=8):(a=null,0===Rb&&d('"coalesce"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=ja(),null!==e?a=[a,c,e]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="coalesce",c.args=b,c}(r,a[2])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"IF"===b.substr(Qb,2)?(a="IF",Qb+=2):(a=null,0===Rb&&d('"IF"')),null===a&&("if"===b.substr(Qb,2)?(a="if",Qb+=2):(a=null,0===Rb&&d('"if"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(44===b.charCodeAt(Qb)?(i=",",Qb++):(i=null,0===Rb&&d('","')),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(k=La(),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();if(null!==l)if(44===b.charCodeAt(Qb)?(m=",",Qb++):(m=null,0===Rb&&d('","')),null!==m){for(n=[],o=Eb();null!==o;)n.push(o),o=Eb();if(null!==n)if(o=La(),null!==o){for(p=[],q=Eb();null!==q;)p.push(q),q=Eb();null!==p?(41===b.charCodeAt(Qb)?(q=")",Qb++):(q=null,0===Rb&&d('")"')),null!==q?a=[a,c,e,f,g,h,i,j,k,l,m,n,o,p,q]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b,c,d){var e={};return e.token="expression",e.expressionType="builtincall",e.builtincall="if",e.args=[b,c,d],e}(r,a[4],a[8],a[12])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"ISLITERAL"===b.substr(Qb,9)?(a="ISLITERAL",Qb+=9):(a=null,0===Rb&&d('"ISLITERAL"')),null===a&&("isliteral"===b.substr(Qb,9)?(a="isliteral",Qb+=9):(a=null,0===Rb&&d('"isliteral"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="isliteral",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"ISBLANK"===b.substr(Qb,7)?(a="ISBLANK",Qb+=7):(a=null,0===Rb&&d('"ISBLANK"')),null===a&&("isblank"===b.substr(Qb,7)?(a="isblank",Qb+=7):(a=null,0===Rb&&d('"isblank"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="isblank",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"SAMETERM"===b.substr(Qb,8)?(a="SAMETERM",Qb+=8):(a=null,0===Rb&&d('"SAMETERM"')),null===a&&("sameterm"===b.substr(Qb,8)?(a="sameterm",Qb+=8):(a=null,0===Rb&&d('"sameterm"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(44===b.charCodeAt(Qb)?(i=",",Qb++):(i=null,0===Rb&&d('","')),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(k=La(),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?(41===b.charCodeAt(Qb)?(m=")",Qb++):(m=null,0===Rb&&d('")"')),null!==m?a=[a,c,e,f,g,h,i,j,k,l,m]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="builtincall",d.builtincall="sameterm",d.args=[b,c],d}(r,a[4],a[8])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"ISURI"===b.substr(Qb,5)?(a="ISURI",Qb+=5):(a=null,0===Rb&&d('"ISURI"')),null===a&&("isuri"===b.substr(Qb,5)?(a="isuri",Qb+=5):(a=null,0===Rb&&d('"isuri"')),null===a&&("ISIRI"===b.substr(Qb,5)?(a="ISIRI",Qb+=5):(a=null,0===Rb&&d('"ISIRI"')),null===a&&("isiri"===b.substr(Qb,5)?(a="isiri",Qb+=5):(a=null,0===Rb&&d('"isiri"'))))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(41===b.charCodeAt(Qb)?(i=")",Qb++):(i=null,0===Rb&&d('")"')),null!==i?a=[a,c,e,f,g,h,i]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s;if(null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="isuri",c.args=[b],c}(r,a[4])),null===a&&(Qb=r),null===a){if(r=Qb,s=Qb,"custom:"===b.substr(Qb,7)?(a="custom:",Qb+=7):(a=null,0===Rb&&d('"custom:"')),null===a&&("CUSTOM:"===b.substr(Qb,7)?(a="CUSTOM:",Qb+=7):(a=null,0===Rb&&d('"CUSTOM:"'))),null!==a){if(/^[a-zA-Z0-9_]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[a-zA-Z0-9_]")),null!==e)for(c=[];null!==e;)c.push(e),/^[a-zA-Z0-9_]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[a-zA-Z0-9_]"));else c=null;if(null!==c){for(e=[],f=Eb();null!==f;)e.push(f),f=Eb();if(null!==e)if(40===b.charCodeAt(Qb)?(f="(",Qb++):(f=null,0===Rb&&d('"("')),null!==f){for(g=[],t=Qb,h=[],i=Eb();null!==i;)h.push(i),i=Eb();for(null!==h?(i=La(),null!==i?(44===b.charCodeAt(Qb)?(j=",",Qb++):(j=null,0===Rb&&d('","')),null!==j?h=[h,i,j]:(h=null,Qb=t)):(h=null,Qb=t)):(h=null,Qb=t);null!==h;){for(g.push(h),t=Qb,h=[],i=Eb();null!==i;)h.push(i),i=Eb();null!==h?(i=La(),null!==i?(44===b.charCodeAt(Qb)?(j=",",Qb++):(j=null,0===Rb&&d('","')),null!==j?h=[h,i,j]:(h=null,Qb=t)):(h=null,Qb=t)):(h=null,Qb=t)}if(null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(i=La(),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();null!==j?(41===b.charCodeAt(Qb)?(k=")",Qb++):(k=null,0===Rb&&d('")"')),null!==k?a=[a,c,e,f,g,h,i,j,k]:(a=null,Qb=s)):(a=null,Qb=s)}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s}else a=null,Qb=s;else a=null,Qb=s}else a=null,Qb=s}else a=null,Qb=s;null!==a&&(a=function(a,b,c,d){var e={};e.token="expression",e.expressionType="custom",e.name=b.join("");for(var f=[],g=0;g<c.length;g++)f.push(c[g][1]);return f.push(d),e.args=f,e}(r,a[1],a[4],a[6])),null===a&&(Qb=r),null===a&&(a=Ua(),null===a&&(a=Va(),null===a&&(a=Wa())))}}}}}}}}}}}}}}return Rb--,0===Rb&&null===a&&d("[106] BuiltInCall"),a}function Ua(){var a,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(Rb++,p=Qb,q=Qb,"REGEX"===b.substr(Qb,5)?(a="REGEX",Qb+=5):(a=null,0===Rb&&d('"REGEX"')),null===a&&("regex"===b.substr(Qb,5)?(a="regex",Qb+=5):(a=null,0===Rb&&d('"regex"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if(g=La(),null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(44===b.charCodeAt(Qb)?(i=",",Qb++):(i=null,0===Rb&&d('","')),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(k=La(),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();if(null!==l){if(r=Qb,44===b.charCodeAt(Qb)?(m=",",Qb++):(m=null,0===Rb&&d('","')),null!==m){for(n=[],o=Eb();null!==o;)n.push(o),o=Eb();null!==n?(o=La(),null!==o?m=[m,n,o]:(m=null,Qb=r)):(m=null,Qb=r)}else m=null,Qb=r;if(m=null!==m?m:"",null!==m){for(n=[],o=Eb();null!==o;)n.push(o),o=Eb();null!==n?(41===b.charCodeAt(Qb)?(o=")",Qb++):(o=null,0===Rb&&d('")"')),null!==o?a=[a,c,e,f,g,h,i,j,k,l,m,n,o]:(a=null,Qb=q)):(a=null,Qb=q)}else a=null,Qb=q}else a=null,Qb=q}else a=null,Qb=q;else a=null,Qb=q}else a=null,Qb=q;else a=null,Qb=q}else a=null,Qb=q;else a=null,Qb=q}else a=null,Qb=q;else a=null,Qb=q}else a=null,Qb=q;return null!==a&&(a=function(a,b,c,d){var e={};return e.token="expression",e.expressionType="regex",e.text=b,e.pattern=c,e.flags=d[2],e}(p,a[4],a[8],a[10])),null===a&&(Qb=p),Rb--,0===Rb&&null===a&&d("[107] RegexExpression"),a}function Va(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,"EXISTS"===b.substr(Qb,6)?(a="EXISTS",Qb+=6):(a=null,0===Rb&&d('"EXISTS"')),null===a&&("exists"===b.substr(Qb,6)?(a="exists",Qb+=6):(a=null,0===Rb&&d('"exists"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(e=Y(),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="exists",c.args=[b],c}(f,a[2])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[108] ExistsFunc"),a}function Wa(){var a,c,e,f,g,h,i;if(Rb++,h=Qb,i=Qb,"NOT"===b.substr(Qb,3)?(a="NOT",Qb+=3):(a=null,0===Rb&&d('"NOT"')),null===a&&("not"===b.substr(Qb,3)?(a="not",Qb+=3):(a=null,0===Rb&&d('"not"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if("EXISTS"===b.substr(Qb,6)?(e="EXISTS",Qb+=6):(e=null,0===Rb&&d('"EXISTS"')),null===e&&("exists"===b.substr(Qb,6)?(e="exists",Qb+=6):(e=null,0===Rb&&d('"exists"'))),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();null!==f?(g=Y(),null!==g?a=[a,c,e,f,g]:(a=null,Qb=i)):(a=null,Qb=i)}else a=null,Qb=i;else a=null,Qb=i}else a=null,Qb=i;return null!==a&&(a=function(a,b){var c={};return c.token="expression",c.expressionType="builtincall",c.builtincall="notexists",c.args=[b],c}(h,a[4])),null===a&&(Qb=h),Rb--,0===Rb&&null===a&&d("[109] NotExistsFunc"),a}function Xa(){var a,c,e,f,g,h,i,j,k,l,m,n,o;if(Rb++,n=Qb,o=Qb,"COUNT"===b.substr(Qb,5)?(a="COUNT",Qb+=5):(a=null,0===Rb&&d('"COUNT"')),null===a&&("count"===b.substr(Qb,5)?(a="count",Qb+=5):(a=null,0===Rb&&d('"count"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if("DISTINCT"===b.substr(Qb,8)?(g="DISTINCT",Qb+=8):(g=null,0===Rb&&d('"DISTINCT"')),null===g&&("distinct"===b.substr(Qb,8)?(g="distinct",Qb+=8):(g=null,0===Rb&&d('"distinct"'))),g=null!==g?g:"",null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(42===b.charCodeAt(Qb)?(i="*",Qb++):(i=null,0===Rb&&d('"*"')),null===i&&(i=La()),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(41===b.charCodeAt(Qb)?(k=")",Qb++):(k=null,0===Rb&&d('")"')),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?a=[a,c,e,f,g,h,i,j,k,l]:(a=null,Qb=o)}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;if(null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="aggregate",d.aggregateType="count",d.distinct=""!=b?"DISTINCT":b,d.expression=c,d}(n,a[4],a[6])),null===a&&(Qb=n),null===a){if(n=Qb,o=Qb,"SUM"===b.substr(Qb,3)?(a="SUM",Qb+=3):(a=null,0===Rb&&d('"SUM"')),null===a&&("sum"===b.substr(Qb,3)?(a="sum",Qb+=3):(a=null,0===Rb&&d('"sum"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if("DISTINCT"===b.substr(Qb,8)?(g="DISTINCT",Qb+=8):(g=null,0===Rb&&d('"DISTINCT"')),null===g&&("distinct"===b.substr(Qb,8)?(g="distinct",Qb+=8):(g=null,0===Rb&&d('"distinct"'))),g=null!==g?g:"",null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(i=La(),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(41===b.charCodeAt(Qb)?(k=")",Qb++):(k=null,0===Rb&&d('")"')),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?a=[a,c,e,f,g,h,i,j,k,l]:(a=null,Qb=o)}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;if(null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="aggregate",d.aggregateType="sum",d.distinct=""!=b?"DISTINCT":b,d.expression=c,d}(n,a[4],a[6])),null===a&&(Qb=n),null===a){if(n=Qb,o=Qb,"MIN"===b.substr(Qb,3)?(a="MIN",Qb+=3):(a=null,0===Rb&&d('"MIN"')),null===a&&("min"===b.substr(Qb,3)?(a="min",Qb+=3):(a=null,0===Rb&&d('"min"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if("DISTINCT"===b.substr(Qb,8)?(g="DISTINCT",Qb+=8):(g=null,0===Rb&&d('"DISTINCT"')),null===g&&("distinct"===b.substr(Qb,8)?(g="distinct",Qb+=8):(g=null,0===Rb&&d('"distinct"'))),g=null!==g?g:"",null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(i=La(),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(41===b.charCodeAt(Qb)?(k=")",Qb++):(k=null,0===Rb&&d('")"')),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?a=[a,c,e,f,g,h,i,j,k,l]:(a=null,Qb=o)}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;if(null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="aggregate",d.aggregateType="min",d.distinct=""!=b?"DISTINCT":b,d.expression=c,d}(n,a[4],a[6])),null===a&&(Qb=n),null===a){if(n=Qb,o=Qb,"MAX"===b.substr(Qb,3)?(a="MAX",Qb+=3):(a=null,0===Rb&&d('"MAX"')),null===a&&("max"===b.substr(Qb,3)?(a="max",Qb+=3):(a=null,0===Rb&&d('"max"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if("DISTINCT"===b.substr(Qb,8)?(g="DISTINCT",Qb+=8):(g=null,0===Rb&&d('"DISTINCT"')),null===g&&("distinct"===b.substr(Qb,8)?(g="distinct",Qb+=8):(g=null,0===Rb&&d('"distinct"'))),g=null!==g?g:"",null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(i=La(),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(41===b.charCodeAt(Qb)?(k=")",Qb++):(k=null,0===Rb&&d('")"')),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?a=[a,c,e,f,g,h,i,j,k,l]:(a=null,Qb=o)}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;if(null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="aggregate",d.aggregateType="max",d.distinct=""!=b?"DISTINCT":b,d.expression=c,d}(n,a[4],a[6])),null===a&&(Qb=n),null===a){if(n=Qb,o=Qb,"AVG"===b.substr(Qb,3)?(a="AVG",Qb+=3):(a=null,0===Rb&&d('"AVG"')),null===a&&("avg"===b.substr(Qb,3)?(a="avg",Qb+=3):(a=null,0===Rb&&d('"avg"'))),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();if(null!==c)if(40===b.charCodeAt(Qb)?(e="(",Qb++):(e=null,0===Rb&&d('"("')),null!==e){for(f=[],g=Eb();null!==g;)f.push(g),g=Eb();if(null!==f)if("DISTINCT"===b.substr(Qb,8)?(g="DISTINCT",Qb+=8):(g=null,0===Rb&&d('"DISTINCT"')),null===g&&("distinct"===b.substr(Qb,8)?(g="distinct",Qb+=8):(g=null,0===Rb&&d('"distinct"'))),g=null!==g?g:"",null!==g){for(h=[],i=Eb();null!==i;)h.push(i),i=Eb();if(null!==h)if(i=La(),null!==i){for(j=[],k=Eb();null!==k;)j.push(k),k=Eb();if(null!==j)if(41===b.charCodeAt(Qb)?(k=")",Qb++):(k=null,0===Rb&&d('")"')),null!==k){for(l=[],m=Eb();null!==m;)l.push(m),m=Eb();null!==l?a=[a,c,e,f,g,h,i,j,k,l]:(a=null,Qb=o)}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;else a=null,Qb=o}else a=null,Qb=o;null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="aggregate",d.aggregateType="avg",d.distinct=""!=b?"DISTINCT":b,d.expression=c,d}(n,a[4],a[6])),null===a&&(Qb=n)}}}}return Rb--,0===Rb&&null===a&&d("[110] Aggregate"),a}function Ya(){var a,b,c,e;return Rb++,c=Qb,e=Qb,a=eb(),null!==a?(b=ia(),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e),null!==a&&(a=function(a,b,c){var d={};return d.token="expression",d.expressionType="irireforfunction",d.iriref=b,d.args=c.value,d}(c,a[0],a[1])),null===a&&(Qb=c),Rb--,0===Rb&&null===a&&d("[117] IRIrefOrFunction"),a}function Za(){var a,c,e,f,g,h;return Rb++,f=Qb,g=Qb,a=db(),null!==a?(c=nb(),null===c&&(h=Qb,"^^"===b.substr(Qb,2)?(c="^^",Qb+=2):(c=null,0===Rb&&d('"^^"')),null!==c?(e=eb(),null!==e?c=[c,e]:(c=null,Qb=h)):(c=null,Qb=h)),c=null!==c?c:"",null!==c?a=[a,c]:(a=null,Qb=g)):(a=null,Qb=g),null!==a&&(a=function(a,b,c){return"string"==typeof c&&c.length>0?{token:"literal",value:b.value,lang:c.slice(1),type:null}:"object"==typeof c?(c.shift(),{token:"literal",value:b.value,lang:null,type:c[0]}):{token:"literal",value:b.value,lang:null,type:null}}(f,a[0],a[1])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[112] RDFLiteral"),a}function $a(){var a;return Rb++,a=_a(),null===a&&(a=ab(),null===a&&(a=bb())),Rb--,0===Rb&&null===a&&d("[113] NumericLiteral"),a}function _a(){var a;return Rb++,a=qb(),null===a&&(a=pb(),null===a&&(a=ob())),Rb--,0===Rb&&null===a&&d("[114] NumericLiteralUnsigned"),a}function ab(){var a;return Rb++,a=tb(),null===a&&(a=sb(),null===a&&(a=rb())),Rb--,0===Rb&&null===a&&d("[115] NumericLiteralPositive"),a}function bb(){var a;return Rb++,a=wb(),null===a&&(a=vb(),null===a&&(a=ub())),Rb--,0===Rb&&null===a&&d("[116] NumericLiteralNegative"),a}function cb(){var a,c;return Rb++,c=Qb,"TRUE"===b.substr(Qb,4)?(a="TRUE",Qb+=4):(a=null,0===Rb&&d('"TRUE"')),null===a&&("true"===b.substr(Qb,4)?(a="true",Qb+=4):(a=null,0===Rb&&d('"true"'))),null!==a&&(a=function(a){var b={};return b.token="literal",b.lang=null,b.type="http://www.w3.org/2001/XMLSchema#boolean",b.value=!0,b}(c)),null===a&&(Qb=c),null===a&&(c=Qb,"FALSE"===b.substr(Qb,5)?(a="FALSE",Qb+=5):(a=null,0===Rb&&d('"FALSE"')),null===a&&("false"===b.substr(Qb,5)?(a="false",Qb+=5):(a=null,0===Rb&&d('"false"'))),null!==a&&(a=function(a){var b={};return b.token="literal",b.lang=null,b.type="http://www.w3.org/2001/XMLSchema#boolean",b.value=!1,b}(c)),null===a&&(Qb=c)),Rb--,0===Rb&&null===a&&d("[117] BooleanLiteral"),a}function db(){var a,b;return Rb++,b=Qb,a=Ab(),null!==a&&(a=function(a,b){return{token:"string",value:b}}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=Bb(),null!==a&&(a=function(a,b){return{token:"string",value:b}}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=yb(),null!==a&&(a=function(a,b){return{token:"string",value:b}}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=zb(),null!==a&&(a=function(a,b){return{token:"string",value:b}}(b,a)),null===a&&(Qb=b)))),Rb--,0===Rb&&null===a&&d("[118] String"),a}function eb(){var a,b;return Rb++,b=Qb,a=hb(),null!==a&&(a=function(a,b){return{token:"uri",prefix:null,suffix:null,value:b}}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=fb(),null!==a&&(a=function(a,b){return b}(b,a)),null===a&&(Qb=b)),Rb--,0===Rb&&null===a&&d("[119] IRIref"),a}function fb(){var a,b;return Rb++,b=Qb,a=jb(),null!==a&&(a=function(a,b){return{token:"uri",prefix:b[0],suffix:b[1],value:null}}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=ib(),null!==a&&(a=function(a,b){return{token:"uri",prefix:b,suffix:"",value:null}}(b,a)),null===a&&(Qb=b)),Rb--,0===Rb&&null===a&&d("[120] PrefixedName"),a}function gb(){var a,b;return Rb++,b=Qb,a=kb(),null!==a&&(a=function(a,b){return{token:"blank",value:b}}(b,a)),null===a&&(Qb=b),null===a&&(b=Qb,a=Gb(),null!==a&&(a=function(a){return Vb++,{token:"blank",value:"_:"+Vb}}(b)),null===a&&(Qb=b)),Rb--,0===Rb&&null===a&&d("[121] BlankNode"),a}function hb(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,60===b.charCodeAt(Qb)?(a="<",Qb++):(a=null,0===Rb&&d('"<"')),null!==a){for(c=[],/^[^<>"{}|^`\\]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d('[^<>"{}|^`\\\\]'));null!==e;)c.push(e),/^[^<>"{}|^`\\]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d('[^<>"{}|^`\\\\]'));null!==c?(62===b.charCodeAt(Qb)?(e=">",Qb++):(e=null,0===Rb&&d('">"')),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b){return b.join("")}(f,a[1])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[122] IRI_REF"),a}function ib(){var a,c,e,f;return Rb++,e=Qb,f=Qb,a=Lb(),a=null!==a?a:"",null!==a?(58===b.charCodeAt(Qb)?(c=":",Qb++):(c=null,0===Rb&&d('":"')),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b}(e,a[0])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[123] PNAME_NS"),a}function jb(){var a,b,c,e;return Rb++,c=Qb,e=Qb,a=ib(),null!==a?(b=Mb(),null!==b?a=[a,b]:(a=null,Qb=e)):(a=null,Qb=e),null!==a&&(a=function(a,b,c){return[b,c]}(c,a[0],a[1])),null===a&&(Qb=c),Rb--,0===Rb&&null===a&&d("[124] PNAME_LN"),a}function kb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,"_:"===b.substr(Qb,2)?(a="_:",Qb+=2):(a=null,0===Rb&&d('"_:"')),null!==a?(c=Mb(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[125] BLANK_NODE_LABEL"),a}function lb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,63===b.charCodeAt(Qb)?(a="?",Qb++):(a=null,0===Rb&&d('"?"')),null!==a?(c=Jb(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[126] VAR1"),a}function mb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,36===b.charCodeAt(Qb)?(a="$",Qb++):(a=null,0===Rb&&d('"$"')),null!==a?(c=Jb(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[127] VAR2"),a}function nb(){var a,c,e,f,g,h,i,j,k;if(Rb++,i=Qb,j=Qb,64===b.charCodeAt(Qb)?(a="@",Qb++):(a=null,0===Rb&&d('"@"')),null!==a){if(/^[a-zA-Z]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[a-zA-Z]")),null!==e)for(c=[];null!==e;)c.push(e),/^[a-zA-Z]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[a-zA-Z]"));else c=null;if(null!==c){if(e=[],k=Qb,45===b.charCodeAt(Qb)?(f="-",Qb++):(f=null,0===Rb&&d('"-"')),null!==f){if(/^[a-zA-Z0-9]/.test(b.charAt(Qb))?(h=b.charAt(Qb),Qb++):(h=null,0===Rb&&d("[a-zA-Z0-9]")),null!==h)for(g=[];null!==h;)g.push(h),/^[a-zA-Z0-9]/.test(b.charAt(Qb))?(h=b.charAt(Qb),Qb++):(h=null,0===Rb&&d("[a-zA-Z0-9]"));else g=null;null!==g?f=[f,g]:(f=null,Qb=k)}else f=null,Qb=k;for(;null!==f;)if(e.push(f),k=Qb,45===b.charCodeAt(Qb)?(f="-",Qb++):(f=null,0===Rb&&d('"-"')),null!==f){if(/^[a-zA-Z0-9]/.test(b.charAt(Qb))?(h=b.charAt(Qb),Qb++):(h=null,0===Rb&&d("[a-zA-Z0-9]")),null!==h)for(g=[];null!==h;)g.push(h),/^[a-zA-Z0-9]/.test(b.charAt(Qb))?(h=b.charAt(Qb),Qb++):(h=null,0===Rb&&d("[a-zA-Z0-9]"));else g=null;null!==g?f=[f,g]:(f=null,Qb=k)}else f=null,Qb=k;null!==e?a=[a,c,e]:(a=null,Qb=j)}else a=null,Qb=j}else a=null,Qb=j;return null!==a&&(a=function(a,b,c){return 0===c.length?("@"+b.join("")).toLowerCase():("@"+b.join("")+"-"+c[0][1].join("")).toLowerCase()}(i,a[1],a[2])),null===a&&(Qb=i),Rb--,0===Rb&&null===a&&d("[128] LANGTAG"),a}function ob(){var a,c,e;if(Rb++,e=Qb,/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]")),null!==c)for(a=[];null!==c;)a.push(c),/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]"));else a=null;return null!==a&&(a=function(a,b){var c={};return c.token="literal",c.lang=null,c.type="http://www.w3.org/2001/XMLSchema#integer",c.value=Ub(b),c}(e,a)),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[129] INTEGER"),a}function pb(){var a,c,e,f,g,h;if(Rb++,g=Qb,h=Qb,/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]")),null!==c)for(a=[];null!==c;)a.push(c),/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]"));else a=null;if(null!==a)if(46===b.charCodeAt(Qb)?(c=".",Qb++):(c=null,0===Rb&&d('"."')),null!==c){for(e=[],/^[0-9]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[0-9]"));null!==f;)e.push(f),/^[0-9]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[0-9]"));null!==e?a=[a,c,e]:(a=null,Qb=h)}else a=null,Qb=h;else a=null,Qb=h;if(null!==a&&(a=function(a,b,c,d){var e={};return e.token="literal",e.lang=null,e.type="http://www.w3.org/2001/XMLSchema#decimal",e.value=Ub([b,c,d]),e}(g,a[0],a[1],a[2])),null===a&&(Qb=g),null===a){if(g=Qb,h=Qb,46===b.charCodeAt(Qb)?(a=".",Qb++):(a=null,
0===Rb&&d('"."')),null!==a){if(/^[0-9]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[0-9]")),null!==e)for(c=[];null!==e;)c.push(e),/^[0-9]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[0-9]"));else c=null;null!==c?a=[a,c]:(a=null,Qb=h)}else a=null,Qb=h;null!==a&&(a=function(a,b,c){var d={};return d.token="literal",d.lang=null,d.type="http://www.w3.org/2001/XMLSchema#decimal",d.value=Ub([b,c]),d}(g,a[0],a[1])),null===a&&(Qb=g)}return Rb--,0===Rb&&null===a&&d("[130] DECIMAL"),a}function qb(){var a,c,e,f,g,h;if(Rb++,g=Qb,h=Qb,/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]")),null!==c)for(a=[];null!==c;)a.push(c),/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]"));else a=null;if(null!==a)if(46===b.charCodeAt(Qb)?(c=".",Qb++):(c=null,0===Rb&&d('"."')),null!==c){for(e=[],/^[0-9]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[0-9]"));null!==f;)e.push(f),/^[0-9]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[0-9]"));null!==e?(f=xb(),null!==f?a=[a,c,e,f]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;else a=null,Qb=h;if(null!==a&&(a=function(a,b,c,d,e){var f={};return f.token="literal",f.lang=null,f.type="http://www.w3.org/2001/XMLSchema#double",f.value=Ub([b,c,d,e]),f}(g,a[0],a[1],a[2],a[3])),null===a&&(Qb=g),null===a){if(g=Qb,h=Qb,46===b.charCodeAt(Qb)?(a=".",Qb++):(a=null,0===Rb&&d('"."')),null!==a){if(/^[0-9]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[0-9]")),null!==e)for(c=[];null!==e;)c.push(e),/^[0-9]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[0-9]"));else c=null;null!==c?(e=xb(),null!==e?a=[a,c,e]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;if(null!==a&&(a=function(a,b,c,d){var e={};return e.token="literal",e.lang=null,e.type="http://www.w3.org/2001/XMLSchema#double",e.value=Ub([b,c,d]),e}(g,a[0],a[1],a[2])),null===a&&(Qb=g),null===a){if(g=Qb,h=Qb,/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]")),null!==c)for(a=[];null!==c;)a.push(c),/^[0-9]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[0-9]"));else a=null;null!==a?(c=xb(),null!==c?a=[a,c]:(a=null,Qb=h)):(a=null,Qb=h),null!==a&&(a=function(a,b,c){var d={};return d.token="literal",d.lang=null,d.type="http://www.w3.org/2001/XMLSchema#double",d.value=Ub([b,c]),d}(g,a[0],a[1])),null===a&&(Qb=g)}}return Rb--,0===Rb&&null===a&&d("[131] DOUBLE"),a}function rb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,43===b.charCodeAt(Qb)?(a="+",Qb++):(a=null,0===Rb&&d('"+"')),null!==a?(c=ob(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b.value="+"+b.value,b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[132] INTEGER_POSITIVE"),a}function sb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,43===b.charCodeAt(Qb)?(a="+",Qb++):(a=null,0===Rb&&d('"+"')),null!==a?(c=pb(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b.value="+"+b.value,b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[133] DECIMAL_POSITIVE"),a}function tb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,43===b.charCodeAt(Qb)?(a="+",Qb++):(a=null,0===Rb&&d('"+"')),null!==a?(c=qb(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b.value="+"+b.value,b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[134] DOUBLE_POSITIVE"),a}function ub(){var a,c,e,f;return Rb++,e=Qb,f=Qb,45===b.charCodeAt(Qb)?(a="-",Qb++):(a=null,0===Rb&&d('"-"')),null!==a?(c=ob(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b.value="-"+b.value,b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[135] INTEGER_NEGATIVE"),a}function vb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,45===b.charCodeAt(Qb)?(a="-",Qb++):(a=null,0===Rb&&d('"-"')),null!==a?(c=pb(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b.value="-"+b.value,b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[136] DECIMAL_NEGATIVE"),a}function wb(){var a,c,e,f;return Rb++,e=Qb,f=Qb,45===b.charCodeAt(Qb)?(a="-",Qb++):(a=null,0===Rb&&d('"-"')),null!==a?(c=qb(),null!==c?a=[a,c]:(a=null,Qb=f)):(a=null,Qb=f),null!==a&&(a=function(a,b){return b.value="-"+b.value,b}(e,a[1])),null===a&&(Qb=e),Rb--,0===Rb&&null===a&&d("[137] DOUBLE_NEGATIVE"),a}function xb(){var a,c,e,f,g,h;if(Rb++,g=Qb,h=Qb,/^[eE]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[eE]")),null!==a)if(/^[+\-]/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[+\\-]")),c=null!==c?c:"",null!==c){if(/^[0-9]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[0-9]")),null!==f)for(e=[];null!==f;)e.push(f),/^[0-9]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[0-9]"));else e=null;null!==e?a=[a,c,e]:(a=null,Qb=h)}else a=null,Qb=h;else a=null,Qb=h;return null!==a&&(a=function(a,b,c,d){return Ub([b,c,d])}(g,a[0],a[1],a[2])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[138] EXPONENT"),a}function yb(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,39===b.charCodeAt(Qb)?(a="'",Qb++):(a=null,0===Rb&&d('"\'"')),null!==a){for(c=[],/^[^'\\\n\r]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[^'\\\\\\n\\r]")),null===e&&(e=Cb());null!==e;)c.push(e),/^[^'\\\n\r]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[^'\\\\\\n\\r]")),null===e&&(e=Cb());null!==c?(39===b.charCodeAt(Qb)?(e="'",Qb++):(e=null,0===Rb&&d('"\'"')),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b){return Ub(b)}(f,a[1])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[139] STRING_LITERAL1"),a}function zb(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,34===b.charCodeAt(Qb)?(a='"',Qb++):(a=null,0===Rb&&d('"\\""')),null!==a){for(c=[],/^[^"\\\n\r]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d('[^"\\\\\\n\\r]')),null===e&&(e=Cb());null!==e;)c.push(e),/^[^"\\\n\r]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d('[^"\\\\\\n\\r]')),null===e&&(e=Cb());null!==c?(34===b.charCodeAt(Qb)?(e='"',Qb++):(e=null,0===Rb&&d('"\\""')),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b){return Ub(b)}(f,a[1])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[140] STRING_LITERAL2"),a}function Ab(){var a,c,e,f,g,h,i;if(Rb++,g=Qb,h=Qb,"'''"===b.substr(Qb,3)?(a="'''",Qb+=3):(a=null,0===Rb&&d("\"'''\"")),null!==a){for(c=[],i=Qb,39===b.charCodeAt(Qb)?(e="'",Qb++):(e=null,0===Rb&&d('"\'"')),null===e&&("''"===b.substr(Qb,2)?(e="''",Qb+=2):(e=null,0===Rb&&d("\"''\""))),e=null!==e?e:"",null!==e?(/^[^']/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[^']")),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i),null===e&&(e=Cb());null!==e;)c.push(e),i=Qb,39===b.charCodeAt(Qb)?(e="'",Qb++):(e=null,0===Rb&&d('"\'"')),null===e&&("''"===b.substr(Qb,2)?(e="''",Qb+=2):(e=null,0===Rb&&d("\"''\""))),e=null!==e?e:"",null!==e?(/^[^']/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d("[^']")),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i),null===e&&(e=Cb());null!==c?("'''"===b.substr(Qb,3)?(e="'''",Qb+=3):(e=null,0===Rb&&d("\"'''\"")),null!==e?a=[a,c,e]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;return null!==a&&(a=function(a,b){return Ub(b)}(g,a[1])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[141] STRING_LITERAL_LONG1"),a}function Bb(){var a,c,e,f,g,h,i;if(Rb++,g=Qb,h=Qb,'"""'===b.substr(Qb,3)?(a='"""',Qb+=3):(a=null,0===Rb&&d('"\\"\\"\\""')),null!==a){for(c=[],i=Qb,34===b.charCodeAt(Qb)?(e='"',Qb++):(e=null,0===Rb&&d('"\\""')),null===e&&('""'===b.substr(Qb,2)?(e='""',Qb+=2):(e=null,0===Rb&&d('"\\"\\""'))),e=null!==e?e:"",null!==e?(/^[^"]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d('[^"]')),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i),null===e&&(e=Cb());null!==e;)c.push(e),i=Qb,34===b.charCodeAt(Qb)?(e='"',Qb++):(e=null,0===Rb&&d('"\\""')),null===e&&('""'===b.substr(Qb,2)?(e='""',Qb+=2):(e=null,0===Rb&&d('"\\"\\""'))),e=null!==e?e:"",null!==e?(/^[^"]/.test(b.charAt(Qb))?(f=b.charAt(Qb),Qb++):(f=null,0===Rb&&d('[^"]')),null!==f?e=[e,f]:(e=null,Qb=i)):(e=null,Qb=i),null===e&&(e=Cb());null!==c?('"""'===b.substr(Qb,3)?(e='"""',Qb+=3):(e=null,0===Rb&&d('"\\"\\"\\""')),null!==e?a=[a,c,e]:(a=null,Qb=h)):(a=null,Qb=h)}else a=null,Qb=h;return null!==a&&(a=function(a,b){return Ub(b)}(g,a[1])),null===a&&(Qb=g),Rb--,0===Rb&&null===a&&d("[142] STRING_LITERAL_LONG2"),a}function Cb(){var a,c,e;return Rb++,e=Qb,92===b.charCodeAt(Qb)?(a="\\",Qb++):(a=null,0===Rb&&d('"\\\\"')),null!==a?(/^[tbnrf"']/.test(b.charAt(Qb))?(c=b.charAt(Qb),Qb++):(c=null,0===Rb&&d("[tbnrf\"']")),null!==c?a=[a,c]:(a=null,Qb=e)):(a=null,Qb=e),Rb--,0===Rb&&null===a&&d("[143] ECHAR"),a}function Db(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,40===b.charCodeAt(Qb)?(a="(",Qb++):(a=null,0===Rb&&d('"("')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(41===b.charCodeAt(Qb)?(e=")",Qb++):(e=null,0===Rb&&d('")"')),null!==e?a=[a,c,e]:(a=null,Qb=g)):(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a){return{token:"triplesnodecollection",triplesContext:[],chainSubject:[{token:"uri",value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}]}}(f)),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[144] NIL"),a}function Eb(){var a;return Rb++,/^[ ]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[ ]")),null===a&&(/^[\t]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\t]")),null===a&&(/^[\r]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\r]")),null===a&&(/^[\n]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\n]")),null===a&&(a=Fb())))),Rb--,0===Rb&&null===a&&d("[145] WS"),a}function Fb(){var a,c,e,f;if(Rb++,f=Qb,35===b.charCodeAt(Qb)?(a="#",Qb++):(a=null,0===Rb&&d('"#"')),null!==a){for(c=[],/^[^\n\r]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[^\\n\\r]"));null!==e;)c.push(e),/^[^\n\r]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[^\\n\\r]"));null!==c?a=[a,c]:(a=null,Qb=f)}else a=null,Qb=f;return Rb--,0===Rb&&null===a&&d(" COMMENT"),a}function Gb(){var a,c,e,f;if(Rb++,f=Qb,91===b.charCodeAt(Qb)?(a="[",Qb++):(a=null,0===Rb&&d('"["')),null!==a){for(c=[],e=Eb();null!==e;)c.push(e),e=Eb();null!==c?(93===b.charCodeAt(Qb)?(e="]",Qb++):(e=null,0===Rb&&d('"]"')),null!==e?a=[a,c,e]:(a=null,Qb=f)):(a=null,Qb=f)}else a=null,Qb=f;return Rb--,0===Rb&&null===a&&d("[146] ANON"),a}function Hb(){var a;return Rb++,/^[A-Z]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[A-Z]")),null===a&&(/^[a-z]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[a-z]")),null===a&&(/^[\xC0-\xD6]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\xC0-\\xD6]")),null===a&&(/^[\xD8-\xF6]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\xD8-\\xF6]")),null===a&&(/^[\xF8-\u02FF]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\xF8-\\u02FF]")),null===a&&(/^[\u0370-\u037D]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u0370-\\u037D]")),null===a&&(/^[\u037F-\u1FFF]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u037F-\\u1FFF]")),null===a&&(/^[\u200C-\u200D]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u200C-\\u200D]")),null===a&&(/^[\u2070-\u218F]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u2070-\\u218F]")),null===a&&(/^[\u2C00-\u2FEF]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u2C00-\\u2FEF]")),null===a&&(/^[\u3001-\uD7FF]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u3001-\\uD7FF]")),null===a&&(/^[\uF900-\uFDCF]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\uF900-\\uFDCF]")),null===a&&(/^[\uFDF0-\uFFFD]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\uFDF0-\\uFFFD]")),null===a&&(/^[\u1000-\uEFFF]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u1000-\\uEFFF]"))))))))))))))),Rb--,0===Rb&&null===a&&d("[147] PN_CHARS_BASE"),a}function Ib(){var a;return Rb++,a=Hb(),null===a&&(95===b.charCodeAt(Qb)?(a="_",Qb++):(a=null,0===Rb&&d('"_"'))),Rb--,0===Rb&&null===a&&d("[148] PN_CHARS_U"),a}function Jb(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,a=Ib(),null===a&&(/^[0-9]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[0-9]"))),null!==a){for(c=[],e=Ib(),null===e&&(/^[0-9]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[0-9]")),null===e&&(/^[\xB7]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[\\xB7]")),null===e&&(/^[\u0300-\u036F]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[\\u0300-\\u036F]")),null===e&&(/^[\u203F-\u2040]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[\\u203F-\\u2040]"))))));null!==e;)c.push(e),e=Ib(),null===e&&(/^[0-9]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[0-9]")),null===e&&(/^[\xB7]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[\\xB7]")),null===e&&(/^[\u0300-\u036F]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[\\u0300-\\u036F]")),null===e&&(/^[\u203F-\u2040]/.test(b.charAt(Qb))?(e=b.charAt(Qb),Qb++):(e=null,0===Rb&&d("[\\u203F-\\u2040]"))))));null!==c?a=[a,c]:(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b,c){return b+c.join("")}(f,a[0],a[1])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[149] VARNAME"),a}function Kb(){var a;return Rb++,a=Ib(),null===a&&(45===b.charCodeAt(Qb)?(a="-",Qb++):(a=null,0===Rb&&d('"-"')),null===a&&(/^[0-9]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[0-9]")),null===a&&(/^[\xB7]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\xB7]")),null===a&&(/^[\u0300-\u036F]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u0300-\\u036F]")),null===a&&(/^[\u203F-\u2040]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[\\u203F-\\u2040]"))))))),Rb--,0===Rb&&null===a&&d("[150] PN_CHARS"),a}function Lb(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,a=Hb(),null!==a){for(c=[],e=Kb(),null===e&&(46===b.charCodeAt(Qb)?(e=".",Qb++):(e=null,0===Rb&&d('"."')));null!==e;)c.push(e),e=Kb(),null===e&&(46===b.charCodeAt(Qb)?(e=".",Qb++):(e=null,0===Rb&&d('"."')));null!==c?a=[a,c]:(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b,c){if("."==c[c.length-1])throw new Error("Wrong PN_PREFIX, cannot finish with '.'");return b+c.join("")}(f,a[0],a[1])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[151] PN_PREFIX"),a}function Mb(){var a,c,e,f,g;if(Rb++,f=Qb,g=Qb,a=Ib(),null===a&&(/^[0-9]/.test(b.charAt(Qb))?(a=b.charAt(Qb),Qb++):(a=null,0===Rb&&d("[0-9]"))),null!==a){for(c=[],e=Kb();null!==e;)c.push(e),e=Kb();null!==c?a=[a,c]:(a=null,Qb=g)}else a=null,Qb=g;return null!==a&&(a=function(a,b,c){return b+c.join("")}(f,a[0],a[1])),null===a&&(Qb=f),Rb--,0===Rb&&null===a&&d("[152] PN_LOCAL"),a}function Nb(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function Ob(){for(var a=1,c=1,d=!1,e=0;e<Math.max(Qb,Sb);e++){var f=b.charAt(e);"\n"===f?(d||a++,c=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,c=1,d=!0):(c++,d=!1)}return{line:a,column:c}}var Pb={SPARQL:e,Query:f,Prologue:g,BaseDecl:h,PrefixDecl:i,SelectQuery:j,SubSelect:k,SelectClause:l,ConstructQuery:m,DescribeQuery:n,AskQuery:o,DatasetClause:p,DefaultGraphClause:q,NamedGraphClause:r,WhereClause:s,SolutionModifier:t,GroupClause:u,GroupCondition:v,HavingClause:w,OrderClause:x,OrderCondition:y,LimitOffsetClauses:z,LimitClause:A,OffsetClause:B,BindingsClause:C,BindingValue:D,Update:E,Update1:F,Load:G,Clear:H,Drop:I,Create:J,InsertData:K,DeleteData:L,DeleteWhere:M,Modify:N,DeleteClause:O,InsertClause:P,UsingClause:Q,GraphRef:R,GraphRefAll:S,QuadPattern:T,QuadData:U,Quads:V,QuadsNotTriples:W,TriplesTemplate:X,GroupGraphPattern:Y,GroupGraphPatternSub:Z,TriplesBlock:$,GraphPatternNotTriples:_,OptionalGraphPattern:aa,GraphGraphPattern:ba,ServiceGraphPattern:ca,MinusGraphPattern:da,GroupOrUnionGraphPattern:ea,Filter:fa,Constraint:ga,FunctionCall:ha,ArgList:ia,ExpressionList:ja,ConstructTemplate:ka,ConstructTriples:la,TriplesSameSubject:ma,PropertyListNotEmpty:na,PropertyList:oa,ObjectList:pa,Verb:qa,TriplesSameSubjectPath:ra,PropertyListNotEmptyPath:sa,PropertyListPath:ta,VerbPath:ua,PathAlternative:va,PathSequence:wa,PathElt:xa,PathEltOrInverse:ya,PathMod:za,PathPrimary:Aa,PathNegatedPropertySet:Ba,PathOneInPropertySet:Ca,TriplesNode:Da,BlankNodePropertyList:Ea,Collection:Fa,GraphNode:Ga,VarOrTerm:Ha,VarOrIRIref:Ia,Var:Ja,GraphTerm:Ka,ConditionalOrExpression:La,ConditionalAndExpression:Ma,RelationalExpression:Na,AdditiveExpression:Oa,MultiplicativeExpression:Pa,UnaryExpression:Qa,PrimaryExpression:Ra,BrackettedExpression:Sa,BuiltInCall:Ta,RegexExpression:Ua,ExistsFunc:Va,NotExistsFunc:Wa,Aggregate:Xa,IRIrefOrFunction:Ya,RDFLiteral:Za,NumericLiteral:$a,NumericLiteralUnsigned:_a,NumericLiteralPositive:ab,NumericLiteralNegative:bb,BooleanLiteral:cb,String:db,IRIref:eb,PrefixedName:fb,BlankNode:gb,IRI_REF:hb,PNAME_NS:ib,PNAME_LN:jb,BLANK_NODE_LABEL:kb,VAR1:lb,VAR2:mb,LANGTAG:nb,INTEGER:ob,DECIMAL:pb,DOUBLE:qb,INTEGER_POSITIVE:rb,DECIMAL_POSITIVE:sb,DOUBLE_POSITIVE:tb,INTEGER_NEGATIVE:ub,DECIMAL_NEGATIVE:vb,DOUBLE_NEGATIVE:wb,EXPONENT:xb,STRING_LITERAL1:yb,STRING_LITERAL2:zb,STRING_LITERAL_LONG1:Ab,STRING_LITERAL_LONG2:Bb,ECHAR:Cb,NIL:Db,WS:Eb,COMMENT:Fb,ANON:Gb,PN_CHARS_BASE:Hb,PN_CHARS_U:Ib,VARNAME:Jb,PN_CHARS:Kb,PN_PREFIX:Lb,PN_LOCAL:Mb};if(void 0!==c){if(void 0===Pb[c])throw new Error("Invalid rule name: "+a(c)+".")}else c="SPARQL";var Qb=0,Rb=0,Sb=0,Tb=[],Ub=function(a){for(var b="",c=0;c<a.length;c++)b+="string"==typeof a[c]?a[c]:a[c].join("");return b},Vb=0,Wb={},Xb=function(a,b){Wb[a]=b},Yb=function(a){Wb[null]=a},Zb=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c];return b.toUpperCase()},$b=Pb[c]();if(null===$b||Qb!==b.length){var _b=Math.max(Qb,Sb),ac=_b<b.length?b.charAt(_b):null,bc=Ob();throw new this.SyntaxError(Nb(Tb),ac,_b,bc.line,bc.column)}return $b},toSource:function(){return this._source}};return b.SyntaxError=function(b,c,d,e,f){function g(b,c){var d,e;switch(b.length){case 0:d="end of input";break;case 1:d=b[0];break;default:d=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}return e=c?a(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=b,this.found=c,this.message=g(b,c),this.offset=d,this.line=e,this.column=f},b.SyntaxError.prototype=Error.prototype,b}();var TabulatorRDFXMLParser=function(){function a(a){return"string"==typeof a||"[object String]"===Object.prototype.toString.call(a)}function b(b,c){var g=b;a(b)&&(g=e(b));var h=new f(c),i=new d(h);return i.parse(g,"http://nobase"),h.statements}var c=function(a,b){var c=b.indexOf("#");if(c>0&&(b=b.slice(0,c)),0==a.length)return b;if(0==a.indexOf("#"))return b+a;var d=a.indexOf(":");if(d>=0)return a;var e=b.indexOf(":");if(""==b)return a;if(0>e)throw"Invalid Base URI";var f=b.slice(0,e+1);if(0==a.indexOf("//"))return f+a;if(b.indexOf("//",e)==e+1){var g=b.indexOf("/",e+3);if(0>g)return b.length-e-3>0?b+"/"+a:f+a}else{var g=b.indexOf("/",e+1);if(0>g)return b.length-e-1>0?b+"/"+a:f+a}if(0==a.indexOf("/"))return b.slice(0,g)+a;var h=b.slice(g),i=h.lastIndexOf("/");if(0>i)return f+a;for(i>=0&&i<h.length-1&&(h=h.slice(0,i+1)),h+=a;h.match(/[^\/]*\/\.\.\//);)h=h.replace(/[^\/]*\/\.\.\//,"");return h=h.replace(/\.\//g,""),h=h.replace(/\/\.$/,"/"),b.slice(0,g)+h},d=function(a){var b={};b.ns={RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"},b.nodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},this.frameFactory=function(a,d,e){return{NODE:1,ARC:2,parent:d,parser:a,store:a.store,element:e,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:!1,terminateFrame:function(){if(this.collection)for(var a=this.node,c=0,d=this.node.nodes.length;d>c;c++){var e=this.store.bnode();this.store.add(a,this.store.sym(b.ns.RDF+"first"),this.node.nodes[c]),d-1>c?this.store.add(a,this.store.sym(b.ns.RDF+"rest"),e):this.store.add(a,this.store.sym(b.ns.RDF+"rest"),this.store.sym(b.ns.RDF+"nil")),a=e}},addSymbol:function(a,b){b=c(b,this.base),this.node=this.store.sym(b),this.nodeType=a},loadTriple:function(){if(this.parent.parent.collection?this.parent.parent.node.append(this.node):this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why),null!=this.parent.rdfid){var a=this.store.sym(c("#"+this.parent.rdfid,this.base));this.store.add(a,this.store.sym(b.ns.RDF+"type"),this.store.sym(b.ns.RDF+"Statement"),this.parser.why),this.store.add(a,this.store.sym(b.ns.RDF+"subject"),this.parent.parent.node,this.parser.why),this.store.add(a,this.store.sym(b.ns.RDF+"predicate"),this.parent.node,this.parser.why),this.store.add(a,this.store.sym(b.ns.RDF+"object"),this.node,this.parser.why)}},isTripleToLoad:function(){return null!=this.parent&&null!=this.parent.parent&&this.nodeType==this.NODE&&this.parent.nodeType==this.ARC&&this.parent.parent.nodeType==this.NODE},addNode:function(a){this.addSymbol(this.NODE,a),this.isTripleToLoad()&&this.loadTriple()},addCollection:function(){this.nodeType=this.NODE,this.node=this.store.collection(),this.collection=!0,this.isTripleToLoad()&&this.loadTriple()},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(a){null!=a?null!=this.parser.bnodes[a]?this.node=this.parser.bnodes[a]:this.node=this.parser.bnodes[a]=this.store.bnode():this.node=this.store.bnode(),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()},addArc:function(a){a==b.ns.RDF+"li"&&(a=b.ns.RDF+"_"+this.parent.listIndex++),this.addSymbol(this.ARC,a)},addLiteral:function(a){this.parent.datatype?this.node=this.store.literal(a,"",this.store.sym(this.parent.datatype)):this.node=this.store.literal(a,this.lang),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()}}},this.getAttributeNodeNS=function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else for(var e,f,g=a.attributes,h=0;h<g.length;++h)if(e=g[h],e.namespaceURI==b&&(f=e.prefix?e.prefix+":"+c:c,f==e.nodeName)){d=e;break}return d},this.store=a,this.bnodes={},this.why=null,this.reify=!1,this.parse=function(a,c,d){var e=a.childNodes;if(this.cleanParser(),a.nodeType==b.nodeType.DOCUMENT){for(var f=0;f<e.length;f++)if(e[f].nodeType==b.nodeType.ELEMENT){var g=e[f];break}}else{if(a.nodeType!=b.nodeType.ELEMENT)throw new Error("RDFParser: can't find root in "+c+". Halting. ");var g=a}this.why=d;var h=this.frameFactory(this);return this.base=c,h.base=c,h.lang="",this.parseDOM(this.buildFrame(h,g)),!0},this.parseDOM=function(a){for(var d=function(a){var b="";return a.namespaceURI&&(b+=a.namespaceURI),a.localName?b+=a.localName:a.nodeName&&(b+=a.nodeName.indexOf(":")>=0?a.nodeName.split(":")[1]:a.nodeName),b},e=!0;a.parent;){var f=a.element,g=f.attributes;if(f.nodeType==b.nodeType.TEXT||f.nodeType==b.nodeType.CDATA_SECTION)a.addLiteral(f.nodeValue);else if(d(f)!=b.ns.RDF+"RDF")if(a.parent&&a.parent.collection&&(a.addCollectionArc(),a=this.buildFrame(a,a.element),a.parent.element=null),a.parent&&a.parent.nodeType&&a.parent.nodeType!=a.ARC){if(a.addArc(d(f)),this.reify){var h=this.getAttributeNodeNS(f,b.ns.RDF,"ID");h&&(a.rdfid=h.nodeValue,f.removeAttributeNode(h))}var i=this.getAttributeNodeNS(f,b.ns.RDF,"parseType"),j=this.getAttributeNodeNS(f,b.ns.RDF,"datatype");if(j&&(a.datatype=j.nodeValue,f.removeAttributeNode(j)),i){var k=i.nodeValue;"Literal"==k?(a.datatype=b.ns.RDF+"XMLLiteral",a=this.buildFrame(a),a.addLiteral(f),e=!1):"Resource"==k?(a=this.buildFrame(a,a.element),a.parent.element=null,a.addBNode()):"Collection"==k&&(a=this.buildFrame(a,a.element),a.parent.element=null,a.addCollection()),f.removeAttributeNode(i)}if(0!=g.length){var l=this.getAttributeNodeNS(f,b.ns.RDF,"resource"),m=this.getAttributeNodeNS(f,b.ns.RDF,"nodeID");a=this.buildFrame(a),l?(a.addNode(l.nodeValue),f.removeAttributeNode(l)):m?(a.addBNode(m.nodeValue),f.removeAttributeNode(m)):a.addBNode();for(var n=g.length-1;n>=0;n--){var o=this.buildFrame(a);o.addArc(d(g[n])),d(g[n])==b.ns.RDF+"type"?this.buildFrame(o).addNode(g[n].nodeValue):this.buildFrame(o).addLiteral(g[n].nodeValue)}}else 0==f.childNodes.length&&this.buildFrame(a).addLiteral("")}else{var p=this.getAttributeNodeNS(f,b.ns.RDF,"about"),h=this.getAttributeNodeNS(f,b.ns.RDF,"ID");if(p&&h)throw new Error("RDFParser: "+f.nodeName+" has both rdf:id and rdf:about. Halting. Only one of these properties may be specified on a node.");if(null==p&&h)a.addNode("#"+h.nodeValue),f.removeAttributeNode(h);else if(null==p&&null==h){var m=this.getAttributeNodeNS(f,b.ns.RDF,"nodeID");m?(a.addBNode(m.nodeValue),f.removeAttributeNode(m)):a.addBNode()}else a.addNode(p.nodeValue),f.removeAttributeNode(p);var q=this.getAttributeNodeNS(f,b.ns.RDF,"type");b.ns.RDF+"Description"!=d(f)&&(q={nodeValue:d(f)}),null!=q&&(this.store.add(a.node,this.store.sym(b.ns.RDF+"type"),this.store.sym(c(q.nodeValue,a.base)),this.why),q.nodeName&&f.removeAttributeNode(q));for(var n=g.length-1;n>=0;n--)this.store.add(a.node,this.store.sym(d(g[n])),this.store.literal(g[n].nodeValue,a.lang),this.why)}for(f=a.element;a.parent;){for(var r=a;null==f;)a=a.parent,f=a.element;var s=f.childNodes[a.lastChild];if(null!=s&&e){if((s.nodeType==b.nodeType.ELEMENT||s.nodeType==b.nodeType.TEXT||s.nodeType==b.nodeType.CDATA_SECTION)&&(s.nodeType!=b.nodeType.TEXT&&s.nodeType!=b.nodeType.CDATA_SECTION||1==f.childNodes.length)){a.lastChild++,a=this.buildFrame(r,f.childNodes[a.lastChild-1]);break}a.lastChild++}else{if(a.terminateFrame(),!(a=a.parent))break;f=a.element,e=!0}}}},this.cleanParser=function(){this.bnodes={},this.why=null},this.buildFrame=function(a,d){var e=this.frameFactory(this,a,d);if(a&&(e.base=a.base,e.lang=a.lang),null==d||d.nodeType==b.nodeType.TEXT||d.nodeType==b.nodeType.CDATA_SECTION)return e;var f=d.attributes,g=d.getAttributeNode("xml:base");null!=g&&(e.base=g.nodeValue,d.removeAttribute("xml:base"));var h=d.getAttributeNode("xml:lang");null!=h&&(e.lang=h.nodeValue,d.removeAttribute("xml:lang"));for(var i=f.length-1;i>=0;i--)if("xml"==f[i].nodeName.substr(0,3)){if("xmlns:"==f[i].name.slice(0,6)){var j=f[i].nodeValue;this.base&&(j=c(j,this.base)),this.store.setPrefixForURI(f[i].name.slice(6),j)}d.removeAttributeNode(f[i])}return e}},e=function(a){var b,c;if("undefined"!=typeof module){var d=require("jsdom");c=d.jsdom(a,{})}else window.DOMParser?(b=new DOMParser,c=b.parseFromString(a,"text/xml")):window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a));return c},f=function(a){this.statements=[],this.namespaces={},this.add=function(b,c,d){this.statements.push({subject:b,predicate:c,object:d,graph:a})},this.sym=function(a){return{token:"uri",value:a}},this.literal=function(a,b,c){return a=a.replace(/\\/g,"\\\\"),a=a.replace(/\"/g,'\\"'),a=a.replace(/\n/g,"\\n"),a='"'+a+'"',c&&(a=a+"^^"+c),b&&(a=a+"@"+b),{literal:a}};var b=0;this.bnode=function(a){return a=a||"_:bnid"+b++,{blank:a}};var c=this;this.collection=function(){var a=c.bnode();return a.nodes=[],a.append=function(a){this.nodes.push(a)},a},this.setPrefixForURI=function(a,b){if(this.namespaces[a]||b!==b)throw"Can't redefine prefix "+a;this.namespaces[a]=b}};return{parse:b}}(),RDFXMLParser={};RDFXMLParser.parser={},RDFXMLParser.parser.parse=function(a,b){try{return TabulatorRDFXMLParser.parse(a,b)}catch(c){throw c}};var RDFJSInterface={};RDFJSInterface.defaultContext={rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#"},RDFJSInterface.UrisMap=function(){this.defaultNs="",this.interfaceProperties=["get","remove","set","setDefault","addAll","resolve","shrink"]},RDFJSInterface.UrisMap.prototype.values=function(){var a={};for(var b in this)Utils.include(this.interfaceProperties,b)||"function"==typeof this[b]||"defaultNs"===b||"interfaceProperties"===b||(a[b]=this[b]);return a},RDFJSInterface.UrisMap.prototype.get=function(a){if(-1!=a.indexOf(" "))throw"Prefix must not contain any whitespaces";return this[a]},RDFJSInterface.UrisMap.prototype.remove=function(a){if(-1!=a.indexOf(" "))throw"Prefix must not contain any whitespaces";return delete this[a],null},RDFJSInterface.UrisMap.prototype.set=function(a,b){if(-1!=a.indexOf(" "))throw"Prefix must not contain any whitespaces";this[a]=b},RDFJSInterface.UrisMap.prototype.setDefault=function(a){this.defaultNs=a},RDFJSInterface.UrisMap.prototype.addAll=function(a,b){for(var c in a)Utils.include(this.interfaceProperties,c)||(null!=this[c]?b===!0&&(this[c]=a[c]):this[c]=a[c]);return this},RDFJSInterface.UrisMap.prototype.resolve=function(a){var b=a.split(":"),c=b[0],d=b[1];return""===c?null==this.defaultNs?null:this.defaultNs+d:this.hasOwnProperty(c)?this[c]+d:null},RDFJSInterface.UrisMap.prototype.shrink=function(a){for(var b in this){var c=this[b];if(0===a.indexOf(c)&&""!==c&&"defaultNs"!=b){var d=a.split(c)[1];return b+":"+d}}return a},RDFJSInterface.Profile=function(){this.prefixes=new RDFJSInterface.UrisMap,this.terms=new RDFJSInterface.UrisMap},RDFJSInterface.Profile.prototype.importProfile=function(a,b){this.prefixes.addAll(a.prefixes,b),this.terms.addAll(a.terms,b)},RDFJSInterface.Profile.prototype.resolve=function(a){return-1!=a.indexOf(":")?this.prefixes.resolve(a):null!=this.terms[a]?this.terms.resolve(a):null},RDFJSInterface.Profile.prototype.setDefaultPrefix=function(a){this.prefixes.setDefault(a)},RDFJSInterface.Profile.prototype.setDefaultVocabulary=function(a){this.terms.setDefault(a)},RDFJSInterface.Profile.prototype.setPrefix=function(a,b){this.prefixes.set(a,b)},RDFJSInterface.Profile.prototype.setTerm=function(a,b){this.terms.set(a,b)},RDFJSInterface.RDFEnvironment=function(){this.blankNodeCounter=0;var a=this;this.filters={s:function(a){return function(b){return b.subject.equals(a)}},p:function(a){return function(b){return b.predicate.equals(a)}},o:function(a){return function(b){return b.object.equals(a)}},sp:function(a,b){return function(c){return c.subject.equals(a)&&c.predicate.equals(b)}},so:function(a,b){return function(c){return c.subject.equals(a)&&c.object.equals(b)}},po:function(a,b){return function(c){return c.predicate.equals(a)&&c.object.equals(b)}},spo:function(a,b,c){return function(d){return d.subject.equals(a)&&d.predicate.equals(b)&&d.object.equals(c)}},describes:function(a){return function(b){return b.subject.equals(a)||b.object.equals(a)}},type:function(b){var c=a.resolve("rdf:type");return function(a){return a.predicate.equals(c)&&a.object.equals(b)}}};for(var b in RDFJSInterface.defaultContext)this.prefixes.set(b,RDFJSInterface.defaultContext[b])},Utils["extends"](RDFJSInterface.Profile,RDFJSInterface.RDFEnvironment),RDFJSInterface.RDFEnvironment.prototype.createBlankNode=function(){var a=new RDFJSInterface.BlankNode(this.blankNodeCounter);return this.blankNodeCounter++,a},RDFJSInterface.RDFEnvironment.prototype.createNamedNode=function(a){var b=this.resolve(a);return null!=b?new RDFJSInterface.NamedNode(b):new RDFJSInterface.NamedNode(a)},RDFJSInterface.RDFEnvironment.prototype.createLiteral=function(a,b,c){return null!=c?new RDFJSInterface.Literal(a,b,c.toString()):new RDFJSInterface.Literal(a,b,c)},RDFJSInterface.RDFEnvironment.prototype.createTriple=function(a,b,c){return new RDFJSInterface.Triple(a,b,c)},RDFJSInterface.RDFEnvironment.prototype.createGraph=function(a){var b=new RDFJSInterface.Graph;if(null!=a)for(var c=0;c<a.length;c++)b.add(a[c]);return b},RDFJSInterface.RDFEnvironment.prototype.createAction=function(a,b){
return function(c){return a(c)?b(c):c}},RDFJSInterface.RDFEnvironment.prototype.createProfile=function(a){if(a===!0)return new RDFJSInterface.RDFEnvironment.Profile;var b=new RDFJSInterface.RDFEnvironment.Profile;return b.importProfile(this),b},RDFJSInterface.RDFEnvironment.prototype.createTermMap=function(a){if(a===!0)return new RDFJSInterface.UrisMap;var b=this.terms.values(),c=new RDFJSInterface.UrisMap;for(var d in b)c[d]=b[d];return c},RDFJSInterface.RDFEnvironment.prototype.createPrefixMap=function(a){if(a===!0)return new RDFJSInterface.UrisMap;var b=this.prefixes.values(),c=new RDFJSInterface.UrisMap;for(var d in b)c[d]=b[d];return c},RDFJSInterface.RDFNode=function(a){this.interfaceName=a,this.attributes=["interfaceName","nominalValue"]},RDFJSInterface.RDFNode.prototype.equals=function(a){if(null==a.interfaceName)return this.valueOf()==a;for(var b in this.attributes){var c=this.attributes[b];if(this[c]!=a[c])return!1}return!0},RDFJSInterface.BlankNode=function(a){RDFJSInterface.RDFNode.call(this,"BlankNode"),this.nominalValue="_:"+a,this.bnodeId=a},Utils["extends"](RDFJSInterface.RDFNode,RDFJSInterface.BlankNode),RDFJSInterface.BlankNode.prototype.toString=function(){return this.nominalValue},RDFJSInterface.BlankNode.prototype.toNT=function(){return this.nominalValue},RDFJSInterface.BlankNode.prototype.valueOf=function(){return this.nominalValue},RDFJSInterface.Literal=function(a,b,c){RDFJSInterface.RDFNode.call(this,"Literal"),this.nominalValue=a,null!=b?this.language=b:null!=c&&(this.datatype=c)},Utils["extends"](RDFJSInterface.RDFNode,RDFJSInterface.Literal),RDFJSInterface.Literal.prototype.toString=function(){if(this.nominalValue.match("\n")){var a='"""'+this.nominalValue+'"""';if(this.nominalValue.match(/"""/))var a="'''"+this.nominalValue+"'''"}else if(this.nominalValue.match(/"/)){var a="'"+this.nominalValue+"'";if(this.nominalValue.match(/'/)){var a='"""'+this.nominalValue+'"""';if(this.nominalValue.match(/"""/)){var a="'''"+this.nominalValue+"'''";if(this.nominalValue.match(/'''/))throw"Literal not possible to escape in a String."}}}else var a='"'+this.nominalValue+'"';return null!=this.language?a=a+"@"+this.language:(null!=this.datatype||this.type)&&(a=a+"^^<"+(this.datatype||this.type)+">"),a},RDFJSInterface.Literal.prototype.toNT=function(){return this.toString()},RDFJSInterface.Literal.prototype.valueOf=function(){return QueryFilters.effectiveTypeValue({token:"literal",type:this.type||this.datatype,value:this.nominalValue,language:this.language})},RDFJSInterface.NamedNode=function(a){RDFJSInterface.RDFNode.call(this,"NamedNode"),null!=a.value?this.nominalValue=a.value:this.nominalValue=a},Utils["extends"](RDFJSInterface.RDFNode,RDFJSInterface.NamedNode),RDFJSInterface.NamedNode.prototype.toString=function(){return this.nominalValue},RDFJSInterface.NamedNode.prototype.toNT=function(){return"<"+this.toString()+">"},RDFJSInterface.NamedNode.prototype.valueOf=function(){return this.nominalValue},RDFJSInterface.Triple=function(a,b,c){this.subject=a,this.predicate=b,this.object=c},RDFJSInterface.Triple.prototype.equals=function(a){return this.subject.equals(a.subject)&&this.predicate.equals(a.predicate)&&this.object.equals(a.object)},RDFJSInterface.Triple.prototype.toString=function(){return this.subject.toNT()+" "+this.predicate.toNT()+" "+this.object.toNT()+" . \r\n"},RDFJSInterface.Graph=function(){this.triples=[],this.duplicates={},this.actions=[],this.length=0},RDFJSInterface.Graph.prototype.add=function(a){for(var b=0;b<this.actions.length;b++)a=this.actions[b](a);var c=a.subject.toString()+a.predicate.toString()+a.object.toString();return this.duplicates[c]||(this.duplicates[c]=!0,this.triples.push(a)),this.length=this.triples.length,this},RDFJSInterface.Graph.prototype.addAction=function(a,b){if(this.actions.push(a),1==b)for(var c=0;c<this.triples.length;c++)this.triples[c]=a(this.triples[c]);return this},RDFJSInterface.Graph.prototype.addAll=function(a){for(var b=a.toArray(),c=0;c<b.length;c++)this.add(b[c]);return this.length=this.triples.length,this},RDFJSInterface.Graph.prototype.remove=function(a){for(var b=null,c=0;c<this.triples.length;c++)if(this.triples[c].equals(a)){var d=a.subject.toString()+a.predicate.toString()+a.object.toString();delete this.duplicates[d],b=c;break}return null!=b&&this.triples.splice(b,1),this.length=this.triples.length,this},RDFJSInterface.Graph.prototype.toArray=function(){return this.triples},RDFJSInterface.Graph.prototype.some=function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!0)return!0;return!1},RDFJSInterface.Graph.prototype.every=function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!1)return!1;return!0},RDFJSInterface.Graph.prototype.filter=function(a){for(var b=new RDFJSInterface.Graph,c=0;c<this.triples.length;c++)a(this.triples[c],this)===!0&&b.add(this.triples[c]);return b},RDFJSInterface.Graph.prototype.forEach=function(a){for(var b=0;b<this.triples.length;b++)a(this.triples[b],this)},RDFJSInterface.Graph.prototype.merge=function(a){for(var b=new RDFJSInterface.Graph,c=0;c<this.triples.length;c++)b.add(this.triples[c]);return b},RDFJSInterface.Graph.prototype.match=function(a,b,c,d){for(var e=new RDFJSInterface.Graph,f=0,g=0;g<this.triples.length;g++){var h=this.triples[g];if((null==a||h.subject.equals(a))&&(null==b||h.predicate.equals(b))&&(null==c||h.object.equals(c))){if(!(null==d||d>f))return e;f++,e.add(h)}}return e},RDFJSInterface.Graph.prototype.removeMatches=function(a,b,c){for(var d=[],e=0;e<this.triples.length;e++){var f=this.triples[e];(null==a||f.subject.equals(a))&&(null==b||f.predicate.equals(b))&&(null==c||f.object.equals(c))&&d.push(f)}for(var e=0;e<d.length;e++)this.remove(d[e]);return this},RDFJSInterface.Graph.prototype.toNT=function(){var a="";return this.forEach(function(b){a+=b.toString()}),a},RDFJSInterface.buildRDFResource=function(a,b,c,d){if("blank"===a.token)return RDFJSInterface.buildBlankNode(a,b,c,d);if("literal"===a.token)return RDFJSInterface.buildLiteral(a,b,c,d);if("uri"===a.token)return RDFJSInterface.buildNamedNode(a,b,c,d);if("var"===a.token){var e=b[a.value];return null!=e?RDFJSInterface.buildRDFResource(e,b,c,d):null}return null},RDFJSInterface.buildBlankNode=function(a,b,c,d){return null!=a.valuetmp&&(a.value=a.valuetmp),0===a.value.indexOf("_:")&&(a.value=a.value.split("_:")[1]),new RDFJSInterface.BlankNode(a.value)},RDFJSInterface.buildLiteral=function(a,b,c,d){return new RDFJSInterface.Literal(a.value,a.lang,a.type)},RDFJSInterface.buildNamedNode=function(a,b,c,d){if(null!=a.value)return new RDFJSInterface.NamedNode(a);if(null!=a.prefix){var e=c.resolveNsInEnvironment(a.prefix,d);return a.value=e+a.suffix,new RDFJSInterface.NamedNode(a)}return new RDFJSInterface.NamedNode(a)},RDFJSInterface.rdf=new RDFJSInterface.RDFEnvironment;var QueryFilters={};QueryFilters.checkFilters=function(a,b,c,d,e,f){var g=a.filter,h=[];if(null==g||null!=a.length)return b;for(var i=0;i<g.length;i++){for(var j=g[i],k=QueryFilters.run(j.value,b,c,d,e,f),l=[],m=0;m<k.length;m++)null!=k[m].__nullify__?h.push(k[m]):l.push(k[m]);b=l}return b.concat(h)},QueryFilters.boundVars=function(a){if(null==a.expressionType)throw console.log("ERROR"),console.log(a),"Cannot find bound expressions in a no expression token";var b=a.expressionType;if("relationalexpression"==b){var c=a.op1,d=a.op2;return QueryFilters.boundVars(c)+QueryFilters.boundVars(d)}if("conditionalor"==b||"conditionaland"==b){for(var e=[],f=0;f<a.operands;f++)e=e.concat(QueryFilters.boundVars(a.operands[f]));return e}if("builtincall"==b){if(null==a.args)return[];for(var g=[],f=0;f<a.args.length;f++)g=g.concat(QueryFilters.boundVars(a.args[f]));return g}if("multiplicativeexpression"==b){for(var g=QueryFilters.boundVars(a.factor),f=0;f<a.factors.length;f++)g=g.concat(QueryFilters.boundVars(a.factors[f].expression));return g}if("additiveexpression"==b){for(var g=QueryFilters.boundVars(a.summand),f=0;f<a.summands.length;f++)g=g.concat(QueryFilters.boundVars(a.summands[f].expression));return g}if("regex"==b){var g=QueryFilters.boundVars(a.expression1);return g.concat(QueryFilters.boundVars(a.expression2))}return"unaryexpression"==b?QueryFilters.boundVars(a.expression):"atomic"==b?"var"==a.primaryexpression?[a.value]:[]:void 0},QueryFilters.run=function(a,b,c,d,e,f){for(var g=f.copyDenormalizedBindings(b,e.outCache),h=[],i=0;i<b.length;i++){var j=g[i],k=QueryFilters.runFilter(a,j,f,d,e),k=QueryFilters.ebv(k);if(QueryFilters.isEbvError(k)){if(c){var l={__nullify__:!0,bindings:b[i]};h.push(l)}}else if(k===!0)h.push(b[i]);else if(c){var l={__nullify__:!0,bindings:b[i]};h.push(l)}}return h},QueryFilters.collect=function(a,b,c,d,e,f){for(var g=e.copyDenormalizedBindings(b,d.outCache),h=[],i=0;i<g.length;i++){var j=g[i],k=QueryFilters.runFilter(a,j,e,c,d);h.push({binding:b[i],value:k})}return h},QueryFilters.runDistinct=function(a,b){},QueryFilters.runAggregator=function(a,b,c,d,e){if(null==b||0===b.length)return QueryFilters.ebvError();if("variable"===a.token&&"var"==a.kind)return b[0][a.value.value];if("variable"===a.token&&"aliased"===a.kind){if("atomic"===a.expression.expressionType&&"var"===a.expression.primaryexpression)return b[0][a.expression.value.value];if("aggregate"===a.expression.expressionType){if("max"===a.expression.aggregateType){for(var f=null,g=0;g<b.length;g++){var h=b[g],i=QueryFilters.runFilter(a.expression.expression,h,c,d,e);QueryFilters.isEbvError(i)||(null===f?f=i:QueryFilters.runLtFunction(f,i).value===!0&&(f=i))}return null===f?QueryFilters.ebvError():f}if("min"===a.expression.aggregateType){for(var j=null,g=0;g<b.length;g++){var h=b[g],i=QueryFilters.runFilter(a.expression.expression,h,c,d,e);QueryFilters.isEbvError(i)||(null===j?j=i:QueryFilters.runGtFunction(j,i).value===!0&&(j=i))}return null===j?QueryFilters.ebvError():j}if("count"===a.expression.aggregateType){var k={},l=0;if("*"===a.expression.expression)if(null!=a.expression.distinct&&""!=a.expression.distinct)for(var g=0;g<b.length;g++){var h=b[g],m=Utils.hashTerm(h);null==k[m]&&(k[m]=!0,l++)}else l=b.length;else for(var g=0;g<b.length;g++){var h=b[g],i=QueryFilters.runFilter(a.expression.expression,h,c,d,e);if(!QueryFilters.isEbvError(i))if(null!=a.expression.distinct&&""!=a.expression.distinct){var m=Utils.hashTerm(i);null==k[m]&&(k[m]=!0,l++)}else l++}return{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+l}}if("avg"===a.expression.aggregateType){for(var k={},n={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"},l=0,g=0;g<b.length;g++){var h=b[g],i=QueryFilters.runFilter(a.expression.expression,h,c,d,e);if(!QueryFilters.isEbvError(i))if(null!=a.expression.distinct&&""!=a.expression.distinct){var m=Utils.hashTerm(i);null==k[m]&&(k[m]=!0,QueryFilters.isNumeric(i)&&(n=QueryFilters.runSumFunction(n,i),l++))}else QueryFilters.isNumeric(i)&&(n=QueryFilters.runSumFunction(n,i),l++)}var o=QueryFilters.runDivFunction(n,{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:""+l});return o.value=""+o.value,o}if("sum"===a.expression.aggregateType){for(var k={},n={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"},g=0;g<b.length;g++){var h=b[g],i=QueryFilters.runFilter(a.expression.expression,h,c,d,e);if(!QueryFilters.isEbvError(i))if(null!=a.expression.distinct&&""!=a.expression.distinct){var m=Utils.hashTerm(i);null==k[m]&&(k[m]=!0,QueryFilters.isNumeric(i)&&(n=QueryFilters.runSumFunction(n,i)))}else QueryFilters.isNumeric(i)&&(n=QueryFilters.runSumFunction(n,i))}return n.value=""+n.value,n}var i=QueryFilters.runFilter(aggregate.expression,b[0],d,{blanks:{},outCache:{}});return i}}},QueryFilters.runFilter=function(a,b,c,d,e){if(null!=a.expressionType){var f=a.expressionType;if("relationalexpression"==f){var g=QueryFilters.runFilter(a.op1,b,c,d,e),h=QueryFilters.runFilter(a.op2,b,c,d,e);return QueryFilters.runRelationalFilter(a,g,h,b,c,d,e)}if("conditionalor"==f)return QueryFilters.runOrFunction(a,b,c,d,e);if("conditionaland"==f)return QueryFilters.runAndFunction(a,b,c,d,e);if("additiveexpression"==f)return QueryFilters.runAddition(a.summand,a.summands,b,c,d,e);if("builtincall"==f)return QueryFilters.runBuiltInCall(a.builtincall,a.args,b,c,d,e);if("multiplicativeexpression"==f)return QueryFilters.runMultiplication(a.factor,a.factors,b,c,d,e);if("unaryexpression"==f)return QueryFilters.runUnaryExpression(a.unaryexpression,a.expression,b,c,d,e);if("irireforfunction"==f)return QueryFilters.runIriRefOrFunction(a.iriref,a.args,b,c,d,e);if("regex"==f)return QueryFilters.runRegex(a.text,a.pattern,a.flags,b,c,d,e);if("custom"==f)return QueryFilters.runBuiltInCall(a.name,a.args,b,c,d,e);if("atomic"==f){if("var"==a.primaryexpression){var i=b[a.value.value];return i}return"object"!=typeof a.value?a.value:null==a.value.type||"object"!=typeof a.value.type?a.value:(a.value.type=Utils.lexicalFormBaseUri(a.value.type,e),a.value)}throw"Unknown filter expression type"}throw"Cannot find bound expressions in a no expression token"},QueryFilters.isRDFTerm=function(a){return null==a?!1:a.token&&"literal"==a.token||a.token&&"uri"==a.token||a.token&&"blank"==a.token?!0:!1},QueryFilters.RDFTermEquality=function(a,b,c,d){return"literal"===a.token&&"literal"===b.token?a.lang==b.lang&&a.type==b.type&&a.value==b.value?!0:null!=a.type&&null!=b.type?QueryFilters.ebvError():QueryFilters.isSimpleLiteral(a)&&null!=b.type?QueryFilters.ebvError():QueryFilters.isSimpleLiteral(b)&&null!=a.type?QueryFilters.ebvError():!1:"uri"===a.token&&"uri"===b.token?Utils.lexicalFormBaseUri(a,d)==Utils.lexicalFormBaseUri(b,d):"blank"===a.token&&"blank"===b.token?a.value==b.value:!1},QueryFilters.isInteger=function(a){return null==a?!1:"literal"===a.token&&("http://www.w3.org/2001/XMLSchema#integer"==a.type||"http://www.w3.org/2001/XMLSchema#decimal"==a.type||"http://www.w3.org/2001/XMLSchema#double"==a.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#long"==a.type||"http://www.w3.org/2001/XMLSchema#int"==a.type||"http://www.w3.org/2001/XMLSchema#short"==a.type||"http://www.w3.org/2001/XMLSchema#byte"==a.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type)?!0:!1},QueryFilters.isFloat=function(a){return null==a?!1:"literal"===a.token&&"http://www.w3.org/2001/XMLSchema#float"==a.type?!0:!1},QueryFilters.isDecimal=function(a){return null==a?!1:"literal"===a.token&&"http://www.w3.org/2001/XMLSchema#decimal"==a.type?!0:!1},QueryFilters.isDouble=function(a){return null==a?!1:"literal"===a.token&&"http://www.w3.org/2001/XMLSchema#double"==a.type?!0:!1},QueryFilters.isNumeric=function(a){return null==a?!1:"literal"===a.token&&("http://www.w3.org/2001/XMLSchema#integer"==a.type||"http://www.w3.org/2001/XMLSchema#decimal"==a.type||"http://www.w3.org/2001/XMLSchema#float"==a.type||"http://www.w3.org/2001/XMLSchema#double"==a.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#long"==a.type||"http://www.w3.org/2001/XMLSchema#int"==a.type||"http://www.w3.org/2001/XMLSchema#short"==a.type||"http://www.w3.org/2001/XMLSchema#byte"==a.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type)?!0:!1},QueryFilters.isSimpleLiteral=function(a){return a&&"literal"==a.token&&null==a.type&&null==a.lang?!0:!1},QueryFilters.isXsdType=function(a,b){return b&&"literal"==b.token?b.type=="http://www.w3.org/2001/XMLSchema#"+a:!1},QueryFilters.ebv=function(a){if(null==a||QueryFilters.isEbvError(a))return QueryFilters.ebvError();if(a.token&&"literal"===a.token){if("http://www.w3.org/2001/XMLSchema#integer"==a.type||"http://www.w3.org/2001/XMLSchema#decimal"==a.type||"http://www.w3.org/2001/XMLSchema#double"==a.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#long"==a.type||"http://www.w3.org/2001/XMLSchema#int"==a.type||"http://www.w3.org/2001/XMLSchema#short"==a.type||"http://www.w3.org/2001/XMLSchema#byte"==a.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type){var b=parseFloat(a.value);return isNaN(b)?!1:0!=parseFloat(a.value)}return"http://www.w3.org/2001/XMLSchema#boolean"===a.type?"true"===a.value||a.value===!0||"True"===a.value:"http://www.w3.org/2001/XMLSchema#string"===a.type?""!=a.value:"http://www.w3.org/2001/XMLSchema#dateTime"===a.type?null!=new Date(a.value):QueryFilters.isEbvError(a)?a:null==a.type?""!=a.value?!0:!1:QueryFilters.ebvError()}return a.value===!0},QueryFilters.effectiveBooleanValue=QueryFilters.ebv,QueryFilters.ebvTrue=function(){var a={token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0};return a},QueryFilters.ebvFalse=function(){var a={token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1};return a},QueryFilters.ebvError=function(){var a={token:"literal",type:"https://github.com/antoniogarrote/js-tools/types#error",value:null};return a},QueryFilters.isEbvError=function(a){return"object"==typeof a&&null!=a?"https://github.com/antoniogarrote/js-tools/types#error"===a.type:!1},QueryFilters.ebvBoolean=function(a){return QueryFilters.isEbvError(a)?a:a===!0?QueryFilters.ebvTrue():QueryFilters.ebvFalse()},QueryFilters.runRelationalFilter=function(a,b,c,d,e,f,g){var h=a.operator;if("="===h)return QueryFilters.runEqualityFunction(b,c,d,e,f,g);if("!="===h){var i=QueryFilters.runEqualityFunction(b,c,d,e,f,g);return QueryFilters.isEbvError(i)?i:(i.value=!i.value,i)}if("<"===h)return QueryFilters.runLtFunction(b,c,d);if(">"===h)return QueryFilters.runGtFunction(b,c,d);if("<="===h)return QueryFilters.runLtEqFunction(b,c,d);if(">="===h)return QueryFilters.runGtEqFunction(b,c,d);throw"Error applying relational filter, unknown operator"},QueryFilters.effectiveTypeValue=function(a){if("literal"!=a.token)throw console.log("not implemented yet"),console.log(a),"value not supported in operations yet";if("http://www.w3.org/2001/XMLSchema#integer"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#decimal"==a.type){var b=parseFloat(a.value);return b}if("http://www.w3.org/2001/XMLSchema#float"==a.type){var b=parseFloat(a.value);return b}if("http://www.w3.org/2001/XMLSchema#double"==a.type){var b=parseFloat(a.value);return b}if("http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==a.type){var b=parseFloat(a.value);return b}if("http://www.w3.org/2001/XMLSchema#negativeInteger"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#long"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#int"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#short"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#byte"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#unsignedLong"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#unsignedInt"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#unsignedShort"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#unsignedByte"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#positiveInteger"==a.type){var b=parseInt(a.value);return b}if("http://www.w3.org/2001/XMLSchema#date"!=a.type&&"http://www.w3.org/2001/XMLSchema#dateTime"!=a.type)return"http://www.w3.org/2001/XMLSchema#boolean"==a.type?a.value===!0||"true"===a.value||"1"===a.value||1===a.value||a.value===!0?!0:a.value===!1||"false"===a.value||"0"===a.value||0===a.value||a.value===!1?!1:void 0:"http://www.w3.org/2001/XMLSchema#string"==a.type?null===a.value||void 0===a.value?void 0:""+a.value:null==a.type?a.value:a.value;try{var c=Utils.parseISO8601(a.value);return c}catch(d){return null}},QueryFilters.runOrFunction=function(a,b,c,d,e){for(var f=null,g=0;g<a.operands.length;g++){var h=QueryFilters.runFilter(a.operands[g],b,c,d,e);0==QueryFilters.isEbvError(h)&&(h=QueryFilters.ebv(h)),null==f?f=h:QueryFilters.isEbvError(h)?f=QueryFilters.isEbvError(f)?QueryFilters.ebvError():f===!0?!0:QueryFilters.ebvError():h===!0?f=!0:QueryFilters.isEbvError(f)&&(f=QueryFilters.ebvError())}return QueryFilters.ebvBoolean(f)},QueryFilters.runAndFunction=function(a,b,c,d,e){for(var f=null,g=0;g<a.operands.length;g++){var h=QueryFilters.runFilter(a.operands[g],b,c,d,e);0==QueryFilters.isEbvError(h)&&(h=QueryFilters.ebv(h)),null==f?f=h:QueryFilters.isEbvError(h)?f=QueryFilters.isEbvError(f)?QueryFilters.ebvError():f===!0?QueryFilters.ebvError():!1:h===!0?QueryFilters.isEbvError(f)&&(f=QueryFilters.ebvError()):f=!1}return QueryFilters.ebvBoolean(f)},QueryFilters.runEqualityFunction=function(a,b,c,d,e,f){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();if(QueryFilters.isNumeric(a)&&QueryFilters.isNumeric(b)){var g=QueryFilters.effectiveTypeValue(a),h=QueryFilters.effectiveTypeValue(b);return isNaN(g)||isNaN(h)?QueryFilters.ebvBoolean(QueryFilters.RDFTermEquality(a,b,d,f)):QueryFilters.ebvBoolean(g==h)}if((QueryFilters.isSimpleLiteral(a)||QueryFilters.isXsdType("string",a))&&(QueryFilters.isSimpleLiteral(b)||QueryFilters.isXsdType("string",b)))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)==QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("boolean",a)&&QueryFilters.isXsdType("boolean",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)==QueryFilters.effectiveTypeValue(b));if((QueryFilters.isXsdType("dateTime",a)||QueryFilters.isXsdType("date",a))&&(QueryFilters.isXsdType("dateTime",b)||QueryFilters.isXsdType("date",b))){if(QueryFilters.isXsdType("dateTime",a)&&QueryFilters.isXsdType("date",b))return QueryFilters.ebvFalse();if(QueryFilters.isXsdType("date",a)&&QueryFilters.isXsdType("dateTime",b))return QueryFilters.ebvFalse();var i=Utils.compareDateComponents(a.value,b.value);return null!=i?0==i?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()}return QueryFilters.isRDFTerm(a)&&QueryFilters.isRDFTerm(b)?QueryFilters.ebvBoolean(QueryFilters.RDFTermEquality(a,b,d,f)):QueryFilters.ebvFalse()},QueryFilters.runGtFunction=function(a,b,c){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();if(QueryFilters.isNumeric(a)&&QueryFilters.isNumeric(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>QueryFilters.effectiveTypeValue(b));if(QueryFilters.isSimpleLiteral(a)&&QueryFilters.isSimpleLiteral(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("string",a)&&QueryFilters.isXsdType("string",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("boolean",a)&&QueryFilters.isXsdType("boolean",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>QueryFilters.effectiveTypeValue(b));if((QueryFilters.isXsdType("dateTime",a)||QueryFilters.isXsdType("date",a))&&(QueryFilters.isXsdType("dateTime",b)||QueryFilters.isXsdType("date",b))){if(QueryFilters.isXsdType("dateTime",a)&&QueryFilters.isXsdType("date",b))return QueryFilters.ebvFalse();if(QueryFilters.isXsdType("date",a)&&QueryFilters.isXsdType("dateTime",b))return QueryFilters.ebvFalse();var d=Utils.compareDateComponents(a.value,b.value);return null!=d?1==d?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()}return QueryFilters.ebvFalse()},QueryFilters.runTotalGtFunction=function(a,b){return QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b)?QueryFilters.ebvError():QueryFilters.isNumeric(a)&&QueryFilters.isNumeric(b)||QueryFilters.isSimpleLiteral(a)&&QueryFilters.isSimpleLiteral(b)||QueryFilters.isXsdType("string",a)&&QueryFilters.isSimpleLiteral("string",b)||QueryFilters.isXsdType("boolean",a)&&QueryFilters.isSimpleLiteral("boolean",b)||QueryFilters.isXsdType("dateTime",a)&&QueryFilters.isSimpleLiteral("dateTime",b)?QueryFilters.runGtFunction(a,b,[]):a.token&&"uri"===a.token&&b.token&&"uri"===b.token?QueryFilters.ebvBoolean(a.value>b.value):a.token&&"literal"===a.token&&b.token&&"literal"===b.token?QueryFilters.ebvBoolean(""+a.value+a.type+a.lang>""+b.value+b.type+b.lang):a.token&&"blank"===a.token&&b.token&&"blank"===b.token?QueryFilters.ebvBoolean(a.value>b.value):a.value&&b.value?QueryFilters.ebvBoolean(a.value>b.value):QueryFilters.ebvTrue()},QueryFilters.runLtFunction=function(a,b,c){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();if(QueryFilters.isNumeric(a)&&QueryFilters.isNumeric(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<QueryFilters.effectiveTypeValue(b));if(QueryFilters.isSimpleLiteral(a)&&QueryFilters.isSimpleLiteral(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("string",a)&&QueryFilters.isXsdType("string",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("boolean",a)&&QueryFilters.isXsdType("boolean",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<QueryFilters.effectiveTypeValue(b));if((QueryFilters.isXsdType("dateTime",a)||QueryFilters.isXsdType("date",a))&&(QueryFilters.isXsdType("dateTime",b)||QueryFilters.isXsdType("date",b))){if(QueryFilters.isXsdType("dateTime",a)&&QueryFilters.isXsdType("date",b))return QueryFilters.ebvFalse();if(QueryFilters.isXsdType("date",a)&&QueryFilters.isXsdType("dateTime",b))return QueryFilters.ebvFalse();var d=Utils.compareDateComponents(a.value,b.value);return null!=d?-1==d?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()}return QueryFilters.ebvFalse()},QueryFilters.runGtEqFunction=function(a,b,c){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();if(QueryFilters.isNumeric(a)&&QueryFilters.isNumeric(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>=QueryFilters.effectiveTypeValue(b));if(QueryFilters.isSimpleLiteral(a)&&QueryFilters.isSimpleLiteral(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>=QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("string",a)&&QueryFilters.isXsdType("string",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>=QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("boolean",a)&&QueryFilters.isXsdType("boolean",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)>=QueryFilters.effectiveTypeValue(b));if((QueryFilters.isXsdType("dateTime",a)||QueryFilters.isXsdType("date",a))&&(QueryFilters.isXsdType("dateTime",b)||QueryFilters.isXsdType("date",b))){if(QueryFilters.isXsdType("dateTime",a)&&QueryFilters.isXsdType("date",b))return QueryFilters.ebvFalse();if(QueryFilters.isXsdType("date",a)&&QueryFilters.isXsdType("dateTime",b))return QueryFilters.ebvFalse();var d=Utils.compareDateComponents(a.value,b.value);return null!=d?-1!=d?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()}return QueryFilters.ebvFalse()},QueryFilters.runLtEqFunction=function(a,b,c){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();if(QueryFilters.isNumeric(a)&&QueryFilters.isNumeric(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<=QueryFilters.effectiveTypeValue(b));if(QueryFilters.isSimpleLiteral(a)&&QueryFilters.isSimpleLiteral(b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<=QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("string",a)&&QueryFilters.isXsdType("string",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<=QueryFilters.effectiveTypeValue(b));if(QueryFilters.isXsdType("boolean",a)&&QueryFilters.isXsdType("boolean",b))return QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(a)<=QueryFilters.effectiveTypeValue(b));if((QueryFilters.isXsdType("dateTime",a)||QueryFilters.isXsdType("date",a))&&(QueryFilters.isXsdType("dateTime",b)||QueryFilters.isXsdType("date",b))){if(QueryFilters.isXsdType("dateTime",a)&&QueryFilters.isXsdType("date",b))return QueryFilters.ebvFalse();if(QueryFilters.isXsdType("date",a)&&QueryFilters.isXsdType("dateTime",b))return QueryFilters.ebvFalse();var d=Utils.compareDateComponents(a.value,b.value);return null!=d?1!=d?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()}return QueryFilters.ebvFalse()},QueryFilters.runAddition=function(a,b,c,d,e,f){var g=QueryFilters.runFilter(a,c,d,e,f);if(QueryFilters.isEbvError(g))return QueryFilters.ebvError();var h=g;if(QueryFilters.isNumeric(g)){for(var i=0;i<b.length;i++){var j=QueryFilters.runFilter(b[i].expression,c,d,e,f);if(!QueryFilters.isNumeric(j))return QueryFilters.ebvFalse();"+"===b[i].operator?h=QueryFilters.runSumFunction(h,j):"-"===b[i].operator&&(h=QueryFilters.runSubFunction(h,j))}return h}return QueryFilters.ebvFalse()},QueryFilters.runSumFunction=function(a,b){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();var c=QueryFilters.effectiveTypeValue(a)+QueryFilters.effectiveTypeValue(b);return QueryFilters.isDouble(a)||QueryFilters.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:c}:QueryFilters.isFloat(a)||QueryFilters.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:c}:QueryFilters.isDecimal(a)||QueryFilters.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:c}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:c}},QueryFilters.runSubFunction=function(a,b){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();var c=QueryFilters.effectiveTypeValue(a)-QueryFilters.effectiveTypeValue(b);return QueryFilters.isDouble(a)||QueryFilters.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:c}:QueryFilters.isFloat(a)||QueryFilters.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:c}:QueryFilters.isDecimal(a)||QueryFilters.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:c}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:c}},QueryFilters.runMultiplication=function(a,b,c,d,e,f){var g=QueryFilters.runFilter(a,c,d,e,f);if(QueryFilters.isEbvError(g))return g;var h=g;if(QueryFilters.isNumeric(g)){for(var i=0;i<b.length;i++){var j=QueryFilters.runFilter(b[i].expression,c,d,e,f);if(QueryFilters.isEbvError(j))return g;if(!QueryFilters.isNumeric(j))return QueryFilters.ebvFalse();"*"===b[i].operator?h=QueryFilters.runMulFunction(h,j):"/"===b[i].operator&&(h=QueryFilters.runDivFunction(h,j))}return h}return QueryFilters.ebvFalse()},QueryFilters.runMulFunction=function(a,b){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();var c=QueryFilters.effectiveTypeValue(a)*QueryFilters.effectiveTypeValue(b);
return QueryFilters.isDouble(a)||QueryFilters.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:c}:QueryFilters.isFloat(a)||QueryFilters.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:c}:QueryFilters.isDecimal(a)||QueryFilters.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:c}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:c}},QueryFilters.runDivFunction=function(a,b){if(QueryFilters.isEbvError(a)||QueryFilters.isEbvError(b))return QueryFilters.ebvError();var c=QueryFilters.effectiveTypeValue(a)/QueryFilters.effectiveTypeValue(b);return QueryFilters.isDouble(a)||QueryFilters.isDouble(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:c}:QueryFilters.isFloat(a)||QueryFilters.isFloat(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:c}:QueryFilters.isDecimal(a)||QueryFilters.isDecimal(b)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:c}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:c}},QueryFilters.runBuiltInCall=function(a,b,c,d,e,f){if("notexists"===a||"exists"===a){var g=JSON.parse(JSON.stringify(b[0])),h=d.abstractQueryTree.parseSelect({pattern:g},c);h=d.abstractQueryTree.bind(h.pattern,c);var i=d.executeSelectUnit([{kind:"*"}],e,h,f);return"exists"===a?QueryFilters.ebvBoolean(0!==i.length):QueryFilters.ebvBoolean(0===i.length)}for(var j=[],k=0;k<b.length;k++)if("var"===b[k].token)j.push(b[k]);else{var l=QueryFilters.runFilter(b[k],c,d,e,f);if(QueryFilters.isEbvError(l))return l;j.push(l)}if("str"===a)return"literal"===j[0].token?{token:"literal",type:null,value:""+j[0].value}:"uri"===j[0].token?{token:"literal",type:null,value:j[0].value}:QueryFilters.ebvFalse();if("lang"===a)return"literal"===j[0].token?null!=j[0].lang?{token:"literal",value:""+j[0].lang}:{token:"literal",value:""}:QueryFilters.ebvError();if("datatype"===a){if("literal"===j[0].token){var m=j[0];return null!=m.type?"string"==typeof m.type?{token:"uri",value:m.type,prefix:null,suffix:null}:m.type:null==m.lang?{token:"uri",value:"http://www.w3.org/2001/XMLSchema#string",prefix:null,suffix:null}:QueryFilters.ebvError()}return QueryFilters.ebvError()}if("isliteral"===a)return"literal"===j[0].token?QueryFilters.ebvTrue():QueryFilters.ebvFalse();if("isblank"===a)return"blank"===j[0].token?QueryFilters.ebvTrue():QueryFilters.ebvFalse();if("isuri"===a||"isiri"===a)return"uri"===j[0].token?QueryFilters.ebvTrue():QueryFilters.ebvFalse();if("sameterm"===a){var n=j[0],o=j[1],p=QueryFilters.RDFTermEquality(n,o,d,f);return QueryFilters.isEbvError(p)&&(p=!1),QueryFilters.ebvBoolean(p)}if("langmatches"===a){var q=j[0],r=j[1];return"literal"===q.token&&"literal"===r.token?"*"===r.value&&""!=q.value?QueryFilters.ebvTrue():QueryFilters.ebvBoolean(0===q.value.toLowerCase().indexOf(r.value.toLowerCase())):QueryFilters.ebvError()}if("bound"===a){var s=j[0].value;return null==s?QueryFilters.ebvError():null!=c[s]?QueryFilters.ebvTrue():QueryFilters.ebvFalse()}if(null!=d.customFns[a])return d.customFns[a](QueryFilters,j);throw"Builtin call "+a+" not implemented yet"},QueryFilters.runUnaryExpression=function(a,b,c,d,e,f){var g=QueryFilters.runFilter(b,c,d,e,f);if(QueryFilters.isEbvError(g))return g;if("!"===a){var h=QueryFilters.ebv(g);return QueryFilters.isEbvError(h)?QueryFilters.ebvFalse():(h=!h,QueryFilters.ebvBoolean(h))}if("+"===a)return QueryFilters.isNumeric(g)?g:QueryFilters.ebvError();if("-"===a){if(QueryFilters.isNumeric(g)){var i={};for(var j in g)i[j]=g[j];return i.value=-i.value,i}return QueryFilters.ebvError()}},QueryFilters.runRegex=function(a,b,c,d,e,f,g){if(null==a)return QueryFilters.ebvError();if(a=QueryFilters.runFilter(a,d,e,f,g),null==b)return QueryFilters.ebvError();if(b=QueryFilters.runFilter(b,d,e,f,g),null!=c&&(c=QueryFilters.runFilter(c,d,e,f,g)),null==b||"literal"!==b.token||null!=c&&"literal"!==c.token)return QueryFilters.ebvError();if(b=b.value,c=null==c?null:c.value,null!=a&&"var"==a.token){if(null==d[a.value])return QueryFilters.ebvError();a=d[a.value]}else{if(null==a||"literal"!==a.token)return QueryFilters.ebvError();if(null!=a.type&&!QueryFilters.isXsdType("string",a))return QueryFilters.ebvError();a=a.value}var h;return h=null==c?new RegExp(b):new RegExp(b,c.toLowerCase()),h.exec(a)?QueryFilters.ebvTrue():QueryFilters.ebvFalse()},QueryFilters.normalizeLiteralDatatype=function(a,b,c){return null==a.value.type||"object"!=typeof a.value.type?a:(a.value.type=Utils.lexicalFormBaseUri(a.value.type,c),a)},QueryFilters.runIriRefOrFunction=function(a,b,c,d,e,f){if(null==b)return a;for(var g=[],h=0;h<b.length;h++)g.push(QueryFilters.runFilter(b[h],c,d,e,f));var i=Utils.lexicalFormBaseUri(a,f);if("http://www.w3.org/2001/XMLSchema#integer"==i||"http://www.w3.org/2001/XMLSchema#decimal"==i||"http://www.w3.org/2001/XMLSchema#double"==i||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==i||"http://www.w3.org/2001/XMLSchema#negativeInteger"==i||"http://www.w3.org/2001/XMLSchema#long"==i||"http://www.w3.org/2001/XMLSchema#int"==i||"http://www.w3.org/2001/XMLSchema#short"==i||"http://www.w3.org/2001/XMLSchema#byte"==i||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==i||"http://www.w3.org/2001/XMLSchema#unsignedLong"==i||"http://www.w3.org/2001/XMLSchema#unsignedInt"==i||"http://www.w3.org/2001/XMLSchema#unsignedShort"==i||"http://www.w3.org/2001/XMLSchema#unsignedByte"==i||"http://www.w3.org/2001/XMLSchema#positiveInteger"==i){var j=g[0];if("literal"!==j.token)return QueryFilters.ebvError();if(j=QueryFilters.normalizeLiteralDatatype(j,d,f),"http://www.w3.org/2001/XMLSchema#integer"==j.type||"http://www.w3.org/2001/XMLSchema#decimal"==j.type||"http://www.w3.org/2001/XMLSchema#double"==j.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==j.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==j.type||"http://www.w3.org/2001/XMLSchema#long"==j.type||"http://www.w3.org/2001/XMLSchema#int"==j.type||"http://www.w3.org/2001/XMLSchema#short"==j.type||"http://www.w3.org/2001/XMLSchema#byte"==j.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==j.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==j.type)return j.type=i,j;if("http://www.w3.org/2001/XMLSchema#boolean"==j.type)return 1==QueryFilters.ebv(j)?(j.type=i,j.value=1):(j.type=i,j.value=0),j;if("http://www.w3.org/2001/XMLSchema#float"==j.type||"http://www.w3.org/2001/XMLSchema#double"==j.type)return j.type=i,j.value=parseInt(j.value),j;if("http://www.w3.org/2001/XMLSchema#string"!=j.type&&null!=j.type)return QueryFilters.ebvError();if(j.value.split(".").length>2)return QueryFilters.ebvError();if(j.value.split("-").length>2)return QueryFilters.ebvError();if(j.value.split("/").length>2)return QueryFilters.ebvError();if(j.value.split("+").length>2)return QueryFilters.ebvError();if("http://www.w3.org/2001/XMLSchema#decimal"==i&&(-1!=j.value.indexOf("e")||-1!=j.value.indexOf("E")))return QueryFilters.ebvError();if(!("http://www.w3.org/2001/XMLSchema#int"!=i&&"http://www.w3.org/2001/XMLSchema#integer"!=i||-1==j.value.indexOf("e")&&-1==j.value.indexOf("E")&&-1==j.value.indexOf(".")))return QueryFilters.ebvError();try{return j.value=parseInt(parseFloat(j.value)),isNaN(j.value)?QueryFilters.ebvError():(j.type=i,j)}catch(k){return QueryFilters.ebvError()}}else{if("http://www.w3.org/2001/XMLSchema#boolean"==i){var j=g[0];return"literal"===j.token&&null==j.type?"true"===j.value||"1"===j.value?QueryFilters.ebvTrue():"false"===j.value||"0"===j.value?QueryFilters.ebvFalse():QueryFilters.ebvError():"literal"===j.token?QueryFilters.isEbvError(j)?j:QueryFilters.ebvBoolean(j):QueryFilters.ebvError()}if("http://www.w3.org/2001/XMLSchema#string"==i){var j=g[0];return"literal"===j.token?(j=QueryFilters.normalizeLiteralDatatype(j,d,f),"http://www.w3.org/2001/XMLSchema#integer"==j.type||"http://www.w3.org/2001/XMLSchema#decimal"==j.type||"http://www.w3.org/2001/XMLSchema#double"==j.type||"http://www.w3.org/2001/XMLSchema#nonPositiveInteger"==j.type||"http://www.w3.org/2001/XMLSchema#negativeInteger"==j.type||"http://www.w3.org/2001/XMLSchema#long"==j.type||"http://www.w3.org/2001/XMLSchema#int"==j.type||"http://www.w3.org/2001/XMLSchema#short"==j.type||"http://www.w3.org/2001/XMLSchema#byte"==j.type||"http://www.w3.org/2001/XMLSchema#nonNegativeInteger"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedLong"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedInt"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedShort"==j.type||"http://www.w3.org/2001/XMLSchema#unsignedByte"==j.type||"http://www.w3.org/2001/XMLSchema#positiveInteger"==j.type||"http://www.w3.org/2001/XMLSchema#float"==j.type?(j.type=i,j.value=""+j.value,j):"http://www.w3.org/2001/XMLSchema#string"==j.type?j:"http://www.w3.org/2001/XMLSchema#boolean"==j.type?(QueryFilters.ebv(j)?(j.type=i,j.value="true"):(j.type=i,j.value="false"),j):"http://www.w3.org/2001/XMLSchema#dateTime"==j.type||"http://www.w3.org/2001/XMLSchema#date"==j.type?(j.type=i,"string"!=typeof j.value&&(j.value=Utils.iso8601(j.value)),j):null==j.type?(j.value=""+j.value,j.type=i,j):QueryFilters.ebvError()):"uri"===j.token?{token:"literal",value:Utils.lexicalFormBaseUri(j,f),type:i,lang:null}:QueryFilters.ebvError()}if("http://www.w3.org/2001/XMLSchema#dateTime"==i||"http://www.w3.org/2001/XMLSchema#date"==i){if(j=g[0],"http://www.w3.org/2001/XMLSchema#dateTime"==j.type||"http://www.w3.org/2001/XMLSchema#date"==j.type)return j;if("http://www.w3.org/2001/XMLSchema#string"!=j.type&&null!=j.type)return QueryFilters.ebvError();try{return j.value=Utils.iso8601(Utils.parseISO8601(j.value)),j.type=i,j}catch(k){return QueryFilters.ebvError()}}else{if("http://www.w3.org/2001/XMLSchema#float"!=i)return QueryFilters.ebvError();var j=g[0];if("literal"!==j.token)return QueryFilters.ebvError();if(j=QueryFilters.normalizeLiteralDatatype(j,d,f),"http://www.w3.org/2001/XMLSchema#decimal"==j.type||"http://www.w3.org/2001/XMLSchema#int"==j.type)return j.type=i,j.value=parseFloat(j.value),j;if("http://www.w3.org/2001/XMLSchema#boolean"==j.type)return 1==QueryFilters.ebv(j)?(j.type=i,j.value=1):(j.type=i,j.value=0),j;if("http://www.w3.org/2001/XMLSchema#float"==j.type||"http://www.w3.org/2001/XMLSchema#double"==j.type)return j.type=i,j.value=parseFloat(j.value),j;if("http://www.w3.org/2001/XMLSchema#string"==j.type)try{return j.value=parseFloat(j.value),isNaN(j.value)?QueryFilters.ebvError():(j.type=i,j)}catch(k){return QueryFilters.ebvError()}else{if(null!=j.type)return QueryFilters.ebvError();if(j.value.split(".").length>2)return QueryFilters.ebvError();if(j.value.split("-").length>2)return QueryFilters.ebvError();if(j.value.split("/").length>2)return QueryFilters.ebvError();if(j.value.split("+").length>2)return QueryFilters.ebvError();try{return j.value=parseFloat(j.value),isNaN(j.value)?QueryFilters.ebvError():(j.type=i,j)}catch(k){return QueryFilters.ebvError()}}}}};var QueryPlanDPSize={};QueryPlanDPSize.variablesInBGP=function(a){var b=a.variables;if(b)return b;var c=a.value||a;b=[];for(var d in c)c[d]&&"var"===c[d].token?b.push(c[d].value):c[d]&&"blank"===c[d].token&&b.push("blank:"+c[d].value);return a.variables=b,b},QueryPlanDPSize.connected=function(a,b){for(var c="/"+a.vars.join("/")+"/",d=0;d<b.vars.length;d++)if(-1!=c.indexOf("/"+b.vars[d]+"/"))return!0;return!1},QueryPlanDPSize.variablesIntersectionBGP=function(a,b){for(var c=QueryPlanDPSize.variablesInBGP(a).sort(),d=QueryPlanDPSize.variablesInBGP(b).sort(),e=0,f=0,g=[];e<c.length&&f<d.length;)c[e]===d[f]?(g.push(c[e]),e++,f++):c[e]<d[f]?e++:f++;return g},QueryPlanDPSize.executeAndBGPsGroups=function(a){for(var b={},c={},d=0,e=0;e<a.length;e++){var f=a[e],g={},h={},i=[];for(var j in f)"_cost"!=j&&("var"===f[j].token?i.push(f[j].value):"blank"===f[j].token&&i.push(f[j].value));var k=!1,l={};for(var m in c){var n=c[m];k=!1;for(var o=0;o<i.length;o++){var p="/"+i[o]+"/";if(-1!=n.indexOf(p)){k=!0;break}}k?l[m]=!0:(g[m]=b[m],h[m]=c[m])}if(k){var q=[],r="",s="";for(var t in l)r+=t,q=q.concat(b[t]),s=c[t];s=s+i.join("/")+"/",q.push(f),g[r]=q,h[r]=s}else g[d]=[f],h[d]="/"+i.join("/")+"/",d++;b=g,c=h}var u=[];for(var d in b)u.push(b[d]);return u},QueryPlanDPSize.intersectionSize=function(a,b){for(var c=b.i.split("_"),d=0;d<c.length;d++)if(""!=c[d]&&-1!=a.i.indexOf("_"+c[d]+"_"))return 1;return 0},QueryPlanDPSize.createJoinTree=function(a,b){for(var c="/"+a.vars.join("/")+"/",d=a.vars.concat([]),e=[],f=0;f<b.vars.length;f++)-1!=c.indexOf("/"+b.vars[f]+"/")?0==b.vars[f].indexOf("_:")?e.push("blank:"+b.vars[f]):e.push(b.vars[f]):d.push(b.vars[f]);for(var g=b.i.split("_"),h=a.i.split("_"),i={},f=0;f<g.length;f++)""!=g[f]&&(i[g[f]]=!0);for(var f=0;f<h.length;f++)""!=h[f]&&(i[h[f]]=!0);var j=[];for(var k in i)j.push(k);return{left:a,right:b,cost:a.cost+b.cost,i:"_"+j.sort().join("_")+"_",vars:d,join:e}},QueryPlanDPSize.executeBushyTree=function(a,b,c,d){if(null==a.left)return QueryPlanDPSize.executeEmptyJoinBGP(a.right,b,c,d);if(null==a.right)return QueryPlanDPSize.executeEmptyJoinBGP(a.left,b,c,d);var e=QueryPlanDPSize.executeBushyTree(a.left,b,c,d);if(null!=e){var f=QueryPlanDPSize.executeBushyTree(a.right,b,c,d);return null!=f?QueryPlanDPSize.joinBindings2(a.join,e,f):null}},QueryPlanDPSize.executeAndBGPsDPSize=function(a,b,c,d){for(var e=QueryPlanDPSize.executeAndBGPsGroups(a),f=[],g=0;g<e.length;g++){var h=e[g],i=(c.computeCosts(h,d),{}),j={},k={},l=1,m=null,n={};k[1]=[];for(var o=0;o<h.length;o++){var p=[];for(var q in h[o])"_cost"!=q&&("var"===h[o][q].token?p.push(h[o][q].value):"blank"===h[o][q].token&&p.push(h[o][q].value));j["_"+o+"_"]={left:h[o],right:null,cost:h[o]._cost,i:"_"+o+"_",vars:p};var r={left:h[o],right:null,cost:h[o]._cost,i:"_"+o+"_",vars:p};i["_"+o+"_"]=r,delete h[o]._cost,n["_"+o+"_"]=!0,k[1].push("_"+o+"_"),(null==m||m.cost>r.cost)&&(m=r)}for(var s=2;s<=h.length;s++)for(var t=1;s>t;t++)for(var u=s-t,v=k[""+t]||[],w=k[""+u]||[],o=0;o<v.length;o++)for(var x=0;x<w.length;x++)if(v[o]!==w[x]){var y=j[v[o]],z=j[w[x]];if(0==QueryPlanDPSize.intersectionSize(y,z)&&QueryPlanDPSize.connected(y,z)){l=s;var A=i[y.i],B=i[z.i],C=QueryPlanDPSize.createJoinTree(A,B);if(!n[C.i]){n[C.i]=!0;var D=C.cost+1;null!=i[C.i]&&(D=i[C.i].cost);var E=k[s]||[];E.push(C.i),j[C.i]=C,k[s]=E,D>C.cost&&(l===s&&(m=C),i[C.i]=C)}}}f.push(m)}for(var E=null,g=0;g<f.length;g++){var F=f[g],G=QueryPlanDPSize.executeBushyTree(F,b,c,d);E=null==E?G:QueryPlanDPSize.crossProductBindings(E,G)}return E},QueryPlanDPSize.executeEmptyJoinBGP=function(a,b,c,d){return QueryPlanDPSize.executeBGPDatasets(a,b,c,d)},QueryPlanDPSize.executeBGPDatasets=function(a,b,c,d){var e={};if(null==a.graph){for(var f=[],g=0;g<b.implicit.length;g++)if(null==e[b.implicit[g].oid]){e[b.implicit[g].oid]=!0,a.graph=b.implicit[g];var h=c.rangeQuery(a,d);h=QueryPlanDPSize.buildBindingsFromRange(h,a),f.push(h)}var i=QueryPlanDPSize.unionManyBindings(f);return i}if("var"===a.graph.token){for(var j=a.graph.value,f=[],g=0;g<b.named.length;g++)if(null==e[b.named[g].oid]){e[b.named[g].oid]=!0,a.graph=b.named[g];var h=c.rangeQuery(a,d);if(null==h)return null;h=QueryPlanDPSize.buildBindingsFromRange(h,a);for(var k=0;k<h.length;k++)h[k][j]=b.named[g].oid;f.push(h)}var i=QueryPlanDPSize.unionManyBindings(f||[]);return i}var h=c.rangeQuery(a,d);return null!=h?h=QueryPlanDPSize.buildBindingsFromRange(h,a):null},QueryPlanDPSize.buildBindingsFromRange=function(a,b){var c=(QueryPlanDPSize.variablesInBGP(b),{}),d=b.value||b,c={};for(j in d)d[j]&&"var"===d[j].token?c[j]=d[j].value:d[j]&&"blank"===d[j].token&&(c[j]="blank:"+d[j].value);var e=[];if(null!=a)for(var f=0;f<a.length;f++){var g={},h=a[f],i=!1;for(var j in c){var k=h[j];if(null!=g[c[j]]&&g[c[j]]!==k){i=!0;break}g[c[j]]=k}i||e.push(g)}return e},QueryPlanDPSize.areCompatibleBindings=function(a,b){for(var c in a)if(null!=b[c]&&b[c]!=a[c])return!1;return!0},QueryPlanDPSize.mergeBindings=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},QueryPlanDPSize.joinBindings2=function(a,b,c){for(var d,e,f,g,h,i={},j=[],k=0;k<b.length;k++){d=b[k],h=i;for(var l=0;l<a.length;l++)e=a[l],f=d[e],l==a.length-1?(g=h[f]||[],g.push(d),h[f]=g):(g=h[f]||{},h[f]=g,h=g)}for(var k=0;k<c.length;k++){d=c[k],h=i;for(var l=0;l<a.length;l++)if(e=a[l],f=d[e],null!=h[f])if(l==a.length-1)for(var m=0;m<h[f].length;m++)j.push(QueryPlanDPSize.mergeBindings(h[f][m],d));else h=h[f]}return j},QueryPlanDPSize.joinBindings=function(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=a[d],f=0;f<b.length;f++){var g=b[f];QueryPlanDPSize.areCompatibleBindings(e,g)&&c.push(QueryPlanDPSize.mergeBindings(e,g))}return c},QueryPlanDPSize.augmentMissingBindings=function(a,b){for(var c in b)null==a[c]&&(a[c]=null);return a},QueryPlanDPSize.leftOuterJoinBindings=function(a,b){for(var c=[],d=0;d<a.length;d++){for(var e=a[d],f=!1,g=0;g<b.length;g++){var h=b[g];QueryPlanDPSize.areCompatibleBindings(e,h)&&(f=!0,c.push(QueryPlanDPSize.mergeBindings(e,h)))}f===!1&&(QueryPlanDPSize.augmentMissingBindings(e,h),c.push(e))}return c},QueryPlanDPSize.crossProductBindings=function(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=a[d],f=0;f<b.length;f++){var g=b[f];c.push(QueryPlanDPSize.mergeBindings(e,g))}return c},QueryPlanDPSize.unionBindings=function(a,b){return a.concat(b)},QueryPlanDPSize.unionManyBindings=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b=QueryPlanDPSize.unionBindings(b,d)}return b};var QueryEngine={},QueryPlan=QueryPlanDPSize;QueryEngine.QueryEngine=function(a){0!=arguments.length&&(this.backend=a.backend,this.lexicon=a.lexicon,this.eventsOnBatchLoad=a.eventsOnBatchLoad||!1,this.defaultPrefixes={},this.abstractQueryTree=new AbstractQueryTree.AbstractQueryTree,this.rdfLoader=new RDFLoader.RDFLoader(a.communication),this.callbacksBackend=new Callbacks.CallbacksBackend(this),this.customFns=a.customFns||{})},QueryEngine.QueryEngine.prototype.setCustomFunctions=function(a){this.customFns=a},QueryEngine.QueryEngine.prototype.registerNsInEnvironment=function(a,b){var c=[];null!=a&&null!=a.prefixes&&(c=a.prefixes);var d={};for(var e in this.defaultPrefixes)d[e]=this.defaultPrefixes[e];for(var f=0;f<c.length;f++){var g=c[f];"prefix"===g.token&&(d[g.prefix]=g.local)}b.namespaces=d,null!=a&&a.base&&"object"==typeof a.base?b.base=a.base.value:b.base=null},QueryEngine.QueryEngine.prototype.applyModifier=function(a,b){if("DISTINCT"==a){for(var c={},d=[],e=0;e<b.length;e++){var f=b[e],g="";for(var h in f){var i=f[h];null==i?g=g+h+"null":"literal"==i.token?(null!=i.value&&(g+=i.value),null!=i.lang&&(g+=i.lang),null!=i.type&&(g+=i.type)):g=i.value?g+h+i.value:g+h+i}null==c[g]&&(d.push(f),c[g]=!0)}return d}return b},QueryEngine.QueryEngine.prototype.applyLimitOffset=function(a,b,c){return null==b&&null==a?c:(null==a&&(a=0),b=null==b?c.length:a+b,c.slice(a,b))},QueryEngine.QueryEngine.prototype.applySingleOrderBy=function(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=a[f],h=QueryFilters.collect(g.expression,[b],c,d,this);e.push(h[0].value)}return{binding:b,value:e}},QueryEngine.QueryEngine.prototype.applyOrderBy=function(a,b,c,d){var e=this,f=[];if(null!=a&&a.length>0){for(var g=0;g<b.length;g++){var h=b[g],i=e.applySingleOrderBy(a,h,c,d);f.push(i)}f.sort(function(b,c){return e.compareFilteredBindings(b,c,a,d)});for(var j=[],g=0;g<f.length;g++)j.push(f[g].binding);return j}return b},QueryEngine.QueryEngine.prototype.compareFilteredBindings=function(a,b,c,d){for(var e=!1,f=0;!e;){if(f==a.value.length)return 0;var g,h=c[f].direction;if(null!=a.value[f]||null!=b.value[f]){if(null==a.value[f])g={value:!1};else if(null==b.value[f])g={value:!0};else{if("blank"===a.value[f].token&&"blank"===b.value[f].token){f++;continue}if("blank"===a.value[f].token)g={value:!1};else if("blank"===b.value[f].token)g={value:!0};else if("uri"===a.value[f].token&&"uri"===b.value[f].token){if(1==QueryFilters.runEqualityFunction(a.value[f],b.value[f],[],this,d).value){f++;continue}g=QueryFilters.runTotalGtFunction(a.value[f],b.value[f],[])}else if("uri"===a.value[f].token)g={value:!1};else if("uri"===b.value[f].token)g={value:!0};else if("literal"===a.value[f].token&&"literal"===b.value[f].token&&null==a.value[f].type&&null==b.value[f].type){if(1==QueryFilters.runEqualityFunction(a.value[f],b.value[f],[],this,d).value){f++;continue}g=QueryFilters.runTotalGtFunction(a.value[f],b.value[f],[])}else if("literal"===a.value[f].token&&null==a.value[f].type)g={value:!1};else if("literal"===b.value[f].token&&null==b.value[f].type)g={value:!0};else{if(1==QueryFilters.runEqualityFunction(a.value[f],b.value[f],[],this,d).value){f++;continue}g=QueryFilters.runTotalGtFunction(a.value[f],b.value[f],[])}}return 1==g.value?"ASC"===h?1:-1:"ASC"===h?-1:1}f++}},QueryEngine.QueryEngine.prototype.removeDefaultGraphBindings=function(a,b){for(var c=[],d={},e=0;e<b.named.length;e++)d[b.named[e].oid]=!0;for(e=0;e<b.implicit.length;e++)null==d[b.implicit[e].oid]&&c.push(b.implicit[e].oid);var f=[];for(e=0;e<a.length;e++){var g=a[e],h=!1;for(var i in g){for(var j=0;j<d.length;j++)if(g[i]===d[j]){h=!0;break}if(h)break}h||f.push(g)}return f},QueryEngine.QueryEngine.prototype.aggregateBindings=function(a,b,c,d){for(var e=this.copyDenormalizedBindings(b,d.outCache),f={},g=0;g<a.length;g++){var h=QueryFilters.runAggregator(a[g],e,this,c,d);a[g].alias?f[a[g].alias.value]=h:f[a[g].value.value]=h}return f},QueryEngine.QueryEngine.prototype.projectBindings=function(a,b,c){if("*"===a[0].kind)return b;for(var d=[],e=0;e<b.length;e++){for(var f=b[e],g={},h=!0,i=0;i<a.length;i++)if("variable"==a[i].token&&"aliased"!=a[i].kind)g[a[i].value.value]=f[a[i].value.value];else if("variable"==a[i].token&&"aliased"==a[i].kind){var j=QueryFilters.runFilter(a[i].expression,f,this,c,{blanks:{},outCache:{}});if(QueryFilters.isEbvError(j)){h=!1;break}g[a[i].alias.value]=j}h===!0&&d.push(g)}return d},QueryEngine.QueryEngine.prototype.resolveNsInEnvironment=function(a,b){var c=b.namespaces;return c[a]},QueryEngine.QueryEngine.prototype.termCost=function(a,b){if("uri"===a.token){var c=Utils.lexicalFormBaseUri(a,b);return null==c?0:this.lexicon.resolveUriCost(c)}if("literal"===a.token){var d=Utils.lexicalFormLiteral(a,b);return this.lexicon.resolveLiteralCost(d)}if("blank"===a.token){var e=a.value;return this.lexicon.resolveBlankCost(e)}return"var"===a.token?this.lexicon.oidCounter/3:null},QueryEngine.QueryEngine.prototype.normalizeTerm=function(a,b,c){if("uri"===a.token){var d=Utils.lexicalFormBaseUri(a,b);return null==d?null:c?this.lexicon.registerUri(d):this.lexicon.resolveUri(d)}if("literal"===a.token){var e=Utils.lexicalFormLiteral(a,b);if(c){var f=this.lexicon.registerLiteral(e);return f}var f=this.lexicon.resolveLiteral(e);return f}if("blank"===a.token){var g=a.value,f=b.blanks[g];if(null!=f)return f;if(c){var f=this.lexicon.registerBlank(g);return b.blanks[g]=f,f}var f=this.lexicon.resolveBlank(g);return b.blanks[g]=f,f}return"var"===a.token?a.value:null},QueryEngine.QueryEngine.prototype.normalizeDatasets=function(a,b,c){for(var d=this,e=0;e<a.length;e++){var f=a[e];if(f.value===d.lexicon.defaultGraphUri)f.oid=d.lexicon.defaultGraphOid;else{var g=d.normalizeTerm(f,b,!1);if(null==g)return null;f.oid=g}}return!0},QueryEngine.QueryEngine.prototype.normalizeQuad=function(a,b,c){var d,e=null,f=null,g=null,h=null;if(null==a.graph)h=0;else{if(d=this.normalizeTerm(a.graph,b,c),null==d)return null;h=d,c===!0&&"var"!=a.graph.token&&this.lexicon.registerGraph(d)}return d=this.normalizeTerm(a.subject,b,c),null==d?null:(e=d,d=this.normalizeTerm(a.predicate,b,c),null==d?null:(f=d,d=this.normalizeTerm(a.object,b,c),null==d?null:(g=d,{subject:e,predicate:f,object:g,graph:h})))},QueryEngine.QueryEngine.prototype.quadCost=function(a,b,c){var d=null,e=null,f=null,g=null;return g=null==a.graph?this.lexicon.oidCounter/4:this.termCost(a.graph,b),d=this.termCost(a.subject,b),e=this.termCost(a.predicate,b),f=this.termCost(a.object,b),g+d+e+f},QueryEngine.QueryEngine.prototype.denormalizeBindingsList=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.denormalizeBindings(a[d],b);c.push(e)}return c},QueryEngine.QueryEngine.prototype.copyDenormalizedBindings=function(a,b,c){for(var d=[],e=0;e<a.length;e++){for(var f={},g=a[e],h=Utils.keys(g),i=0;i<h.length;i++){var j=g[h[i]];if(null==j)f[h[i]]=null;else if("object"==typeof j)f[h[i]]=j;else{var k=b[j];if(null!=k)f[h[i]]=k;else{var l=this.lexicon.retrieve(j);b[j]=l,f[h[i]]=l}}}d.push(f)}return d},QueryEngine.QueryEngine.prototype.denormalizeBindings=function(a,b,c){for(var d=Utils.keys(a),e=b.outCache,f=0;f<d.length;f++){var g=a[d[f]];if(null==g)a[d[f]]=null;else if(null!=e[g])a[d[f]]=e[g];else{var h=this.lexicon.retrieve(g);a[d[f]]=h,"blank"===h.token&&(b.blanks[h.value]=g)}}return a},QueryEngine.QueryEngine.prototype.execute=function(a,b,c,d){a=Utils.normalizeUnicodeLiterals(a);var e=this.abstractQueryTree.parseQueryString(a);if(null==e)b(!1,"Error parsing query string");else if("query"===e.token&&"update"==e.kind){this.callbacksBackend.startGraphModification();var f=this;this.executeUpdate(e,function(a,c){f.lexicon.updateAfterWrite&&f.lexicon.updateAfterWrite(),a?f.callbacksBackend.endGraphModification(function(){b(a,c)}):(f.callbacksBackend.cancelGraphModification(),b(a,c))})}else"query"===e.token&&"query"==e.kind&&this.executeQuery(e,b,c,d)},QueryEngine.QueryEngine.prototype.executeQuery=function(a,b,c,d){var e=a.prologue,f=a.units,g=this,h={blanks:{},outCache:{}};this.registerNsInEnvironment(e,h);var i=g.abstractQueryTree.parseExecutableUnit(f[0]);"select"===i.kind?this.executeSelect(i,h,c,d,function(a,c){if(a)if("object"==typeof c&&c.denorm===!0)b(!0,c.bindings);else{var c=g.denormalizeBindingsList(c,h);null!=c?b(!0,c):b(!1,c)}else b(!1,c)}):"ask"===i.kind?(i.projection=[{token:"variable",kind:"*"}],this.executeSelect(i,h,c,d,function(a,c){a&&a?c.length>0?b(!0,!0):b(!0,!1):b(!1,c)})):"construct"===i.kind&&(i.projection=[{token:"variable",kind:"*"}],g=this,this.executeSelect(i,h,c,d,function(a,c){if(a)if(a){var c=g.denormalizeBindingsList(c,h);if(null!=c){var d=new RDFJSInterface.Graph;null==i.template&&(i.template={triplesContext:i.pattern});for(var e=1,f=[],j=0;j<c.length;j++){for(var k=c[j],l=0;l<f.length;l++)delete f[l].valuetmp;for(var l=0;l<i.template.triplesContext.length;l++){for(var m=["subject","predicate","object"],n=i.template.triplesContext[l],o=0;o<m.length;o++){var p=m[o];if("blank"===n[p].token)if(n[p].valuetmp&&null!=n[p].valuetmp);else{var q="_:b"+e;e++,n[p].valuetmp=q,f.push(n[p])}}var r=RDFJSInterface.buildRDFResource(n.subject,k,g,h),o=RDFJSInterface.buildRDFResource(n.predicate,k,g,h),s=RDFJSInterface.buildRDFResource(n.object,k,g,h);if(null!=r&&null!=o&&null!=s){var t=new RDFJSInterface.Triple(r,o,s);d.add(t)}}}b(!0,d)}else b(!1,c)}else b(!1,c);else b(!1,c)}))},QueryEngine.QueryEngine.prototype.executeSelect=function(a,b,c,d,e){if("select"===a.kind||"ask"===a.kind||"construct"===a.kind||"modify"===a.kind){var f=a.projection,g=a.dataset,h=a.modifier,i=a.limit,j=a.offset,k=a.order,l=this;if((null!=c||null!=d)&&(g.implicit=c||[],g.named=d||[]),null!=g.implicit&&0===g.implicit.length&&null!=g.named&&0===g.named.length&&g.implicit.push(this.lexicon.defaultGraphUriTerm),null!=l.normalizeDatasets(g.implicit.concat(g.named),b)){var m=l.executeSelectUnit(f,g,a.pattern,b);if(null!=m){if(null!=a.group&&""===a.group){for(var n=!1,o=0;o<a.projection.length;o++)if(null!=a.projection[o].expression&&"aggregate"===a.projection[o].expression.expressionType){n=!0;break}n===!0&&(a.group="singleGroup")}if(a.group&&""!=a.group)if(l.checkGroupSemantics(a.group,f)){for(var p=l.groupSolution(m,a.group,g,b),q=[],o=0;o<p.length;o++){var r=l.aggregateBindings(f,p[o],g,b);q.push(r)}e(!0,{bindings:q,denorm:!0})}else e(!1,"Incompatible Group and Projection variables");else{var s=l.applyOrderBy(k,m,g,b),t=l.projectBindings(f,s,g),u=l.applyModifier(h,t),v=l.applyLimitOffset(j,i,u),w=l.removeDefaultGraphBindings(v,g);e(!0,w)}}else e(!1,m)}else e(!1,"Error normalizing datasets")}else e(!1,"Cannot execute "+a.kind+" query as a select query")},QueryEngine.QueryEngine.prototype.groupSolution=function(a,b,c,d){var e=[],f=[],g=!1,h=this;if("singleGroup"===b)return[a];for(var i=0;i<a.length;i++){for(var j=(arguments.callee,a[i]),k=!0,l=0;l<b.length;l++){var m=(arguments.callee,b[l]),n=null;if("var"===m.token)n=m.value,0==g&&e.push(n);else if("aliased_expression"===m.token)if(n=m.alias.value,0==g&&e.push(n),"var"===m.expression.primaryexpression)j[m.alias.value]=j[m.expression.value.value];else{var o=this.copyDenormalizedBindings([j],d.outCache),p=QueryFilters.runFilter(m.expression,o[0],h,c,d);QueryFilters.isEbvError(p)?k=!1:(null!=p.value&&(p.value=""+p.value),j[m.alias.value]=p)}else{var o=h.copyDenormalizedBindings([j],d.outCache),p=QueryFilters.runFilter(m,o[0],h,d);QueryFilters.isEbvError(p)?k=!1:(j["groupCondition"+env._i]=p,n="groupCondition"+env._i,0==g&&e.push(n))}}0==g&&(g=!0),k===!0&&f.push(j)}for(var q={},r={},s=0,i=0;i<f.length;i++){for(var t=f[i],u="",l=0;l<e.length;l++){var v=t[e[l]];u+="object"==typeof v?v.value:v}null==q[u]?(r[u]=s,q[u]=[t]):q[u].push(t)}var w=[];for(var x in q)w.push(q[x]);return w},QueryEngine.QueryEngine.prototype.executeSelectUnit=function(a,b,c,d){if("BGP"===c.kind)return this.executeAndBGP(a,b,c,d);if("UNION"===c.kind)return this.executeUNION(a,b,c.value,d);if("JOIN"===c.kind)return this.executeJOIN(a,b,c,d);if("LEFT_JOIN"===c.kind)return this.executeLEFT_JOIN(a,b,c,d);if("FILTER"===c.kind){var e=this.executeSelectUnit(a,b,c.value,d);return null!=e?e=QueryFilters.checkFilters(c,e,!1,b,d,this):[]}return"EMPTY_PATTERN"===c.kind?[]:"ZERO_OR_MORE_PATH"===c.kind||"ONE_OR_MORE_PATH"===c.kind?this.executeZeroOrMorePath(c,b,d):(console.log("Cannot execute query pattern "+c.kind+". Not implemented yet."),null)},QueryEngine.QueryEngine.prototype.executeZeroOrMorePath=function(a,b,c){var d=[],e=!1;if("var"===a.x.token&&d.push({token:"variable",kind:"var",value:a.x.value}),"var"===a.y.token&&d.push({token:"variable",kind:"var",value:a.y.value}),0===d.length&&(d.push({token:"variable",kind:"*"}),e=!0),"var"===a.x.token&&"var"===a.y.token){for(var f,g,h,i,j=this.executeAndBGP(d,b,a.path,c),k={},l=[],m=a.x.value,n=a.x,o=a.path,p=0;p<j.length;p++)if(f=j[p][m],null==k[f]){i=this.lexicon.retrieve(f),a.x=i,a.path=this.abstractQueryTree.replace(o,n,i,c),o=Utils.clone(a.path),g=this.executeZeroOrMorePath(a,b,c);for(var q=0;q<g.length;q++)h=g[q],h[m]=f,l.push(h);n=i}return l}if("var"!==a.x.token&&"var"===a.y.token){var j,h,n,k={},r=!0,s=[],t=[];for(a.x;1==r||0!==s.length;){if(r===!0)j=this.executeAndBGP(d,b,a.path,c),n=a.x,r=!1;else{var u=s.pop(),v=this.lexicon.retrieve(u),w=a.path;w=this.abstractQueryTree.replace(w,n,v,c),j=this.executeAndBGP(d,b,w,c),n=v}for(var p=0;p<j.length;p++){var v=j[p][a.y.value];k[v]!==!0&&(h={},h[a.y.value]=v,t.push(h),k[v]=!0,s.push(v))}}return t}throw"Kind of path not supported!"},QueryEngine.QueryEngine.prototype.executeUNION=function(a,b,c,d){var e=c[0],f=c[1],g=null,h=null;if(2!=c.length)throw"SPARQL algebra UNION with more than two components";var i=this;if(g=i.executeSelectUnit(a,b,e,d),null==g)return null;if(h=i.executeSelectUnit(a,b,f,d),null==h)return null;var j=QueryPlan.unionBindings(g,h);return j=QueryFilters.checkFilters(c,j,!1,b,d,i)},QueryEngine.QueryEngine.prototype.executeAndBGP=function(a,b,c,d){var e=this,f=QueryPlan.executeAndBGPsDPSize(c.value,b,this,d);return null!=f?QueryFilters.checkFilters(c,f,!1,b,d,e):null},QueryEngine.QueryEngine.prototype.executeLEFT_JOIN=function(a,b,c,d){var e,f,g=c.lvalue,h=c.rvalue,i=null,j=null,k=this;if(i=k.executeSelectUnit(a,b,g,d),null==i)return null;if(j=k.executeSelectUnit(a,b,h,d),null==j)return null;var l=QueryPlan.leftOuterJoinBindings(i,j),m=QueryFilters.checkFilters(c,l,!0,b,d,k);if(i.length>1&&j.length>1){var n=[],o={};for(var p in i[0])o[p]=!0;for(p in j[0])1!=o[p]&&n.push(p);
e=[],f={};for(var q=0;q<m.length;q++)if(m[q].__nullify__===!0){for(var r=0;r<n.length;r++)m[q].bindings[n[r]]=null;var s=[],t=[];for(var p in m[q].bindings)null!=m[q].bindings[p]&&(s.push(p+m[q].bindings[p]),s.sort(),t.push(s.join("")));if(null==f[s.join("")]){for(r=0;r<t.length;r++)f[t[r]]=!0;e.push(m[q].bindings)}}else{e.push(m[q]);var s=[],t=[];for(var p in m[q])s.push(p+m[q][p]),s.sort(),f[s.join("")]=!0}return e}return m},QueryEngine.QueryEngine.prototype.executeJOIN=function(a,b,c,d){var e=c.lvalue,f=c.rvalue,g=null,h=null,i=this;if(g=i.executeSelectUnit(a,b,e,d),null==g)return null;if(h=i.executeSelectUnit(a,b,f,d),null==h)return null;var j=null;if(0===g.length||0===h.length)j=[];else{var k={},l=[];for(var m in g[0])k[m]=!1;for(var m in h[0])k[m]===!1&&l.push(m);j=0==l.length?QueryPlan.joinBindings(g,h):this.abstractQueryTree.treeWithUnion(e)||this.abstractQueryTree.treeWithUnion(f)?QueryPlan.joinBindings(g,h):QueryPlan.joinBindings2(l,g,h)}return j=QueryFilters.checkFilters(c,j,!1,b,d,i)},QueryEngine.QueryEngine.prototype.rangeQuery=function(a,b){var c=this,d=c.normalizeQuad(a,b,!1);if(null!=d){var e=c.backend.range(new QuadIndexCommon.Pattern(d));return null==e||0==e.length?[]:e}return console.log("ERROR normalizing quad"),null},QueryEngine.QueryEngine.prototype.executeUpdate=function(a,b){var c=a.prologue,d=a.units,e=this,f={blanks:{},outCache:{}};this.registerNsInEnvironment(c,f);for(var g=0;g<d.length;g++){var h=e.abstractQueryTree.parseExecutableUnit(d[g]);if("insertdata"===h.kind){for(var i=0;i<h.quads.length;i++){var j=h.quads[i],k=e._executeQuadInsert(j,f);if(k!==!0)return b(!1,error)}b(!0)}else if("deletedata"===h.kind){for(var i=0;i<h.quads.length;i++){var j=h.quads[i];this._executeQuadDelete(j,f)}b(!0)}else if("modify"===h.kind)this._executeModifyQuery(h,f,b);else if("create"===h.kind)b(!0);else if("load"===h.kind){var l={uri:Utils.lexicalFormBaseUri(h.sourceGraph,f)};null!=h.destinyGraph&&(l={uri:Utils.lexicalFormBaseUri(h.destinyGraph,f)});var e=this;this.rdfLoader.load(h.sourceGraph.value,l,function(a,c){if(0==a)console.log("Error loading graph"),console.log(c),b(!1,"error batch loading quads");else{var c=e.batchLoad(c);b(null!=c,c||"error batch loading quads")}})}else if("drop"===h.kind)this._executeClearGraph(h.destinyGraph,f,b);else{if("clear"!==h.kind)throw new Error("not supported execution unit");this._executeClearGraph(h.destinyGraph,f,b)}}},QueryEngine.QueryEngine.prototype.batchLoad=function(a,b){var c,d,e,f,g,h=null,i=null,j=null,k=null,l=(Utils.stackCounterLimit,0),m=!0,n={};this.eventsOnBatchLoad&&this.callbacksBackend.startGraphModification();for(var o=0;o<a.length;o++){e=a[o],e.subject.uri||"uri"===e.subject.token?(d=this.lexicon.registerUri(e.subject.uri||e.subject.value),null!=e.subject.uri&&(e.subject={token:"uri",value:e.subject.uri},delete e.subject.uri),h=d):e.subject.literal||"literal"===e.subject.token?(d=this.lexicon.registerLiteral(e.subject.literal||e.subject.value),null!=e.subject.literal&&(e.subject=this.lexicon.parseLiteral(e.subject.literal),delete e.subject.literal),h=d):(c=n[e.subject.blank||e.subject.value],null==c&&(c=this.lexicon.registerBlank(e.subject.blank||e.subject.value),n[e.subject.blank||e.subject.value]=c),null==e.subject.token&&(e.subject.token="blank",e.subject.value=e.subject.blank,delete e.subject.blank),h=c),e.predicate.uri||"uri"===e.predicate.token?(d=this.lexicon.registerUri(e.predicate.uri||e.predicate.value),null!=e.predicate.uri&&(e.predicate={token:"uri",value:e.predicate.uri},delete e.subject.uri),i=d):e.predicate.literal||"literal"===e.predicate.token?(d=this.lexicon.registerLiteral(e.predicate.literal||e.predicate.value),null!=e.predicate.literal&&(e.predicate=this.lexicon.parseLiteral(e.predicate.literal),delete e.predicate.literal),i=d):(c=n[e.predicate.blank||e.predicate.value],null==c&&(c=this.lexicon.registerBlank(e.predicate.blank||e.predicate.value),n[e.predicate.blank||e.predicate.value]=c),null==e.predicate.token&&(e.predicate.token="blank",e.predicate.value=e.predicate.blank,delete e.predicate.blank),i=c),e.object.uri||"uri"===e.object.token?(d=this.lexicon.registerUri(e.object.uri||e.object.value),null!=e.object.uri&&(e.object={token:"uri",value:e.object.uri},delete e.subject.uri),j=d):e.object.literal||"literal"===e.object.token?("literal"===e.object.token&&(null!=e.object.type?e.object.value='"'+e.object.value+'"^^<'+e.object.type+">":null!=e.object.lang?e.object.value='"'+e.object.value+'"@'+e.object.lang:e.object.value='"'+e.object.value+'"'),d=this.lexicon.registerLiteral(e.object.literal||e.object.value),null!=e.object.literal&&(e.object=this.lexicon.parseLiteral(e.object.literal),delete e.object.literal),j=d):(c=n[e.object.blank||e.object.value],null==c&&(c=this.lexicon.registerBlank(e.object.blank||e.object.value),n[e.object.blank||e.object.value]=c),null==e.object.token&&(e.object.token="blank",e.object.value=e.object.blank,delete e.object.blank),j=c),e.graph.uri||"uri"===e.graph.token?(d=this.lexicon.registerUri(e.graph.uri||e.graph.value),null!=e.graph.uri&&(e.graph={token:"uri",value:e.graph.uri},delete e.subject.uri),this.lexicon.registerGraph(d),k=d):e.graph.literal||"literal"===e.graph.token?(d=this.lexicon.registerLiteral(e.graph.literal||e.graph.value),null!=e.predicate.literal&&(e.predicate=this.lexicon.parseLiteral(e.predicate.literal),delete e.predicate.literal),k=d):(c=n[e.graph.blank||e.graph.value],null==c&&(c=this.lexicon.registerBlank(e.graph.blank||e.graph.value),n[e.graph.blank||e.graph.value]=c),null==e.graph.token&&(e.graph.token="blank",e.graph.value=e.graph.blank,delete e.graph.blank),k=c),g=e,e={subject:h,predicate:i,object:j,graph:k},f=new QuadIndexCommon.NodeKey(e);var p=this.backend.search(f);if(!p){if(p=this.backend.index(f),1!=p){m=!1;break}this.eventsOnBatchLoad&&this.callbacksBackend.nextGraphModification(Callbacks.added,[g,e]),l+=1}}null!=this.lexicon.updateAfterWrite&&this.lexicon.updateAfterWrite();var q=function(){m?b&&b(!0,l):b&&b(!1,null)};return this.eventsOnBatchLoad?this.callbacksBackend.endGraphModification(function(){q()}):q(),m?l:null},QueryEngine.QueryEngine.prototype.computeCosts=function(a,b){for(var c=0;c<a.length;c++)a[c]._cost=this.quadCost(a[c],b);return a},QueryEngine.QueryEngine.prototype._executeModifyQuery=function(a,b,c){var d=this,e=!0,f=null,g=["subject","predicate","object","graph"];a.insert=null==a.insert?[]:a.insert,a["delete"]=null==a["delete"]?[]:a["delete"],Utils.seq(function(c){var g=[],h=[];if(null!=a["with"]&&g.push(a["with"]),null!=a.using){h=[];for(var i=0;i<a.using.length;i++){var j=a.using[i];"named"===j.kind?h.push(j.uri):g.push(j.uri)}}a.dataset={},a.projection=[{token:"variable",kind:"*"}],d.executeSelect(a,b,g,h,function(a,g){if(a){var g=d.denormalizeBindingsList(g,b);return null!=g?f=g:e=!1,c()}return e=!1,c()})},function(c){var h=a["with"];if(e){for(var i=[],j=0;j<a["delete"].length;j++)for(var k=a["delete"][j],l=0;l<f.length;l++){for(var m={},n=f[l],o=0;o<g.length;o++){var p=g[o];"graph"==p&&null==k[p]?m.graph=h:"var"===k[p].token?m[p]=n[k[p].value]:m[p]=k[p]}i.push(m)}for(var m,l=0;l<i.length;l++)m=i[l],d._executeQuadDelete(m,b);c()}else c()},function(c){var h=a["with"];if(e){for(var i=[],j=0;j<a.insert.length;j++)for(var k=a.insert[j],l=0;l<f.length;l++){for(var m={},n=f[l],o=0;o<g.length;o++){var p=g[o];"graph"==p&&null==k[p]?m.graph=h:"var"===k[p].token?m[p]=n[k[p].value]:m[p]=k[p]}i.push(m)}for(var j=0;j<i.length;j++){var m=i[j];d._executeQuadInsert(m,b)}c()}else c()})(function(){c(e)})},QueryEngine.QueryEngine.prototype._executeQuadInsert=function(a,b){var c=this,d=this.normalizeQuad(a,b,!0);if(null!=d){var e=new QuadIndexCommon.NodeKey(d),f=c.backend.search(e);if(f)return f;var f=c.backend.index(e);return 1==f?(c.callbacksBackend.nextGraphModification(Callbacks.added,[a,d]),!0):(console.log("ERROR inserting quad"),!1)}return console.log("ERROR normalizing quad"),!1},QueryEngine.QueryEngine.prototype._executeQuadDelete=function(a,b){var c=this,d=this.normalizeQuad(a,b,!1);if(null!=d){var e=new QuadIndexCommon.NodeKey(d);c.backend["delete"](e);var f=c.lexicon.unregister(a,e);return 1==f?(c.callbacksBackend.nextGraphModification(Callbacks.deleted,[a,d]),!0):(console.log("ERROR unregistering quad"),!1)}return console.log("ERROR normalizing quad"),!1},QueryEngine.QueryEngine.prototype._executeClearGraph=function(a,b,c){if("default"===a)this.execute("DELETE { ?s ?p ?o } WHERE { ?s ?p ?o }",c);else if("named"===a){var d=this,e=this.lexicon.registeredGraphs(!0);if(null!=e){var f=!1;Utils.repeat(0,e.length,function(a,b){var c=e[b._i],g=arguments.callee;f?a(g,b):d.execute("DELETE { GRAPH <"+c+"> { ?s ?p ?o } } WHERE { GRAPH <"+c+"> { ?s ?p ?o } }",function(c,d){f=!c,a(g,b)})},function(a){c(!f)})}else c(!1,"Error deleting named graphs")}else if("all"===a){var d=this;this.execute("CLEAR DEFAULT",function(a,b){a?d.execute("CLEAR NAMED",c):c(!1,b)})}else if("uri"==a.token){var g=Utils.lexicalFormBaseUri(a,b);null!=g?this.execute("DELETE { GRAPH <"+g+"> { ?s ?p ?o } } WHERE { GRAPH <"+g+"> { ?s ?p ?o } }",c):c(!1,"wrong graph URI")}else c(!1,"wrong graph URI")},QueryEngine.QueryEngine.prototype.checkGroupSemantics=function(a,b){if("singleGroup"===a)return!0;for(var c={},d=0;d<a.length;d++){var e=a[d];"var"===e.token?c[e.value]=!0:"aliased_expression"===e.token&&(c[e.alias.value]=!0)}for(d=0;d<b.length;d++){var f=b[d];if("var"===f.kind){if(null==c[f.value.value])return!1}else if("aliased"===f.kind&&f.expression&&"var"===f.expression.primaryexpression&&null==c[f.expression.value.value])return!1}return!0},QueryEngine.QueryEngine.prototype.registerDefaultNamespace=function(a,b){this.defaultPrefixes[a]=b};var Callbacks={};Callbacks.ANYTHING={token:"var",value:"_"},Callbacks.added="added",Callbacks.deleted="deleted",Callbacks.eventsFlushed="eventsFlushed",Callbacks.CallbacksBackend=function(){this.aqt=new AbstractQueryTree.AbstractQueryTree,this.engine=arguments[0],this.indexMap={},this.observersMap={},this.queriesIndexMap={},this.emptyNotificationsMap={},this.queriesList=[],this.pendingQueries=[],this.matchedQueries=[],this.updateInProgress=null,this.indices=["SPOG","GP","OGS","POG","GSP","OS"],this.componentOrders={SPOG:["subject","predicate","object","graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate","object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]},this.callbackCounter=0,this.callbacksMap={},this.callbacksInverseMap={},this.queryCounter=0,this.queriesMap={},this.queriesCallbacksMap={},this.queriesInverseMap={};for(var a=0;a<this.indices.length;a++){var b=this.indices[a];this.indexMap[b]={},this.queriesIndexMap[b]={}}},Callbacks.CallbacksBackend.prototype.startGraphModification=function(){this.pendingQueries=[].concat(this.queriesList),this.matchedQueries=[];Callbacks.added,Callbacks.deleted;null==this.updateInProgress&&(this.updateInProgress={added:[],deleted:[]})},Callbacks.CallbacksBackend.prototype.nextGraphModification=function(a,b){this.updateInProgress[a].push(b)},Callbacks.CallbacksBackend.prototype.endGraphModification=function(a){var b=this;if(null!=this.updateInProgress){var c=b.updateInProgress;b.updateInProgress=null,this.sendNotification(Callbacks.deleted,c[Callbacks.deleted],function(){b.sendNotification(Callbacks.added,c[Callbacks.added],function(){b.sendEmptyNotification(Callbacks.eventsFlushed,null,function(){b.dispatchQueries(function(){a(!0)})})})})}else a(!0)},Callbacks.CallbacksBackend.prototype.cancelGraphModification=function(){this.updateInProgress=null},Callbacks.CallbacksBackend.prototype.sendNotification=function(a,b,c){for(var d={},e=0;e<b.length;e++){var f=b[e];for(var g in this.indexMap){var h=this.indexMap[g],i=this.componentOrders[g];this._searchCallbacksInIndex(h,i,a,f,d),0!=this.pendingQueries.length&&(h=this.queriesIndexMap[g],this._searchQueriesInIndex(h,i,f))}}this.dispatchNotifications(d),null!=c&&c(!0)},Callbacks.CallbacksBackend.prototype.sendEmptyNotification=function(a,b,c){for(var d=this.emptyNotificationsMap[a]||[],e=0;e<d.length;e++)d[e](a,b);c()},Callbacks.CallbacksBackend.prototype.dispatchNotifications=function(a){for(var b in a){var c=this.callbacksMap[b],d=a[b][Callbacks.deleted];if(null!=d)try{c(Callbacks.deleted,d)}catch(e){}for(var f in a[b])if(f!=Callbacks.deleted)try{c(f,a[b][f])}catch(e){}}},Callbacks.CallbacksBackend.prototype._searchCallbacksInIndex=function(a,b,c,d,e){for(var f=d[1],d=d[0],g=0;g<b.length+1;g++){for(var h=a._||[],i=[],j=0;j<h.length;j++){var k=h[j];null!=this.callbacksMap[k]&&(e[k]=e[k]||{},e[k][c]=e[k][c]||[],e[k][c].push(d),i.push(k))}a._=i;var l=b[g];if(null==a[""+f[l]])break;a=a[""+f[l]]}},Callbacks.CallbacksBackend.prototype.subscribeEmpty=function(a,b){var c=this.emptyNotificationsMap[a]||[];c.push(b),this.emptyNotificationsMap[a]=c},Callbacks.CallbacksBackend.prototype.unsubscribeEmpty=function(a,b){var c=this.emptyNotificationsMap[a];null!=c&&(c=Utils.remove(c,b)),this.emptyNotificationsMap[a]=c},Callbacks.CallbacksBackend.prototype.subscribe=function(a,b,c,d,e,f){var g=this._tokenizeComponents(a,b,c,d),h={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,h);for(var i=this,j=this.engine.normalizeQuad(g,h,!0),k=new QuadIndexCommon.Pattern(j),l=i._indexForPattern(k),m=i.componentOrders[l],n=i.indexMap[l],o=0;o<m.length;o++){var p=m[o],q=j[p];if("_"===q){null==n._&&(n._=[]),i.callbackCounter++,n._.push(i.callbackCounter),i.callbacksMap[i.callbackCounter]=e,i.callbacksInverseMap[e]=i.callbackCounter;break}o===m.length-1?(n[q]=n[q]||{_:[]},i.callbackCounter++,n[q]._.push(i.callbackCounter),i.callbacksMap[i.callbackCounter]=e,i.callbacksInverseMap[e]=i.callbackCounter):(n[q]=n[q]||{},n=n[q])}null!=f&&f(!0)},Callbacks.CallbacksBackend.prototype.unsubscribe=function(a){var b=this.callbacksInverseMap[a];null!=b&&(delete this.callbacksInverseMap[a],delete this.callbacksMap[b])},Callbacks.CallbacksBackend.prototype._tokenizeComponents=function(a,b,c,d){var e={};return null==a?e.subject=Callbacks.ANYTHING:0==a.indexOf("_:")?e.subject={token:"blank",value:a}:e.subject={token:"uri",value:a},null==b?e.predicate=Callbacks.ANYTHING:e.predicate={token:"uri",value:b},null==c?e.object=Callbacks.ANYTHING:e.object={token:"uri",value:c},null==d?e.graph=Callbacks.ANYTHING:e.graph={token:"uri",value:d},e},Callbacks.CallbacksBackend.prototype._indexForPattern=function(a){for(var b=a.indexKey,c=this.indices,d=0;d<c.length;d++)for(var e=c[d],f=this.componentOrders[e],g=0;g<f.length&&Utils.include(b,f[g])!==!1;g++)if(g==b.length-1)return e;return"SPOG"},Callbacks.CallbacksBackend.prototype.observeNode=function(){var a,b,c,d;4===arguments.length?(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]):(a=arguments[0],b=this.engine.lexicon.defaultGraphUri,c=arguments[1],d=arguments[2]);var e="CONSTRUCT { <"+a+"> ?p ?o } WHERE { GRAPH <"+b+"> { <"+a+"> ?p ?o } }",f=this,g={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,g);var h=[];this.engine.execute(e,function(b,e){if(b){var i=e,j=!1,k=function(a,b){if("eventsFlushed"===a&&j){j=!1;try{c(i)}catch(d){}}else if("eventsFlushed"!==a){j=!0;for(var e=0;e<b.length;e++){var k=b[e],l=RDFJSInterface.buildRDFResource(k.subject,h,f.engine,g),m=RDFJSInterface.buildRDFResource(k.predicate,h,f.engine,g),n=RDFJSInterface.buildRDFResource(k.object,h,f.engine,g);null!=l&&null!=m&&null!=n&&(k=new RDFJSInterface.Triple(l,m,n),a===Callbacks.added?i.add(k):a===Callbacks.deleted&&i.remove(k))}}};f.observersMap[c]=k,f.subscribeEmpty(Callbacks.eventsFlushed,k),f.subscribe(a,null,null,null,k,function(){try{c(i)}catch(a){}d&&d(!0)})}else d&&d(!1)})},Callbacks.CallbacksBackend.prototype.stopObservingNode=function(a){var b=this.observersMap[a];return b?(this.unsubscribe(b),this.unsubscribeEmpty(Callbacks.eventsFlushed,b),!0):!1},Callbacks.CallbacksBackend.prototype.observeQuery=function(a,b,c){var d=this.aqt.parseQueryString(a),e=this.aqt.parseSelect(d.units[0]),f=this.aqt.collectBasicTriples(e),g=this,h={blanks:{},outCache:{}};this.engine.registerNsInEnvironment(null,h);var i,j,k,l,m,n=this.queryCounter;this.queryCounter++,this.queriesMap[n]=a,this.queriesInverseMap[a]=n,this.queriesList.push(n),this.queriesCallbacksMap[n]=b;for(var o=0;o<f.length;o++){j=f[o],null==j.graph&&(j.graph=g.engine.lexicon.defaultGraphUriTerm);var p=g.engine.normalizeQuad(j,h,!0);i=new QuadIndexCommon.Pattern(p),k=g._indexForPattern(i),l=g.componentOrders[k],m=g.queriesIndexMap[k];for(var q=0;q<l.length;q++){var r=l[q],s=p[r];if("string"==typeof s){null==m._&&(m._=[]),m._.push(n);break}q===l.length-1?(m[s]=m[s]||{_:[]},m[s]._.push(n)):(m[s]=m[s]||{},m=m[s])}}this.engine.execute(a,function(a,c){a?b(c):console.log("ERROR in query callback "+c)}),null!=c&&c()},Callbacks.CallbacksBackend.prototype.stopObservingQuery=function(a){var b=this.queriesInverseMap[a];null!=b&&(delete this.queriesInverseMap[a],delete this.queriesMap[b],this.queriesList=Utils.remove(this.queriesList,b))},Callbacks.CallbacksBackend.prototype._searchQueriesInIndex=function(a,b,c){for(var d=c[1],c=c[0],e=0;e<b.length+1;e++){for(var f=a._||[],g=[],h=0;h<f.length;h++){var i=f[h];Utils.include(this.pendingQueries,i)&&(Utils.remove(this.pendingQueries,i),this.matchedQueries.push(i)),null!=this.queriesMap[i]&&g.push(i)}a._=g;var j=b[e];if(null==a[""+d[j]])break;a=a[""+d[j]]}},Callbacks.CallbacksBackend.prototype.dispatchQueries=function(a){var b,c,d,e,f=this,g={};Utils.repeat(0,this.matchedQueries.length,function(a,h){b=arguments.callee,d=f.matchedQueries[h._i],null==g[d]?(g[d]=!0,c=f.queriesMap[d],e=f.queriesCallbacksMap[d],Utils.recur(function(){f.engine.execute(c,function(c,d){if(c)try{e(d)}catch(f){}a(b,h)})})):a(b,h)},function(b){a()})};var RDFStoreClient={};try{"undefined"==typeof Worker&&(Worker=null)}catch(e){Worker=null}Worker&&(RDFStoreClient.RDFStoreClient=function(a,b,c){console.log("trying to load "+a),Worker.Worker?this.connection=new Worker.Worker(a):this.connection=new Worker(a),this.callbacksCounter=1;var d=this,e=function(a,b){a===!0?c(!0,d):c(!1,b)};this.rdf=RDFJSInterface.rdf,console.log("The worker"),console.log(this.connection);var d=this;this.connection.onmessage=function(a){d.receive(a)},this.observingCallbacks={},this.callbacks={0:{cb:e,fn:"create"}},this.connection.postMessage({fn:"create",args:b,callback:"0"})},RDFStoreClient.RDFStoreClient.prototype.receive=function(a){var b=a.data||a;if("workerRequest:NetworkTransport:load"===b.fn){var c=this,d=b.callback,e=b.arguments.concat(function(a,b){c.connection.postMessage({fn:"workerRequestResponse",results:[a,b],callback:d})});NetworkTransport.load.apply(NetworkTransport,e)}else{var f=this.callbacks[b.callback];f&&("create"===f.fn||"execute"===f.fn||"insert"===f.fn||"graph"==f.fn||"node"===f.fn||"insert"===f.fn||"delete"===f.fn||"clear"===f.fn||"load"===f.fn||"startObservingQueryEndCb"===f.fn||"registeredGraphs"===f.fn?(delete this.callbacks[b.callback],f.cb(b.success,b.result)):"startObservingQuery"===f.fn?f.cb(b.result):"startObservingNode"===f.fn?f.cb(b.result):"subscribe"===f.fn&&f.cb(b.event,b.result))}},RDFStoreClient.RDFStoreClient.prototype.registerCallback=function(a,b){var c=""+this.callbacksCounter;return this.callbacks[c]={fn:a,cb:b},this.callbacksCounter++,c},RDFStoreClient.RDFStoreClient.prototype.execute=function(){if(3===arguments.length)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2]);else if(4===arguments.length)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2],arguments[3]);else{var a,b;1===arguments.length?(a=arguments[0],b=function(){}):2===arguments.length&&(a=arguments[0],b=arguments[1]);var c=this.registerCallback("execute",b);this.connection.postMessage({fn:"execute",args:[a],callback:c})}},RDFStoreClient.RDFStoreClient.prototype.insert=function(){var a,b,c;if(1===arguments.length)b=arguments[0],this.connection.postMessage({fn:"insert",args:[b]});else if(2===arguments.length){b=arguments[0],c=arguments[1]||function(){};var d=this.registerCallback("insert",c);this.connection.postMessage({fn:"insert",args:[b],callback:d})}else{if(3!==arguments.length)throw"The triples to insert, an optional graph and callback must be provided";b=arguments[0],a=arguments[1],c=arguments[2]||function(){};var d=this.registerCallback("insert",c);this.connection.postMessage({fn:"insert",args:[b,a],callback:d})}},RDFStoreClient.RDFStoreClient.prototype.graph=function(){var a=null,b=null;if(1===arguments.length)b=arguments[0]||function(){};else{if(2!==arguments.length)throw"An optional graph URI and a callback function must be provided";b=arguments[1]||function(){},a=arguments[0]}var c=this,d=function(a,d){if(a){for(var e,f=0;f<d.triples.length;f++)e=d.triples[f],d.triples[f]=new RDFJSInterface.Triple(c.adaptJSInterface(e.subject),c.adaptJSInterface(e.predicate),c.adaptJSInterface(e.object));b(a,c.rdf.createGraph(d.triples))}else b(a,d)},e=this.registerCallback("insert",d);null==a?this.connection.postMessage({fn:"graph",args:[],callback:e}):this.connection.postMessage({fn:"graph",args:[a],callback:e})},RDFStoreClient.RDFStoreClient.prototype.node=function(){var a=null,b=null,c=null;if(2===arguments.length)c=arguments[0],b=arguments[1]||function(){};else{if(3!==arguments.length)throw"An optional graph URI and a callback function must be provided";c=arguments[0],a=arguments[1],b=arguments[2]||function(){}}var d=this,e=function(a,c){if(a){for(var e,f=0;f<c.triples.length;f++)e=c.triples[f],c.triples[f]=new RDFJSInterface.Triple(d.adaptJSInterface(e.subject),d.adaptJSInterface(e.predicate),d.adaptJSInterface(e.object));b(a,d.rdf.createGraph(c.triples))}else b(a,c)},f=this.registerCallback("insert",e);null==a?this.connection.postMessage({fn:"node",args:[c],callback:f}):this.connection.postMessage({fn:"node",args:[c,a],callback:f})},RDFStoreClient.RDFStoreClient.prototype.setPrefix=function(a,b){this.rdf.setPrefix(a,b),this.connection.postMessage({fn:"rdf/setPrefix",args:[a,b],callback:null})},RDFStoreClient.RDFStoreClient.prototype.setDefaultPrefix=function(a){this.rdf.setDefaultPrefix(a),this.connection.postMessage({fn:"rdf/setDefaultPrefix",args:[a],callback:null})},RDFStoreClient.RDFStoreClient.prototype["delete"]=function(){var a,b,c;if(1===arguments.length)b=arguments[0],this.connection.postMessage({fn:"delete",args:[b]});else if(2===arguments.length){b=arguments[0],c=arguments[1]||function(){};var d=this.registerCallback("delete",c);this.connection.postMessage({fn:"delete",args:[b],callback:d})}else{if(3!==arguments.length)throw"The triples to delete, an optional graph and callback must be provided";b=arguments[0],a=arguments[1],c=arguments[2]||function(){};var d=this.registerCallback("delete",c);this.connection.postMessage({fn:"delete",args:[b,a],callback:d})}},RDFStoreClient.RDFStoreClient.prototype.clear=function(){var a,b;if(1===arguments.length){b=arguments[0]||function(){};var c=this.registerCallback("clear",b);this.connection.postMessage({fn:"clear",args:[],callback:c})}else{if(2!==arguments.length)throw"The optional graph and a callback must be provided";a=arguments[0],b=arguments[1]||function(){};var c=this.registerCallback("clear",b);this.connection.postMessage({fn:"clear",args:[a],callback:c})}},RDFStoreClient.RDFStoreClient.prototype.setBatchLoadEvents=function(a){this.connection.postMessage({fn:"setBatchLoadEvents",args:[a]})},RDFStoreClient.RDFStoreClient.prototype.registerDefaultNamespace=function(a,b){this.connection.postMessage({fn:"registerDefaultNamespace",args:[a,b]})},RDFStoreClient.RDFStoreClient.prototype.registerDefaultProfileNamespaces=function(){this.connection.postMessage({fn:"registerDefaultProfileNamespaces",args:[]})},RDFStoreClient.RDFStoreClient.prototype.load=function(){var a,b,c,d;if(3===arguments.length){a=arguments[0],b=arguments[1],d=arguments[2]||function(){};var e=this.registerCallback("load",d);this.connection.postMessage({fn:"load",args:[a,b],callback:e})}else if(4===arguments.length){a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3]||function(){};var e=this.registerCallback("load",d);this.connection.postMessage({fn:"load",args:[a,b,c],callback:e})}else if(2===arguments.length)throw"The mediaType of the parser, the data a callback and an optional graph must be provided"},RDFStoreClient.RDFStoreClient.prototype.startObservingQuery=function(){var a=arguments[0],b=arguments[1],c=arguments[2];if(null!=c){var d=this.registerCallback("startObservingQuery",b);this.observingCallbacks[a]=d;var e=this.registerCallback("startObservingQueryEndCb",c);this.connection.postMessage({fn:"startObservingQuery",args:[a],callback:[d,e]})}else{var d=this.registerCallback("startObservingQuery",b);this.observingCallbacks[a]=d,this.connection.postMessage({fn:"startObservingQuery",args:[a],callback:[d]})}},RDFStoreClient.RDFStoreClient.prototype.stopObservingQuery=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a],delete this.callbacks[b],this.connection.postMessage({fn:"stopObservingQuery",args:[a],callback:[]})},RDFStoreClient.RDFStoreClient.prototype.startObservingNode=function(){var a,b,c;if(2===arguments.length){a=arguments[0],c=arguments[1];var d=this,e=function(a){for(var b,e=0;e<a.triples.length;e++)b=a.triples[e],a.triples[e]=new RDFJSInterface.Triple(d.adaptJSInterface(b.subject),d.adaptJSInterface(b.predicate),d.adaptJSInterface(b.object));c(d.rdf.createGraph(a.triples))},f=this.registerCallback("startObservingNode",e);this.observingCallbacks[c]=f,this.connection.postMessage({fn:"startObservingNode",args:[a],callback:f})}else if(3===arguments.length){a=arguments[0],b=arguments[1],c=arguments[2];var d=this,e=function(a){for(var b,e=0;e<a.triples.length;e++)b=a.triples[e],a.triples[e]=new RDFJSInterface.Triple(d.adaptJSInterface(b.subject),d.adaptJSInterface(b.predicate),d.adaptJSInterface(b.object));c(d.rdf.createGraph(a.triples))},f=this.registerCallback("startObservingNode",e);this.observingCallbacks[c]=f,this.connection.postMessage({fn:"startObservingNode",args:[a,b],callback:f})}},RDFStoreClient.RDFStoreClient.prototype.stopObservingNode=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a],delete this.callbacks[b],this.connection.postMessage({fn:"stopObservingNode",args:[b],callback:[]})},RDFStoreClient.RDFStoreClient.prototype.subscribe=function(a,b,c,d,e){var f=this,g=function(a,b){for(var c,d=0;d<b.length;d++)c=b[d],b[d]=new RDFJSInterface.Triple(f.adaptJSInterface(c.subject),f.adaptJSInterface(c.predicate),f.adaptJSInterface(c.object));e(a,b)},h=this.registerCallback("subscribe",g);this.observingCallbacks[e]=h,this.connection.postMessage({fn:"subscribe",args:[a,b,c,d],callback:h})},RDFStoreClient.RDFStoreClient.prototype.unsubscribe=function(a){var b=this.observingCallbacks[a];delete this.observingCallbacks[a],delete this.callbacks[b],this.connection.postMessage({fn:"unsubscribe",args:[b],callback:[]})},RDFStoreClient.RDFStoreClient.prototype.registeredGraphs=function(a){var b=this,c=function(c,d){if(c){for(var e=0;e<d.length;e++){var f=d[e];d[e]=b.adaptJSInterface(f)}a(c,d)}else a(c,d)},d=this.registerCallback("registeredGraphs",c);this.connection.postMessage({fn:"registeredGraphs",args:[],callback:d})},RDFStoreClient.RDFStoreClient.prototype.adaptJSInterface=function(a){return"BlankNode"===a.interfaceName?new RDFJSInterface.BlankNode(a.bnodeId):"Literal"===a.interfaceName?new RDFJSInterface.Literal(a.nominalValue,a.language,a.datatype):"NamedNode"===a.interfaceName?new RDFJSInterface.NamedNode(a.nominalValue):void 0},RDFStoreClient.RDFStoreClient.prototype.isWebWorkerConnection=!0);var Store={},MongodbQueryEngine={MongodbQueryEngine:function(){throw"MongoDB backend not supported in the browser version"}},RDFStoreClient=RDFStoreClient;Store.VERSION="0.8.1",Store.connect=function(){var a,b,c;1==arguments.length?(a=__dirname,b={},c=arguments[0]):2==arguments.length?("string"==typeof arguments[0]?(a=arguments[0],b={}):(a=__dirname+"/index.js",b=arguments[0]),c=arguments[1]):(a=arguments[0],b=arguments[1],c=arguments[2]);try{Worker?new RDFStoreClient.RDFStoreClient(a,b,function(a,b){c(a,b)}):Store.create(b,function(a){c(!1,a)})}catch(d){Store.create(b,function(a){c(!1,a)})}},Store.create=function(){return 1==arguments.length?new Store.Store(arguments[0]):2==arguments.length?new Store.Store(arguments[0],arguments[1]):new Store.Store},Store.Store=function(a,b){var c=null,d=null;if(0==arguments.length)d={};else if(1==arguments.length)d={},c=a;else{if(!(arguments.length>1))throw"An optional argument map and a callback must be provided";d=a,c=b}null==d.treeOrder&&(d.treeOrder=15),this.functionMap={};var e=this;this.customFns={},"mongodb"===d.engine?(this.isMongodb=!0,this.engine=new MongodbQueryEngine.MongodbQueryEngine(d),this.engine.readConfiguration(function(){d.overwrite===!0?e.engine.clean(function(){c(e)}):c(e)})):new Lexicon.Lexicon(function(a){d.overwrite===!0&&a.clear(),new QuadBackend.QuadBackend(d,function(b){d.overwrite===!0&&b.clear(),d.backend=b,d.lexicon=a,e.engine=new QueryEngine.QueryEngine(d),c&&c(e)})},d.name)},Store.Store.prototype.rdf=RDFJSInterface.rdf,Store.Store.prototype.rdf.api=RDFJSInterface,Store.Store.prototype.registerCustomFunction=function(a,b){this.customFns[a]=b,this.engine.setCustomFunctions(this.customFns)},Store.Store.prototype.execute=function(){if(3===arguments.length)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2]);else if(4===arguments.length)this.executeWithEnvironment(arguments[0],arguments[1],arguments[2],arguments[3]);else{var a,b;if(1===arguments.length){a=arguments[0];var b=function(){}}else 2===arguments.length&&(a=arguments[0],b=arguments[1]);this.engine.execute(a,b)}},Store.Store.prototype.executeWithEnvironment=function(){var a,b,c;if(3===arguments.length){a=arguments[0];var d=function(){};b=arguments[1],c=arguments[2]}else if(4===arguments.length){a=arguments[0];var d=arguments[3];b=arguments[1],c=arguments[2]}for(var e=[],f=[],g=0;g<b.length;g++)e.push({token:"uri",value:b[g]});for(var g=0;g<c.length;g++)f.push({token:"uri",value:c[g]});this.engine.execute(a,d,e,f)},Store.Store.prototype.graph=function(){var a=null,b=null;if(1===arguments.length)b=arguments[0]||function(){},a=this.engine.lexicon.defaultGraphUri;else{if(2!==arguments.length)throw"An optional graph URI and a callback function must be provided";b=arguments[1]||function(){},a=arguments[0]}null!=this.rdf.resolve(a)&&(a=this.rdf.resolve(a)),this.engine.execute("CONSTRUCT { ?s ?p ?o } WHERE { GRAPH <"+a+"> { ?s ?p ?o } }",b)},Store.Store.prototype.node=function(){var a=null,b=null,c=null;if(2===arguments.length)c=arguments[0],b=arguments[1]||function(){},a=this.engine.lexicon.defaultGraphUri;else{if(3!==arguments.length)throw"An optional graph URI, node URI and a callback function must be provided";c=arguments[0],a=arguments[1],b=arguments[2]||function(){}}null!=this.rdf.resolve(a)&&(a=this.rdf.resolve(a)),null!=this.rdf.resolve(c)&&(c=this.rdf.resolve(c)),this.engine.execute("CONSTRUCT { <"+c+"> ?p ?o } WHERE { GRAPH <"+a+"> { <"+c+"> ?p ?o } }",b)},Store.Store.prototype.startObservingNode=function(){var a,b,c;2===arguments.length?(a=arguments[0],c=arguments[1],this.engine.callbacksBackend.observeNode(a,c,function(){})):3===arguments.length&&(a=arguments[0],b=arguments[1],c=arguments[2],this.engine.callbacksBackend.observeNode(a,b,c,function(){}))},Store.Store.prototype.stopObservingNode=function(a){this.engine.callbacksBackend.stopObservingNode(a)},Store.Store.prototype.startObservingQuery=function(){var a=arguments[0],b=arguments[1],c=arguments[2];null!=c?this.engine.callbacksBackend.observeQuery(a,b,c):this.engine.callbacksBackend.observeQuery(a,b,function(){})},Store.Store.prototype.stopObservingQuery=function(a){this.engine.callbacksBackend.stopObservingQuery(a)},Store.Store.prototype.subscribe=function(a,b,c,d,e){var f=this,g=function(a,b){for(var c=[],d={blanks:{},outCache:{}},g=[],h=0;h<b.length;h++){var i=b[h],j=RDFJSInterface.buildRDFResource(i.subject,g,f.engine,d),k=RDFJSInterface.buildRDFResource(i.predicate,g,f.engine,d),l=RDFJSInterface.buildRDFResource(i.object,g,f.engine,d);
null!=j&&null!=k&&null!=l&&(i=new RDFJSInterface.Triple(j,k,l),c.push(i))}e(a,c)};this.functionMap[e]=g,this.engine.callbacksBackend.subscribe(a,b,c,d,g,function(){})},Store.Store.prototype.unsubscribe=function(a){var b=this.functionMap[a];this.engine.callbacksBackend.unsubscribe(b),delete this.functionMap[a]},Store.Store.prototype.setPrefix=function(a,b){this.rdf.setPrefix(a,b)},Store.Store.prototype.setDefaultPrefix=function(a){this.rdf.setDefaultPrefix(a)},Store.Store.prototype.insert=function(){var a,b,c;if(1===arguments.length)b=arguments[0],c=function(){};else if(2===arguments.length)b=arguments[0],c=arguments[1]||function(){};else{if(3!==arguments.length)throw"The triples to insert, an optional graph and callback must be provided";b=arguments[0],a=this.rdf.createNamedNode(arguments[1]),c=arguments[2]||function(){}}var d="",e=this;b.forEach(function(a){d=d+e._nodeToQuery(a.subject)+e._nodeToQuery(a.predicate)+e._nodeToQuery(a.object)+"."}),d=null!=a?"INSERT DATA { GRAPH "+this._nodeToQuery(a)+" { "+d+" } }":"INSERT DATA { "+d+" }",this.engine.execute(d,c)},Store.Store.prototype._nodeToQuery=function(a){if("NamedNode"===a.interfaceName){var b=this.rdf.resolve(a.valueOf());return null!=b?"<"+b+">":"<"+a.valueOf()+">"}return a.toString()},Store.Store.prototype["delete"]=function(){var a,b,c;if(1===arguments.length)b=arguments[0],c=function(){};else if(2===arguments.length)b=arguments[0],c=arguments[1]||function(){};else{if(3!==arguments.length)throw"The triples to delete, an optional graph and callback must be provided";b=arguments[0],a=this.rdf.createNamedNode(arguments[1]),c=arguments[2]||function(){}}var d="",e=this;b.forEach(function(a){d=d+e._nodeToQuery(a.subject)+e._nodeToQuery(a.predicate)+e._nodeToQuery(a.object)+"."}),d=null!=a?"DELETE DATA { GRAPH "+this._nodeToQuery(a)+" { "+d+" } }":"DELETE DATA { "+d+" }",this.engine.execute(d,c)},Store.Store.prototype.clear=function(){var a,b;if(0===arguments.length){a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri);var b=function(){}}else if(1===arguments.length)a=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),b=arguments[0]||function(){};else{if(2!==arguments.length)throw"The optional graph and a callback must be provided";a=this.rdf.createNamedNode(arguments[0]),b=arguments[1]||function(){}}var c="CLEAR GRAPH "+this._nodeToQuery(a);this.engine.execute(c,b)},Store.Store.prototype.setBatchLoadEvents=function(a){this.engine.eventsOnBatchLoad=a},Store.Store.prototype.registerDefaultNamespace=function(a,b){this.rdf.prefixes.set(a,b),this.engine.registerDefaultNamespace(a,b)},Store.Store.prototype.registerDefaultProfileNamespaces=function(){var a=this.rdf.prefixes.values();for(var b in a)this.registerDefaultNamespace(b,a[b])},Store.Store.prototype.load=function(){var a,b,c,d,e={};if(3===arguments.length)c=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),a=arguments[0],b=arguments[1],d=arguments[2]||function(){};else if(4===arguments.length)a=arguments[0],b=arguments[1],e=arguments[2],"string"==typeof e?(c=this.rdf.createNamedNode(e),e={}):(c=this.rdf.createNamedNode(e.graph||this.engine.lexicon.defaultGraphUri),delete e.graph),d=arguments[3]||function(){};else if(2===arguments.length)throw"The mediaType of the parser, the data a callback and an optional graph must be provided";if("remote"===a){b=this.rdf.createNamedNode(b);var f="LOAD <"+b.valueOf()+"> INTO GRAPH <"+c.valueOf()+">";this.engine.execute(f,d)}else{var g=this,h=this.engine.rdfLoader.parsers[a];if(!h)return d(!1,0);var i=function(a,b){a?g.engine.batchLoad(b,d):d(a,b)},j=[h,{token:"uri",value:c.valueOf()},b,e,i];b&&"string"==typeof b&&0===b.indexOf("file://")?this.engine.rdfLoader.loadFromFile.apply(null,j):this.engine.rdfLoader.tryToParse.apply(null,j)}},Store.Store.prototype.registerParser=function(a,b){this.engine.rdfLoader.registerParser(a,b)},Store.Store.prototype.registeredGraphs=function(a){if(!this.isMongodb){for(var b=this.engine.lexicon.registeredGraphs(!0),c=[],d=0;d<b.length;d++){var e=b[d],f=new RDFJSInterface.NamedNode(e);c.push(f)}return a(!0,c)}this.engine.registeredGraphs(!0,function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=new RDFJSInterface.NamedNode(e);c.push(f)}return a(!0,c)})},Store.Store.prototype.getNetworkTransport=function(){return NetworkTransport},Store.Store.prototype.setNetworkTransport=function(a){NetworkTransport=a},Store.Store.prototype.close=function(a){null==a&&(a=function(){}),this.engine.close?this.engine.close(a):a()},RDFStoreWorker={},RDFStoreWorker.observingCallbacks={},RDFStoreWorker.workerCallbacksCounter=0,RDFStoreWorker.workerCallbacks={},RDFStoreWorker.registerCallback=function(a){var b=""+RDFStoreWorker.workerCallbacksCounter;return RDFStoreWorker.workerCallbacksCounter++,RDFStoreWorker.workerCallbacks[b]=a,b},RDFStoreWorker.handleCreate=function(a,b){"undefined"!=typeof NetworkTransport&&null!=NetworkTransport&&(NetworkTransport={load:function(a,b,c){var d=RDFStoreWorker.registerCallback(function(a){c.apply(c,a)});postMessage({fn:"workerRequest:NetworkTransport:load",callback:d,arguments:[a,b]})},loadFromFile:function(a,b,c,d){}});var c=[a];c.push(function(a){RDFStoreWorker.store=a,postMessage({callback:b,result:"created",success:!0})}),Store.create.apply(Store,c)},RDFStoreWorker.receive=function(a){var b=a.data||a;if("workerRequestResponse"===b.fn){var c=b.callback,d=RDFStoreWorker.workerCallbacks[c];null!=d&&(delete RDFStoreWorker.workerCallbacks[c],d(b.results))}else if("create"===b.fn&&null!=b.args)RDFStoreWorker.handleCreate(b.args,b.callback);else if("setBatchLoadEvents"===b.fn)RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if("registerDefaultNamespace"===b.fn)RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if("registerDefaultProfileNamespaces"===b.fn)RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args);else if("execute"!==b.fn&&"executeWithEnvironment"!==b.fn&&"graph"!==b.fn&&"node"!==b.fn&&"clear"!==b.fn&&"load"!==b.fn||null==b.args)if("insert"!==b.fn&&"delete"!==b.fn||null==b.args){if("rdf/setPrefix"===b.fn&&null!=b.args)RDFStoreWorker.store.rdf.setPrefix(b.args[0],b.args[1]);else if("rdf/setDefaultPrefix"===b.fn&&null!=b.args)RDFStoreWorker.store.rdf.setDefaultPrefix(b.args[0]);else if("startObservingQuery"===b.fn&&null!=b.args){var e=function(a,c){postMessage({callback:b.callback[0],result:c,success:a})};RDFStoreWorker.observingCallbacks[b.args[0]]=e,b.args.push(e),b.args.push(function(a,c){b.callback&&null!=b.callback[1]&&postMessage({callback:b.callback[1],result:c,success:a})}),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}else if("stopObservingQuery"===b.fn){var e=RDFStoreWorker.observingCallbacks[b.args[0]];e&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[e]),delete RDFStoreWorker.observingCallbacks[b.args[0]]}else if("startObservingNode"===b.fn&&null!=b.args){var e=function(a){postMessage({callback:b.callback,result:a})};RDFStoreWorker.observingCallbacks[b.callback]=e,b.args.push(e),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}else if("stopObservingNode"===b.fn&&null!=b.args){var e=RDFStoreWorker.observingCallbacks[b.args[0]];e&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[e]),delete RDFStoreWorker.observingCallbacks[b.args[0]]}else if("subscribe"===b.fn&&null!=b.args){var e=function(a,c){postMessage({callback:b.callback,event:a,result:c})};RDFStoreWorker.observingCallbacks[b.callback]=e,b.args.push(e),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}else if("stopObservingNode"===b.fn&&null!=b.args){var e=RDFStoreWorker.observingCallbacks[b.args[0]];e&&RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[e]),delete RDFStoreWorker.observingCallbacks[b.args[0]]}else if("registeredGraphs"===b.fn&&null!=b.args){var e=function(a,c){null!=b.callback&&postMessage({callback:b.callback,result:c,success:a})};RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,[e])}}else try{b.args.push(function(a,c){null!=b.callback&&postMessage({callback:b.callback,result:c,success:a})});for(var f,g=b.args[0],h=0;h<g.triples.length;h++)f=g.triples[h],g.triples[h]=new RDFJSInterface.Triple(RDFStoreWorker.adaptJSInterface(f.subject),RDFStoreWorker.adaptJSInterface(f.predicate),RDFStoreWorker.adaptJSInterface(f.object));null!=b.args[1].interfaceName&&(b.args[1]=RDFStoreWorker.adaptJSInterface(b.args[1])),b.args[0]=RDFStoreWorker.store.rdf.createGraph(g.triples),RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}catch(i){console.log("Error executing method through connection"),console.log(i)}else{b.args.push(function(a,c){null!=b.callback&&postMessage({callback:b.callback,result:c,success:a})});try{RDFStoreWorker.store[b.fn].apply(RDFStoreWorker.store,b.args)}catch(i){console.log("Error executing method through connection"),console.log(i)}}},RDFStoreWorker.adaptJSInterface=function(a){return"BlankNode"===a.interfaceName?new RDFJSInterface.BlankNode(a.bnodeId):"Literal"===a.interfaceName?new RDFJSInterface.Literal(a.nominalValue,a.language,a.datatype):"NamedNode"===a.interfaceName?new RDFJSInterface.NamedNode(a.nominalValue):void 0},onmessage=RDFStoreWorker.receive;try{window.rdfstore=Store}catch(e){}}(),window.RDFE||(window.RDFE={}),RDFE.Utils={},RDFE.Utils.createTitle=function(a){if(a){a=a.replace(/_/g," ");var b=a.replace(/^\s*/,"");return b=b.replace(/^[a-z]|[^\sA-Z][A-Z]/g,function(a,b){return 0==b?a.toUpperCase():a.substr(0,1)+" "+a.substr(1).toUpperCase()})}return a},RDFE.Utils.escapeXml=function(a){return a.replace(/[<>&'"]/g,function(a){switch(a){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},RDFE.Utils.trim=function(a,b){if(a){for(b||(b=" ");a.substring(0,1)==b;)a=a.substring(1,a.length);for(;a.substring(a.length-1,a.length)==b;)a=a.substring(0,a.length-1)}return a},RDFE.Utils.namingSchemaLabel=function(a,b,c,d){var e=c===!0?1:0,f=b[a][e];return d===!0?f.toLowerCase():f},RDFE.Utils.uriParams=function(){var a={},b=location.search;if(b.length>1&&(b=b.substring(1)),b)for(var c=b.split("&"),d=0;d<c.length;d++){var e=c[d];if(e){var f=e.indexOf("=");if(-1==f)a[decodeURIComponent(e)]="";else{var g=e.substring(0,f),h=e.substring(f+1);g=decodeURIComponent(g),h=decodeURIComponent(h.replace(/\+/g," "));var i=!1;(i=g.match(/(.*)\[\]$/))?(g=i[1],g in a?a[g].push(h):a[g]=[h]):a[g]=h}}}return a},RDFE.Utils.uri2name=function(a){if(a){var b=a.lastIndexOf("#");if((0>b||-1!==["this","me","i"].indexOf(a.substring(b+1,a.length)))&&(b=a.lastIndexOf("/"),b+1===a.length&&(a=a.substring(0,a.length-1),b=a.lastIndexOf("/"))),b>=0)return a.substring(b+1,a.length);var b=a.lastIndexOf(":");if(b>=0)return a.substring(b+1,a.length)}return a},RDFE.Utils.uriAbbreviate=function(a,b){if(a&&b){if(a.length<=b)return a;var c="",d="...",e=RDFE.Utils.uri2name(a);if(e.length>b-3)return e;if(a=a.substring(0,a.length-e.length),a.match(/http:\/\/.*/))c="http://",a=a.substring(c.length,a.length),a.length<=3?d=a:c+=a.substring(0,b-3-c.length-e.length);else{var f=a.indexOf(":");f>0?f===a.length-1?(c=a,d=""):(c=a.substring(0,f+1),a=a.substring(c.length,a.length),a.length<=3?d=a:c+=a.substring(0,b-3-c.length-e.length)):c+=a.substring(0,b-3-c.length-e.length)}return c+d+e}return a},RDFE.Utils.strAbbreviate=function(a,b){if(a&&b){var c="...";if(a.length<=b||a.length<=c.length+2)return a;b<c.length+2&&(b=c.length+2);var d=a.substring(0,Math.ceil((b-3)/2)),e=a.substr(-(b-d.length-c.length));return d+c+e}return a},RDFE.Utils.getLabel=function(a,b){return a&&a[b]?a[b]:b},RDFE.Utils.getUrlBase=function(a){var b=RDFE.Utils.splitUrl(a);return b.protocol+"//"+b.host},RDFE.Utils.getProtocol=function(a){var b=RDFE.Utils.splitUrl(a);return b.protocol},RDFE.Utils.splitUrl=function(a){var b=document.createElement("a");return b.href=a,{protocol:b.protocol,host:b.host,hostname:b.hostname,path:b.pathname,port:b.port,search:b.search}},RDFE.Utils.resolveStorageLocations=function(a,b){function c(e){if(e>=a.length)return void b(d);var f=a[e].uri,g=a[e].sparqlEndpoint;if(g){var h=new RDFE.IO.Folder(g);h.ioType="sparql",h.sparqlEndpoint=g;var i=new RDFE.IO.File(f);return i.parent=h,i.ioType="sparql",i.sparqlEndpoint=g,h.children.push(i),d.push(h),void c(e+1)}RDFE.IO.openUrl(f,{checkForFiles:!0},function(a){d.push(a),c(e+1)},function(a,b){var g=new RDFE.IO.File(f);g.errorMessage=a,g.httpStatus=b,d.push(g),c(e+1)})}var d=[];c(0)},RDFE.Utils.extractDomain=function(a){var b;return b=a.indexOf("://")>-1?a.split("/")[2]:a.split("/")[0],b=b.split(":")[0]},rdfstore.Store.prototype.uriToCuri=function(a){var b=node.toString();for(prefix in this.rdf.prefixes){var c=this.rdf.prefixes[prefix];if(c.length>0&&b.startsWith(c))return b.replace(c,prefix+":")}return null},rdfstore.Store.prototype.curiToUri=function(a){return this.rdf.resolve(a)},rdfstore.Store.prototype.parseLiteral=function(a){var b=a.lastIndexOf("@");if(-1!=b&&'"'===a[b-1]&&null!=a.substring(b,a.length).match(/^@[a-zA-Z\-]+$/g)){var c=a.substring(1,b-1),d=a.substring(b+1,a.length);return{token:"literal",value:c,lang:d}}var b=a.lastIndexOf("^^");if(-1!=b&&'"'===a[b-1]&&"<"===a[b+2]&&">"===a[a.length-1]){var c=a.substring(1,b-1),e=a.substring(b+3,a.length-1);return{token:"literal",value:c,type:e}}var c=a.substring(1,a.length-1);return{token:"literal",value:c}},rdfstore.Store.prototype.termToNode=function(a){return"literal"==a.token?this.rdf.createLiteral(a.value,a.lang,a.type):"uri"==a.token?this.rdf.createNamedNode(a.value):this.rdf.createNamedNode(a.value)},rdfstore.Store.prototype.rdf.api.RDFNode.prototype.localeCompare=function(a,b,c){return this.toString().localeCompare(a.toString(),b,c)},rdfstore.Store.prototype.loadTurtle=function(a,b,c,d){var e=this,f=N3.Parser();"function"==typeof c&&(d=c,c=b);var g={},h=function(a){if(a){if(N3.Util.isLiteral(a)){var b=N3.Util.getLiteralLanguage(a);return""==b&&(b=null),e.rdf.createLiteral(N3.Util.getLiteralValue(a),b,N3.Util.getLiteralType(a))}if(N3.Util.isBlank(a)){var d=g[a];return d||(d=e.rdf.createBlankNode(),g[a]=d),d}return e.rdf.createNamedNode(a)}return e.rdf.createNamedNode(c)},i=function(a){return e.rdf.createTriple(h(a.subject),h(a.predicate),h(a.object))},j=function(a){if(a.length)try{e.insert(e.rdf.createGraph(a),b,function(a,b){a||d&&d(!1,"Failed to add new triple to store: "+b.toString())})}catch(c){d&&d(!1,"Failed to add new triple to store: "+c.toString())}},k=0,l=[];f.parse(a,function(a,c,f){if(a&&d&&d(!1,a),null==c)j(l),d&&d(!0,k);else{var g=i(c);"BlankNode"==g.subject.interfaceName||"BlankNode"==g.object.interfaceName?l.push(g):e.insert(e.rdf.createGraph([g]),b,function(){}),k++}})},String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})},function(a){window.RDFE||(window.RDFE={}),RDFE.IO={},a.ajaxSetup({cache:!1}),RDFE.IO.createIO=function(a,b){var c="sparql",d={};if("string"==typeof a?(c=a,d=b):"object"==typeof a&&(d=a,d.type&&(c=d.type)),"sparql"===c)return new RDFE.IO.SPARQL(d);if("gsp"===c)return new RDFE.IO.GSP(d);if("ldp"===c||"webdav"===c||"dav"===c)return new RDFE.IO.LDP(d);if("http"===c)return new RDFE.IO.HTTP(d);throw"Unsupport IO type: "+c};var b=function(b,c){return a.extend({},c,b)},c=function(){},d=function(a,b){a.clear(b,c)};RDFE.IO.Base=function(){var b=function(){};return b.inherit=function(a){var b=function(){};return b.prototype=this.prototype,a.prototype=new b,a.prototype.constructor=a,a["super"]=this,a},b.prototype.baseExec=function(b,c){var d=this;return a(document).ajaxError(c.ajaxError),a(document).ajaxSuccess(c.ajaxSuccess),b.headers=b.headers||{},c.username&&(b.headers.Authorization="Basic "+btoa(c.username+":"+c.password),b=a.extend({withCredentials:!0},b)),c.authFunction&&RDFE.Utils.getUrlBase(b.url)===RDFE.Utils.getUrlBase(window.location.href)&&(b.headers["X-Requested-With"]="XMLHttpRequest"),b=a.extend({crossDomain:!0},b),d.options.ioTimeout&&(b=a.extend({timeout:d.options.ioTimeout},b)),RDFE.Utils.getProtocol(b.url)!==document.location.protocol&&"https:"===document.location.protocol?void(c&&c.error&&c.error({httpCode:"",message:"Mixed Content Error: This request has been blocked; the content must be served over HTTPS"})):void a.ajax(b).done(function(a,b,d){c&&c.success&&c.success(a,b,d)}).fail(function(a,e,f){if(c&&c.error){var g={httpCode:a.status,message:a.statusText};if(this.crossDomain&&"error"===g.message&&RDFE.Utils.extractDomain(this.url)!==window.location.hostname&&(g.message="The document failed to load - this could be related to missing CORS settings on the server."),401!==a.status&&403!==a.status||!c.authFunction)if("timeout"===e){var g={httpCode:e,message:"Failed to load document because of timeout"};c.error(g,a,e,f)}else c.error(g,a,e,f);else c.authFunction(b.url,function(a){c.username=a.username,c.password=a.password,d.baseExec(b,c)},function(){g="Error: "+a.status+" ("+a.statusText+")",c.error(g,a,e,f)})}})},b}(),RDFE.IO.SPARQL=function(){var c=RDFE.IO.Base.inherit(function(b){var c=this;c.constructor["super"].call(this);var d={sparqlEndpoint:window.location.protocol+"//"+window.location.host+"/sparql"};c.options=a.extend({},d,b),c.options.sparqlEndpoint&&0!==c.options.sparqlEndpoint.length||(c.options.sparqlEndpoint=d.sparqlEndpoint)}),e="CONSTRUCT {?s ?p ?o} WHERE {GRAPH <{0}> {?s ?p ?o}}",f="INSERT DATA {GRAPH <{0}> { {1}}}",g="<{0}> <{1}> {2}",h="DELETE DATA {GRAPH <{0}> { <{1}> <{2}> {3} . }}",i="CLEAR GRAPH <{0}>";return c.prototype.retrieve=function(a,c,d){var f=this;c=b(c,f.options),d&&(c.ajaxError=null,c.ajaxSuccess=null),f.exec(e.format(a),c)},c.prototype.retrieveToStore=function(a,c,e,f){var g=this;f=b(f,g.options);var h=function(b,g,h){d(c,e),c.loadTurtle(b,e,a,function(a,c){a&&f.__success?f.__success(b,g,h):!a&&f.error&&f.error(c)})};f.__success=f.success,f.success=h,g.retrieve(a,f,!0)},c.prototype.insert=function(a,c,d,e,h){var i=this;h=b(h,i.options),i.exec(f.format(a,g.format(c,d,e)),h)},c.prototype.insertFromStore=function(c,d,e,h){var i=this;h=b(h,i.options),d.graph(e,function(b,d){if(!b)return void(h.error&&h.error(d));var e=function(b,e){var j=h.chunkSize||400,k=function(b){if(b>=d.length)h.success=h.__success,h.__success=null,h.success();else{for(var e="",l="\n",m=b;b+j>m&&m<d.length;m+=1)e+=l+g.format(d.toArray()[m].subject,d.toArray()[m].predicate,d.toArray()[m].object.toNT()),l=" .\n";h.success=function(){k(b+j)},i.exec(f.format(c,e),a.extend({method:"POST"},h))}};k(0)};h.__success=h.success,h.success=e,i.clear(c,h)})},c.prototype["delete"]=function(a,c,d,e,f){var g=this;f=b(f,g.options),g.exec(h.format(a,c,d,e),f)},c.prototype.clear=function(a,c,d){var e=this;c=b(c,e.options),d&&(c.ajaxError=null,c.ajaxSuccess=null),e.exec(i.format(a),c)},c.prototype.exec=function(a,b){var c=this,d={url:b.sparqlEndpoint,type:b.method||"GET",data:{query:a,format:b.format},dataType:"text"};return c.baseExec(d,b)},c}(),RDFE.IO.GSP=function(){var c=RDFE.IO.Base.inherit(function(b){console.log("GSP");var c=this;c.constructor["super"].call(this);var d={contentType:"application/octet-stream",processData:!1,gspEndpoint:window.location.protocol+"//"+window.location.host+"/sparql-graph-crud"};c.options=a.extend({},d,b),c.options.gspEndpoint&&0!==c.options.gspEndpoint.length||(c.options.gspEndpoint=d.gspEndpoint)});return c.prototype.retrieve=function(a,c,d){var e=this;c=b(c,e.options),d&&(c.ajaxError=null,c.ajaxSuccess=null),this.exec("GET",a,null,c)},c.prototype.retrieveToStore=function(a,c,e,f){var g=this;f=b(f,g.options);var h=function(b,g,h){d(c,e),c.loadTurtle(b,e,a,function(a,c){a&&f.__success?f.__success(b,g,h):!a&&f.error&&f.error(c)})};f.__success=f.success,f.success=h,this.retrieve(a,f,!0)},c.prototype.insert=function(a,c,d){d=b(d,this.options),this.exec("PUT",a,c,d)},c.prototype.insertFromStore=function(a,c,d,e){var f=this;e=b(e,f.options),c.graph(d,function(b,c){if(!b)return void(e.error&&e.error(c));var d=function(b,d){e.success=e.__success,f.insert(a,c.toNT(),e)};e.__success=e.success,e.success=d,f.clear(a,e,!0)})},c.prototype.update=function(a,c,d){var e=this;d=b(d,e.options),e.exec("POST",a,c,d)},c.prototype["delete"]=function(a,c,d){var e=this;c=b(c,e.options),d&&(c.ajaxError=null,c.ajaxSuccess=null),e.exec("DELETE",a,null,c)},c.prototype.clear=c.prototype["delete"],c.prototype.exec=function(a,b,c,d){var e=this,f=d.gspEndpoint+"?graph="+encodeURIComponent(b),g={url:f,type:a,contentType:d.contentType,processData:d.processData,data:c,dataType:"text"};return e.baseExec(g,d)},c}(),RDFE.IO.LDP=function(){var c=RDFE.IO.Base.inherit(function(b){var c=this;c.constructor["super"].call(this);var d={dataType:"text"};c.options=a.extend({},d,b)}),e="INSERT DATA {GRAPH <{0}> { <{1}> <{2}> {3} . }}";return c.prototype.retrieve=function(a,c,d){c=b(c,this.options),d&&(c.ajaxError=null,c.ajaxSuccess=null);var e={};"webdav"!=this.type&&(e={Accept:"text/turtle, */*;q=0.1"}),this.exec("GET",a,e,null,c)},c.prototype.retrieveToStore=function(a,c,e,f){f=b(f,this.options);var g=function(b,g,h){d(c,e),c.loadTurtle(b,e,a,function(a,c){a&&f.__success?f.__success(b,g,h):!a&&f.error&&f.error(c)})};f.__success=f.success,f.success=g,this.retrieve(a,f,!0)},c.prototype.insert=function(a,c,d){d=b(d,this.options);var e,f;"webdav"!==this.type?(f="PUT",e={"Content-Type":"text/turtle"}):f="PUT",this.exec(f,a,e,c,d)},c.prototype.insertFromStore=function(a,c,d,e){var f=this;e=b(e,f.options),c.graph(d,function(b,c){if(!b)return void(e.error&&e.error(c));var d=c.toNT();f.insert(a,d,e)})},c.prototype.update=function(a,c,d,f,g){var h=this;g=b(g,h.options);var i=q.format(e,c,d,f),j={"Content-Type":"application/sparql-update"};h.exec("PATCH",a,j,i,g)},c.prototype["delete"]=function(a,c){var d=this;c=b(c,d.options),d.exec("DELETE",a,null,null,c)},c.prototype.clear=c.prototype["delete"],c.prototype.exec=function(a,b,c,d,e){var f=this,g={url:b,type:a,headers:c,contentType:"text/turtle",processData:!1,data:d,dataType:e.dataType};return f.baseExec(g,e)},c}(),RDFE.IO.HTTP=function(){var b=RDFE.IO.Base.inherit(function(b){var c=this;c.constructor["super"].call(this);var d={dataType:"text",httpTemplate:"{0}",httpProxyTemplate:document.location.protocol+"//"+document.location.host+"/proxy?url={0}&output-format=turtle&force=rdf"};c.options=a.extend({},d,b),c.options.httpTemplate&&0!==c.options.httpTemplate.length||(c.options.httpTemplate=d.httpTemplate),c.options.httpProxyTemplate&&0!==c.options.httpProxyTemplate.length||(c.options.httpProxyTemplate=d.httpProxyTemplate)});return b.prototype.retrieve=function(a,b){var c=this;b.__success=b.success,b.success=function(a,c,d){b&&b.__success&&b.__success(a,c,d)};var d=b.proxy?c.options.httpProxyTemplate.format(encodeURIComponent(a)):c.options.httpTemplate.format(a),e=b&&b.acceptType?b.acceptType:"text/n3; q=1, text/turtle; q=0.8, application/rdf+xml; q=0.6",f={url:d,type:"GET",dataType:"text",beforeSend:function(a){a.setRequestHeader("Accept",e)}};return c.baseExec(f,b)},b.prototype.retrieveToStore=function(a,b,c,d){var e=this;d.__success=d.success,d.success=function(a,d){return function(e,f,g){var h=(g.getResponseHeader("content-type")||"").split(";")[0],i=function(a,b){return a?void(d&&d.__success&&d.__success(e,f,g)):void console.error("URI load error =>",c,b)};h.indexOf("turtle")>0||0===h.length?b.loadTurtle(e,a,i):b.load(h,e,a,i)}}(c,d);var f=d.proxy?e.options.httpProxyTemplate.format(encodeURIComponent(a)):e.options.httpTemplate.format(a),g=d&&d.acceptType?d.acceptType:"text/n3; q=1, text/turtle; q=0.8, application/rdf+xml; q=0.6",h={url:f,type:"GET",dataType:"text",beforeSend:function(a){a.setRequestHeader("Accept",g)}};return e.baseExec(h,d)},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.IO||(RDFE.IO={}),RDFE.IO.Resource=function(){var a=function(a){this.url=a||"",a&&(this.path=decodeURIComponent(RDFE.Utils.splitUrl(a).path),this.host=RDFE.Utils.splitUrl(a).host,this.name=this.path.match(/([^\/]+)\/?$/),this.name&&this.name.length>1?this.name=this.name[1]:this.name=this.url),this.options={}};return a.inherit=function(a){var b=function(){};return b.prototype=this.prototype,a.prototype=new b,a.prototype.constructor=a,a["super"]=this,a.inherit=this.inherit,a},a.prototype.isFolder=function(){return"folder"===this.type},a.prototype.isFile=function(){return"file"===this.type},a.prototype.getOption=function(a){return this.options[a]?this.options[a]:this.parent?this.parent.getOption(a):void 0},a.prototype.standardAjaxHeaders=function(a){var b=this.getOption("username");return a=a||{},b&&(a.Authorization="Basic "+btoa(b+":"+this.getOption("password"))),a},a}(),RDFE.IO.File=function(){var b=RDFE.IO.Resource.inherit(function(b,c){var d=this;d.constructor["super"].call(this,b),d.type="file",d.dirty=!0;var e={};d.options=a.extend({},e,c)});return b}(),RDFE.IO.Folder=function(){var b=RDFE.IO.Resource.inherit(function(b,c){var d=this;RDFE.IO.Resource.call(this,b),d.type="folder",d.dirty=!0,d.url.length>0&&"/"!=d.url.substring(d.url.length-1)&&(d.url+="/"),d.rootUrl=d.url,d.children=[];var e={};d.options=a.extend({},e,c)});b.prototype.update=function(b,c,d){var e=this,f=b,g=c,h=d;"function"==typeof f&&(h=g,g=f,f=!1),f||this.dirty?this.listDir(function(){a(e.children).each(function(){this.rootUrl=e.rootUrl,this.parent=e}),e.dirty=!1,g&&g(e)},function(a,b){401!==b&&403!==b||!e.options.authFunction?h&&h(e,a,b):e.options.authFunction(e.url,function(a){e.options.username=a.username,e.options.password=a.password,e.update(f,g,h)},function(){h&&h(e,a,b)})}):g(e)},b.prototype.listDir=function(a){a()};var c={sort:"name",foldersFirst:!0,sortOrder:"asc"};return b.prototype.getChildren=function(b){for(var d=a.extend({},c,b),e=[],f=[],g=0;g<this.children.length;g++)"folder"!==d.type&&"file"===this.children[g].type||"file"!==d.type&&!d.foldersFirst?e.push(this.children[g]):"file"!==d.type&&f.push(this.children[g]);var h="desc"===d.sortOrder.toLowerCase(),i=function(a,b){return h?a[d.sort]>b[d.sort]:a[d.sort]<b[d.sort]};return d.sort&&(e.sort(i),f.sort(i)),a.merge(f,e)},b}(),RDFE.IO.WebDavFolder=function(){function b(b,c){for(var d=RDFE.Utils.getUrlBase(b),e=[],f=!1,g=function(a,b){for(var c=[],d=a.getElementsByTagName("*"),e=0;e<d.length;e++)(d[e].localName===b||d[e].baseName===b)&&c.push(d[e]);return c},h=function(b,c){var d=g(b,c);return d.length?a(d[0]).text():null},i=g(c,"response"),j=0;j<i.length;j++){var k=null,l=i[j],m=g(l,"href");if(m.length){var n=d+a(m[0]).text();if(n!==b){var o=g(l,"propstat");if(!o.length)continue;var p=g(o[0],"prop");if(!p.length)continue;if(g(p[0],"collection").length)k=new RDFE.IO.WebDavFolder(n);else{k=new RDFE.IO.File(n);var q=h(p[0],"getcontentlength");q&&(k.size=parseInt(a(q[0]).text())),k.dirty=!1,k.ioType="dav"}var r=h(p[0],"creationdate");r&&(k.creationDate=new Date(r)),r=h(p[0],"getlastmodified"),r&&(k.modificationDate=new Date(r)),r=h(p[0],"virtpermissions"),r&&(k.permissions=r),r=h(p[0],"virtowneruid"),r&&(k.uid=r),r=h(p[0],"virtownergid"),r&&(k.gid=r),r=h(p[0],"getcontenttype"),r&&(k.contentType=r),e.push(k)}else f=!0}}return 0!==e.length||f?e:null}var c=RDFE.IO.Folder.inherit(function(b,c){var d=this;d.constructor["super"].call(this,b);var e={};d.ioType="webdav",d.options=a.extend({},e,c)});return c.prototype.listDir=function(c,d){var e=this,f='<?xml version="1.0" encoding="utf-8" ?><propfind xmlns="DAV:">  <prop>    <creationdate />    <getlastmodified />    <href />    <resourcetype />    <getcontentlength />    <getcontenttype />    <virtpermissions xmlns="http://www.openlinksw.com/virtuoso/webdav/1.0/" />    <virtowneruid xmlns="http://www.openlinksw.com/virtuoso/webdav/1.0/" />    <virtownergid xmlns="http://www.openlinksw.com/virtuoso/webdav/1.0/" />  </prop></propfind>',g=function(a){e.children=b(e.url,a),e.children?c():d('Failed to parse WebDAV result for "'+e.url+'".',200)};a.ajax({url:this.url,method:"PROPFIND",contentType:"text/xml",data:f,dataType:"xml",headers:this.standardAjaxHeaders()}).done(g).fail(function(a){d(RDFE.IO.ajaxFailMessage(a,'Failed to list WebDAV folder for "{0}"',e.url),a.status)})},c}(),RDFE.IO.LDPFolder=function(){function b(a,b,c,d){a.registerDefaultNamespace("rdfs","http://www.w3.org/2000/01/rdf-schema#"),a.registerDefaultNamespace("posix","http://www.w3.org/ns/posix/stat#"),a.registerDefaultNamespace("ldp","http://www.w3.org/ns/ldp#");var e=[];a.execute(" select distinct ?s ?size ?mtime    from <urn:default>    where {            ?s a ?t .            FILTER(?t in (posix:File, rdfs:Resource, ldp:Resource)) .            optional { ?s posix:size ?size . } .            optional { ?s posix:mtime ?mtime . }          }",function(f,g){if(!f)return void d("Failed to query LDP the container at "+b+".");for(var h=0;h<g.length;h++){var i=g[h].s.value;i.startsWith("http")||(i=b+i);var j=new RDFE.IO.File(i);g[h].mtime&&(j.modificationDate=new Date(1e3*g[h].mtime.value)),g[h].size&&(j.size=g[h].size.value),j.dirty=!1,j.ioType="ldp",e.push(j)}a.execute(" select distinct ?s ?mtime ?contains   from <urn:default>    where {            ?s a ?t .            FILTER(?t in (posix:Directory, ldp:Container, ldp:BasicContainer)) .            optional { ?s posix:mtime ?mtime }            optional { ?s ldp:contains ?contains }          }",function(a,f){if(!a)return void d("Failed to query LDP the container at "+b+".");for(var g=0;g<f.length;g++)if(!f[g].contains){var h=f[g].s.value;if(h.startsWith("http")||(h=b+h),h!=b){var i=new RDFE.IO.LDPFolder(h);f[g].mtime&&(i.modificationDate=new Date(1e3*f[g].mtime.value)),e.push(i)}}c(e)})})}var c=RDFE.IO.Folder.inherit(function(b,c){var d=this;d.constructor["super"].call(this,b),d.ioType="ldp";var e={};d.options=a.extend({},e,c)});return c.prototype.listDir=function(c,d){var e=this;a.ajax({url:e.url,headers:e.standardAjaxHeaders({Accept:"text/turtle"})}).done(function(a,f,g){var h=!1,i=g.getResponseHeader("Link");if(i)for(var j=i.split(","),k=0;k<j.length;k++)if(j[k].replace(/ /g,"").toLowerCase().indexOf('rel="type"')>=0&&j[k].indexOf("http://www.w3.org/ns/ldp#BasicContainer")>=0){h=!0;break}if(h)if(g.getResponseHeader("Content-Type").indexOf("turtle")<0)d("The LDP container at "+e.url+" does not return Turtle content.");else{var l=rdfstore.create();l.load("text/turtle",a,"urn:default",function(){b(l,e.url,function(a){e.children=a,c&&c()},d)})}else d("Only LDP Basic containers are supported at the moment.")}).fail(function(a){d&&d(RDFE.IO.ajaxFailMessage(a,'Failed to fetch Turtle content from "{0}"',e.url),a.status)})},c}(),RDFE.IO.openUrl=function(b,c,d,e){var f=d,g=e,h=c;"function"==typeof c&&(g=f,f=h,h=void 0);var i=new RDFE.IO.LDPFolder(b,h);i.update(function(){f(i)},function(c,d,e){if(401===e||403===e)g(d,e);else{var j=new RDFE.IO.WebDavFolder(b,i.options);j.update(function(){f(j)},function(c,d,e){h&&h.checkForFiles?a.ajax({url:b,headers:c.standardAjaxHeaders()}).done(function(a,d,e){var g=new RDFE.IO.File(b,c.options);g.content=a,g.contentType=e.getResponseHeader("Content-Type"),g.size=parseInt(e.getResponseHeader("Content-Length")),g.dirty=!1,g.ioType="http",f(g)}).fail(function(a){g&&g(RDFE.IO.ajaxFailMessage(a,'Failed to get "{0}"',b),a.status)}):g&&g(d,e)})}})},RDFE.IO.ajaxFailMessage=function(a,b,c){return(a.statusText="error")&&RDFE.Utils.extractDomain(c)!==window.location.hostname?b.format(c)+" - this could be related to missing CORS settings on the server.":b.format(c)+"."}}(jQuery),window.RDFE||(window.RDFE={}),RDFE.Config=function(a,b,c){var d=this;this.options=RDFE.Config.defaults,a&&$.ajax({url:a,type:"GET",dataType:"json",success:function(a){return function(b){d.options=$.extend(d.options,b),d.options.ontology=$.extend(RDFE.Config.defaults.ontology,b.ontology),d.options.labelProps&&0!=d.options.labelProps.length||(d.options.labelProps=RDFE.Config.defaults.labelProps),a&&a(d)}}(b),error:function(a,b,d){console.error("config load =>",d),c&&c()}})},RDFE.Config.defaults={ontology:{proxy:!1,nonTTLProxy:!0,fresnelLenses:!0,fresnelFormats:!0,fresnelGroups:!0,forceLoad:!1,preloadOnly:!1},bookmarks:[],actions:["new","open","save","saveAs","bookmarks","entities","triples"],labelProps:["http://www.w3.org/2004/02/skos/core#prefLabel","http://www.w3.org/2000/01/rdf-schema#"],
defaultView:"entities",sparqlEndpoint:window.location.protocol+"//"+window.location.host+"/sparql",gspEndpoint:window.location.protocol+"//"+window.location.host+"/sparql-graph-crud",prefixes:{},entityUriTmpl:"{DOC-URI}#{NAME}",autoInverseOfHandling:!1,entityTypesFiler:null,namingSchema:"eavSchema",eavSchema:{spo:["Statement","Statements"],s:["Entity","Entities"],p:["Attribute","Attributes"],o:["Value","Values"]},spoSchema:{spo:["Triple","Triples"],s:["Subject","Subjects"],p:["Predicate","Predicates"],o:["Object","Objects"]},useEntityEditor:!1,maxLabelLength:0},window.RDFE||(window.RDFE={}),RDFE.RdfNode=function(a,b,c,d){this.type=a,this.value=b,this.datatype=c,this.language=d},RDFE.RdfNode.prototype.toStoreNode=function(a){return"uri"==this.type?a.rdf.createNamedNode(this.value):a.rdf.createLiteral(this.value,this.language,this.datatype)},RDFE.RdfNode.prototype.toString=function(){return this.value},RDFE.RdfNode.fromStoreNode=function(a){if("string"==typeof a)return new RDFE.RdfNode("uri",a);if(a instanceof RDFE.RdfNode)return a;if(a.token)return new RDFE.RdfNode(a.token,a.value,a.type,a.lang);if(a.interfaceName){var b;if("NamedNode"===a.interfaceName)b="uri";else{if("Literal"!==a.interfaceName)throw"Blank nodes cannot be converted into RDFE.RdfNode values.";b="literal"}return new RDFE.RdfNode(b,a.nominalValue,a.datatype,a.language)}if(a.uri)return new RDFE.RdfNode("uri",a.uri);throw"Unsupported node type for RDFE.RdfNode conversion."},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0==this.indexOf(a)}),window.RDFE||(window.RDFE={}),RDFE.prefixes={},RDFE.prefixes.annotation="http://www.w3.org/2000/10/annotation-ns#",RDFE.prefixes.atom="http://atomowl.org/ontologies/atomrdf#",RDFE.prefixes.bibo="http://purl.org/ontology/bibo/",RDFE.prefixes.book="http://purl.org/NET/book/vocab#",RDFE.prefixes.cc="http://web.resource.org/cc/",RDFE.prefixes.dataview="http://www.w3.org/2003/g/data-view#",RDFE.prefixes.dc="http://purl.org/dc/elements/1.1/",RDFE.prefixes.dcterms="http://purl.org/dc/terms/",RDFE.prefixes.foaf="http://xmlns.com/foaf/0.1/",RDFE.prefixes.fresnel="http://www.w3.org/2004/09/fresnel#",RDFE.prefixes.geo="http://www.w3.org/2003/01/geo/wgs84_pos#",RDFE.prefixes.gr="http://purl.org/goodrelations/v1#",RDFE.prefixes.ibis="http://purl.org/ibis#",RDFE.prefixes.ical="http://www.w3.org/2002/12/cal/icaltzd#",RDFE.prefixes.like="http://ontologi.es/like#",RDFE.prefixes.mo="http://purl.org/ontology/mo/",RDFE.prefixes.owl="http://www.w3.org/2002/07/owl#",RDFE.prefixes.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFE.prefixes.rdfs="http://www.w3.org/2000/01/rdf-schema#",RDFE.prefixes.rev="http://purl.org/stuff/rev#",RDFE.prefixes.rss="http://purl.org/rss/1.0/",RDFE.prefixes.schema="http://schema.org/",RDFE.prefixes.scot="http://scot-project.org/scot/ns",RDFE.prefixes.sioc="http://rdfs.org/sioc/ns#",RDFE.prefixes.sioct="http://rdfs.org/sioc/types#",RDFE.prefixes.skos="http://www.w3.org/2004/02/skos/core#",RDFE.prefixes["void"]="http://rdfs.org/ns/void#",RDFE.prefixes.vs="http://www.w3.org/2003/06/sw-vocab-status/ns#",RDFE.prefixes.wot="http://xmlns.com/wot/0.1/",RDFE.prefixes.xhtml="http://www.w3.org/1999/xhtml",RDFE.prefixes.xsd="http://www.w3.org/2001/XMLSchema#",RDFE.coalesce=function(){for(i=0;i<arguments.length;i++)if("undefined"!=typeof arguments[i]&&null!==arguments[i])return arguments[i]},RDFE.uriPrefix=function(a){var b=Math.max(a.lastIndexOf(":"),a.lastIndexOf("/"),a.lastIndexOf("#"));return-1!=b&&b==a.lastIndexOf(":")?a.substring(0,b):null},RDFE.uriLabel=function(a){var b=Math.max(a.lastIndexOf(":"),a.lastIndexOf("/"),a.lastIndexOf("#"));return-1==b?a:b!=a.length-1?a.substring(b+1):null},RDFE.isUriPrefix=function(a){return-1==Math.max(a.lastIndexOf(":"),a.lastIndexOf("/"),a.lastIndexOf("#"))},RDFE.uriOntology=function(a){if(!a)return null;var b=Math.max(a.lastIndexOf(":"),a.lastIndexOf("/"),a.lastIndexOf("#"));return-1!=b?a.substring(0,b+1):null},RDFE.isBlankNode=function(a){return _.isString(a)?a.match(/^\_\:*/)?!0:!1:_.isObject(a)&&a.URI?RDFE.isBlankNode(a.URI):!1},RDFE.ontologyByPrefix=function(a){var b="http://prefix.cc/{0}.file.json".format(a);return $.ajax({url:b,type:"GET",async:!1}).done(function(b){RDFE.prefixes[a]=b[a]}),RDFE.prefixes[a]},RDFE.OntologyManager=function(a){this.config=a||{},this.options=$.extend(RDFE.Config.defaults.ontology,this.config.ontology),this.reset(),this.prefixes=$.extend({},RDFE.prefixes,this.config.prefixes)},RDFE.OntologyManager.prototype.init=function(a){var b=this;this.reset();var a=$.extend({},a),c=b.options.preloadOntologies||[],d=function(a,e){if(a<c.length){var f=c[a],g=function(c,e){return function(){$(b).trigger(e,[b,f]),d(a+1,c)}},h={success:g(e,"loadingFinished"),error:g(e,"loadingFailed")};$(b).trigger("loading",[b,f]),b.parseOntologyFile(f,h)}else e.success&&e.success()};d(0,a)},RDFE.OntologyManager.prototype.reset=function(a){this.ontologies={},this.ontologyClasses={},this.ontologyProperties={},this.individuals={},this.fresnelLenses={}},RDFE.OntologyManager.prototype.prefixByOntology=function(a){for(prefix in this.prefixes)if(this.prefixes[prefix]==a)return prefix;return null},RDFE.OntologyManager.prototype.uriDenormalize=function(a){var b=RDFE.uriPrefix(a);return b&&(this.prefixes[b]||RDFE.ontologyByPrefix(b),this.prefixes[b])?this.prefixes[b]+a.substring(b.length+1):a},RDFE.OntologyManager.prototype.uriNormalize=function(a,b){var c=RDFE.uriOntology(a);if(c)for(var d in this.prefixes)if(this.prefixes[d]==c)return d+":"+a.substring(c.length);return b},RDFE.OntologyManager.prototype.ontologiesAsArray=function(){return _.values(this.ontologies)},RDFE.OntologyManager.prototype.ontologyByURI=function(a,b){var c=this.ontologies[a];return c||b!==!0||(this.ontologies[a]=c=new RDFE.Ontology(this,a)),c},RDFE.OntologyManager.prototype.ontologyByPrefix=function(a){return this.ontologies[this.prefixes[a]]},RDFE.OntologyManager.prototype.ontologyRemove=function(a){var b=this.ontologyByURI(a);if(b){delete this.ontologies[a];for(var c=b.classesAsArray(),d=0;d<c.length;d++)this.ontologyClassRemove(c[d].URI);for(var e=b.allProperties(),d=0;d<e.length;d++)this.ontologyPropertyRemove(e[d].URI);$(this).trigger("changed",[this])}},RDFE.OntologyManager.prototype.ontologyClassRemove=function(a){delete this.ontologyClasses[a]},RDFE.OntologyManager.prototype.ontologyPropertyRemove=function(a){delete this.ontologyProperties[a]},RDFE.OntologyManager.prototype.ontologyClassByURI=function(a,b){var c=this.ontologyClasses[a];return c||b!==!0||(this.ontologyClasses[a]=c=new RDFE.OntologyClass(this,a),c.ontology=this.ontologyByURI(RDFE.uriOntology(a),!0),c.ontology.classes[a]=c),c},RDFE.OntologyManager.prototype.ontologyPropertyByURI=function(a,b){var c=this.ontologyProperties[a];return c||b!==!0||(this.ontologyProperties[a]=c=new RDFE.OntologyProperty(this,a),c.ontology=this.ontologyByURI(RDFE.uriOntology(a),!0),c.ontology.properties[a]=c),c},RDFE.OntologyManager.prototype.individualByURI=function(a){return this.individuals[a]},RDFE.OntologyManager.prototype.load=function(a,b){var c=this,d=b.ioType?b.ioType:"http",e={};c.options.nonTTLProxyUrl&&(e.httpProxyTemplate=c.options.nonTTLProxyUrl[document.location.protocol]);var f=RDFE.IO.createIO(d,e);f.type=d,b.__success=b.success,b.success=function(d,e,g){if(c.options.nonTTLProxy&&c.options.proxy!==c.options.nonTTLProxy){var h=(g.getResponseHeader("content-type")||"").split(";")[0];if(h.length>0&&h.indexOf("turtle")<0)return void f.retrieve(a,$.extend({proxy:c.options.nonTTLProxy},b))}b.__success&&b.__success(d,e,g)},b.__error=b.error,b.error=function(d,e,g,h){return c.options.nonTTLProxy&&c.options.proxy!==c.options.nonTTLProxy?(b.error=b.__error,void f.retrieve(a,$.extend({proxy:c.options.nonTTLProxy},b))):void(b.__error&&b.__error(d,e,g,h))};var g=RDFE.Utils.getProtocol(a)!==document.location.protocol&&"https:"===document.location.protocol?!0:c.options.proxy;f.retrieve(a,$.extend({proxy:g},b))},RDFE.OntologyManager.prototype.parseOntologyFile=function(a,b){function c(a){return N3.Util.isBlank(a)?null:h.ontologyClassByURI(a,!0)}function d(a){return N3.Util.isBlank(a)?null:h.ontologyPropertyByURI(a,!0)}function e(a){return h.individuals[a]=h.individuals[a]||new RDFE.OntologyIndividual(h,a)}function f(a){return n[a]=n[a]||new RDFE.FresnelLens(h,a)}function g(a){for(var b=[],c=a;c;){var d=m[c];c=null,d&&(d.first&&b.push(d.first),c=d.rest)}return b}var h=this,i={},j={},k={},l={},m={},n={},o=function(a){var b=a.subject,g=a.predicate,h=a.object;if("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===g)switch(h){case"http://www.w3.org/2000/01/rdf-schema##Class":case"http://www.w3.org/2002/07/owl#Class":c(b);break;case"http://www.w3.org/2002/07/owl#ObjectProperty":case"http://www.w3.org/2002/07/owl#DatatypeProperty":case"http://www.w3.org/1999/02/22-rdf-syntax-ns#Property":d(b);break;case"http://www.w3.org/2002/07/owl#Restriction":k[b]=k[b]||{};break;case"http://www.openlinksw.com/ontology/oplowl#AggregateRestriction":var n=k[b]=k[b]||{};n.isAggregate=!0;break;case"http://www.openlinksw.com/ontology/oplowl#UniqueIdRestriction":var n=k[b]=k[b]||{};n.isUniqueId=!0;break;case"http://www.w3.org/2004/09/fresnel#Lens":f(b);break;default:var o=e(b),p=c(h);o.type=p,p.individuals[b]=o}else if("http://www.w3.org/2000/01/rdf-schema#label"===g)i[b]=N3.Util.getLiteralValue(h);else if("http://www.w3.org/2000/01/rdf-schema#comment"===g)j[b]=N3.Util.getLiteralValue(h);else if("http://www.w3.org/2000/01/rdf-schema#subClassOf"===g){var q=c(b);if(N3.Util.isBlank(h)){var n=l[b]=l[b]||[];n.push(h)}else r=c(h),q.subClassOf.push(r),r.superClassOf.push(q)}else if("http://www.w3.org/2000/01/rdf-schema#subPropertyOf"===g){var r=d(h),q=d(b);q.subPropertyOf.push(r),r.superPropertyOf.push(q)}else if("http://www.w3.org/2000/01/rdf-schema#domain"===g){var s=d(b);N3.Util.isBlank(h)?s.domain.push(h):s.domain.push(c(h))}else if("http://www.w3.org/2000/01/rdf-schema#range"===g){var s=d(b);s.range=h}else if("http://www.w3.org/2002/07/owl#onProperty"===g){var n=k[b]=k[b]||{};(n.onProperty=n.onProperty||[]).push(h)}else if("http://www.w3.org/2002/07/owl#cardinality"===g||"http://www.w3.org/2002/07/owl#maxCardinality"===g||"http://www.w3.org/2002/07/owl#minCardinality"===g||"http://www.openlinksw.com/ontology/oplowl#hasCustomLabel"===g||"http://www.openlinksw.com/ontology/oplowl#hasCustomComment"===g){var n=k[b]=k[b]||{};n[RDFE.uriLabel(g)]=N3.Util.getLiteralValue(h)}else if("http://www.w3.org/1999/02/22-rdf-syntax-ns#first"===g||"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"===g){if("http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"!==h){var s=m[b]=m[b]||{};s[RDFE.uriLabel(g)]=h}}else if("http://www.w3.org/2002/07/owl#unionOf"===g)m[b]={rest:h};else if("http://www.w3.org/2004/09/fresnel#showProperties"===g||"http://www.w3.org/2004/09/fresnel#hideProperties"===g||"http://www.w3.org/2004/09/fresnel#classLensDomain"===g){var t=f(b);t[RDFE.uriLabel(g)]=h}},p=function(){for(uri in h.ontologyClasses){var a=h.ontologyClasses[uri];a.label=a.label||i[uri],a.comment=a.comment||j[uri];var b=l[uri];if(b)for(var d=0;d<b.length;d++){for(var e=k[b[d]],f=_.clone(e),o=0;o<e.onProperty.length;o++)a.restrictions[e.onProperty[o]]=f;delete f.onProperty}}for(uri in h.ontologyProperties){var p=h.ontologyProperties[uri];p.label=p.label||i[uri],p.comment=p.comment||j[uri],N3.Util.isBlank(p.range)&&(p.rangeAll=g(p.range),p.range=_.first(p.rangeAll));var q=_.clone(p.domain);p.domain=[];for(var d=0;d<q.length;d++)!q[d].URI&&N3.Util.isBlank(q[d])?p.domain=_.union(p.domain,g(q[d])):p.domain.push(q[d])}for(uri in h.ontologies){var r=h.ontologies[uri];r.label=r.label||i[uri]||i[uri.substring(0,uri.length-1)],r.comment=r.comment||j[uri]||j[uri.substring(0,uri.length-1)]}for(uri in h.individuals){var p=h.individuals[uri];p.label=p.label||i[uri],p.comment=p.comment||j[uri]}for(uri in n){var p=n[uri];p.label=p.label||i[uri],p.comment=p.comment||j[uri],p.showProperties=g(p.showProperties),p.hideProperties=g(p.hideProperties),h.fresnelLenses[uri]=p,p.classLensDomain&&(c(p.classLensDomain).fresnelLens=p)}delete i,delete j,delete l,delete k,delete m,$(h).trigger("changed",[h])},q=function(a,c,d){var e=(d.getResponseHeader("content-type")||"").split(";")[0];if(e.length>0&&e.indexOf("turtle")<0){var f="Only Turtle files can be parsed in the ontology manager.";console.error(f),b.error&&b.error({message:f})}else{var g=N3.Parser();g.parse(a,function(a,c,d){a?b.error&&b.error():c?o(c):(p(),b.success&&b.success())})}},r={ioType:b.ioType,success:q,error:b.error};h.load(a,r)},RDFE.OntologyManager.prototype.findFresnelLens=function(a){var b=this.ontologyClasses[a];return b?b.getFresnelLens():null},RDFE.OntologyManager.prototype.ontologyDetermine=function(a){var b,c=this,d=RDFE.uriPrefix(a);return d?(b=c.ontologyByPrefix(d),b=b?b.URI:RDFE.ontologyByPrefix(d)):b=RDFE.uriOntology(a),b},RDFE.OntologyManager.prototype.allOntologies=function(){return _.values(this.ontologies)},RDFE.OntologyManager.prototype.allClasses=function(){return _.values(this.ontologyClasses)},RDFE.OntologyManager.prototype.allProperties=function(a){var b=[];for(uri in this.ontologyProperties){var c=this.ontologyProperties[uri];(!a||c.domain.indexOf(a))&&b.push(c)}return b},RDFE.OntologyManager.prototype.typesToLabel=function(a,b){var c=this;return _.uniq(_.map(a,function(a){var d,e=c.ontologyClassByURI(a);return d=e?e.label:RDFE.Utils.uri2name(a),b?'<a href="'+a+'">'+d+"</a>":d})).join(", ")},RDFE.Ontology=function(a,b,c){this.options=$.extend({},c),this.URI=b,this.prefix=a.prefixByOntology(b),this.classes={},this.properties={},this.manager=a,this.manager.ontologies[b]=this},RDFE.Ontology.prototype.classesAsArray=function(){return _.values(this.classes)},RDFE.Ontology.prototype.classesLength=function(){return this.classesAsArray().length},RDFE.Ontology.prototype.ontologyClassByURI=function(a){return this.classes[URI]},RDFE.Ontology.prototype.propertyByURI=function(a){return this.properties[URI]},RDFE.Ontology.prototype.propertiesLength=function(){return _.values(this.properties).length},RDFE.Ontology.prototype.allProperties=function(a){var b=[];for(uri in this.properties){var c=this.properties[uri];(!a||c.domain.indexOf(a))&&b.push(c)}return b},RDFE.OntologyClass=function(a,b){this.URI=b,this.curi=a.uriNormalize(b),this.name=RDFE.Utils.uri2name(b),this.subClassOf=[],this.superClassOf=[],this.disjointWith=[],this.properties={},this.individuals={},this.restrictions={},this.manager=a},RDFE.OntologyClass.prototype.propertiesAsArray=function(){var a=this,b=[];for(v in a.properties)b.push(a.properties[v]);return b},RDFE.OntologyClass.prototype.maxCardinalityForProperty=function(a,b){var c=this.restrictions[a],d=null;if(c&&(d=c.cardinality||c.maxCardinality))return d;var e=this.manager.ontologyPropertyByURI(a);if(e)for(var f=e.getSuperProperties(),g=0;g<f.length;g++){var h=this.restrictions[f[g].URI];if(h&&(d=h.cardinality||h.maxCardinality))return d}for(var g=0;g<this.subClassOf.length;g++){var i=this.subClassOf[g];if($.inArray(i.URI,b)<0){if(b=b||[],b.push(i.URI),d=i.maxCardinalityForProperty(a,b))return d}else console.log("CAUTION: Found sub-class loop in ",b)}return null},RDFE.OntologyClass.prototype.isAggregateProperty=function(a,b){var c=this.restrictions[a];if(c&&c.isAggregate)return!0;for(var d=0;d<this.subClassOf.length;d++){var e=this.subClassOf[d];if($.inArray(e.URI,b)<0){if(b=b||[],b.push(e.URI),e.isAggregateProperty(a,b))return!0}else console.log("CAUTION: Found sub-class loop in ",b)}return!1},RDFE.OntologyClass.prototype.getSubClasses=function(a,b,c){if(b=b||[],b=_.union(b,this.superClassOf),a!==!1){c=c||[],c.push(this.URI);for(var d=0;d<this.superClassOf.length;d++){var e=this.superClassOf[d];$.inArray(e.URI,c)<0&&e.getSubClasses(a,b,c)}}return b},RDFE.OntologyClass.prototype.getSuperClasses=function(a,b,c){if(b=b||[],b=_.union(b,this.subClassOf),a!==!1){c=c||[],c.push(this.URI);for(var d=0;d<this.subClassOf.length;d++){var e=this.subClassOf[d];$.inArray(e.URI,c)<0&&e.getSuperClasses(a,b,c)}}return b},RDFE.OntologyClass.prototype.getUniqueRestrictions=function(){var a=[];if(this.restrictions)for(var b in this.restrictions){var c=this.restrictions[b];c.isUniqueId===!0&&a.push(this.manager.ontologyPropertyByURI(b))}return a},RDFE.OntologyClass.prototype.getIndividuals=function(a){var b=this.individuals;if(a)for(var c=this.getSubClasses(!0),d=0;d<c.length;d++)b=_.union(b,c[d].individuals);return b},RDFE.OntologyClass.prototype.getFresnelLens=function(){var a=this.fresnelLens;if(!a)for(var b=this.getSuperClasses(!0),c=0;c<b.length;c++)if(a=b[c].fresnelLens)return a;return a},RDFE.OntologyProperty=function(a,b){this.URI=b,this.curi=a.uriNormalize(b),this.name=RDFE.Utils.uri2name(b),this.subPropertyOf=[],this.superPropertyOf=[],this.domain=[],this.manager=a,this.manager.ontologyProperties[b]=self},RDFE.OntologyProperty.prototype.hasDomain=function(a){var b=this;if(b.domain)for(var c=0;c<b.domain.length;c++)if(a==b.domain[c])return!0;return!1},RDFE.OntologyProperty.prototype.getRange=function(a){var b=this.range;if(b)return b;for(var c=0;c<this.subPropertyOf.length;c++){var d=this.subPropertyOf[c];if($.inArray(d.URI,a)<0){if(a=a||[],a.push(d.URI),b=d.getRange(a))return b}else console.log("CAUTION: Found sub-property loop in ",a)}return void 0},RDFE.OntologyProperty.prototype.getSuperProperties=function(a,b,c){if(b=b||[],b=_.union(b,this.subPropertyOf),a!==!1){c=c||[],c.push(this.URI);for(var d=0;d<this.subPropertyOf.length;d++){var e=this.subPropertyOf[d];$.inArray(e.URI,c)<0&&e.getSuperProperties(a,b,c)}}return b},RDFE.OntologyIndividual=function(a,b,c){this.URI=b,this.curi=a.uriNormalize(b),this.name=RDFE.Utils.uri2name(b),this.manager=a,this.manager.individuals[b]=this},RDFE.FresnelLens=function(a,b){this.URI=b,this.manager=a,this.showProperties=[],this.hideProperties=[]},window.RDFE||(window.RDFE={}),RDFE.Document=function(a,b,c){var d=this;d.ontologyManager=a,d.config=b,d.documentTree=c,d.store=rdfstore.create(),d.store.registerDefaultNamespace("skos","http://www.w3.org/2004/02/skos/core#"),d.graph="urn:graph:default",d.dirty=!1},RDFE.Document.prototype.setChanged=function(a){var b=this;b.dirty=a,b.dirty&&$(b).trigger("changed",b),$(b).trigger("docChanged",b)},RDFE.Document.prototype.load=function(a,b,c,d){var e=this,f=function(d,f,g){e.url=a,e.io=b,e.setChanged(!1),e.srcParams={length:d.length,md5:$.md5(d)},c&&c()};e.store.clear(function(){b.retrieveToStore(a,e.store,e.graph,{success:f,error:d})})},RDFE.Document.prototype.verifyData=function(a,b){var c=this;return c.config.options.validateEmptyNodes?void c.store.execute("select * from <"+c.graph+"> where {{ <> ?p ?o } union { ?s2 ?p2 <> }}",function(c,d){return c?d.length>0?(a&&a(!1,"The document is not valid. It contains empty URI nodes."),!1):(a&&a(!0),!0):(b&&b(),!1)}):(a&&a(!0),!0)},RDFE.Document.prototype.save=function(a,b,c,d){var e=this,f=a,g=b,h=c,i=d;"string"!=typeof a&&(f=e.url,g=a,h=b,i=c),"function"!=typeof g&&g||(i=h,h=g,g=e.io),f?(g.insertFromStore||(g=RDFE.IO.createIO("webdav",g.options),g.type="webdav"),e.verifyData(function(a,b){if(a){var c=function(){e.url=f,e.io=g,e.setChanged(!1),e.documentTree.addRecentDoc(e.url,e.io.type),g.retrieve(f,{success:function(a,b,c){e.srcParams={length:a.length,md5:$.md5(a)}},error:function(){e.srcParams=null}}),h&&h()};g.insertFromStore(f,e.store,e.graph,{success:c,error:i})}else i&&i(b)},i)):i&&i("No document loaded")},RDFE.Document.prototype["new"]=function(a,b){var c=this;c.url=null,c.io=null,c.srcParams=null,c.store.clear(c.graph,function(d){d&&a?(c.setChanged(!1),a()):!d&&b&&b()})},RDFE.Document.prototype.deleteBySubject=function(a,b,c){var d=this;if(d.config.options.autoInverseOfHandling){var e="construct { <{1}> ?p ?o } FROM <{0}> WHERE { <{1}> ?p ?o. } ".format(d.graph,a);d.store.execute(e,function(a,e){a?d.deleteTriples(e.triples,b,c):c&&c(e)})}else d.store.execute("with <"+d.graph+"> delete { <"+a+"> ?p ?o } where { <"+a+"> ?p ?o }",function(a,d){a&&b?b():!a&&c&&c(d)})},RDFE.Document.prototype.deleteByPredicate=function(a,b,c){var d=this;if(d.config.options.autoInverseOfHandling){var e="construct { ?s <{1}> ?o} FROM <{0}> WHERE { ?s <{1}> ?o . } ".format(d.graph,a);d.store.execute(e,function(a,e){a?d.deleteTriples(e.triples,b,c):c&&c(e)})}else d.store.execute("with <"+d.graph+"> delete { ?s <"+a+"> ?o} where { ?s <"+a+"> ?o . }",function(a,d){a&&b?b():!a&&c&&c(d)})},RDFE.Document.prototype.deleteByObjectIRI=function(a,b,c){var d=this;if(d.config.options.autoInverseOfHandling){var e="construct { ?s ?p <{1}> } FROM <{0}> WHERE { ?s ?p <{1}> . } ".format(d.graph,a);d.store.execute(e,function(a,e){a?d.deleteTriples(e.triples,b,c):c&&c(e)})}else d.store.execute("with <"+d.graph+"> delete { ?s ?p <"+a+"> } where { ?s ?p <"+a+"> . }",function(a,d){a&&b?b():!a&&c&&c(d)})},RDFE.Document.prototype.deleteByObject=function(a,b,c){var d,e=this;if("Literal"===a.interfaceName)var d='construct { ?s ?p ?o } FROM <{0}> WHERE { ?s ?p ?o. FILTER (str(?o) = "{1}"). } '.format(e.graph,"http://www.w3.org/2001/XMLSchema#dateTime"==a.datatype?new Date(a.nominalValue).toString():a.nominalValue);else var d="construct { ?s ?p <{1}> } FROM <{0}> WHERE { ?s ?p <{1}> . } ".format(e.graph,a.toString());e.store.execute(d,function(a,d){a?e.deleteTriples(d.triples,b,c):c&&c(d)})},RDFE.Document.prototype.deleteEntity=function(a,b,c){var d=this;a?d.deleteBySubject(a,function(){d.deleteByObjectIRI(a,b,c)},c):c&&c("Need Entity URI for deletion.")},RDFE.Document.prototype.deleteEntities=function(a,b,c){function d(f){f<a.length?e.deleteEntity(a[f],function(){d(f+1)},c):b()}var e=this;d(0)},RDFE.Document.prototype.deletePredicate=function(a,b,c){var d=this;a?d.deleteByPredicate(a,b,c):c&&c("Need Predicate URI for deletion.")},RDFE.Document.prototype.deleteObject=function(a,b,c){var d=this;a?d.deleteByObject(a,b,c):c&&c("Need object for deletion.")},RDFE.Document.prototype.addTriples=function(a,b,c,d){var e=this,f=_.isArray(a)?a:[a];return _.isEmpty(f)?void(b&&b()):void e.store.insert(e.store.rdf.createGraph(f),e.graph,function(a){if(a)if(e.config.options.autoInverseOfHandling!==!0||d)e.setChanged(!0),b&&b();else{var g=e.inverseTriples(f);_.isEmpty(g)?(e.setChanged(!0),b&&b()):e.addTriples(g,b,c,!0)}else c&&c()})},RDFE.Document.prototype.addTriple=RDFE.Document.prototype.addTriples,RDFE.Document.prototype.deleteTriples=function(a,b,c,d){var e=this,f=_.isArray(a)?a:[a];return _.isEmpty(f)?void(b&&b()):void e.store["delete"](e.store.rdf.createGraph(f),e.graph,function(a){if(a)if(e.setChanged(!0),e.config.options.autoInverseOfHandling!==!0||d)e.setChanged(!0),b&&b();else{var g=e.inverseTriples(f);_.isEmpty(g)?(e.setChanged(!0),b&&b()):e.deleteTriples(g,b,c,!0)}else c&&c()})},RDFE.Document.prototype.deleteTriple=RDFE.Document.prototype.deleteTriples,RDFE.Document.prototype.updateTriple=function(a,b,c,d){var e=this;e.deleteTriple(a,function(){e.addTriple(b,function(){e.setChanged(!0),c&&c()},function(){d&&d("Adding new triple failed")})},function(){d&&d("Deleting triple failed")})},RDFE.Document.prototype.inverseTriple=function(a){var b=this,c=null,d=a.subject,e=a.object;if("NamedNode"==d.interfaceName&&"NamedNode"==e.interfaceName){var f=a.predicate,g=b.ontologyManager.ontologyPropertyByURI(f.nominalValue);if(g){var h=g.inverseOf;if(h)var c=b.store.rdf.createTriple(b.store.rdf.createNamedNode(e.nominalValue),b.store.rdf.createNamedNode(h.URI),b.store.rdf.createNamedNode(d.nominalValue))}}return c},RDFE.Document.prototype.inverseTriples=function(a){for(var b=this,c=[],d=0,e=a.length;e>d;d++){var f=b.inverseTriple(a[d]);f&&c.push(f)}return c},RDFE.Document.prototype.getEntityLabel=function(a,b,c){var d=this,e=b,f=c;"function"==typeof e&&(f=e,e=void 0);var g=function(b,c){c>=b.length?f(RDFE.Utils.uri2name(a),!1):d.store.execute("select ?l from <"+d.graph+"> where { <"+a+"> <"+b[c]+"> ?l . }",function(a,d){a&&d.length>0&&d[0].l.value.length>0?f(d[0].l.value,!0):g(b,c+1)})};g(e||d.config.options.labelProps,0)},RDFE.Document.prototype.getEntity=function(a,b){var c=this;c.store.node(a,c.graph,function(d,e){var f={uri:a,label:RDFE.Utils.uri2name(a),types:[],properties:{}};if(d){e=e.triples;for(var g=0;g<e.length;g++){var h=e[g].predicate.nominalValue;(f.properties[h]=f.properties[h]||[]).push(RDFE.RdfNode.fromStoreNode(e[g].object)),"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==h&&f.types.push(e[g].object.nominalValue)}for(var g=0;g<c.config.options.labelProps.length;g++)if(f.properties[c.config.options.labelProps[g]]){f.label=f.properties[c.config.options.labelProps[g]][0].toString();break}}b(f)})},RDFE.Document.prototype.listProperties=function(a){var b=this;b.store.execute("select distinct ?p from <"+b.graph+"> where { ?s ?p ?o }",function(b,c){var d=[];if(b)for(var e=0;e<c.length;e++)d.push(c[e].p.value);a(d)})},RDFE.Document.prototype.listEntities=function(a,b,c){var d=a,e=b,f=c,g=this;"function"==typeof d?(e=a,f=b,d=null):"string"==typeof d&&(d=[d]);var h="select ?s ?p ?o from <"+g.graph+"> where { ?s ?p ?o . ";if(d&&d.length>0){h+="?s a ?t . filter(";for(var i=0;i<d.length;i++)i>0&&(h+="||"),h+="?t = <"+d[i]+">";h+=") . "}h+="}",g.store.execute(h,function(a,b){var d={};if(a){for(var f=0;f<b.length;f++){var h=b[f].s.value,i=b[f].p.value;d[h]||(d[h]={uri:h,types:[]});var j=d[h];"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==i?j.types.push(b[f].o.value):_.indexOf(g.config.options.labelProps,i)>=0&&(j[i]=b[f].o.value)}d=_.values(d);for(var f=0;f<d.length;f++)d[f].label=g.getEntityLabel(d[f])}else c&&c(b);e(d)})},RDFE.Document.prototype.itemsByRange=function(a){for(var b=this,c=[],d=_.values(b.ontologyManager.ontologyClassByURI(a).getIndividuals()),e=0;e<d.length;e++){var f=RDFE.RdfNode.fromStoreNode(d[e].URI);f.label=d[e].curi||d[e].URI,c.push(f)}return b.listEntities(a,function(a){for(var b=0;b<a.length;b++){var d=RDFE.RdfNode.fromStoreNode(a[b].uri);d.label=a[b].label||a[b].uri,c.push(d)}}),c.length||(c=null),c},RDFE.Document.prototype.buildEntityUri=function(a){var b=this.config.options.entityUriTmpl;b&&0!=b.length||(b="urn:entities:{NAME}"),b=b.replace("{DOC-URI}",this.url||"urn:entities:");var c=a||"entity",d=b.indexOf("{NAME}");d>=0?b=b.replace("{NAME}",encodeURIComponent(c)):("#"!=b[b.length-1]&&"/"!=b[b.length-1]&&":"!=b[b.length-1]&&(b+="#"),b+=encodeURIComponent(c));var e=b,f=this,g=function(a){f.store.node(e,f.graph,function(c,d){console.log(c,d),c&&d.length&&(e=b+a,g(a+1))})};return g(1),e},RDFE.Document.prototype.addEntity=function(a,b,c,d,e){var f=this;a&&0!=a.length||(a=f.buildEntityUri(b));var g=[f.store.rdf.createTriple(f.store.rdf.createNamedNode(a),f.store.rdf.createNamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),f.store.rdf.createNamedNode(c))];if(b&&b.length>0){var h=f.ontologyManager.uriDenormalize(f.config.options.labelProps[0]);g.push(f.store.rdf.createTriple(f.store.rdf.createNamedNode(a),f.store.rdf.createNamedNode(h),f.store.rdf.createLiteral(b)))}for(var i=f.ontologyManager.ontologyClassByURI(c),j=i?i.getUniqueRestrictions():[],k=0;k<j.length;k++){var l=j[k],m=f.getUniqueValue(a,l);m&&g.push(f.store.rdf.createTriple(f.store.rdf.createNamedNode(a),f.store.rdf.createNamedNode(l.URI),f.store.rdf.createLiteral(m.toString(),null,l.range)))}f.addTriples(g,function(){d&&d({uri:a,label:b})},function(){e&&e()})},RDFE.Document.prototype.listSubjects=function(a,b){var c=this;c.store.graph(c.graph,function(d,e){if(d){for(var f={},g=e.toArray(),h=0;h<g.length;h+=1){var i=g[h].subject.toString();f[i]||(f[i]=c.newSubject(i)),f[i].items.push(g[h])}f=_.values(f),a(f)}else b&&b(e)})},RDFE.Document.prototype.getSubject=function(a,b,c){var d=this;d.store.graph(d.graph,function(e,f){if(e){for(var g=d.newSubject(a),h=f.toArray(),i=0;i<h.length;i+=1)h[i].subject.toString()===a&&g.items.push(h[i]);b&&b(g)}else c&&c(f)})},RDFE.Document.prototype.newSubject=function(a){return{uri:a,items:[]}},RDFE.Document.prototype.listPredicates=function(a,b){var c=this;c.store.graph(c.graph,function(d,e){if(d){for(var f={},g=e.toArray(),h=0;h<g.length;h+=1){var i=g[h].predicate.toString();f[i]||(f[i]=c.newPredicate(i)),f[i].items.push(g[h])}f=_.values(f),a(f)}else b&&b(e)})},RDFE.Document.prototype.getPredicate=function(a,b,c){var d=this;d.store.graph(d.graph,function(e,f){if(e){for(var g=d.newPredicate(a),h=f.toArray(),i=0;i<h.length;i+=1)h[i].predicate.toString()===a&&g.items.push(h[i]);b&&b(g)}else c&&c(f)})},RDFE.Document.prototype.newPredicate=function(a){return{uri:a,items:[]}},RDFE.Document.prototype.listObjects=function(a,b){var c=this;c.store.graph(c.graph,function(d,e){if(d){for(var f={},g=e.toArray(),h=0;h<g.length;h+=1){var i=g[h].object,j=c.formatObjectID(i);f[j]||(f[j]=c.newObject(i)),f[j].items.push(g[h])}f=_.values(f),a(f)}else b&&b(e)})},RDFE.Document.prototype.getObject=function(a,b,c){var d=this;d.store.graph(d.graph,function(e,f){if(e){for(var g=d.newObject(a),h=f.toArray(),i=0;i<h.length;i+=1)d.formatObjectID(h[i].object)===g.id&&g.items.push(h[i]);b&&b(g)}else c&&c(f)})},RDFE.Document.prototype.newObject=function(a){var b=this;return"string"==typeof a&&(a=new RDFE.RdfNode("literal",a)),{id:b.formatObjectID(a),label:b.formatObjectLabel(a),type:b.formatObjectType(a),object:a,items:[]}},RDFE.Document.prototype.formatObjectID=function(a){if("Literal"==a.interfaceName){var b="http://www.w3.org/2001/XMLSchema#dateTime"==a.datatype?new Date(a.nominalValue).toString():a.nominalValue,c=a.datatype?a.datatype:"literal";return c+" - "+b}return a.toString()},RDFE.Document.prototype.formatObjectLabel=function(a){return"Literal"===a.interfaceName?"http://www.w3.org/2001/XMLSchema#dateTime"==a.datatype?new Date(a.nominalValue).toString():a.nominalValue:a.toString()},RDFE.Document.prototype.formatObjectType=function(a){return"Literal"===a.interfaceName?a.datatype?a.datatype:"http://www.w3.org/2000/01/rdf-schema#Literal":"IRI"},RDFE.Document.prototype.getEntityLabel=function(a){for(var b=this,c=0;c<b.config.options.labelProps.length;c++)if(a[b.config.options.labelProps[c]])return a[b.config.options.labelProps[c]];return RDFE.Utils.uri2name(a.uri)},RDFE.Document.prototype.getUniqueValue=function(){var a=["http://www.w3.org/2000/01/rdf-schema#Literal","http://www.w3.org/2001/XMLSchema#string"],b=["http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#byte","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#unsignedByte","http://www.w3.org/2001/XMLSchema#positiveInteger"];return function(c,d){var e,f=this,g=d.range;if(-1!==a.indexOf(g))e=c;else if(-1!==b.indexOf(g)){e=1;var h="SELECT (MAX(?v) as ?mv) FROM <{0}> WHERE {?s <{1}> ?v}".format(f.graph,d.URI);f.store.execute(h,function(a,b){a?0!==b.length&&(e=parseInt(RDFE.coalesce(b[0].mv.value,0)),isNaN(e)&&(e=0),e++):console.log("Failed to determine unique value for ",c," and ",d.URI,b)})}return e}}(),function(a,b){"function"==typeof define&&define.amd?define("sifter",b):"object"==typeof exports?module.exports=b():a.Sifter=b()}(this,function(){var a=function(a,b){this.items=a,this.settings=b||{diacritics:!0}};a.prototype.tokenize=function(a){if(a=d(String(a||"").toLowerCase()),!a||!a.length)return[];var b,c,f,h,i=[],j=a.split(/ +/);for(b=0,c=j.length;c>b;b++){if(f=e(j[b]),this.settings.diacritics)for(h in g)g.hasOwnProperty(h)&&(f=f.replace(new RegExp(h,"g"),g[h]));i.push({string:j[b],regex:new RegExp(f,"i")})}return i},a.prototype.iterator=function(a,b){var c;c=f(a)?Array.prototype.forEach||function(a){for(var b=0,c=this.length;c>b;b++)a(this[b],b,this)}:function(a){for(var b in this)this.hasOwnProperty(b)&&a(this[b],b,this)},c.apply(a,[b])},a.prototype.getScoreFunction=function(a,b){var c,d,e,f;c=this,
a=c.prepareSearch(a,b),e=a.tokens,d=a.options.fields,f=e.length;var g=function(a,b){var c,d;return a?(a=String(a||""),d=a.search(b.regex),-1===d?0:(c=b.string.length/a.length,0===d&&(c+=.5),c)):0},h=function(){var a=d.length;return a?1===a?function(a,b){return g(b[d[0]],a)}:function(b,c){for(var e=0,f=0;a>e;e++)f+=g(c[d[e]],b);return f/a}:function(){return 0}}();return f?1===f?function(a){return h(e[0],a)}:"and"===a.options.conjunction?function(a){for(var b,c=0,d=0;f>c;c++){if(b=h(e[c],a),0>=b)return 0;d+=b}return d/f}:function(a){for(var b=0,c=0;f>b;b++)c+=h(e[b],a);return c/f}:function(){return 0}},a.prototype.getSortFunction=function(a,c){var d,e,f,g,h,i,j,k,l,m,n;if(f=this,a=f.prepareSearch(a,c),n=!a.query&&c.sort_empty||c.sort,l=function(a,b){return"$score"===a?b.score:f.items[b.id][a]},h=[],n)for(d=0,e=n.length;e>d;d++)(a.query||"$score"!==n[d].field)&&h.push(n[d]);if(a.query){for(m=!0,d=0,e=h.length;e>d;d++)if("$score"===h[d].field){m=!1;break}m&&h.unshift({field:"$score",direction:"desc"})}else for(d=0,e=h.length;e>d;d++)if("$score"===h[d].field){h.splice(d,1);break}for(k=[],d=0,e=h.length;e>d;d++)k.push("desc"===h[d].direction?-1:1);return i=h.length,i?1===i?(g=h[0].field,j=k[0],function(a,c){return j*b(l(g,a),l(g,c))}):function(a,c){var d,e,f;for(d=0;i>d;d++)if(f=h[d].field,e=k[d]*b(l(f,a),l(f,c)))return e;return 0}:null},a.prototype.prepareSearch=function(a,b){if("object"==typeof a)return a;b=c({},b);var d=b.fields,e=b.sort,g=b.sort_empty;return d&&!f(d)&&(b.fields=[d]),e&&!f(e)&&(b.sort=[e]),g&&!f(g)&&(b.sort_empty=[g]),{options:b,query:String(a||"").toLowerCase(),tokens:this.tokenize(a),total:0,items:[]}},a.prototype.search=function(a,b){var c,d,e,f,g=this;return d=this.prepareSearch(a,b),b=d.options,a=d.query,f=b.score||g.getScoreFunction(d),a.length?g.iterator(g.items,function(a,e){c=f(a),(b.filter===!1||c>0)&&d.items.push({score:c,id:e})}):g.iterator(g.items,function(a,b){d.items.push({score:1,id:b})}),e=g.getSortFunction(d,b),e&&d.items.sort(e),d.total=d.items.length,"number"==typeof b.limit&&(d.items=d.items.slice(0,b.limit)),d};var b=function(a,b){return"number"==typeof a&&"number"==typeof b?a>b?1:b>a?-1:0:(a=h(String(a||"")),b=h(String(b||"")),a>b?1:b>a?-1:0)},c=function(a,b){var c,d,e,f;for(c=1,d=arguments.length;d>c;c++)if(f=arguments[c])for(e in f)f.hasOwnProperty(e)&&(a[e]=f[e]);return a},d=function(a){return(a+"").replace(/^\s+|\s+$|/g,"")},e=function(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},f=Array.isArray||$&&$.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},g={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"},h=function(){var a,b,c,d,e="",f={};for(c in g)if(g.hasOwnProperty(c))for(d=g[c].substring(2,g[c].length-1),e+=d,a=0,b=d.length;b>a;a++)f[d.charAt(a)]=c;var h=new RegExp("["+e+"]","g");return function(a){return a.replace(h,function(a){return f[a]}).toLowerCase()}}();return a}),function(a,b){"function"==typeof define&&define.amd?define("microplugin",b):"object"==typeof exports?module.exports=b():a.MicroPlugin=b()}(this,function(){var a={};a.mixin=function(a){a.plugins={},a.prototype.initializePlugins=function(a){var c,d,e,f=this,g=[];if(f.plugins={names:[],settings:{},requested:{},loaded:{}},b.isArray(a))for(c=0,d=a.length;d>c;c++)"string"==typeof a[c]?g.push(a[c]):(f.plugins.settings[a[c].name]=a[c].options,g.push(a[c].name));else if(a)for(e in a)a.hasOwnProperty(e)&&(f.plugins.settings[e]=a[e],g.push(e));for(;g.length;)f.require(g.shift())},a.prototype.loadPlugin=function(b){var c=this,d=c.plugins,e=a.plugins[b];if(!a.plugins.hasOwnProperty(b))throw new Error('Unable to find "'+b+'" plugin');d.requested[b]=!0,d.loaded[b]=e.fn.apply(c,[c.plugins.settings[b]||{}]),d.names.push(b)},a.prototype.require=function(a){var b=this,c=b.plugins;if(!b.plugins.loaded.hasOwnProperty(a)){if(c.requested[a])throw new Error('Plugin has circular dependency ("'+a+'")');b.loadPlugin(a)}return c.loaded[a]},a.define=function(b,c){a.plugins[b]={name:b,fn:c}}};var b={isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}};return a}),function(a,b){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],b):"object"==typeof exports?module.exports=b(require("jquery"),require("sifter"),require("microplugin")):a.Selectize=b(a.jQuery,a.Sifter,a.MicroPlugin)}(this,function(a,b,c){"use strict";var d=function(a,b){if("string"!=typeof b||b.length){var c="string"==typeof b?new RegExp(b,"i"):b,d=function(a){var b=0;if(3===a.nodeType){var e=a.data.search(c);if(e>=0&&a.data.length>0){var f=a.data.match(c),g=document.createElement("span");g.className="highlight";var h=a.splitText(e),i=(h.splitText(f[0].length),h.cloneNode(!0));g.appendChild(i),h.parentNode.replaceChild(g,h),b=1}}else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(var j=0;j<a.childNodes.length;++j)j+=d(a.childNodes[j]);return b};return a.each(function(){d(this)})}},e=function(){};e.prototype={on:function(a,b){this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(b)},off:function(a,b){var c=arguments.length;return 0===c?delete this._events:1===c?delete this._events[a]:(this._events=this._events||{},void(a in this._events!=!1&&this._events[a].splice(this._events[a].indexOf(b),1)))},trigger:function(a){if(this._events=this._events||{},a in this._events!=!1)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}},e.mixin=function(a){for(var b=["on","off","trigger"],c=0;c<b.length;c++)a.prototype[b[c]]=e.prototype[b[c]]};var f=/Mac/.test(navigator.userAgent),g=65,h=13,i=27,j=37,k=38,l=80,m=39,n=40,o=78,p=8,q=46,r=16,s=f?91:17,t=f?18:17,u=9,v=1,w=2,x=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,y=function(a){return"undefined"!=typeof a},z=function(a){return"undefined"==typeof a||null===a?null:"boolean"==typeof a?a?"1":"0":a+""},A=function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},B=function(a){return(a+"").replace(/\$/g,"$$$$")},C={};C.before=function(a,b,c){var d=a[b];a[b]=function(){return c.apply(a,arguments),d.apply(a,arguments)}},C.after=function(a,b,c){var d=a[b];a[b]=function(){var b=d.apply(a,arguments);return c.apply(a,arguments),b}};var D=function(a){var b=!1;return function(){b||(b=!0,a.apply(this,arguments))}},E=function(a,b){var c;return function(){var d=this,e=arguments;window.clearTimeout(c),c=window.setTimeout(function(){a.apply(d,e)},b)}},F=function(a,b,c){var d,e=a.trigger,f={};a.trigger=function(){var c=arguments[0];return-1===b.indexOf(c)?e.apply(a,arguments):void(f[c]=arguments)},c.apply(a,[]),a.trigger=e;for(d in f)f.hasOwnProperty(d)&&e.apply(a,f[d])},G=function(a,b,c,d){a.on(b,c,function(b){for(var c=b.target;c&&c.parentNode!==a[0];)c=c.parentNode;return b.currentTarget=c,d.apply(this,[b])})},H=function(a){var b={};if("selectionStart"in a)b.start=a.selectionStart,b.length=a.selectionEnd-b.start;else if(document.selection){a.focus();var c=document.selection.createRange(),d=document.selection.createRange().text.length;c.moveStart("character",-a.value.length),b.start=c.text.length-d,b.length=d}return b},I=function(a,b,c){var d,e,f={};if(c)for(d=0,e=c.length;e>d;d++)f[c[d]]=a.css(c[d]);else f=a.css();b.css(f)},J=function(b,c){if(!b)return 0;var d=a("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(b).appendTo("body");I(c,d,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var e=d.width();return d.remove(),e},K=function(a){var b=null,c=function(c,d){var e,f,g,h,i,j,k,l;c=c||window.event||{},d=d||{},c.metaKey||c.altKey||(d.force||a.data("grow")!==!1)&&(e=a.val(),c.type&&"keydown"===c.type.toLowerCase()&&(f=c.keyCode,g=f>=97&&122>=f||f>=65&&90>=f||f>=48&&57>=f||32===f,f===q||f===p?(l=H(a[0]),l.length?e=e.substring(0,l.start)+e.substring(l.start+l.length):f===p&&l.start?e=e.substring(0,l.start-1)+e.substring(l.start+1):f===q&&"undefined"!=typeof l.start&&(e=e.substring(0,l.start)+e.substring(l.start+1))):g&&(j=c.shiftKey,k=String.fromCharCode(c.keyCode),k=j?k.toUpperCase():k.toLowerCase(),e+=k)),h=a.attr("placeholder"),!e&&h&&(e=h),i=J(e,a)+4,i!==b&&(b=i,a.width(i),a.triggerHandler("resize")))};a.on("keydown keyup update blur",c),c()},L=function(c,d){var e,f,g,h,i=this;h=c[0],h.selectize=i;var j=window.getComputedStyle&&window.getComputedStyle(h,null);if(g=j?j.getPropertyValue("direction"):h.currentStyle&&h.currentStyle.direction,g=g||c.parents("[dir]:first").attr("dir")||"",a.extend(i,{order:0,settings:d,$input:c,tabIndex:c.attr("tabindex")||"",tagType:"select"===h.tagName.toLowerCase()?v:w,rtl:/rtl/i.test(g),eventNS:".selectize"+ ++L.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:c.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===d.loadThrottle?i.onSearchChange:E(i.onSearchChange,d.loadThrottle)}),i.sifter=new b(this.options,{diacritics:d.diacritics}),i.settings.options){for(e=0,f=i.settings.options.length;f>e;e++)i.registerOption(i.settings.options[e]);delete i.settings.options}if(i.settings.optgroups){for(e=0,f=i.settings.optgroups.length;f>e;e++)i.registerOptionGroup(i.settings.optgroups[e]);delete i.settings.optgroups}i.settings.mode=i.settings.mode||(1===i.settings.maxItems?"single":"multi"),"boolean"!=typeof i.settings.hideSelected&&(i.settings.hideSelected="multi"===i.settings.mode),i.initializePlugins(i.settings.plugins),i.setupCallbacks(),i.setupTemplates(),i.setup()};return e.mixin(L),c.mixin(L),a.extend(L.prototype,{setup:function(){var b,c,d,e,g,h,i,j,k,l=this,m=l.settings,n=l.eventNS,o=a(window),p=a(document),q=l.$input;if(i=l.settings.mode,j=q.attr("class")||"",b=a("<div>").addClass(m.wrapperClass).addClass(j).addClass(i),c=a("<div>").addClass(m.inputClass).addClass("items").appendTo(b),d=a('<input type="text" autocomplete="off" />').appendTo(c).attr("tabindex",q.is(":disabled")?"-1":l.tabIndex),h=a(m.dropdownParent||b),e=a("<div>").addClass(m.dropdownClass).addClass(i).hide().appendTo(h),g=a("<div>").addClass(m.dropdownContentClass).appendTo(e),l.settings.copyClassesToDropdown&&e.addClass(j),b.css({width:q[0].style.width}),l.plugins.names.length&&(k="plugin-"+l.plugins.names.join(" plugin-"),b.addClass(k),e.addClass(k)),(null===m.maxItems||m.maxItems>1)&&l.tagType===v&&q.attr("multiple","multiple"),l.settings.placeholder&&d.attr("placeholder",m.placeholder),!l.settings.splitOn&&l.settings.delimiter){var u=l.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");l.settings.splitOn=new RegExp("\\s*"+u+"+\\s*")}q.attr("autocorrect")&&d.attr("autocorrect",q.attr("autocorrect")),q.attr("autocapitalize")&&d.attr("autocapitalize",q.attr("autocapitalize")),l.$wrapper=b,l.$control=c,l.$control_input=d,l.$dropdown=e,l.$dropdown_content=g,e.on("mouseenter","[data-selectable]",function(){return l.onOptionHover.apply(l,arguments)}),e.on("mousedown click","[data-selectable]",function(){return l.onOptionSelect.apply(l,arguments)}),G(c,"mousedown","*:not(input)",function(){return l.onItemSelect.apply(l,arguments)}),K(d),c.on({mousedown:function(){return l.onMouseDown.apply(l,arguments)},click:function(){return l.onClick.apply(l,arguments)}}),d.on({mousedown:function(a){a.stopPropagation()},keydown:function(){return l.onKeyDown.apply(l,arguments)},keyup:function(){return l.onKeyUp.apply(l,arguments)},keypress:function(){return l.onKeyPress.apply(l,arguments)},resize:function(){l.positionDropdown.apply(l,[])},blur:function(){return l.onBlur.apply(l,arguments)},focus:function(){return l.ignoreBlur=!1,l.onFocus.apply(l,arguments)},paste:function(){return l.onPaste.apply(l,arguments)}}),p.on("keydown"+n,function(a){l.isCmdDown=a[f?"metaKey":"ctrlKey"],l.isCtrlDown=a[f?"altKey":"ctrlKey"],l.isShiftDown=a.shiftKey}),p.on("keyup"+n,function(a){a.keyCode===t&&(l.isCtrlDown=!1),a.keyCode===r&&(l.isShiftDown=!1),a.keyCode===s&&(l.isCmdDown=!1)}),p.on("mousedown"+n,function(a){if(l.isFocused){if(a.target===l.$dropdown[0]||a.target.parentNode===l.$dropdown[0])return!1;l.$control.has(a.target).length||a.target===l.$control[0]||l.blur(a.target)}}),o.on(["scroll"+n,"resize"+n].join(" "),function(){l.isOpen&&l.positionDropdown.apply(l,arguments)}),o.on("mousemove"+n,function(){l.ignoreHover=!1}),this.revertSettings={$children:q.children().detach(),tabindex:q.attr("tabindex")},q.attr("tabindex",-1).hide().after(l.$wrapper),a.isArray(m.items)&&(l.setValue(m.items),delete m.items),x&&q.on("invalid"+n,function(a){a.preventDefault(),l.isInvalid=!0,l.refreshState()}),l.updateOriginalInput(),l.refreshItems(),l.refreshState(),l.updatePlaceholder(),l.isSetup=!0,q.is(":disabled")&&l.disable(),l.on("change",this.onChange),q.data("selectize",l),q.addClass("selectized"),l.trigger("initialize"),m.preload===!0&&l.onSearchChange("")},setupTemplates:function(){var b=this,c=b.settings.labelField,d=b.settings.optgroupLabelField,e={optgroup:function(a){return'<div class="optgroup">'+a.html+"</div>"},optgroup_header:function(a,b){return'<div class="optgroup-header">'+b(a[d])+"</div>"},option:function(a,b){return'<div class="option">'+b(a[c])+"</div>"},item:function(a,b){return'<div class="item">'+b(a[c])+"</div>"},option_create:function(a,b){return'<div class="create">Add <strong>'+b(a.input)+"</strong>&hellip;</div>"}};b.settings.render=a.extend({},e,b.settings.render)},setupCallbacks:function(){var a,b,c={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(a in c)c.hasOwnProperty(a)&&(b=this.settings[c[a]],b&&this.on(a,b))},onClick:function(a){var b=this;b.isFocused||(b.focus(),a.preventDefault())},onMouseDown:function(b){var c=this,d=b.isDefaultPrevented();a(b.target);if(c.isFocused){if(b.target!==c.$control_input[0])return"single"===c.settings.mode?c.isOpen?c.close():c.open():d||c.setActiveItem(null),!1}else d||window.setTimeout(function(){c.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(b){var c=this;c.isFull()||c.isInputHidden||c.isLocked?b.preventDefault():c.settings.splitOn&&setTimeout(function(){for(var b=a.trim(c.$control_input.val()||"").split(c.settings.splitOn),d=0,e=b.length;e>d;d++)c.createItem(b[d])},0)},onKeyPress:function(a){if(this.isLocked)return a&&a.preventDefault();var b=String.fromCharCode(a.keyCode||a.which);return this.settings.create&&"multi"===this.settings.mode&&b===this.settings.delimiter?(this.createItem(),a.preventDefault(),!1):void 0},onKeyDown:function(a){var b=(a.target===this.$control_input[0],this);if(b.isLocked)return void(a.keyCode!==u&&a.preventDefault());switch(a.keyCode){case g:if(b.isCmdDown)return void b.selectAll();break;case i:return void(b.isOpen&&(a.preventDefault(),a.stopPropagation(),b.close()));case o:if(!a.ctrlKey||a.altKey)break;case n:if(!b.isOpen&&b.hasOptions)b.open();else if(b.$activeOption){b.ignoreHover=!0;var c=b.getAdjacentOption(b.$activeOption,1);c.length&&b.setActiveOption(c,!0,!0)}return void a.preventDefault();case l:if(!a.ctrlKey||a.altKey)break;case k:if(b.$activeOption){b.ignoreHover=!0;var d=b.getAdjacentOption(b.$activeOption,-1);d.length&&b.setActiveOption(d,!0,!0)}return void a.preventDefault();case h:return void(b.isOpen&&b.$activeOption&&(b.onOptionSelect({currentTarget:b.$activeOption}),a.preventDefault()));case j:return void b.advanceSelection(-1,a);case m:return void b.advanceSelection(1,a);case u:return b.settings.selectOnTab&&b.isOpen&&b.$activeOption&&(b.onOptionSelect({currentTarget:b.$activeOption}),b.isFull()||a.preventDefault()),void(b.settings.create&&b.createItem()&&a.preventDefault());case p:case q:return void b.deleteSelection(a)}return!b.isFull()&&!b.isInputHidden||(f?a.metaKey:a.ctrlKey)?void 0:void a.preventDefault()},onKeyUp:function(a){var b=this;if(b.isLocked)return a&&a.preventDefault();var c=b.$control_input.val()||"";b.lastValue!==c&&(b.lastValue=c,b.onSearchChange(c),b.refreshOptions(),b.trigger("type",c))},onSearchChange:function(a){var b=this,c=b.settings.load;c&&(b.loadedSearches.hasOwnProperty(a)||(b.loadedSearches[a]=!0,b.load(function(d){c.apply(b,[a,d])})))},onFocus:function(a){var b=this,c=b.isFocused;return b.isDisabled?(b.blur(),a&&a.preventDefault(),!1):void(b.ignoreFocus||(b.isFocused=!0,"focus"===b.settings.preload&&b.onSearchChange(""),c||b.trigger("focus"),b.$activeItems.length||(b.showInput(),b.setActiveItem(null),b.refreshOptions(!!b.settings.openOnFocus)),b.refreshState()))},onBlur:function(a,b){var c=this;if(c.isFocused&&(c.isFocused=!1,!c.ignoreFocus)){if(!c.ignoreBlur&&document.activeElement===c.$dropdown_content[0])return c.ignoreBlur=!0,void c.onFocus(a);var d=function(){c.close(),c.setTextboxValue(""),c.setActiveItem(null),c.setActiveOption(null),c.setCaret(c.items.length),c.refreshState(),(b||document.body).focus(),c.ignoreFocus=!1,c.trigger("blur")};c.ignoreFocus=!0,c.settings.create&&c.settings.createOnBlur?c.createItem(null,!1,d):d()}},onOptionHover:function(a){this.ignoreHover||this.setActiveOption(a.currentTarget,!1)},onOptionSelect:function(b){var c,d,e=this;b.preventDefault&&(b.preventDefault(),b.stopPropagation()),d=a(b.currentTarget),d.hasClass("create")?e.createItem(null,function(){e.settings.closeAfterSelect&&e.close()}):(c=d.attr("data-value"),"undefined"!=typeof c&&(e.lastQuery=null,e.setTextboxValue(""),e.addItem(c),e.settings.closeAfterSelect?e.close():!e.settings.hideSelected&&b.type&&/mouse/.test(b.type)&&e.setActiveOption(e.getOption(c))))},onItemSelect:function(a){var b=this;b.isLocked||"multi"===b.settings.mode&&(a.preventDefault(),b.setActiveItem(a.currentTarget,a))},load:function(a){var b=this,c=b.$wrapper.addClass(b.settings.loadingClass);b.loading++,a.apply(b,[function(a){b.loading=Math.max(b.loading-1,0),a&&a.length&&(b.addOption(a),b.refreshOptions(b.isFocused&&!b.isInputHidden)),b.loading||c.removeClass(b.settings.loadingClass),b.trigger("load",a)}])},setTextboxValue:function(a){var b=this.$control_input,c=b.val()!==a;c&&(b.val(a).triggerHandler("update"),this.lastValue=a)},getValue:function(){return this.tagType===v&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(a,b){var c=b?[]:["change"];F(this,c,function(){this.clear(b),this.addItems(a,b)})},setActiveItem:function(b,c){var d,e,f,g,h,i,j,k,l=this;if("single"!==l.settings.mode){if(b=a(b),!b.length)return a(l.$activeItems).removeClass("active"),l.$activeItems=[],void(l.isFocused&&l.showInput());if(d=c&&c.type.toLowerCase(),"mousedown"===d&&l.isShiftDown&&l.$activeItems.length){for(k=l.$control.children(".active:last"),g=Array.prototype.indexOf.apply(l.$control[0].childNodes,[k[0]]),h=Array.prototype.indexOf.apply(l.$control[0].childNodes,[b[0]]),g>h&&(j=g,g=h,h=j),e=g;h>=e;e++)i=l.$control[0].childNodes[e],-1===l.$activeItems.indexOf(i)&&(a(i).addClass("active"),l.$activeItems.push(i));c.preventDefault()}else"mousedown"===d&&l.isCtrlDown||"keydown"===d&&this.isShiftDown?b.hasClass("active")?(f=l.$activeItems.indexOf(b[0]),l.$activeItems.splice(f,1),b.removeClass("active")):l.$activeItems.push(b.addClass("active")[0]):(a(l.$activeItems).removeClass("active"),l.$activeItems=[b.addClass("active")[0]]);l.hideInput(),this.isFocused||l.focus()}},setActiveOption:function(b,c,d){var e,f,g,h,i,j=this;j.$activeOption&&j.$activeOption.removeClass("active"),j.$activeOption=null,b=a(b),b.length&&(j.$activeOption=b.addClass("active"),(c||!y(c))&&(e=j.$dropdown_content.height(),f=j.$activeOption.outerHeight(!0),c=j.$dropdown_content.scrollTop()||0,g=j.$activeOption.offset().top-j.$dropdown_content.offset().top+c,h=g,i=g-e+f,g+f>e+c?j.$dropdown_content.stop().animate({scrollTop:i},d?j.settings.scrollDuration:0):c>g&&j.$dropdown_content.stop().animate({scrollTop:h},d?j.settings.scrollDuration:0)))},selectAll:function(){var a=this;"single"!==a.settings.mode&&(a.$activeItems=Array.prototype.slice.apply(a.$control.children(":not(input)").addClass("active")),a.$activeItems.length&&(a.hideInput(),a.close()),a.focus())},hideInput:function(){var a=this;a.setTextboxValue(""),a.$control_input.css({opacity:0,position:"absolute",left:a.rtl?1e4:-1e4}),a.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var a=this;a.isDisabled||(a.ignoreFocus=!0,a.$control_input[0].focus(),window.setTimeout(function(){a.ignoreFocus=!1,a.onFocus()},0))},blur:function(a){this.$control_input[0].blur(),this.onBlur(null,a)},getScoreFunction:function(a){return this.sifter.getScoreFunction(a,this.getSearchOptions())},getSearchOptions:function(){var a=this.settings,b=a.sortField;return"string"==typeof b&&(b=[{field:b}]),{fields:a.searchField,conjunction:a.searchConjunction,sort:b}},search:function(b){var c,d,e,f=this,g=f.settings,h=this.getSearchOptions();if(g.score&&(e=f.settings.score.apply(this,[b]),"function"!=typeof e))throw new Error('Selectize "score" setting must be a function that returns a function');if(b!==f.lastQuery?(f.lastQuery=b,d=f.sifter.search(b,a.extend(h,{score:e})),f.currentResults=d):d=a.extend(!0,{},f.currentResults),g.hideSelected)for(c=d.items.length-1;c>=0;c--)-1!==f.items.indexOf(z(d.items[c].id))&&d.items.splice(c,1);return d},refreshOptions:function(b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;"undefined"==typeof b&&(b=!0);var t=this,u=a.trim(t.$control_input.val()),v=t.search(u),w=t.$dropdown_content,x=t.$activeOption&&z(t.$activeOption.attr("data-value"));for(g=v.items.length,"number"==typeof t.settings.maxOptions&&(g=Math.min(g,t.settings.maxOptions)),h={},i=[],c=0;g>c;c++)for(j=t.options[v.items[c].id],k=t.render("option",j),l=j[t.settings.optgroupField]||"",m=a.isArray(l)?l:[l],e=0,f=m&&m.length;f>e;e++)l=m[e],t.optgroups.hasOwnProperty(l)||(l=""),h.hasOwnProperty(l)||(h[l]=[],i.push(l)),h[l].push(k);for(this.settings.lockOptgroupOrder&&i.sort(function(a,b){var c=t.optgroups[a].$order||0,d=t.optgroups[b].$order||0;return c-d}),n=[],c=0,g=i.length;g>c;c++)l=i[c],t.optgroups.hasOwnProperty(l)&&h[l].length?(o=t.render("optgroup_header",t.optgroups[l])||"",o+=h[l].join(""),n.push(t.render("optgroup",a.extend({},t.optgroups[l],{html:o})))):n.push(h[l].join(""));if(w.html(n.join("")),t.settings.highlight&&v.query.length&&v.tokens.length)for(c=0,g=v.tokens.length;g>c;c++)d(w,v.tokens[c].regex);if(!t.settings.hideSelected)for(c=0,g=t.items.length;g>c;c++)t.getOption(t.items[c]).addClass("selected");p=t.canCreate(u),p&&(w.prepend(t.render("option_create",{input:u})),s=a(w[0].childNodes[0])),t.hasOptions=v.items.length>0||p,t.hasOptions?(v.items.length>0?(r=x&&t.getOption(x),r&&r.length?q=r:"single"===t.settings.mode&&t.items.length&&(q=t.getOption(t.items[0])),q&&q.length||(q=s&&!t.settings.addPrecedence?t.getAdjacentOption(s,1):w.find("[data-selectable]:first"))):q=s,t.setActiveOption(q),b&&!t.isOpen&&t.open()):(t.setActiveOption(null),b&&t.isOpen&&t.close())},addOption:function(b){var c,d,e,f=this;if(a.isArray(b))for(c=0,d=b.length;d>c;c++)f.addOption(b[c]);else(e=f.registerOption(b))&&(f.userOptions[e]=!0,f.lastQuery=null,f.trigger("option_add",e,b))},registerOption:function(a){var b=z(a[this.settings.valueField]);return!b||this.options.hasOwnProperty(b)?!1:(a.$order=a.$order||++this.order,this.options[b]=a,b)},registerOptionGroup:function(a){var b=z(a[this.settings.optgroupValueField]);return b?(a.$order=a.$order||++this.order,this.optgroups[b]=a,b):!1},addOptionGroup:function(a,b){b[this.settings.optgroupValueField]=a,(a=this.registerOptionGroup(b))&&this.trigger("optgroup_add",a,b)},removeOptionGroup:function(a){this.optgroups.hasOwnProperty(a)&&(delete this.optgroups[a],this.renderCache={},this.trigger("optgroup_remove",a))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(b,c){var d,e,f,g,h,i,j,k=this;if(b=z(b),f=z(c[k.settings.valueField]),null!==b&&k.options.hasOwnProperty(b)){if("string"!=typeof f)throw new Error("Value must be set in option data");j=k.options[b].$order,f!==b&&(delete k.options[b],g=k.items.indexOf(b),-1!==g&&k.items.splice(g,1,f)),c.$order=c.$order||j,k.options[f]=c,h=k.renderCache.item,i=k.renderCache.option,h&&(delete h[b],delete h[f]),i&&(delete i[b],delete i[f]),-1!==k.items.indexOf(f)&&(d=k.getItem(b),e=a(k.render("item",c)),d.hasClass("active")&&e.addClass("active"),d.replaceWith(e)),k.lastQuery=null,k.isOpen&&k.refreshOptions(!1)}},removeOption:function(a,b){var c=this;a=z(a);var d=c.renderCache.item,e=c.renderCache.option;d&&delete d[a],e&&delete e[a],delete c.userOptions[a],delete c.options[a],c.lastQuery=null,c.trigger("option_remove",a),c.removeItem(a,b)},clearOptions:function(){var a=this;a.loadedSearches={},a.userOptions={},a.renderCache={},a.options=a.sifter.items={},a.lastQuery=null,a.trigger("option_clear"),a.clear()},getOption:function(a){return this.getElementWithValue(a,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(b,c){var d=this.$dropdown.find("[data-selectable]"),e=d.index(b)+c;return e>=0&&e<d.length?d.eq(e):a()},getElementWithValue:function(b,c){if(b=z(b),"undefined"!=typeof b&&null!==b)for(var d=0,e=c.length;e>d;d++)if(c[d].getAttribute("data-value")===b)return a(c[d]);return a()},getItem:function(a){return this.getElementWithValue(a,this.$control.children())},addItems:function(b,c){for(var d=a.isArray(b)?b:[b],e=0,f=d.length;f>e;e++)this.isPending=f-1>e,this.addItem(d[e],c)},addItem:function(b,c){var d=c?[]:["change"];F(this,d,function(){var d,e,f,g,h,i=this,j=i.settings.mode;return b=z(b),-1!==i.items.indexOf(b)?void("single"===j&&i.close()):void(i.options.hasOwnProperty(b)&&("single"===j&&i.clear(c),"multi"===j&&i.isFull()||(d=a(i.render("item",i.options[b])),h=i.isFull(),i.items.splice(i.caretPos,0,b),i.insertAtCaret(d),(!i.isPending||!h&&i.isFull())&&i.refreshState(),i.isSetup&&(f=i.$dropdown_content.find("[data-selectable]"),i.isPending||(e=i.getOption(b),g=i.getAdjacentOption(e,1).attr("data-value"),i.refreshOptions(i.isFocused&&"single"!==j),g&&i.setActiveOption(i.getOption(g))),!f.length||i.isFull()?i.close():i.positionDropdown(),i.updatePlaceholder(),i.trigger("item_add",b,d),i.updateOriginalInput({silent:c})))))})},removeItem:function(a,b){var c,d,e,f=this;c="object"==typeof a?a:f.getItem(a),a=z(c.attr("data-value")),d=f.items.indexOf(a),-1!==d&&(c.remove(),c.hasClass("active")&&(e=f.$activeItems.indexOf(c[0]),f.$activeItems.splice(e,1)),f.items.splice(d,1),f.lastQuery=null,!f.settings.persist&&f.userOptions.hasOwnProperty(a)&&f.removeOption(a,b),d<f.caretPos&&f.setCaret(f.caretPos-1),f.refreshState(),f.updatePlaceholder(),f.updateOriginalInput({silent:b}),f.positionDropdown(),f.trigger("item_remove",a,c))},createItem:function(b,c){var d=this,e=d.caretPos;b=b||a.trim(d.$control_input.val()||"");var f=arguments[arguments.length-1];if("function"!=typeof f&&(f=function(){}),"boolean"!=typeof c&&(c=!0),!d.canCreate(b))return f(),!1;d.lock();var g="function"==typeof d.settings.create?this.settings.create:function(a){var b={};return b[d.settings.labelField]=a,b[d.settings.valueField]=a,b},h=D(function(a){if(d.unlock(),!a||"object"!=typeof a)return f();var b=z(a[d.settings.valueField]);return"string"!=typeof b?f():(d.setTextboxValue(""),d.addOption(a),d.setCaret(e),d.addItem(b),d.refreshOptions(c&&"single"!==d.settings.mode),void f(a))}),i=g.apply(this,[b,h]);return"undefined"!=typeof i&&h(i),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){var a,b=this;b.isRequired&&(b.items.length&&(b.isInvalid=!1),b.$control_input.prop("required",a)),b.refreshClasses()},refreshClasses:function(){var b=this,c=b.isFull(),d=b.isLocked;b.$wrapper.toggleClass("rtl",b.rtl),b.$control.toggleClass("focus",b.isFocused).toggleClass("disabled",b.isDisabled).toggleClass("required",b.isRequired).toggleClass("invalid",b.isInvalid).toggleClass("locked",d).toggleClass("full",c).toggleClass("not-full",!c).toggleClass("input-active",b.isFocused&&!b.isInputHidden).toggleClass("dropdown-active",b.isOpen).toggleClass("has-options",!a.isEmptyObject(b.options)).toggleClass("has-items",b.items.length>0),b.$control_input.data("grow",!c&&!d)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(a){var b,c,d,e,f=this;if(a=a||{},f.tagType===v){for(d=[],b=0,c=f.items.length;c>b;b++)e=f.options[f.items[b]][f.settings.labelField]||"",d.push('<option value="'+A(f.items[b])+'" selected="selected">'+A(e)+"</option>");d.length||this.$input.attr("multiple")||d.push('<option value="" selected="selected"></option>'),f.$input.html(d.join(""))}else f.$input.val(f.getValue()),f.$input.attr("value",f.$input.val());f.isSetup&&(a.silent||f.trigger("change",f.$input.val()))},updatePlaceholder:function(){if(this.settings.placeholder){var a=this.$control_input;this.items.length?a.removeAttr("placeholder"):a.attr("placeholder",this.settings.placeholder),a.triggerHandler("update",{force:!0})}},open:function(){var a=this;a.isLocked||a.isOpen||"multi"===a.settings.mode&&a.isFull()||(a.focus(),a.isOpen=!0,a.refreshState(),a.$dropdown.css({visibility:"hidden",display:"block"}),a.positionDropdown(),a.$dropdown.css({visibility:"visible"}),a.trigger("dropdown_open",a.$dropdown))},close:function(){var a=this,b=a.isOpen;"single"===a.settings.mode&&a.items.length&&a.hideInput(),a.isOpen=!1,a.$dropdown.hide(),a.setActiveOption(null),a.refreshState(),b&&a.trigger("dropdown_close",a.$dropdown)},positionDropdown:function(){var a=this.$control,b="body"===this.settings.dropdownParent?a.offset():a.position();b.top+=a.outerHeight(!0),this.$dropdown.css({width:a.outerWidth(),top:b.top,left:b.left})},clear:function(a){var b=this;b.items.length&&(b.$control.children(":not(input)").remove(),b.items=[],b.lastQuery=null,b.setCaret(0),b.setActiveItem(null),b.updatePlaceholder(),b.updateOriginalInput({silent:a}),b.refreshState(),b.showInput(),b.trigger("clear"))},insertAtCaret:function(b){var c=Math.min(this.caretPos,this.items.length);0===c?this.$control.prepend(b):a(this.$control[0].childNodes[c]).before(b),this.setCaret(c+1)},deleteSelection:function(b){var c,d,e,f,g,h,i,j,k,l=this;if(e=b&&b.keyCode===p?-1:1,f=H(l.$control_input[0]),l.$activeOption&&!l.settings.hideSelected&&(i=l.getAdjacentOption(l.$activeOption,-1).attr("data-value")),g=[],l.$activeItems.length){for(k=l.$control.children(".active:"+(e>0?"last":"first")),h=l.$control.children(":not(input)").index(k),e>0&&h++,c=0,d=l.$activeItems.length;d>c;c++)g.push(a(l.$activeItems[c]).attr("data-value"));b&&(b.preventDefault(),b.stopPropagation())}else(l.isFocused||"single"===l.settings.mode)&&l.items.length&&(0>e&&0===f.start&&0===f.length?g.push(l.items[l.caretPos-1]):e>0&&f.start===l.$control_input.val().length&&g.push(l.items[l.caretPos]));if(!g.length||"function"==typeof l.settings.onDelete&&l.settings.onDelete.apply(l,[g])===!1)return!1;for("undefined"!=typeof h&&l.setCaret(h);g.length;)l.removeItem(g.pop());return l.showInput(),l.positionDropdown(),l.refreshOptions(!0),i&&(j=l.getOption(i),j.length&&l.setActiveOption(j)),!0},advanceSelection:function(a,b){var c,d,e,f,g,h,i=this;0!==a&&(i.rtl&&(a*=-1),c=a>0?"last":"first",
d=H(i.$control_input[0]),i.isFocused&&!i.isInputHidden?(f=i.$control_input.val().length,g=0>a?0===d.start&&0===d.length:d.start===f,g&&!f&&i.advanceCaret(a,b)):(h=i.$control.children(".active:"+c),h.length&&(e=i.$control.children(":not(input)").index(h),i.setActiveItem(null),i.setCaret(a>0?e+1:e))))},advanceCaret:function(a,b){var c,d,e=this;0!==a&&(c=a>0?"next":"prev",e.isShiftDown?(d=e.$control_input[c](),d.length&&(e.hideInput(),e.setActiveItem(d),b&&b.preventDefault())):e.setCaret(e.caretPos+a))},setCaret:function(b){var c=this;if(b="single"===c.settings.mode?c.items.length:Math.max(0,Math.min(c.items.length,b)),!c.isPending){var d,e,f,g;for(f=c.$control.children(":not(input)"),d=0,e=f.length;e>d;d++)g=a(f[d]).detach(),b>d?c.$control_input.before(g):c.$control.append(g)}c.caretPos=b},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var a=this;a.$input.prop("disabled",!0),a.$control_input.prop("disabled",!0).prop("tabindex",-1),a.isDisabled=!0,a.lock()},enable:function(){var a=this;a.$input.prop("disabled",!1),a.$control_input.prop("disabled",!1).prop("tabindex",a.tabIndex),a.isDisabled=!1,a.unlock()},destroy:function(){var b=this,c=b.eventNS,d=b.revertSettings;b.trigger("destroy"),b.off(),b.$wrapper.remove(),b.$dropdown.remove(),b.$input.html("").append(d.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:d.tabindex}).show(),b.$control_input.removeData("grow"),b.$input.removeData("selectize"),a(window).off(c),a(document).off(c),a(document.body).off(c),delete b.$input[0].selectize},render:function(a,b){var c,d,e="",f=!1,g=this,h=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===a||"item"===a)&&(c=z(b[g.settings.valueField]),f=!!c),f&&(y(g.renderCache[a])||(g.renderCache[a]={}),g.renderCache[a].hasOwnProperty(c))?g.renderCache[a][c]:(e=g.settings.render[a].apply(this,[b,A]),("option"===a||"option_create"===a)&&(e=e.replace(h,"<$1 data-selectable")),"optgroup"===a&&(d=b[g.settings.optgroupValueField]||"",e=e.replace(h,'<$1 data-group="'+B(A(d))+'"')),("option"===a||"item"===a)&&(e=e.replace(h,'<$1 data-value="'+B(A(c||""))+'"')),f&&(g.renderCache[a][c]=e),e)},clearCache:function(a){var b=this;"undefined"==typeof a?b.renderCache={}:delete b.renderCache[a]},canCreate:function(a){var b=this;if(!b.settings.create)return!1;var c=b.settings.createFilter;return a.length&&("function"!=typeof c||c.apply(b,[a]))&&("string"!=typeof c||new RegExp(c).test(a))&&(!(c instanceof RegExp)||c.test(a))}}),L.count=0,L.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},a.fn.selectize=function(b){var c=a.fn.selectize.defaults,d=a.extend({},c,b),e=d.dataAttr,f=d.labelField,g=d.valueField,h=d.optgroupField,i=d.optgroupLabelField,j=d.optgroupValueField,k=function(b,c){var h,i,j,k,l=b.attr(e);if(l)for(c.options=JSON.parse(l),h=0,i=c.options.length;i>h;h++)c.items.push(c.options[h][g]);else{var m=a.trim(b.val()||"");if(!d.allowEmptyOption&&!m.length)return;for(j=m.split(d.delimiter),h=0,i=j.length;i>h;h++)k={},k[f]=j[h],k[g]=j[h],c.options.push(k);c.items=j}},l=function(b,c){var k,l,m,n,o=c.options,p={},q=function(a){var b=e&&a.attr(e);return"string"==typeof b&&b.length?JSON.parse(b):null},r=function(b,e){b=a(b);var i=z(b.attr("value"));if(i||d.allowEmptyOption)if(p.hasOwnProperty(i)){if(e){var j=p[i][h];j?a.isArray(j)?j.push(e):p[i][h]=[j,e]:p[i][h]=e}}else{var k=q(b)||{};k[f]=k[f]||b.text(),k[g]=k[g]||i,k[h]=k[h]||e,p[i]=k,o.push(k),b.is(":selected")&&c.items.push(i)}},s=function(b){var d,e,f,g,h;for(b=a(b),f=b.attr("label"),f&&(g=q(b)||{},g[i]=f,g[j]=f,c.optgroups.push(g)),h=a("option",b),d=0,e=h.length;e>d;d++)r(h[d],f)};for(c.maxItems=b.attr("multiple")?null:1,n=b.children(),k=0,l=n.length;l>k;k++)m=n[k].tagName.toLowerCase(),"optgroup"===m?s(n[k]):"option"===m&&r(n[k])};return this.each(function(){if(!this.selectize){var e,f=a(this),g=this.tagName.toLowerCase(),h=f.attr("placeholder")||f.attr("data-placeholder");h||d.allowEmptyOption||(h=f.children('option[value=""]').text());var i={placeholder:h,options:[],optgroups:[],items:[]};"select"===g?l(f,i):k(f,i),e=new L(f,a.extend(!0,{},c,i,b))}})},a.fn.selectize.defaults=L.defaults,a.fn.selectize.support={validity:x},L.define("drag_drop",function(b){if(!a.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var c=this;c.lock=function(){var a=c.lock;return function(){var b=c.$control.data("sortable");return b&&b.disable(),a.apply(c,arguments)}}(),c.unlock=function(){var a=c.unlock;return function(){var b=c.$control.data("sortable");return b&&b.enable(),a.apply(c,arguments)}}(),c.setup=function(){var b=c.setup;return function(){b.apply(this,arguments);var d=c.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:c.isLocked,start:function(a,b){b.placeholder.css("width",b.helper.css("width")),d.css({overflow:"visible"})},stop:function(){d.css({overflow:"hidden"});var b=c.$activeItems?c.$activeItems.slice():null,e=[];d.children("[data-value]").each(function(){e.push(a(this).attr("data-value"))}),c.setValue(e),c.setActiveItem(b)}})}}()}}),L.define("dropdown_header",function(b){var c=this;b=a.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(a){return'<div class="'+a.headerClass+'"><div class="'+a.titleRowClass+'"><span class="'+a.labelClass+'">'+a.title+'</span><a href="javascript:void(0)" class="'+a.closeClass+'">&times;</a></div></div>'}},b),c.setup=function(){var d=c.setup;return function(){d.apply(c,arguments),c.$dropdown_header=a(b.html(b)),c.$dropdown.prepend(c.$dropdown_header)}}()}),L.define("optgroup_columns",function(b){var c=this;b=a.extend({equalizeWidth:!0,equalizeHeight:!0},b),this.getAdjacentOption=function(b,c){var d=b.closest("[data-group]").find("[data-selectable]"),e=d.index(b)+c;return e>=0&&e<d.length?d.eq(e):a()},this.onKeyDown=function(){var a=c.onKeyDown;return function(b){var d,e,f,g;return!this.isOpen||b.keyCode!==j&&b.keyCode!==m?a.apply(this,arguments):(c.ignoreHover=!0,g=this.$activeOption.closest("[data-group]"),d=g.find("[data-selectable]").index(this.$activeOption),g=b.keyCode===j?g.prev("[data-group]"):g.next("[data-group]"),f=g.find("[data-selectable]"),e=f.eq(Math.min(f.length-1,d)),void(e.length&&this.setActiveOption(e)))}}();var d=function(){var a,b=d.width,c=document;return"undefined"==typeof b&&(a=c.createElement("div"),a.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',a=a.firstChild,c.body.appendChild(a),b=d.width=a.offsetWidth-a.clientWidth,c.body.removeChild(a)),b},e=function(){var e,f,g,h,i,j,k;if(k=a("[data-group]",c.$dropdown_content),f=k.length,f&&c.$dropdown_content.width()){if(b.equalizeHeight){for(g=0,e=0;f>e;e++)g=Math.max(g,k.eq(e).height());k.css({height:g})}b.equalizeWidth&&(j=c.$dropdown_content.innerWidth()-d(),h=Math.round(j/f),k.css({width:h}),f>1&&(i=j-h*(f-1),k.eq(f-1).css({width:i})))}};(b.equalizeHeight||b.equalizeWidth)&&(C.after(this,"positionDropdown",e),C.after(this,"refreshOptions",e))}),L.define("remove_button",function(b){if("single"!==this.settings.mode){b=a.extend({label:"&times;",title:"Remove",className:"remove",append:!0},b);var c=this,d='<a href="javascript:void(0)" class="'+b.className+'" tabindex="-1" title="'+A(b.title)+'">'+b.label+"</a>",e=function(a,b){var c=a.search(/(<\/[^>]+>\s*)$/);return a.substring(0,c)+b+a.substring(c)};this.setup=function(){var f=c.setup;return function(){if(b.append){var g=c.settings.render.item;c.settings.render.item=function(a){return e(g.apply(this,arguments),d)}}f.apply(this,arguments),this.$control.on("click","."+b.className,function(b){if(b.preventDefault(),!c.isLocked){var d=a(b.currentTarget).parent();c.setActiveItem(d),c.deleteSelection()&&c.setCaret(c.items.length)}})}}()}}),L.define("restore_on_backspace",function(a){var b=this;a.text=a.text||function(a){return a[this.settings.labelField]},this.onKeyDown=function(){var c=b.onKeyDown;return function(b){var d,e;return b.keyCode===p&&""===this.$control_input.val()&&!this.$activeItems.length&&(d=this.caretPos-1,d>=0&&d<this.items.length)?(e=this.options[this.items[d]],this.deleteSelection(b)&&(this.setTextboxValue(a.text.apply(this,[e])),this.refreshOptions(!0)),void b.preventDefault()):c.apply(this,arguments)}}()}),L}),function(a){if("undefined"!=typeof exports&&"undefined"!=typeof require)var b=a._||require("underscore"),c=a.Backbone||require("backbone");else var b=a._,c=a.Backbone;var d=c.View.extend({events:{submit:function(a){this.trigger("submit",a)}},initialize:function(a){var c=this;a=this.options=b.extend({submitButton:!1},a);var d=this.schema=function(){if(a.schema)return b.result(a,"schema");var d=a.model;return d&&d.schema?b.result(d,"schema"):c.schema?b.result(c,"schema"):{}}();b.extend(this,b.pick(a,"model","data","idPrefix","templateData"));var e=this.constructor;this.template=a.template||this.template||e.template,this.Fieldset=a.Fieldset||this.Fieldset||e.Fieldset,this.Field=a.Field||this.Field||e.Field,this.NestedField=a.NestedField||this.NestedField||e.NestedField;var f=this.selectedFields=a.fields||b.keys(d),g=this.fields={};b.each(f,function(a){var b=d[a];g[a]=this.createField(a,b)},this);var h=a.fieldsets||b.result(this,"fieldsets")||b.result(this.model,"fieldsets")||[f];this.fieldsets=[];b.each(h,function(a){this.fieldsets.push(this.createFieldset(a))},this)},createFieldset:function(a){var b={schema:a,fields:this.fields,legend:a.legend||null};return new this.Fieldset(b)},createField:function(a,b){var c={form:this,key:a,schema:b,idPrefix:this.idPrefix};this.model?c.model=this.model:this.data?c.value=this.data[a]:c.value=null;var d=new this.Field(c);return this.listenTo(d.editor,"all",this.handleEditorEvent),d},handleEditorEvent:function(a,c){var d=c.key+":"+a;switch(this.trigger.call(this,d,this,c,Array.prototype.slice.call(arguments,2)),a){case"change":this.trigger("change",this);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":if(this.hasFocus){var e=this;setTimeout(function(){var a=b.find(e.fields,function(a){return a.editor.hasFocus});a||e.trigger("blur",e)},0)}}},templateData:function(){var a=this.options;return{submitButton:a.submitButton}},render:function(){var a=this,d=this.fields,e=c.$,f=e(e.trim(this.template(b.result(this,"templateData"))));return f.find("[data-editors]").add(f).each(function(c,f){var g=e(f),h=g.attr("data-editors");if(!b.isUndefined(h)){var i="*"==h?a.selectedFields||b.keys(d):h.split(",");b.each(i,function(a){var b=d[a];g.append(b.editor.render().el)})}}),f.find("[data-fields]").add(f).each(function(c,f){var g=e(f),h=g.attr("data-fields");if(!b.isUndefined(h)){var i="*"==h?a.selectedFields||b.keys(d):h.split(",");b.each(i,function(a){var b=d[a];g.append(b.render().el)})}}),f.find("[data-fieldsets]").add(f).each(function(c,d){var f=e(d),g=f.attr("data-fieldsets");b.isUndefined(g)||b.each(a.fieldsets,function(a){f.append(a.render().el)})}),this.setElement(f),f.addClass(this.className),this},validate:function(a){var c=this.fields,d=this.model,e={};if(a=a||{},b.each(c,function(a){var b=a.validate();b&&(e[a.key]=b)}),!a.skipModelValidate&&d&&d.validate){var f=d.validate(this.getValue());if(f){var g=b.isObject(f)&&!b.isArray(f);g||(e._others=e._others||[],e._others.push(f)),g&&b.each(f,function(a,b){if(c[b]&&!e[b])c[b].setError(a),e[b]=a;else{e._others=e._others||[];var d={};d[b]=a,e._others.push(d)}})}}return b.isEmpty(e)?null:e},commit:function(a){a=a||{};var c={skipModelValidate:!a.validate},d=this.validate(c);if(d)return d;var e,f=b.extend({error:function(a,b){e=b}},a);return this.model.set(this.getValue(),f),e?e:void 0},getValue:function(a){if(a)return this.fields[a].getValue();var c={};return b.each(this.fields,function(a){c[a.key]=a.getValue()}),c},setValue:function(a,b){var c={};"string"==typeof a?c[a]=b:c=a;var d;for(d in this.schema)void 0!==c[d]&&this.fields[d].setValue(c[d])},getEditor:function(a){var b=this.fields[a];if(!b)throw new Error("Field not found: "+a);return b.editor},focus:function(){if(!this.hasFocus){var a=this.fieldsets[0],b=a.getFieldAt(0);b&&b.editor.focus()}},blur:function(){if(this.hasFocus){var a=b.find(this.fields,function(a){return a.editor.hasFocus});a&&a.editor.blur()}},trigger:function(a){return"focus"===a?this.hasFocus=!0:"blur"===a&&(this.hasFocus=!1),c.View.prototype.trigger.apply(this,arguments)},remove:function(){return b.each(this.fieldsets,function(a){a.remove()}),b.each(this.fields,function(a){a.remove()}),c.View.prototype.remove.apply(this,arguments)}},{template:b.template('    <form>     <div data-fieldsets></div>      <% if (submitButton) { %>        <button type="submit"><%= submitButton %></button>      <% } %>    </form>  ',null,this.templateSettings),templateSettings:{evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},editors:{}});d.validators=function(){var a={};return a.errMessages={required:"Required",regexp:"Invalid",number:"Must be a number",email:"Invalid email address",url:"Invalid URL",match:b.template('Must match field "<%= field %>"',null,d.templateSettings)},a.required=function(a){return a=b.extend({type:"required",message:this.errMessages.required},a),function(c){a.value=c;var d={type:a.type,message:b.isFunction(a.message)?a.message(a):a.message};return null===c||void 0===c||c===!1||""===c?d:void 0}},a.regexp=function(a){if(!a.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return a=b.extend({type:"regexp",match:!0,message:this.errMessages.regexp},a),function(c){a.value=c;var d={type:a.type,message:b.isFunction(a.message)?a.message(a):a.message};if(null!==c&&void 0!==c&&""!==c)return"string"==typeof a.regexp&&(a.regexp=new RegExp(a.regexp,a.flags)),(a.match?!a.regexp.test(c):a.regexp.test(c))?d:void 0}},a.number=function(c){return c=b.extend({type:"number",message:this.errMessages.number,regexp:/^[0-9]*\.?[0-9]*?$/},c),a.regexp(c)},a.email=function(c){return c=b.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},c),a.regexp(c)},a.url=function(c){return c=b.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i},c),a.regexp(c)},a.match=function(a){if(!a.field)throw new Error('Missing required "field" options for "match" validator');return a=b.extend({type:"match",message:this.errMessages.match},a),function(c,d){a.value=c;var e={type:a.type,message:b.isFunction(a.message)?a.message(a):a.message};if(null!==c&&void 0!==c&&""!==c)return c!==d[a.field]?e:void 0}},a}(),d.Fieldset=c.View.extend({initialize:function(a){a=a||{};var c=this.schema=this.createSchema(a.schema);this.fields=b.pick(a.fields,c.fields),this.template=a.template||c.template||this.template||this.constructor.template},createSchema:function(a){return b.isArray(a)&&(a={fields:a}),a.legend=a.legend||null,a},getFieldAt:function(a){var b=this.schema.fields[a];return this.fields[b]},templateData:function(){return this.schema},render:function(){var a=(this.schema,this.fields),d=c.$,e=d(d.trim(this.template(b.result(this,"templateData"))));return e.find("[data-fields]").add(e).each(function(c,e){var f=d(e),g=f.attr("data-fields");b.isUndefined(g)||b.each(a,function(a){f.append(a.render().el)})}),this.setElement(e),this},remove:function(){b.each(this.fields,function(a){a.remove()}),c.View.prototype.remove.call(this)}},{template:b.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  ",null,d.templateSettings)}),d.Field=c.View.extend({initialize:function(a){a=a||{},b.extend(this,b.pick(a,"form","key","model","value","idPrefix"));var c=this.schema=this.createSchema(a.schema);this.template=a.template||c.template||this.template||this.constructor.template,this.errorClassName=a.errorClassName||this.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(a){return b.isString(a)&&(a={type:a}),a=b.extend({type:"Text",title:this.createTitle()},a),a.type=b.isString(a.type)?d.editors[a.type]:a.type,a},createEditor:function(){var a=b.extend(b.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()}),c=this.schema.type;return new c(a)},createEditorId:function(){var a=this.idPrefix,c=this.key;return c=c.replace(/\./g,"_"),b.isString(a)||b.isNumber(a)?a+c:b.isNull(a)?c:this.model?this.model.cid+"_"+c:c},createTitle:function(){var a=this.key;return a=a.replace(/([A-Z])/g," $1"),a=a.replace(/^./,function(a){return a.toUpperCase()})},templateData:function(){var a=this.schema;return{help:a.help||"",title:a.title,titleHTML:a.titleHTML,fieldAttrs:a.fieldAttrs,editorAttrs:a.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var a=this.schema,d=this.editor,e=c.$;if(this.editor.noField===!0)return this.setElement(d.render().el);var f=e(e.trim(this.template(b.result(this,"templateData"))));return a.fieldClass&&f.addClass(a.fieldClass),a.fieldAttrs&&f.attr(a.fieldAttrs),f.find("[data-editor]").add(f).each(function(a,c){var f=e(c),g=f.attr("data-editor");b.isUndefined(g)||f.append(d.render().el)}),this.setElement(f),this},disable:function(){b.isFunction(this.editor.disable)?this.editor.disable():($input=this.editor.$el,$input=$input.is("input")?$input:$input.find("input"),$input.attr("disabled",!0))},enable:function(){b.isFunction(this.editor.enable)?this.editor.enable():($input=this.editor.$el,$input=$input.is("input")?$input:$input.find("input"),$input.attr("disabled",!1))},validate:function(){var a=this.editor.validate();return a?this.setError(a.message):this.clearError(),a},setError:function(a){this.editor.hasNestedForm||(this.$el.addClass(this.errorClassName),this.$("[data-error]").html(a))},clearError:function(){this.$el.removeClass(this.errorClassName),this.$("[data-error]").empty()},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(a){this.editor.setValue(a)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),c.View.prototype.remove.call(this)}},{template:b.template('    <div>      <label for="<%= editorId %>">        <% if (titleHTML){ %><%= titleHTML %>        <% } else { %><%- title %><% } %>      </label>      <div>        <span data-editor></span>        <div data-error></div>        <div><%= help %></div>      </div>    </div>  ',null,d.templateSettings),errorClassName:"error"}),d.NestedField=d.Field.extend({template:b.template('    <div>      <label for="<%= editorId %>">        <% if (titleHTML){ %><%= titleHTML %>        <% } else { %><%- title %><% } %>      </label>      <div>        <span data-editor></span>        <div class="error-text" data-error></div>        <div class="error-help"><%= help %></div>      </div>    </div>  ',null,d.templateSettings)}),d.Editor=d.editors.Base=c.View.extend({defaultValue:null,hasFocus:!1,initialize:function(a){var a=a||{};if(a.model){if(!a.key)throw new Error("Missing option: 'key'");this.model=a.model,this.value=this.model.get(a.key)}else void 0!==a.value&&(this.value=a.value);void 0===this.value&&(this.value=this.defaultValue),b.extend(this,b.pick(a,"key","form"));var c=this.schema=a.schema||{};this.validators=a.validators||c.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),c.editorClass&&this.$el.addClass(c.editorClass),c.editorAttrs&&this.$el.attr(c.editorAttrs)},getName:function(){var a=this.key||"";return a.replace(/\./g,"_")},getValue:function(){return this.value},setValue:function(a){this.value=a},focus:function(){throw new Error("Not implemented")},blur:function(){throw new Error("Not implemented")},commit:function(a){var b=this.validate();return b?b:(this.listenTo(this.model,"invalid",function(a,c){b=c}),this.model.set(this.key,this.getValue(),a),b?b:void 0)},validate:function(){var a=(this.$el,null),c=this.getValue(),d=this.form?this.form.getValue():{},e=this.validators,f=this.getValidator;return e&&b.every(e,function(b){return a=f(b)(c,d),a?!1:!0}),a},trigger:function(a){return"focus"===a?this.hasFocus=!0:"blur"===a&&(this.hasFocus=!1),c.View.prototype.trigger.apply(this,arguments)},getValidator:function(a){var c=d.validators;if(b.isRegExp(a))return c.regexp({regexp:a});if(b.isString(a)){if(!c[a])throw new Error('Validator "'+a+'" not found');return c[a]()}if(b.isFunction(a))return a;if(b.isObject(a)&&a.type){var e=a;return c[e.type](e)}throw new Error("Invalid validator: "+a)}}),d.editors.Text=d.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(a){var b=this;setTimeout(function(){b.determineChange()},0)},select:function(a){this.trigger("select",this)},focus:function(a){this.trigger("focus",this)},blur:function(a){this.trigger("blur",this)}},initialize:function(a){d.editors.Base.prototype.initialize.call(this,a);var b=this.schema,c="text";b&&b.editorAttrs&&b.editorAttrs.type&&(c=b.editorAttrs.type),b&&b.dataType&&(c=b.dataType),this.$el.attr("type",c)},render:function(){return this.setValue(this.value),this},determineChange:function(a){var b=this.$el.val(),c=b!==this.previousValue;c&&(this.previousValue=b,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(a){this.$el.val(a)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},select:function(){this.$el.select()}}),d.editors.TextArea=d.editors.Text.extend({tagName:"textarea",initialize:function(a){d.editors.Base.prototype.initialize.call(this,a)}}),d.editors.Password=d.editors.Text.extend({initialize:function(a){d.editors.Text.prototype.initialize.call(this,a),this.$el.attr("type","password")}}),d.editors.Number=d.editors.Text.extend({defaultValue:0,events:b.extend({},d.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(a){d.editors.Text.prototype.initialize.call(this,a);var b=this.schema;this.$el.attr("type","number"),b&&b.editorAttrs&&b.editorAttrs.step||this.$el.attr("step","any")},onKeyPress:function(a){var b=this,c=function(){setTimeout(function(){b.determineChange()},0)};if(0===a.charCode)return void c();var d=this.$el.val();void 0!=a.charCode&&(d+=String.fromCharCode(a.charCode));var e=/^[0-9]*\.?[0-9]*?$/.test(d);e?c():a.preventDefault()},getValue:function(){var a=this.$el.val();return""===a?null:parseFloat(a,10)},setValue:function(a){a=function(){return b.isNumber(a)?a:b.isString(a)&&""!==a?parseFloat(a,10):null}(),b.isNaN(a)&&(a=null),d.editors.Text.prototype.setValue.call(this,a)}}),d.editors.Hidden=d.editors.Text.extend({defaultValue:"",noField:!0,initialize:function(a){d.editors.Text.prototype.initialize.call(this,a),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),d.editors.Checkbox=d.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(a){this.trigger("change",this)},focus:function(a){this.trigger("focus",this)},blur:function(a){this.trigger("blur",this)}},initialize:function(a){d.editors.Base.prototype.initialize.call(this,a),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(a){a?this.$el.prop("checked",!0):this.$el.prop("checked",!1)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),d.editors.Select=d.editors.Base.extend({tagName:"select",previousValue:"",events:{keyup:"determineChange",keypress:function(a){var b=this;setTimeout(function(){b.determineChange()},0)},change:function(a){this.trigger("change",this)},focus:function(a){this.trigger("focus",this)},blur:function(a){this.trigger("blur",this)}},initialize:function(a){if(d.editors.Base.prototype.initialize.call(this,a),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},render:function(){return this.setOptions(this.schema.options),this},setOptions:function(a){var d=this;if(a instanceof c.Collection){var e=a;e.length>0?this.renderOptions(a):e.fetch({success:function(b){d.renderOptions(a)}})}else b.isFunction(a)?a(function(a){d.renderOptions(a)},d):this.renderOptions(a)},renderOptions:function(a){var b,c=this.$el;b=this._getOptionsHtml(a),c.html(b),this.setValue(this.value)},_getOptionsHtml:function(a){var d;if(b.isString(a))d=a;else if(b.isArray(a))d=this._arrayToHtml(a);else if(a instanceof c.Collection)d=this._collectionToHtml(a);else if(b.isFunction(a)){var e;a(function(a){e=a},this),d=this._getOptionsHtml(e)}else d=this._objectToHtml(a);return d},determineChange:function(a){var b=this.getValue(),c=b!==this.previousValue;c&&(this.previousValue=b,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(a){this.$el.val(a)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},_collectionToHtml:function(a){var b=[];a.each(function(a){b.push({val:a.id,label:a.toString()})});var c=this._arrayToHtml(b);return c},_objectToHtml:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({val:c,label:a[c]});var d=this._arrayToHtml(b);return d},_arrayToHtml:function(a){var c=$();return b.each(a,function(a){if(b.isObject(a))if(a.group){var d=$("<optgroup>").attr("label",a.group).html(this._getOptionsHtml(a.options));c=c.add(d)}else{var e=a.val||0===a.val?a.val:"";c=c.add($("<option>").val(e).text(a.label))}else c=c.add($("<option>").text(a))},this),c}}),d.editors.Radio=d.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=radio]":function(){if(this.hasFocus){var a=this;setTimeout(function(){a.$("input[type=radio]:focus")[0]||a.trigger("blur",a)},0)}}},getTemplate:function(){return this.schema.template||this.constructor.template},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(a){this.$("input[type=radio]").val([a])},focus:function(){if(!this.hasFocus){var a=this.$("input[type=radio]:checked");return a[0]?void a.focus():void this.$("input[type=radio]").first().focus()}},blur:function(){this.hasFocus&&this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(a){var c=this,d=this.getTemplate(),e=c.getName(),f=c.id,g=b.map(a,function(a,c){var d={name:e,id:f+"-"+c};return b.isObject(a)?(d.value=a.val||0===a.val?a.val:"",d.label=a.label,d.labelHTML=a.labelHTML):(d.value=a,d.label=a),d});return d({items:g})}},{template:b.template('    <% _.each(items, function(item) { %>      <li>        <input type="radio" name="<%= item.name %>" value="<%- item.value %>" id="<%= item.id %>" />        <label for="<%= item.id %>"><% if (item.labelHTML){ %><%= item.labelHTML %><% }else{ %><%- item.label %><% } %></label>      </li>    <% }); %>  ',null,d.templateSettings)}),d.editors.Checkboxes=d.editors.Select.extend({tagName:"ul",groupNumber:0,events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=checkbox]":function(){if(this.hasFocus){var a=this;setTimeout(function(){a.$("input[type=checkbox]:focus")[0]||a.trigger("blur",a)},0)}}},getValue:function(){var a=[];return this.$("input[type=checkbox]:checked").each(function(){a.push($(this).val())}),a},setValue:function(a){b.isArray(a)||(a=[a]),this.$("input[type=checkbox]").val(a)},focus:function(){this.hasFocus||this.$("input[type=checkbox]").first().focus()},blur:function(){this.hasFocus&&this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(a){var c=$(),d=this;return b.each(a,function(a,e){var f=$("<li>");if(b.isObject(a))if(a.group){var g=d.id;d.id+="-"+d.groupNumber++,f=$('<fieldset class="group">').append($("<legend>").text(a.group)),f=f.append(d._arrayToHtml(a.options)),d.id=g,close=!1}else{var h=a.val||0===a.val?a.val:"";f.append($('<input type="checkbox" name="'+d.getName()+'" id="'+d.id+"-"+e+'" />').val(h)),a.labelHTML?f.append($('<label for="'+d.id+"-"+e+'">').html(a.labelHTML)):f.append($('<label for="'+d.id+"-"+e+'">').text(a.label))}else f.append($('<input type="checkbox" name="'+d.getName()+'" id="'+d.id+"-"+e+'" />').val(a)),f.append($('<label for="'+d.id+"-"+e+'">').text(a));c=c.add(f)}),c}}),d.editors.Object=d.editors.Base.extend({hasNestedForm:!0,initialize:function(a){if(this.value={},d.editors.Base.prototype.initialize.call(this,a),!this.form)throw new Error('Missing required option "form"');if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var a=this.form.constructor;return this.nestedForm=new a({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:a.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(a){this.value=a,this.render()},focus:function(){this.hasFocus||this.nestedForm.focus()},blur:function(){this.hasFocus&&this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),c.View.prototype.remove.call(this)},validate:function(){var a=b.extend({},d.editors.Base.prototype.validate.call(this),this.nestedForm.validate());return b.isEmpty(a)?!1:a},_observeFormEvents:function(){this.nestedForm&&this.nestedForm.on("all",function(){var a=b.toArray(arguments);a[1]=this,this.trigger.apply(this,a)},this)}}),d.editors.NestedModel=d.editors.Object.extend({initialize:function(a){if(d.editors.Base.prototype.initialize.call(this,a),!this.form)throw new Error('Missing required option "form"');if(!a.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var a=this.form.constructor,b=this.value||{},c=(this.key,this.schema.model),d=b.constructor===c?b:new c(b);return this.nestedForm=new a({model:d,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var a=this.nestedForm.commit();return a?(this.$el.addClass("error"),a):d.editors.Object.prototype.commit.call(this)}}),d.editors.Date=d.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var a=this;setTimeout(function(){a.$("select:focus")[0]||a.trigger("blur",a)},0)}}},initialize:function(a){a=a||{},d.editors.Base.prototype.initialize.call(this,a);var c=d.editors.Date,e=new Date;if(this.options=b.extend({monthNames:c.monthNames,showMonthNames:c.showMonthNames},a),this.schema=b.extend({yearStart:e.getFullYear()-100,yearEnd:e.getFullYear()},a.schema||{}),this.value&&!b.isDate(this.value)&&(this.value=new Date(this.value)),
!this.value){var f=new Date;f.setSeconds(0),f.setMilliseconds(0),this.value=f}this.template=a.template||this.constructor.template},render:function(){var a=this.options,d=this.schema,e=c.$,f=b.map(b.range(1,32),function(a){return'<option value="'+a+'">'+a+"</option>"}),g=b.map(b.range(0,12),function(b){var c=a.showMonthNames?a.monthNames[b]:b+1;return'<option value="'+b+'">'+c+"</option>"}),h=d.yearStart<d.yearEnd?b.range(d.yearStart,d.yearEnd+1):b.range(d.yearStart,d.yearEnd-1,-1),i=b.map(h,function(a){return'<option value="'+a+'">'+a+"</option>"}),j=e(e.trim(this.template({dates:f.join(""),months:g.join(""),years:i.join("")})));return this.$date=j.find('[data-type="date"]'),this.$month=j.find('[data-type="month"]'),this.$year=j.find('[data-type="year"]'),this.$hidden=e('<input type="hidden" name="'+this.key+'" />'),j.append(this.$hidden),this.setValue(this.value),this.setElement(j),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var a=this.$year.val(),b=this.$month.val(),c=this.$date.val();return a&&b&&c?new Date(a,b,c):null},setValue:function(a){this.$date.val(a.getDate()),this.$month.val(a.getMonth()),this.$year.val(a.getFullYear()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var a=this.getValue();b.isDate(a)&&(a=a.toISOString()),this.$hidden.val(a)}},{template:b.template('    <div>      <select data-type="date"><%= dates %></select>      <select data-type="month"><%= months %></select>      <select data-type="year"><%= years %></select>    </div>  ',null,d.templateSettings),showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),d.editors.DateTime=d.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){if(this.hasFocus){var a=this;setTimeout(function(){a.$("select:focus")[0]||a.trigger("blur",a)},0)}}},initialize:function(a){a=a||{},d.editors.Base.prototype.initialize.call(this,a),this.options=b.extend({DateEditor:d.editors.DateTime.DateEditor},a),this.schema=b.extend({minsInterval:15},a.schema||{}),this.dateEditor=new this.options.DateEditor(a),this.value=this.dateEditor.value,this.template=a.template||this.constructor.template},render:function(){function a(a){return 10>a?"0"+a:a}var d=this.schema,e=c.$,f=b.map(b.range(0,24),function(b){return'<option value="'+b+'">'+a(b)+"</option>"}),g=b.map(b.range(0,60,d.minsInterval),function(b){return'<option value="'+b+'">'+a(b)+"</option>"}),h=e(e.trim(this.template({hours:f.join(),mins:g.join()})));return h.find("[data-date]").append(this.dateEditor.render().el),this.$hour=h.find('select[data-type="hour"]'),this.$min=h.find('select[data-type="min"]'),this.$hidden=h.find('input[type="hidden"]'),this.setValue(this.value),this.setElement(h),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var a=this.dateEditor.getValue(),b=this.$hour.val(),c=this.$min.val();return a&&b&&c?(a.setHours(b),a.setMinutes(c),a):null},setValue:function(a){b.isDate(a)||(a=new Date(a)),this.dateEditor.setValue(a),this.$hour.val(a.getHours()),this.$min.val(a.getMinutes()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var a=this.getValue();b.isDate(a)&&(a=a.toISOString()),this.$hidden.val(a)},remove:function(){this.dateEditor.remove(),d.editors.Base.prototype.remove.call(this)}},{template:b.template('    <div class="bbf-datetime">      <div class="bbf-date-container" data-date></div>      <select data-type="hour"><%= hours %></select>      :      <select data-type="min"><%= mins %></select>    </div>  ',null,d.templateSettings),DateEditor:d.editors.Date}),d.VERSION="0.14.0",c.Form=d,"undefined"!=typeof module&&(module.exports=d)}(window||global||this),function(a){"use strict";var b=function(b,c){this.options=a.extend({},a.fn.editableform.defaults,c),this.$div=a(b),this.options.scope||(this.options.scope=this)};b.prototype={constructor:b,initInput:function(){this.input=this.options.input,this.value=this.input.str2value(this.options.value),this.input.prerender()},initTemplate:function(){this.$form=a(a.fn.editableform.template)},initButtons:function(){var b=this.$form.find(".editable-buttons");b.append(a.fn.editableform.buttons),"bottom"===this.options.showbuttons&&b.addClass("editable-buttons-bottom")},render:function(){this.$loading=a(a.fn.editableform.loading),this.$div.empty().append(this.$loading),this.initTemplate(),this.options.showbuttons?this.initButtons():this.$form.find(".editable-buttons").remove(),this.showLoading(),this.isSaving=!1,this.$div.triggerHandler("rendering"),this.initInput(),this.$form.find("div.editable-input").append(this.input.$tpl),this.$div.append(this.$form),a.when(this.input.render()).then(a.proxy(function(){if(this.options.showbuttons||this.input.autosubmit(),this.$form.find(".editable-cancel").click(a.proxy(this.cancel,this)),this.input.error)this.error(this.input.error),this.$form.find(".editable-submit").attr("disabled",!0),this.input.$input.attr("disabled",!0),this.$form.submit(function(a){a.preventDefault()});else{this.error(!1),this.input.$input.removeAttr("disabled"),this.$form.find(".editable-submit").removeAttr("disabled");var b=null===this.value||void 0===this.value||""===this.value?this.options.defaultValue:this.value;this.input.value2input(b),this.$form.submit(a.proxy(this.submit,this))}this.$div.triggerHandler("rendered"),this.showForm(),this.input.postrender&&this.input.postrender()},this))},cancel:function(){this.$div.triggerHandler("cancel")},showLoading:function(){var a,b;this.$form?(a=this.$form.outerWidth(),b=this.$form.outerHeight(),a&&this.$loading.width(a),b&&this.$loading.height(b),this.$form.hide()):(a=this.$loading.parent().width(),a&&this.$loading.width(a)),this.$loading.show()},showForm:function(a){this.$loading.hide(),this.$form.show(),a!==!1&&this.input.activate(),this.$div.triggerHandler("show")},error:function(b){var c,d=this.$form.find(".control-group"),e=this.$form.find(".editable-error-block");if(b===!1)d.removeClass(a.fn.editableform.errorGroupClass),e.removeClass(a.fn.editableform.errorBlockClass).empty().hide();else{if(b){c=(""+b).split("\n");for(var f=0;f<c.length;f++)c[f]=a("<div>").text(c[f]).html();b=c.join("<br>")}d.addClass(a.fn.editableform.errorGroupClass),e.addClass(a.fn.editableform.errorBlockClass).html(b).show()}},submit:function(b){b.stopPropagation(),b.preventDefault();var c=this.input.input2value(),d=this.validate(c);if("object"===a.type(d)&&void 0!==d.newValue){if(c=d.newValue,this.input.value2input(c),"string"==typeof d.msg)return this.error(d.msg),void this.showForm()}else if(d)return this.error(d),void this.showForm();if(!this.options.savenochange&&this.input.value2str(c)==this.input.value2str(this.value))return void this.$div.triggerHandler("nochange");var e=this.input.value2submit(c);this.isSaving=!0,a.when(this.save(e)).done(a.proxy(function(a){this.isSaving=!1;var b="function"==typeof this.options.success?this.options.success.call(this.options.scope,a,c):null;return b===!1?(this.error(!1),void this.showForm(!1)):"string"==typeof b?(this.error(b),void this.showForm()):(b&&"object"==typeof b&&b.hasOwnProperty("newValue")&&(c=b.newValue),this.error(!1),this.value=c,void this.$div.triggerHandler("save",{newValue:c,submitValue:e,response:a}))},this)).fail(a.proxy(function(a){this.isSaving=!1;var b;b="function"==typeof this.options.error?this.options.error.call(this.options.scope,a,c):"string"==typeof a?a:a.responseText||a.statusText||"Unknown error!",this.error(b),this.showForm()},this))},save:function(b){this.options.pk=a.fn.editableutils.tryParseJson(this.options.pk,!0);var c,d="function"==typeof this.options.pk?this.options.pk.call(this.options.scope):this.options.pk,e=!!("function"==typeof this.options.url||this.options.url&&("always"===this.options.send||"auto"===this.options.send&&null!==d&&void 0!==d));return e?(this.showLoading(),c={name:this.options.name||"",value:b,pk:d},"function"==typeof this.options.params?c=this.options.params.call(this.options.scope,c):(this.options.params=a.fn.editableutils.tryParseJson(this.options.params,!0),a.extend(c,this.options.params)),"function"==typeof this.options.url?this.options.url.call(this.options.scope,c):a.ajax(a.extend({url:this.options.url,data:c,type:"POST"},this.options.ajaxOptions))):void 0},validate:function(a){return void 0===a&&(a=this.value),"function"==typeof this.options.validate?this.options.validate.call(this.options.scope,a):void 0},option:function(a,b){a in this.options&&(this.options[a]=b),"value"===a&&this.setValue(b)},setValue:function(a,b){b?this.value=this.input.str2value(a):this.value=a,this.$form&&this.$form.is(":visible")&&this.input.value2input(this.value)}},a.fn.editableform=function(c){var d=arguments;return this.each(function(){var e=a(this),f=e.data("editableform"),g="object"==typeof c&&c;f||e.data("editableform",f=new b(this,g)),"string"==typeof c&&f[c].apply(f,Array.prototype.slice.call(d,1))})},a.fn.editableform.Constructor=b,a.fn.editableform.defaults={type:"text",url:null,params:null,name:null,pk:null,value:null,defaultValue:null,send:"auto",validate:null,success:null,error:null,ajaxOptions:null,showbuttons:!0,scope:null,savenochange:!1},a.fn.editableform.template='<form class="form-inline editableform"><div class="control-group"><div><div class="editable-input"></div><div class="editable-buttons"></div></div><div class="editable-error-block"></div></div></form>',a.fn.editableform.loading='<div class="editableform-loading"></div>',a.fn.editableform.buttons='<button type="submit" class="editable-submit">ok</button><button type="button" class="editable-cancel">cancel</button>',a.fn.editableform.errorGroupClass=null,a.fn.editableform.errorBlockClass="editable-error",a.fn.editableform.engine="jquery"}(window.jQuery),function(a){"use strict";a.fn.editableutils={inherit:function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype},setCursorPosition:function(a,b){if(a.setSelectionRange)a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},tryParseJson:function(a,b){if("string"==typeof a&&a.length&&a.match(/^[\{\[].*[\}\]]$/))if(b)try{a=new Function("return "+a)()}catch(c){}finally{return a}else a=new Function("return "+a)();return a},sliceObj:function(b,c,d){var e,f,g={};if(!a.isArray(c)||!c.length)return g;for(var h=0;h<c.length;h++)e=c[h],b.hasOwnProperty(e)&&(g[e]=b[e]),d!==!0&&(f=e.toLowerCase(),b.hasOwnProperty(f)&&(g[e]=b[f]));return g},getConfigData:function(b){var c={};return a.each(b.data(),function(a,b){("object"!=typeof b||b&&"object"==typeof b&&(b.constructor===Object||b.constructor===Array))&&(c[a]=b)}),c},objectKeys:function(a){if(Object.keys)return Object.keys(a);if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c},escape:function(b){return a("<div>").text(b).html()},itemsByValue:function(b,c,d){if(!c||null===b)return[];if("function"!=typeof d){var e=d||"value";d=function(a){return a[e]}}var f=a.isArray(b),g=[],h=this;return a.each(c,function(c,e){if(e.children)g=g.concat(h.itemsByValue(b,e.children,d));else if(f)a.grep(b,function(a){return a==(e&&"object"==typeof e?d(e):e)}).length&&g.push(e);else{var i=e&&"object"==typeof e?d(e):e;b==i&&g.push(e)}}),g},createInput:function(b){var c,d,e,f=b.type;return"date"===f&&("inline"===b.mode?a.fn.editabletypes.datefield?f="datefield":a.fn.editabletypes.dateuifield&&(f="dateuifield"):a.fn.editabletypes.date?f="date":a.fn.editabletypes.dateui&&(f="dateui"),"date"!==f||a.fn.editabletypes.date||(f="combodate")),"datetime"===f&&"inline"===b.mode&&(f="datetimefield"),"wysihtml5"!==f||a.fn.editabletypes[f]||(f="textarea"),"function"==typeof a.fn.editabletypes[f]?(c=a.fn.editabletypes[f],d=this.sliceObj(b,this.objectKeys(c.defaults)),e=new c(d)):(a.error("Unknown type: "+f),!1)},supportsTransitions:function(){var a=document.body||document.documentElement,b=a.style,c="transition",d=["Moz","Webkit","Khtml","O","ms"];if("string"==typeof b[c])return!0;c=c.charAt(0).toUpperCase()+c.substr(1);for(var e=0;e<d.length;e++)if("string"==typeof b[d[e]+c])return!0;return!1}}}(window.jQuery),function(a){"use strict";var b=function(a,b){this.init(a,b)},c=function(a,b){this.init(a,b)};b.prototype={containerName:null,containerDataName:null,innerCss:null,containerClass:"editable-container editable-popup",defaults:{},init:function(c,d){this.$element=a(c),this.options=a.extend({},a.fn.editableContainer.defaults,d),this.splitOptions(),this.formOptions.scope=this.$element[0],this.initContainer(),this.delayedHide=!1,this.$element.on("destroyed",a.proxy(function(){this.destroy()},this)),a(document).data("editable-handlers-attached")||(a(document).on("keyup.editable",function(b){27===b.which&&a(".editable-open").editableContainer("hide")}),a(document).on("click.editable",function(c){var d,e=a(c.target),f=[".editable-container",".ui-datepicker-header",".datepicker",".modal-backdrop",".bootstrap-wysihtml5-insert-image-modal",".bootstrap-wysihtml5-insert-link-modal"];if(a.contains(document.documentElement,c.target)&&!e.is(document)){for(d=0;d<f.length;d++)if(e.is(f[d])||e.parents(f[d]).length)return;b.prototype.closeOthers(c.target)}}),a(document).data("editable-handlers-attached",!0))},splitOptions:function(){if(this.containerOptions={},this.formOptions={},!a.fn[this.containerName])throw new Error(this.containerName+" not found. Have you included corresponding js file?");for(var b in this.options)b in this.defaults?this.containerOptions[b]=this.options[b]:this.formOptions[b]=this.options[b]},tip:function(){return this.container()?this.container().$tip:null},container:function(){var a;return this.containerDataName&&(a=this.$element.data(this.containerDataName))?a:a=this.$element.data(this.containerName)},call:function(){this.$element[this.containerName].apply(this.$element,arguments)},initContainer:function(){this.call(this.containerOptions)},renderForm:function(){this.$form.editableform(this.formOptions).on({save:a.proxy(this.save,this),nochange:a.proxy(function(){this.hide("nochange")},this),cancel:a.proxy(function(){this.hide("cancel")},this),show:a.proxy(function(){this.delayedHide?(this.hide(this.delayedHide.reason),this.delayedHide=!1):this.setPosition()},this),rendering:a.proxy(this.setPosition,this),resize:a.proxy(this.setPosition,this),rendered:a.proxy(function(){this.$element.triggerHandler("shown",a(this.options.scope).data("editable"))},this)}).editableform("render")},show:function(b){this.$element.addClass("editable-open"),b!==!1&&this.closeOthers(this.$element[0]),this.innerShow(),this.tip().addClass(this.containerClass),this.$form,this.$form=a("<div>"),this.tip().is(this.innerCss)?this.tip().append(this.$form):this.tip().find(this.innerCss).append(this.$form),this.renderForm()},hide:function(a){if(this.tip()&&this.tip().is(":visible")&&this.$element.hasClass("editable-open")){if(this.$form.data("editableform").isSaving)return void(this.delayedHide={reason:a});this.delayedHide=!1,this.$element.removeClass("editable-open"),this.innerHide(),this.$element.triggerHandler("hidden",a||"manual")}},innerShow:function(){},innerHide:function(){},toggle:function(a){this.container()&&this.tip()&&this.tip().is(":visible")?this.hide():this.show(a)},setPosition:function(){},save:function(a,b){this.$element.triggerHandler("save",b),this.hide("save")},option:function(a,b){this.options[a]=b,a in this.containerOptions?(this.containerOptions[a]=b,this.setContainerOption(a,b)):(this.formOptions[a]=b,this.$form&&this.$form.editableform("option",a,b))},setContainerOption:function(a,b){this.call("option",a,b)},destroy:function(){this.hide(),this.innerDestroy(),this.$element.off("destroyed"),this.$element.removeData("editableContainer")},innerDestroy:function(){},closeOthers:function(b){a(".editable-open").each(function(c,d){if(d!==b&&!a(d).find(b).length){var e=a(d),f=e.data("editableContainer");f&&("cancel"===f.options.onblur?e.data("editableContainer").hide("onblur"):"submit"===f.options.onblur&&e.data("editableContainer").tip().find("form").submit())}})},activate:function(){this.tip&&this.tip().is(":visible")&&this.$form&&this.$form.data("editableform").input.activate()}},a.fn.editableContainer=function(d){var e=arguments;return this.each(function(){var f=a(this),g="editableContainer",h=f.data(g),i="object"==typeof d&&d,j="inline"===i.mode?c:b;h||f.data(g,h=new j(this,i)),"string"==typeof d&&h[d].apply(h,Array.prototype.slice.call(e,1))})},a.fn.editableContainer.Popup=b,a.fn.editableContainer.Inline=c,a.fn.editableContainer.defaults={value:null,placement:"top",autohide:!0,onblur:"cancel",anim:!1,mode:"popup"},jQuery.event.special.destroyed={remove:function(a){a.handler&&a.handler()}}}(window.jQuery),function(a){"use strict";a.extend(a.fn.editableContainer.Inline.prototype,a.fn.editableContainer.Popup.prototype,{containerName:"editableform",innerCss:".editable-inline",containerClass:"editable-container editable-inline",initContainer:function(){this.$tip=a("<span></span>"),this.options.anim||(this.options.anim=0)},splitOptions:function(){this.containerOptions={},this.formOptions=this.options},tip:function(){return this.$tip},innerShow:function(){this.$element.hide(),this.tip().insertAfter(this.$element).show()},innerHide:function(){this.$tip.hide(this.options.anim,a.proxy(function(){this.$element.show(),this.innerDestroy()},this))},innerDestroy:function(){this.tip()&&this.tip().empty().remove()}})}(window.jQuery),function(a){"use strict";var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.editable.defaults,c,a.fn.editableutils.getConfigData(this.$element)),this.options.selector?this.initLive():this.init(),this.options.highlight&&!a.fn.editableutils.supportsTransitions()&&(this.options.highlight=!1)};b.prototype={constructor:b,init:function(){var b,c=!1;if(this.options.name=this.options.name||this.$element.attr("id"),this.options.scope=this.$element[0],this.input=a.fn.editableutils.createInput(this.options),this.input){switch(void 0===this.options.value||null===this.options.value?(this.value=this.input.html2value(a.trim(this.$element.html())),c=!0):(this.options.value=a.fn.editableutils.tryParseJson(this.options.value,!0),"string"==typeof this.options.value?this.value=this.input.str2value(this.options.value):this.value=this.options.value),this.$element.addClass("editable"),"textarea"===this.input.type&&this.$element.addClass("editable-pre-wrapped"),"manual"!==this.options.toggle?(this.$element.addClass("editable-click"),this.$element.on(this.options.toggle+".editable",a.proxy(function(a){if(this.options.disabled||a.preventDefault(),"mouseenter"===this.options.toggle)this.show();else{var b="click"!==this.options.toggle;this.toggle(b)}},this))):this.$element.attr("tabindex",-1),"function"==typeof this.options.display&&(this.options.autotext="always"),this.options.autotext){case"always":b=!0;break;case"auto":b=!a.trim(this.$element.text()).length&&null!==this.value&&void 0!==this.value&&!c;break;default:b=!1}a.when(b?this.render():!0).then(a.proxy(function(){this.options.disabled?this.disable():this.enable(),this.$element.triggerHandler("init",this)},this))}},initLive:function(){var b=this.options.selector;this.options.selector=!1,this.options.autotext="never",this.$element.on(this.options.toggle+".editable",b,a.proxy(function(b){var c=a(b.target);c.data("editable")||(c.hasClass(this.options.emptyclass)&&c.empty(),c.editable(this.options).trigger(b))},this))},render:function(a){return this.options.display!==!1?this.input.value2htmlFinal?this.input.value2html(this.value,this.$element[0],this.options.display,a):"function"==typeof this.options.display?this.options.display.call(this.$element[0],this.value,a):this.input.value2html(this.value,this.$element[0]):void 0},enable:function(){this.options.disabled=!1,this.$element.removeClass("editable-disabled"),this.handleEmpty(this.isEmpty),"manual"!==this.options.toggle&&"-1"===this.$element.attr("tabindex")&&this.$element.removeAttr("tabindex")},disable:function(){this.options.disabled=!0,this.hide(),this.$element.addClass("editable-disabled"),this.handleEmpty(this.isEmpty),this.$element.attr("tabindex",-1)},toggleDisabled:function(){this.options.disabled?this.enable():this.disable()},option:function(b,c){return b&&"object"==typeof b?void a.each(b,a.proxy(function(b,c){this.option(a.trim(b),c)},this)):(this.options[b]=c,"disabled"===b?c?this.disable():this.enable():("value"===b&&this.setValue(c),this.container&&this.container.option(b,c),void(this.input.option&&this.input.option(b,c))))},handleEmpty:function(b){this.options.display!==!1&&(void 0!==b?this.isEmpty=b:"function"==typeof this.input.isEmpty?this.isEmpty=this.input.isEmpty(this.$element):this.isEmpty=""===a.trim(this.$element.html()),this.options.disabled?this.isEmpty&&(this.$element.empty(),this.options.emptyclass&&this.$element.removeClass(this.options.emptyclass)):this.isEmpty?(this.$element.html(this.options.emptytext),this.options.emptyclass&&this.$element.addClass(this.options.emptyclass)):this.options.emptyclass&&this.$element.removeClass(this.options.emptyclass))},show:function(b){if(!this.options.disabled){if(this.container){if(this.container.tip().is(":visible"))return}else{var c=a.extend({},this.options,{value:this.value,input:this.input});this.$element.editableContainer(c),this.$element.on("save.internal",a.proxy(this.save,this)),this.container=this.$element.data("editableContainer")}this.container.show(b)}},hide:function(){this.container&&this.container.hide()},toggle:function(a){this.container&&this.container.tip().is(":visible")?this.hide():this.show(a)},save:function(a,b){if(this.options.unsavedclass){var c=!1;c=c||"function"==typeof this.options.url,c=c||this.options.display===!1,c=c||void 0!==b.response,c=c||this.options.savenochange&&this.input.value2str(this.value)!==this.input.value2str(b.newValue),c?this.$element.removeClass(this.options.unsavedclass):this.$element.addClass(this.options.unsavedclass)}if(this.options.highlight){var d=this.$element,e=d.css("background-color");d.css("background-color",this.options.highlight),setTimeout(function(){"transparent"===e&&(e=""),d.css("background-color",e),d.addClass("editable-bg-transition"),setTimeout(function(){d.removeClass("editable-bg-transition")},1700)},10)}this.setValue(b.newValue,!1,b.response)},validate:function(){return"function"==typeof this.options.validate?this.options.validate.call(this,this.value):void 0},setValue:function(b,c,d){c?this.value=this.input.str2value(b):this.value=b,this.container&&this.container.option("value",this.value),a.when(this.render(d)).then(a.proxy(function(){this.handleEmpty()},this))},activate:function(){this.container&&this.container.activate()},destroy:function(){this.disable(),this.container&&this.container.destroy(),this.input.destroy(),"manual"!==this.options.toggle&&(this.$element.removeClass("editable-click"),this.$element.off(this.options.toggle+".editable")),this.$element.off("save.internal"),this.$element.removeClass("editable editable-open editable-disabled"),this.$element.removeData("editable")}},a.fn.editable=function(c){var d={},e=arguments,f="editable";switch(c){case"validate":return this.each(function(){var b,c=a(this),e=c.data(f);e&&(b=e.validate())&&(d[e.options.name]=b)}),d;case"getValue":return 2===arguments.length&&arguments[1]===!0?d=this.eq(0).data(f).value:this.each(function(){var b=a(this),c=b.data(f);c&&void 0!==c.value&&null!==c.value&&(d[c.options.name]=c.input.value2submit(c.value))}),d;case"submit":var g=arguments[1]||{},h=this,i=this.editable("validate");if(a.isEmptyObject(i)){var j={};if(1===h.length){var k=h.data("editable"),l={name:k.options.name||"",value:k.input.value2submit(k.value),pk:"function"==typeof k.options.pk?k.options.pk.call(k.options.scope):k.options.pk};"function"==typeof k.options.params?l=k.options.params.call(k.options.scope,l):(k.options.params=a.fn.editableutils.tryParseJson(k.options.params,!0),a.extend(l,k.options.params)),j={url:k.options.url,data:l,type:"POST"},g.success=g.success||k.options.success,g.error=g.error||k.options.error}else{var m=this.editable("getValue");j={url:g.url,data:m,type:"POST"}}j.success="function"==typeof g.success?function(a){g.success.call(h,a,g)}:a.noop,j.error="function"==typeof g.error?function(){g.error.apply(h,arguments)}:a.noop,g.ajaxOptions&&a.extend(j,g.ajaxOptions),g.data&&a.extend(j.data,g.data),a.ajax(j)}else"function"==typeof g.error&&g.error.call(h,i);return this}return this.each(function(){var d=a(this),g=d.data(f),h="object"==typeof c&&c;return h&&h.selector?void(g=new b(this,h)):(g||d.data(f,g=new b(this,h)),void("string"==typeof c&&g[c].apply(g,Array.prototype.slice.call(e,1))))})},a.fn.editable.defaults={type:"text",disabled:!1,toggle:"click",emptytext:"Empty",autotext:"auto",value:null,display:null,emptyclass:"editable-empty",unsavedclass:"editable-unsaved",selector:null,highlight:"#FFFF80"}}(window.jQuery),function(a){"use strict";a.fn.editabletypes={};var b=function(){};b.prototype={init:function(b,c,d){this.type=b,this.options=a.extend({},d,c)},prerender:function(){this.$tpl=a(this.options.tpl),this.$input=this.$tpl,this.$clear=null,this.error=null},render:function(){},value2html:function(b,c){a(c)[this.options.escape?"text":"html"](a.trim(b))},html2value:function(b){return a("<div>").html(b).text()},value2str:function(a){return a},str2value:function(a){return a},value2submit:function(a){return a},value2input:function(a){this.$input.val(a)},input2value:function(){return this.$input.val()},activate:function(){this.$input.is(":visible")&&this.$input.focus()},clear:function(){this.$input.val(null)},escape:function(b){return a("<div>").text(b).html()},autosubmit:function(){},destroy:function(){},setClass:function(){this.options.inputclass&&this.$input.addClass(this.options.inputclass)},setAttr:function(a){void 0!==this.options[a]&&null!==this.options[a]&&this.$input.attr(a,this.options[a])},option:function(a,b){this.options[a]=b}},b.defaults={tpl:"",inputclass:null,escape:!0,scope:null,showbuttons:!0},a.extend(a.fn.editabletypes,{abstractinput:b})}(window.jQuery),function(a){"use strict";var b=function(a){};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){var b=a.Deferred();return this.error=null,this.onSourceReady(function(){this.renderList(),b.resolve()},function(){this.error=this.options.sourceError,b.resolve()}),b.promise()},html2value:function(a){return null},value2html:function(b,c,d,e){var f=a.Deferred(),g=function(){"function"==typeof d?d.call(c,b,this.sourceData,e):this.value2htmlFinal(b,c),f.resolve()};return null===b?g.call(this):this.onSourceReady(g,function(){f.resolve()}),f.promise()},onSourceReady:function(b,c){var d;if(a.isFunction(this.options.source)?(d=this.options.source.call(this.options.scope),this.sourceData=null):d=this.options.source,this.options.sourceCache&&a.isArray(this.sourceData))return void b.call(this);try{d=a.fn.editableutils.tryParseJson(d,!1)}catch(e){return void c.call(this)}if("string"==typeof d){if(this.options.sourceCache){var f,g=d;if(a(document).data(g)||a(document).data(g,{}),f=a(document).data(g),f.loading===!1&&f.sourceData)return this.sourceData=f.sourceData,this.doPrepend(),void b.call(this);if(f.loading===!0)return f.callbacks.push(a.proxy(function(){this.sourceData=f.sourceData,this.doPrepend(),b.call(this)},this)),void f.err_callbacks.push(a.proxy(c,this));f.loading=!0,f.callbacks=[],f.err_callbacks=[]}var h=a.extend({url:d,type:"get",cache:!1,dataType:"json",success:a.proxy(function(d){f&&(f.loading=!1),this.sourceData=this.makeArray(d),a.isArray(this.sourceData)?(f&&(f.sourceData=this.sourceData,a.each(f.callbacks,function(){this.call()})),this.doPrepend(),b.call(this)):(c.call(this),f&&a.each(f.err_callbacks,function(){this.call()}))},this),error:a.proxy(function(){c.call(this),f&&(f.loading=!1,a.each(f.err_callbacks,function(){this.call()}))},this)},this.options.sourceOptions);a.ajax(h)}else this.sourceData=this.makeArray(d),a.isArray(this.sourceData)?(this.doPrepend(),b.call(this)):c.call(this)},doPrepend:function(){null!==this.options.prepend&&void 0!==this.options.prepend&&(a.isArray(this.prependData)||(a.isFunction(this.options.prepend)&&(this.options.prepend=this.options.prepend.call(this.options.scope)),this.options.prepend=a.fn.editableutils.tryParseJson(this.options.prepend,!0),"string"==typeof this.options.prepend&&(this.options.prepend={"":this.options.prepend}),this.prependData=this.makeArray(this.options.prepend)),a.isArray(this.prependData)&&a.isArray(this.sourceData)&&(this.sourceData=this.prependData.concat(this.sourceData)))},renderList:function(){},value2htmlFinal:function(a,b){},makeArray:function(b){var c,d,e,f,g=[];if(!b||"string"==typeof b)return null;if(a.isArray(b)){f=function(a,b){return d={value:a,text:b},c++>=2?!1:void 0};for(var h=0;h<b.length;h++)e=b[h],"object"==typeof e?(c=0,a.each(e,f),1===c?g.push(d):c>1&&(e.children&&(e.children=this.makeArray(e.children)),g.push(e))):g.push({value:e,text:e})}else a.each(b,function(a,b){g.push({value:a,text:b})});return g},option:function(a,b){this.options[a]=b,"source"===a&&(this.sourceData=null),"prepend"===a&&(this.prependData=null)}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{source:null,prepend:!1,sourceError:"Error when loading list",sourceCache:!0,sourceOptions:null}),a.fn.editabletypes.list=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("text",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.renderClear(),this.setClass(),this.setAttr("placeholder")},activate:function(){this.$input.is(":visible")&&(this.$input.focus(),a.fn.editableutils.setCursorPosition(this.$input.get(0),this.$input.val().length),this.toggleClear&&this.toggleClear())},renderClear:function(){this.options.clear&&(this.$clear=a('<span class="editable-clear-x"></span>'),this.$input.after(this.$clear).css("padding-right",24).keyup(a.proxy(function(b){if(!~a.inArray(b.keyCode,[40,38,9,13,27])){clearTimeout(this.t);var c=this;this.t=setTimeout(function(){c.toggleClear(b)},100)}},this)).parent().css("position","relative"),this.$clear.click(a.proxy(this.clear,this)))},postrender:function(){},toggleClear:function(a){if(this.$clear){var b=this.$input.val().length,c=this.$clear.is(":visible");b&&!c&&this.$clear.show(),!b&&c&&this.$clear.hide()}},clear:function(){this.$clear.hide(),this.$input.val("").focus()}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',placeholder:null,clear:!0}),a.fn.editabletypes.text=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("textarea",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.setClass(),this.setAttr("placeholder"),this.setAttr("rows"),this.$input.keydown(function(b){b.ctrlKey&&13===b.which&&a(this).closest("form").submit()})},activate:function(){a.fn.editabletypes.text.prototype.activate.call(this)}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:"<textarea></textarea>",inputclass:"input-large",placeholder:null,rows:7}),a.fn.editabletypes.textarea=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("select",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.list),a.extend(b.prototype,{
renderList:function(){this.$input.empty();var b=function(c,d){var e;if(a.isArray(d))for(var f=0;f<d.length;f++)e={},d[f].children?(e.label=d[f].text,c.append(b(a("<optgroup>",e),d[f].children))):(e.value=d[f].value,d[f].disabled&&(e.disabled=!0),c.append(a("<option>",e).text(d[f].text)));return c};b(this.$input,this.sourceData),this.setClass(),this.$input.on("keydown.editable",function(b){13===b.which&&a(this).closest("form").submit()})},value2htmlFinal:function(b,c){var d="",e=a.fn.editableutils.itemsByValue(b,this.sourceData);e.length&&(d=e[0].text),a.fn.editabletypes.abstractinput.prototype.value2html.call(this,d,c)},autosubmit:function(){this.$input.off("keydown.editable").on("change.editable",function(){a(this).closest("form").submit()})}}),b.defaults=a.extend({},a.fn.editabletypes.list.defaults,{tpl:"<select></select>"}),a.fn.editabletypes.select=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("checklist",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.list),a.extend(b.prototype,{renderList:function(){var b;if(this.$tpl.empty(),a.isArray(this.sourceData)){for(var c=0;c<this.sourceData.length;c++)b=a("<label>").append(a("<input>",{type:"checkbox",value:this.sourceData[c].value})).append(a("<span>").text(" "+this.sourceData[c].text)),a("<div>").append(b).appendTo(this.$tpl);this.$input=this.$tpl.find('input[type="checkbox"]'),this.setClass()}},value2str:function(b){return a.isArray(b)?b.sort().join(a.trim(this.options.separator)):""},str2value:function(b){var c,d=null;return"string"==typeof b&&b.length?(c=new RegExp("\\s*"+a.trim(this.options.separator)+"\\s*"),d=b.split(c)):d=a.isArray(b)?b:[b],d},value2input:function(b){this.$input.prop("checked",!1),a.isArray(b)&&b.length&&this.$input.each(function(c,d){var e=a(d);a.each(b,function(a,b){e.val()==b&&e.prop("checked",!0)})})},input2value:function(){var b=[];return this.$input.filter(":checked").each(function(c,d){b.push(a(d).val())}),b},value2htmlFinal:function(b,c){var d=[],e=a.fn.editableutils.itemsByValue(b,this.sourceData),f=this.options.escape;e.length?(a.each(e,function(b,c){var e=f?a.fn.editableutils.escape(c.text):c.text;d.push(e)}),a(c).html(d.join("<br>"))):a(c).empty()},activate:function(){this.$input.first().focus()},autosubmit:function(){this.$input.on("keydown",function(b){13===b.which&&a(this).closest("form").submit()})}}),b.defaults=a.extend({},a.fn.editabletypes.list.defaults,{tpl:'<div class="editable-checklist"></div>',inputclass:null,separator:","}),a.fn.editabletypes.checklist=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("password",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),a.extend(b.prototype,{value2html:function(b,c){b?a(c).text("[hidden]"):a(c).empty()},html2value:function(a){return null}}),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="password">'}),a.fn.editabletypes.password=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("email",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="email">'}),a.fn.editabletypes.email=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("url",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="url">'}),a.fn.editabletypes.url=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("tel",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="tel">'}),a.fn.editabletypes.tel=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("number",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text),a.extend(b.prototype,{render:function(){b.superclass.render.call(this),this.setAttr("min"),this.setAttr("max"),this.setAttr("step")},postrender:function(){this.$clear&&this.$clear.css({right:24})}}),b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="number">',inputclass:"input-mini",min:null,max:null,step:null}),a.fn.editabletypes.number=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("range",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.number),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.filter("input"),this.setClass(),this.setAttr("min"),this.setAttr("max"),this.setAttr("step"),this.$input.on("input",function(){a(this).siblings("output").text(a(this).val())})},activate:function(){this.$input.focus()}}),b.defaults=a.extend({},a.fn.editabletypes.number.defaults,{tpl:'<input type="range"><output style="width: 30px; display: inline-block"></output>',inputclass:"input-medium"}),a.fn.editabletypes.range=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("time",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.setClass()}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="time">'}),a.fn.editabletypes.time=b}(window.jQuery),function(a){"use strict";var b=function(c){if(this.init("select2",c,b.defaults),c.select2=c.select2||{},this.sourceData=null,c.placeholder&&(c.select2.placeholder=c.placeholder),!c.select2.tags&&c.source){var d=c.source;a.isFunction(c.source)&&(d=c.source.call(c.scope)),"string"==typeof d?(c.select2.ajax=c.select2.ajax||{},c.select2.ajax.data||(c.select2.ajax.data=function(a){return{query:a}}),c.select2.ajax.results||(c.select2.ajax.results=function(a){return{results:a}}),c.select2.ajax.url=d):(this.sourceData=this.convertSource(d),c.select2.data=this.sourceData)}if(this.options.select2=a.extend({},b.defaults.select2,c.select2),this.isMultiple=this.options.select2.tags||this.options.select2.multiple,this.isRemote="ajax"in this.options.select2,this.idFunc=this.options.select2.id,"function"!=typeof this.idFunc){var e=this.idFunc||"id";this.idFunc=function(a){return a[e]}}this.formatSelection=this.options.select2.formatSelection,"function"!=typeof this.formatSelection&&(this.formatSelection=function(a){return a.text})};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.setClass(),this.isRemote&&this.$input.on("select2-loaded",a.proxy(function(a){this.sourceData=a.items.results},this)),this.isMultiple&&this.$input.on("change",function(){a(this).closest("form").parent().triggerHandler("resize")})},value2html:function(c,d){var e,f="",g=this;this.options.select2.tags?e=c:this.sourceData&&(e=a.fn.editableutils.itemsByValue(c,this.sourceData,this.idFunc)),a.isArray(e)?(f=[],a.each(e,function(a,b){f.push(b&&"object"==typeof b?g.formatSelection(b):b)})):e&&(f=g.formatSelection(e)),f=a.isArray(f)?f.join(this.options.viewseparator):f,b.superclass.value2html.call(this,f,d)},html2value:function(a){return this.options.select2.tags?this.str2value(a,this.options.viewseparator):null},value2input:function(b){if(a.isArray(b)&&(b=b.join(this.getSeparator())),this.$input.data("select2")?this.$input.val(b).trigger("change",!0):(this.$input.val(b),this.$input.select2(this.options.select2)),this.isRemote&&!this.isMultiple&&!this.options.select2.initSelection){var c=this.options.select2.id,d=this.options.select2.formatSelection;if(!c&&!d){var e=a(this.options.scope);if(!e.data("editable").isEmpty){var f={id:b,text:e.text()};this.$input.select2("data",f)}}}},input2value:function(){return this.$input.select2("val")},str2value:function(b,c){if("string"!=typeof b||!this.isMultiple)return b;c=c||this.getSeparator();var d,e,f;if(null===b||b.length<1)return null;for(d=b.split(c),e=0,f=d.length;f>e;e+=1)d[e]=a.trim(d[e]);return d},autosubmit:function(){this.$input.on("change",function(b,c){c||a(this).closest("form").submit()})},getSeparator:function(){return this.options.select2.separator||a.fn.select2.defaults.separator},convertSource:function(b){if(a.isArray(b)&&b.length&&void 0!==b[0].value)for(var c=0;c<b.length;c++)void 0!==b[c].value&&(b[c].id=b[c].value,delete b[c].value);return b},destroy:function(){this.$input.data("select2")&&this.$input.select2("destroy")}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="hidden">',select2:null,placeholder:null,source:null,viewseparator:", "}),a.fn.editabletypes.select2=b}(window.jQuery),function(a){var b=function(b,c){return this.$element=a(b),this.$element.is("input")?(this.options=a.extend({},a.fn.combodate.defaults,c,this.$element.data()),void this.init()):void a.error("Combodate should be applied to INPUT element")};b.prototype={constructor:b,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]},this.$widget=a('<span class="combodate"></span>').html(this.getTemplate()),this.initCombos(),this.$widget.on("change","select",a.proxy(function(b){this.$element.val(this.getValue()).change(),this.options.smartDays&&(a(b.target).is(".month")||a(b.target).is(".year"))&&this.fillCombo("day")},this)),this.$widget.find("select").css("width","auto"),this.$element.hide().after(this.$widget),this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var b=this.options.template;return a.each(this.map,function(a,c){c=c[0];var d=new RegExp(c+"+"),e=c.length>1?c.substring(1,2):c;b=b.replace(d,"{"+e+"}")}),b=b.replace(/ /g,"&nbsp;"),a.each(this.map,function(a,c){c=c[0];var d=c.length>1?c.substring(1,2):c;b=b.replace("{"+d+"}",'<select class="'+a+'"></select>')}),b},initCombos:function(){for(var a in this.map){var b=this.$widget.find("."+a);this["$"+a]=b.length?b:null,this.fillCombo(a)}},fillCombo:function(a){var b=this["$"+a];if(b){var c="fill"+a.charAt(0).toUpperCase()+a.slice(1),d=this[c](),e=b.val();b.empty();for(var f=0;f<d.length;f++)b.append('<option value="'+d[f][0]+'">'+d[f][1]+"</option>");b.val(e)}},fillCommon:function(a){var b,c=[];if("name"===this.options.firstItem){b=moment.relativeTime||moment.langData()._relativeTime;var d="function"==typeof b[a]?b[a](1,!0,a,!1):b[a];d=d.split(" ").reverse()[0],c.push(["",d])}else"empty"===this.options.firstItem&&c.push(["",""]);return c},fillDay:function(){var a,b,c=this.fillCommon("d"),d=-1!==this.options.template.indexOf("DD"),e=31;if(this.options.smartDays&&this.$month&&this.$year){var f=parseInt(this.$month.val(),10),g=parseInt(this.$year.val(),10);isNaN(f)||isNaN(g)||(e=moment([g,f]).daysInMonth())}for(b=1;e>=b;b++)a=d?this.leadZero(b):b,c.push([b,a]);return c},fillMonth:function(){var a,b,c=this.fillCommon("M"),d=-1!==this.options.template.indexOf("MMMM"),e=-1!==this.options.template.indexOf("MMM"),f=-1!==this.options.template.indexOf("MM");for(b=0;11>=b;b++)a=d?moment().date(1).month(b).format("MMMM"):e?moment().date(1).month(b).format("MMM"):f?this.leadZero(b+1):b+1,c.push([b,a]);return c},fillYear:function(){var a,b,c=[],d=-1!==this.options.template.indexOf("YYYY");for(b=this.options.maxYear;b>=this.options.minYear;b--)a=d?b:(b+"").substring(2),c[this.options.yearDescending?"push":"unshift"]([b,a]);return c=this.fillCommon("y").concat(c)},fillHour:function(){var a,b,c=this.fillCommon("h"),d=-1!==this.options.template.indexOf("h"),e=(-1!==this.options.template.indexOf("H"),-1!==this.options.template.toLowerCase().indexOf("hh")),f=d?1:0,g=d?12:23;for(b=f;g>=b;b++)a=e?this.leadZero(b):b,c.push([b,a]);return c},fillMinute:function(){var a,b,c=this.fillCommon("m"),d=-1!==this.options.template.indexOf("mm");for(b=0;59>=b;b+=this.options.minuteStep)a=d?this.leadZero(b):b,c.push([b,a]);return c},fillSecond:function(){var a,b,c=this.fillCommon("s"),d=-1!==this.options.template.indexOf("ss");for(b=0;59>=b;b+=this.options.secondStep)a=d?this.leadZero(b):b,c.push([b,a]);return c},fillAmpm:function(){var a=-1!==this.options.template.indexOf("a"),b=(-1!==this.options.template.indexOf("A"),[["am",a?"am":"AM"],["pm",a?"pm":"PM"]]);return b},getValue:function(b){var c,d={},e=this,f=!1;return a.each(this.map,function(a,b){if("ampm"!==a){var c="day"===a?1:0;return d[a]=e["$"+a]?parseInt(e["$"+a].val(),10):c,isNaN(d[a])?(f=!0,!1):void 0}}),f?"":(this.$ampm&&(12===d.hour?d.hour="am"===this.$ampm.val()?0:12:d.hour="am"===this.$ampm.val()?d.hour:d.hour+12),c=moment([d.year,d.month,d.day,d.hour,d.minute,d.second]),this.highlight(c),b=void 0===b?this.options.format:b,null===b?c.isValid()?c:null:c.isValid()?c.format(b):"")},setValue:function(b){function c(b,c){var d={};return b.children("option").each(function(b,e){var f,g=a(e).attr("value");""!==g&&(f=Math.abs(g-c),("undefined"==typeof d.distance||f<d.distance)&&(d={value:g,distance:f}))}),d.value}if(b){var d="string"==typeof b?moment(b,this.options.format):moment(b),e=this,f={};d.isValid()&&(a.each(this.map,function(a,b){"ampm"!==a&&(f[a]=d[b[1]]())}),this.$ampm&&(f.hour>=12?(f.ampm="pm",f.hour>12&&(f.hour-=12)):(f.ampm="am",0===f.hour&&(f.hour=12))),a.each(f,function(a,b){e["$"+a]&&("minute"===a&&e.options.minuteStep>1&&e.options.roundTime&&(b=c(e["$"+a],b)),"second"===a&&e.options.secondStep>1&&e.options.roundTime&&(b=c(e["$"+a],b)),e["$"+a].val(b))}),this.options.smartDays&&this.fillCombo("day"),this.$element.val(d.format(this.options.format)).change())}},highlight:function(a){a.isValid()?this.options.errorClass?this.$widget.removeClass(this.options.errorClass):this.$widget.find("select").css("border-color",this.borderColor):this.options.errorClass?this.$widget.addClass(this.options.errorClass):(this.borderColor||(this.borderColor=this.$widget.find("select").css("border-color")),this.$widget.find("select").css("border-color","red"))},leadZero:function(a){return 9>=a?"0"+a:a},destroy:function(){this.$widget.remove(),this.$element.removeData("combodate").show()}},a.fn.combodate=function(c){var d,e=Array.apply(null,arguments);return e.shift(),"getValue"===c&&this.length&&(d=this.eq(0).data("combodate"))?d.getValue.apply(d,e):this.each(function(){var d=a(this),f=d.data("combodate"),g="object"==typeof c&&c;f||d.data("combodate",f=new b(this,g)),"string"==typeof c&&"function"==typeof f[c]&&f[c].apply(f,e)})},a.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:2015,yearDescending:!0,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,roundTime:!0,smartDays:!1}}(window.jQuery),function(a){"use strict";var b=function(c){this.init("combodate",c,b.defaults),this.options.viewformat||(this.options.viewformat=this.options.format),c.combodate=a.fn.editableutils.tryParseJson(c.combodate,!0),this.options.combodate=a.extend({},b.defaults.combodate,c.combodate,{format:this.options.format,template:this.options.template})};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.$input.combodate(this.options.combodate),"bs3"===a.fn.editableform.engine&&this.$input.siblings().find("select").addClass("form-control"),this.options.inputclass&&this.$input.siblings().find("select").addClass(this.options.inputclass)},value2html:function(a,c){var d=a?a.format(this.options.viewformat):"";b.superclass.value2html.call(this,d,c)},html2value:function(a){return a?moment(a,this.options.viewformat):null},value2str:function(a){return a?a.format(this.options.format):""},str2value:function(a){return a?moment(a,this.options.format):null},value2submit:function(a){return this.value2str(a)},value2input:function(a){this.$input.combodate("setValue",a)},input2value:function(){return this.$input.combodate("getValue",null)},activate:function(){this.$input.siblings(".combodate").find("select").eq(0).focus()},autosubmit:function(){}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',inputclass:null,format:"YYYY-MM-DD",viewformat:null,template:"D / MMM / YYYY",combodate:null}),a.fn.editabletypes.combodate=b}(window.jQuery),function(a){"use strict";var b=a.fn.editableform.Constructor.prototype.initInput;a.extend(a.fn.editableform.Constructor.prototype,{initTemplate:function(){this.$form=a(a.fn.editableform.template),this.$form.find(".control-group").addClass("form-group"),this.$form.find(".editable-error-block").addClass("help-block")},initInput:function(){b.apply(this);var c=null===this.input.options.inputclass||this.input.options.inputclass===!1,d="input-sm",e="text,select,textarea,password,email,url,tel,number,range,time,typeaheadjs".split(",");~a.inArray(this.input.type,e)&&(this.input.$input.addClass("form-control"),c&&(this.input.options.inputclass=d,this.input.$input.addClass(d)));for(var f=this.$form.find(".editable-buttons"),g=c?[d]:this.input.options.inputclass.split(" "),h=0;h<g.length;h++)"input-lg"===g[h].toLowerCase()&&f.find("button").removeClass("btn-sm").addClass("btn-lg")}}),a.fn.editableform.buttons='<button type="submit" class="btn btn-primary btn-sm editable-submit"><i class="glyphicon glyphicon-ok"></i></button><button type="button" class="btn btn-default btn-sm editable-cancel"><i class="glyphicon glyphicon-remove"></i></button>',a.fn.editableform.errorGroupClass="has-error",a.fn.editableform.errorBlockClass=null,a.fn.editableform.engine="bs3"}(window.jQuery),function(a){"use strict";a.extend(a.fn.editableContainer.Popup.prototype,{containerName:"popover",containerDataName:"bs.popover",innerCss:".popover-content",defaults:a.fn.popover.Constructor.DEFAULTS,initContainer:function(){a.extend(this.containerOptions,{trigger:"manual",selector:!1,content:" ",template:this.defaults.template});var b;this.$element.data("template")&&(b=this.$element.data("template"),this.$element.removeData("template")),this.call(this.containerOptions),b&&this.$element.data("template",b)},innerShow:function(){this.call("show")},innerHide:function(){this.call("hide")},innerDestroy:function(){this.call("destroy")},setContainerOption:function(a,b){this.container().options[a]=b},setPosition:function(){(function(){var a=this.tip(),b="function"==typeof this.options.placement?this.options.placement.call(this,a[0],this.$element[0]):this.options.placement,c=/\s?auto?\s?/i,d=c.test(b);d&&(b=b.replace(c,"")||"top");var e=this.getPosition(),f=a[0].offsetWidth,g=a[0].offsetHeight;if(d){var h=this.$element.parent(),i=b,j=document.documentElement.scrollTop||document.body.scrollTop,k="body"==this.options.container?window.innerWidth:h.outerWidth(),l="body"==this.options.container?window.innerHeight:h.outerHeight(),m="body"==this.options.container?0:h.offset().left;b="bottom"==b&&e.top+e.height+g-j>l?"top":"top"==b&&e.top-j-g<0?"bottom":"right"==b&&e.right+f>k?"left":"left"==b&&e.left-f<m?"right":b,a.removeClass(i).addClass(b)}var n=this.getCalculatedOffset(b,e,f,g);this.applyPlacement(n,b)}).call(this.container())}})}(window.jQuery),function(a){function b(){return new Date(Date.UTC.apply(Date,arguments))}function c(b,c){var d,e=a(b).data(),f={},g=new RegExp("^"+c.toLowerCase()+"([A-Z])"),c=new RegExp("^"+c.toLowerCase());for(var h in e)c.test(h)&&(d=h.replace(g,function(a,b){return b.toLowerCase()}),f[d]=e[h]);return f}function d(b){var c={};if(k[b]||(b=b.split("-")[0],k[b])){var d=k[b];return a.each(j,function(a,b){b in d&&(c[b]=d[b])}),c}}var e=function(b,c){this._process_options(c),this.element=a(b),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=a(l.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&(this.picker.addClass("datepicker-rtl"),this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today").attr("colspan",function(a,b){return parseInt(b)+1}),this._allow_update=!1,this.setStartDate(this.o.startDate),this.setEndDate(this.o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};e.prototype={constructor:e,_process_options:function(b){this._o=a.extend({},this._o,b);var c=this.o=a.extend({},this._o),d=c.language;switch(k[d]||(d=d.split("-")[0],k[d]||(d=i.language)),c.language=d,c.startView){case 2:case"decade":c.startView=2;break;case 1:case"year":c.startView=1;break;default:c.startView=0}switch(c.minViewMode){case 1:case"months":c.minViewMode=1;break;case 2:case"years":c.minViewMode=2;break;default:c.minViewMode=0}c.startView=Math.max(c.startView,c.minViewMode),c.weekStart%=7,c.weekEnd=(c.weekStart+6)%7;var e=l.parseFormat(c.format);c.startDate!==-(1/0)&&(c.startDate=l.parseDate(c.startDate,e,c.language)),c.endDate!==1/0&&(c.endDate=l.parseDate(c.endDate,e,c.language)),c.daysOfWeekDisabled=c.daysOfWeekDisabled||[],a.isArray(c.daysOfWeekDisabled)||(c.daysOfWeekDisabled=c.daysOfWeekDisabled.split(/[,\s]*/)),c.daysOfWeekDisabled=a.map(c.daysOfWeekDisabled,function(a){return parseInt(a,10)})},_events:[],_secondaryEvents:[],_applyEvents:function(a){for(var b,c,d=0;d<a.length;d++)b=a[d][0],c=a[d][1],b.on(c)},_unapplyEvents:function(a){for(var b,c,d=0;d<a.length;d++)b=a[d][0],c=a[d][1],b.off(c)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}],[this.component,{click:a.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:a.proxy(this.show,this)}]],this._secondaryEvents=[[this.picker,{click:a.proxy(this.click,this)}],[a(window),{resize:a.proxy(this.place,this)}],[a(document),{mousedown:a.proxy(function(a){this.element.is(a.target)||this.element.find(a.target).size()||this.picker.is(a.target)||this.picker.find(a.target).size()||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(b,c){var d=c||this.date,e=new Date(d.getTime()+6e4*d.getTimezoneOffset());this.element.trigger({type:b,date:e,format:a.proxy(function(a){var b=a||this.o.format;return l.formatDate(d,b,this.o.language)},this)})},show:function(a){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),this._attachSecondaryEvents(),a&&a.preventDefault(),this._trigger("show")},hide:function(a){this.isInline||this.picker.is(":visible")&&(this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},getDate:function(){var a=this.getUTCDate();return new Date(a.getTime()+6e4*a.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(a){this.setUTCDate(new Date(a.getTime()-6e4*a.getTimezoneOffset()))},setUTCDate:function(a){this.date=a,this.setValue()},setValue:function(){var a=this.getFormattedDate();this.isInput?this.element.val(a):this.component&&this.element.find("input").val(a)},getFormattedDate:function(a){return void 0===a&&(a=this.o.format),l.formatDate(this.date,a,this.o.language)},setStartDate:function(a){this._process_options({startDate:a}),this.update(),this.updateNavArrows()},setEndDate:function(a){this._process_options({endDate:a}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(a){this._process_options({daysOfWeekDisabled:a}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var b=parseInt(this.element.parents().filter(function(){return"auto"!=a(this).css("z-index")}).first().css("z-index"))+10,c=this.component?this.component.parent().offset():this.element.offset(),d=this.component?this.component.outerHeight(!0):this.element.outerHeight(!0);this.picker.css({top:c.top+d,left:c.left,zIndex:b})}},_allow_update:!0,update:function(){if(this._allow_update){var a,b=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(a=arguments[0],b=!0):(a=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),delete this.element.data().date),this.date=l.parseDate(a,this.o.format,this.o.language),b&&this.setValue(),this.date<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.date>this.o.endDate?this.viewDate=new Date(this.o.endDate):this.viewDate=new Date(this.date),this.fill()}},fillDow:function(){var a=this.o.weekStart,b="<tr>";if(this.o.calendarWeeks){var c='<th class="cw">&nbsp;</th>';b+=c,this.picker.find(".datepicker-days thead tr:first-child").prepend(c)}for(;a<this.o.weekStart+7;)b+='<th class="dow">'+k[this.o.language].daysMin[a++%7]+"</th>";b+="</tr>",this.picker.find(".datepicker-days thead").append(b)},fillMonths:function(){for(var a="",b=0;12>b;)a+='<span class="month">'+k[this.o.language].monthsShort[b++]+"</span>";this.picker.find(".datepicker-months td").html(a)},setRange:function(b){b&&b.length?this.range=a.map(b,function(a){return a.valueOf()}):delete this.range,this.fill()},getClassNames:function(b){var c=[],d=this.viewDate.getUTCFullYear(),e=this.viewDate.getUTCMonth(),f=this.date.valueOf(),g=new Date;return b.getUTCFullYear()<d||b.getUTCFullYear()==d&&b.getUTCMonth()<e?c.push("old"):(b.getUTCFullYear()>d||b.getUTCFullYear()==d&&b.getUTCMonth()>e)&&c.push("new"),this.o.todayHighlight&&b.getUTCFullYear()==g.getFullYear()&&b.getUTCMonth()==g.getMonth()&&b.getUTCDate()==g.getDate()&&c.push("today"),f&&b.valueOf()==f&&c.push("active"),(b.valueOf()<this.o.startDate||b.valueOf()>this.o.endDate||-1!==a.inArray(b.getUTCDay(),this.o.daysOfWeekDisabled))&&c.push("disabled"),this.range&&(b>this.range[0]&&b<this.range[this.range.length-1]&&c.push("range"),-1!=a.inArray(b.valueOf(),this.range)&&c.push("selected")),c},fill:function(){var c,d=new Date(this.viewDate),e=d.getUTCFullYear(),f=d.getUTCMonth(),g=this.o.startDate!==-(1/0)?this.o.startDate.getUTCFullYear():-(1/0),h=this.o.startDate!==-(1/0)?this.o.startDate.getUTCMonth():-(1/0),i=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,j=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0;this.date&&this.date.valueOf();this.picker.find(".datepicker-days thead th.datepicker-switch").text(k[this.o.language].months[f]+" "+e),this.picker.find("tfoot th.today").text(k[this.o.language].today).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot th.clear").text(k[this.o.language].clear).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var m=b(e,f-1,28,0,0,0,0),n=l.getDaysInMonth(m.getUTCFullYear(),m.getUTCMonth());m.setUTCDate(n),m.setUTCDate(n-(m.getUTCDay()-this.o.weekStart+7)%7);var o=new Date(m);o.setUTCDate(o.getUTCDate()+42),o=o.valueOf();for(var p,q=[];m.valueOf()<o;){if(m.getUTCDay()==this.o.weekStart&&(q.push("<tr>"),this.o.calendarWeeks)){var r=new Date(+m+(this.o.weekStart-m.getUTCDay()-7)%7*864e5),s=new Date(+r+(11-r.getUTCDay())%7*864e5),t=new Date(+(t=b(s.getUTCFullYear(),0,1))+(11-t.getUTCDay())%7*864e5),u=(s-t)/864e5/7+1;q.push('<td class="cw">'+u+"</td>")}p=this.getClassNames(m),p.push("day");var v=this.o.beforeShowDay(m);void 0===v?v={}:"boolean"==typeof v?v={enabled:v}:"string"==typeof v&&(v={classes:v}),v.enabled===!1&&p.push("disabled"),v.classes&&(p=p.concat(v.classes.split(/\s+/))),v.tooltip&&(c=v.tooltip),p=a.unique(p),q.push('<td class="'+p.join(" ")+'"'+(c?' title="'+c+'"':"")+">"+m.getUTCDate()+"</td>"),m.getUTCDay()==this.o.weekEnd&&q.push("</tr>"),m.setUTCDate(m.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(q.join(""));var w=this.date&&this.date.getUTCFullYear(),x=this.picker.find(".datepicker-months").find("th:eq(1)").text(e).end().find("span").removeClass("active");w&&w==e&&x.eq(this.date.getUTCMonth()).addClass("active"),(g>e||e>i)&&x.addClass("disabled"),e==g&&x.slice(0,h).addClass("disabled"),e==i&&x.slice(j+1).addClass("disabled"),q="",e=10*parseInt(e/10,10);var y=this.picker.find(".datepicker-years").find("th:eq(1)").text(e+"-"+(e+9)).end().find("td");e-=1;for(var z=-1;11>z;z++)q+='<span class="year'+(-1==z?" old":10==z?" new":"")+(w==e?" active":"")+(g>e||e>i?" disabled":"")+'">'+e+"</span>",e+=1;y.html(q)},updateNavArrows:function(){if(this._allow_update){var a=new Date(this.viewDate),b=a.getUTCFullYear(),c=a.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-(1/0)&&b<=this.o.startDate.getUTCFullYear()&&c<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==1/0&&b>=this.o.endDate.getUTCFullYear()&&c>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-(1/0)&&b<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==1/0&&b>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}}},click:function(c){c.preventDefault();var d=a(c.target).closest("span, td, th");if(1==d.length)switch(d[0].nodeName.toLowerCase()){case"th":switch(d[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var e=l.modes[this.viewMode].navStep*("prev"==d[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,e);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,e)}this.fill();break;case"today":var f=new Date;f=b(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),this.showMode(-2);var g="linked"==this.o.todayBtn?null:"view";this._setDate(f,g);break;case"clear":var h;this.isInput?h=this.element:this.component&&(h=this.element.find("input")),h&&h.val("").change(),this._trigger("changeDate"),this.update(),this.o.autoclose&&this.hide()}break;case"span":if(!d.is(".disabled")){if(this.viewDate.setUTCDate(1),d.is(".month")){var i=1,j=d.parent().find("span").index(d),k=this.viewDate.getUTCFullYear();this.viewDate.setUTCMonth(j),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(b(k,j,i,0,0,0,0))}else{var k=parseInt(d.text(),10)||0,i=1,j=0;this.viewDate.setUTCFullYear(k),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(b(k,j,i,0,0,0,0))}this.showMode(-1),this.fill()}break;case"td":if(d.is(".day")&&!d.is(".disabled")){var i=parseInt(d.text(),10)||1,k=this.viewDate.getUTCFullYear(),j=this.viewDate.getUTCMonth();d.is(".old")?0===j?(j=11,k-=1):j-=1:d.is(".new")&&(11==j?(j=0,k+=1):j+=1),this._setDate(b(k,j,i,0,0,0,0))}}},_setDate:function(a,b){b&&"date"!=b||(this.date=new Date(a)),b&&"view"!=b||(this.viewDate=new Date(a)),this.fill(),this.setValue(),this._trigger("changeDate");var c;this.isInput?c=this.element:this.component&&(c=this.element.find("input")),c&&(c.change(),!this.o.autoclose||b&&"date"!=b||this.hide())},moveMonth:function(a,b){if(!b)return a;var c,d,e=new Date(a.valueOf()),f=e.getUTCDate(),g=e.getUTCMonth(),h=Math.abs(b);if(b=b>0?1:-1,1==h)d=-1==b?function(){return e.getUTCMonth()==g}:function(){return e.getUTCMonth()!=c},c=g+b,e.setUTCMonth(c),(0>c||c>11)&&(c=(c+12)%12);else{
for(var i=0;h>i;i++)e=this.moveMonth(e,b);c=e.getUTCMonth(),e.setUTCDate(f),d=function(){return c!=e.getUTCMonth()}}for(;d();)e.setUTCDate(--f),e.setUTCMonth(c);return e},moveYear:function(a,b){return this.moveMonth(a,12*b)},dateWithinRange:function(a){return a>=this.o.startDate&&a<=this.o.endDate},keydown:function(a){if(this.picker.is(":not(:visible)"))return void(27==a.keyCode&&this.show());var b,c,d,e=!1;switch(a.keyCode){case 27:this.hide(),a.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;b=37==a.keyCode?-1:1,a.ctrlKey?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):a.shiftKey?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):(c=new Date(this.date),c.setUTCDate(this.date.getUTCDate()+b),d=new Date(this.viewDate),d.setUTCDate(this.viewDate.getUTCDate()+b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 38:case 40:if(!this.o.keyboardNavigation)break;b=38==a.keyCode?-1:1,a.ctrlKey?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):a.shiftKey?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):(c=new Date(this.date),c.setUTCDate(this.date.getUTCDate()+7*b),d=new Date(this.viewDate),d.setUTCDate(this.viewDate.getUTCDate()+7*b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 13:this.hide(),a.preventDefault();break;case 9:this.hide()}if(e){this._trigger("changeDate");var f;this.isInput?f=this.element:this.component&&(f=this.element.find("input")),f&&f.change()}},showMode:function(a){a&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+a))),this.picker.find(">div").hide().filter(".datepicker-"+l.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var f=function(b,c){this.element=a(b),this.inputs=a.map(c.inputs,function(a){return a.jquery?a[0]:a}),delete c.inputs,a(this.inputs).datepicker(c).bind("changeDate",a.proxy(this.dateUpdated,this)),this.pickers=a.map(this.inputs,function(b){return a(b).data("datepicker")}),this.updateDates()};f.prototype={updateDates:function(){this.dates=a.map(this.pickers,function(a){return a.date}),this.updateRanges()},updateRanges:function(){var b=a.map(this.dates,function(a){return a.valueOf()});a.each(this.pickers,function(a,c){c.setRange(b)})},dateUpdated:function(b){var c=a(b.target).data("datepicker"),d=c.getUTCDate(),e=a.inArray(b.target,this.inputs),f=this.inputs.length;if(-1!=e){if(d<this.dates[e])for(;e>=0&&d<this.dates[e];)this.pickers[e--].setUTCDate(d);else if(d>this.dates[e])for(;f>e&&d>this.dates[e];)this.pickers[e++].setUTCDate(d);this.updateDates()}},remove:function(){a.map(this.pickers,function(a){a.remove()}),delete this.element.data().datepicker}};var g=a.fn.datepicker,h=a.fn.datepicker=function(b){var g=Array.apply(null,arguments);g.shift();var h;return this.each(function(){var j=a(this),k=j.data("datepicker"),l="object"==typeof b&&b;if(!k){var m=c(this,"date"),n=a.extend({},i,m,l),o=d(n.language),p=a.extend({},i,o,m,l);if(j.is(".input-daterange")||p.inputs){var q={inputs:p.inputs||j.find("input").toArray()};j.data("datepicker",k=new f(this,a.extend(p,q)))}else j.data("datepicker",k=new e(this,p))}return"string"==typeof b&&"function"==typeof k[b]&&(h=k[b].apply(k,g),void 0!==h)?!1:void 0}),void 0!==h?h:this},i=a.fn.datepicker.defaults={autoclose:!1,beforeShowDay:a.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,rtl:!1,startDate:-(1/0),startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},j=a.fn.datepicker.locale_opts=["format","rtl","weekStart"];a.fn.datepicker.Constructor=e;var k=a.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},l={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},getDaysInMonth:function(a,b){return[31,l.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(a){var b=a.replace(this.validParts,"\x00").split("\x00"),c=a.match(this.validParts);if(!b||!b.length||!c||0===c.length)throw new Error("Invalid date format.");return{separators:b,parts:c}},parseDate:function(c,d,f){if(c instanceof Date)return c;if("string"==typeof d&&(d=l.parseFormat(d)),/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(c)){var g,h,i=/([\-+]\d+)([dmwy])/,j=c.match(/([\-+]\d+)([dmwy])/g);c=new Date;for(var m=0;m<j.length;m++)switch(g=i.exec(j[m]),h=parseInt(g[1]),g[2]){case"d":c.setUTCDate(c.getUTCDate()+h);break;case"m":c=e.prototype.moveMonth.call(e.prototype,c,h);break;case"w":c.setUTCDate(c.getUTCDate()+7*h);break;case"y":c=e.prototype.moveYear.call(e.prototype,c,h)}return b(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate(),0,0,0)}var n,o,g,j=c&&c.match(this.nonpunctuation)||[],c=new Date,p={},q=["yyyy","yy","M","MM","m","mm","d","dd"],r={yyyy:function(a,b){return a.setUTCFullYear(b)},yy:function(a,b){return a.setUTCFullYear(2e3+b)},m:function(a,b){for(b-=1;0>b;)b+=12;for(b%=12,a.setUTCMonth(b);a.getUTCMonth()!=b;)a.setUTCDate(a.getUTCDate()-1);return a},d:function(a,b){return a.setUTCDate(b)}};r.M=r.MM=r.mm=r.m,r.dd=r.d,c=b(c.getFullYear(),c.getMonth(),c.getDate(),0,0,0);var s=d.parts.slice();if(j.length!=s.length&&(s=a(s).filter(function(b,c){return-1!==a.inArray(c,q)}).toArray()),j.length==s.length){for(var m=0,t=s.length;t>m;m++){if(n=parseInt(j[m],10),g=s[m],isNaN(n))switch(g){case"MM":o=a(k[f].months).filter(function(){var a=this.slice(0,j[m].length),b=j[m].slice(0,a.length);return a==b}),n=a.inArray(o[0],k[f].months)+1;break;case"M":o=a(k[f].monthsShort).filter(function(){var a=this.slice(0,j[m].length),b=j[m].slice(0,a.length);return a==b}),n=a.inArray(o[0],k[f].monthsShort)+1}p[g]=n}for(var u,m=0;m<q.length;m++)u=q[m],u in p&&!isNaN(p[u])&&r[u](c,p[u])}return c},formatDate:function(b,c,d){"string"==typeof c&&(c=l.parseFormat(c));var e={d:b.getUTCDate(),D:k[d].daysShort[b.getUTCDay()],DD:k[d].days[b.getUTCDay()],m:b.getUTCMonth()+1,M:k[d].monthsShort[b.getUTCMonth()],MM:k[d].months[b.getUTCMonth()],yy:b.getUTCFullYear().toString().substring(2),yyyy:b.getUTCFullYear()};e.dd=(e.d<10?"0":"")+e.d,e.mm=(e.m<10?"0":"")+e.m;for(var b=[],f=a.extend([],c.separators),g=0,h=c.parts.length;h>=g;g++)f.length&&b.push(f.shift()),b.push(e[c.parts[g]]);return b.join("")},headTemplate:'<thead><tr><th class="prev"><i class="icon-arrow-left"/></th><th colspan="5" class="datepicker-switch"></th><th class="next"><i class="icon-arrow-right"/></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};l.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+l.headTemplate+"<tbody></tbody>"+l.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+l.headTemplate+l.contTemplate+l.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+l.headTemplate+l.contTemplate+l.footTemplate+"</table></div></div>",a.fn.datepicker.DPGlobal=l,a.fn.datepicker.noConflict=function(){return a.fn.datepicker=g,this},a(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(b){var c=a(this);c.data("datepicker")||(b.preventDefault(),h.call(c,"show"))}),a(function(){h.call(a('[data-provide="datepicker-inline"]'))})}(window.jQuery),function(a){"use strict";a.fn.bdatepicker=a.fn.datepicker.noConflict(),a.fn.datepicker||(a.fn.datepicker=a.fn.bdatepicker);var b=function(a){this.init("date",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{initPicker:function(b,c){this.options.viewformat||(this.options.viewformat=this.options.format),b.datepicker=a.fn.editableutils.tryParseJson(b.datepicker,!0),this.options.datepicker=a.extend({},c.datepicker,b.datepicker,{format:this.options.viewformat}),this.options.datepicker.language=this.options.datepicker.language||"en",this.dpg=a.fn.bdatepicker.DPGlobal,this.parsedFormat=this.dpg.parseFormat(this.options.format),this.parsedViewFormat=this.dpg.parseFormat(this.options.viewformat)},render:function(){this.$input.bdatepicker(this.options.datepicker),this.options.clear&&(this.$clear=a('<a href="#"></a>').html(this.options.clear).click(a.proxy(function(a){a.preventDefault(),a.stopPropagation(),this.clear()},this)),this.$tpl.parent().append(a('<div class="editable-clear">').append(this.$clear)))},value2html:function(a,c){var d=a?this.dpg.formatDate(a,this.parsedViewFormat,this.options.datepicker.language):"";b.superclass.value2html.call(this,d,c)},html2value:function(a){return this.parseDate(a,this.parsedViewFormat)},value2str:function(a){return a?this.dpg.formatDate(a,this.parsedFormat,this.options.datepicker.language):""},str2value:function(a){return this.parseDate(a,this.parsedFormat)},value2submit:function(a){return this.value2str(a)},value2input:function(a){this.$input.bdatepicker("update",a)},input2value:function(){return this.$input.data("datepicker").date},activate:function(){},clear:function(){this.$input.data("datepicker").date=null,this.$input.find(".active").removeClass("active"),this.options.showbuttons||this.$input.closest("form").submit()},autosubmit:function(){this.$input.on("mouseup",".day",function(b){if(!a(b.currentTarget).is(".old")&&!a(b.currentTarget).is(".new")){var c=a(this).closest("form");setTimeout(function(){c.submit()},200)}})},parseDate:function(a,b){var c,d=null;return a&&(d=this.dpg.parseDate(a,b,this.options.datepicker.language),"string"==typeof a&&(c=this.dpg.formatDate(d,b,this.options.datepicker.language),a!==c&&(d=null))),d}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-date well"></div>',inputclass:null,format:"yyyy-mm-dd",viewformat:null,datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:!1},clear:"&times; clear"}),a.fn.editabletypes.date=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("datefield",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.date),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.find("input"),this.setClass(),this.setAttr("placeholder"),this.$tpl.bdatepicker(this.options.datepicker),this.$input.off("focus keydown"),this.$input.keyup(a.proxy(function(){this.$tpl.removeData("date"),this.$tpl.bdatepicker("update")},this))},value2input:function(a){this.$input.val(a?this.dpg.formatDate(a,this.parsedViewFormat,this.options.datepicker.language):""),this.$tpl.bdatepicker("update")},input2value:function(){return this.html2value(this.$input.val())},activate:function(){a.fn.editabletypes.text.prototype.activate.call(this)},autosubmit:function(){}}),b.defaults=a.extend({},a.fn.editabletypes.date.defaults,{tpl:'<div class="input-append date"><input type="text"/><span class="add-on"><i class="icon-th"></i></span></div>',inputclass:"input-small",datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:!0}}),a.fn.editabletypes.datefield=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("datetime",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{initPicker:function(b,c){this.options.viewformat||(this.options.viewformat=this.options.format),b.datetimepicker=a.fn.editableutils.tryParseJson(b.datetimepicker,!0),this.options.datetimepicker=a.extend({},c.datetimepicker,b.datetimepicker,{format:this.options.viewformat}),this.options.datetimepicker.language=this.options.datetimepicker.language||"en",this.dpg=a.fn.datetimepicker.DPGlobal,this.parsedFormat=this.dpg.parseFormat(this.options.format,this.options.formatType),this.parsedViewFormat=this.dpg.parseFormat(this.options.viewformat,this.options.formatType)},render:function(){this.$input.datetimepicker(this.options.datetimepicker),this.$input.on("changeMode",function(b){var c=a(this).closest("form").parent();setTimeout(function(){c.triggerHandler("resize")},0)}),this.options.clear&&(this.$clear=a('<a href="#"></a>').html(this.options.clear).click(a.proxy(function(a){a.preventDefault(),a.stopPropagation(),this.clear()},this)),this.$tpl.parent().append(a('<div class="editable-clear">').append(this.$clear)))},value2html:function(a,c){var d=a?this.dpg.formatDate(this.toUTC(a),this.parsedViewFormat,this.options.datetimepicker.language,this.options.formatType):"";return c?void b.superclass.value2html.call(this,d,c):d},html2value:function(a){var b=this.parseDate(a,this.parsedViewFormat);return b?this.fromUTC(b):null},value2str:function(a){return a?this.dpg.formatDate(this.toUTC(a),this.parsedFormat,this.options.datetimepicker.language,this.options.formatType):""},str2value:function(a){var b=this.parseDate(a,this.parsedFormat);return b?this.fromUTC(b):null},value2submit:function(a){return this.value2str(a)},value2input:function(a){a&&this.$input.data("datetimepicker").setDate(a)},input2value:function(){var a=this.$input.data("datetimepicker");return a.date?a.getDate():null},activate:function(){},clear:function(){this.$input.data("datetimepicker").date=null,this.$input.find(".active").removeClass("active"),this.options.showbuttons||this.$input.closest("form").submit()},autosubmit:function(){this.$input.on("mouseup",".minute",function(b){var c=a(this).closest("form");setTimeout(function(){c.submit()},200)})},toUTC:function(a){return a?new Date(a.valueOf()-6e4*a.getTimezoneOffset()):a},fromUTC:function(a){return a?new Date(a.valueOf()+6e4*a.getTimezoneOffset()):a},parseDate:function(a,b){var c,d=null;return a&&(d=this.dpg.parseDate(a,b,this.options.datetimepicker.language,this.options.formatType),"string"==typeof a&&(c=this.dpg.formatDate(d,b,this.options.datetimepicker.language,this.options.formatType),a!==c&&(d=null))),d}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-date well"></div>',inputclass:null,format:"yyyy-mm-dd hh:ii",formatType:"standard",viewformat:null,datetimepicker:{todayHighlight:!1,autoclose:!1},clear:"&times; clear"}),a.fn.editabletypes.datetime=b}(window.jQuery),function(a){"use strict";var b=function(a){this.init("datetimefield",a,b.defaults),this.initPicker(a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.datetime),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.find("input"),this.setClass(),this.setAttr("placeholder"),this.$tpl.datetimepicker(this.options.datetimepicker),this.$input.off("focus keydown"),this.$input.keyup(a.proxy(function(){this.$tpl.removeData("date"),this.$tpl.datetimepicker("update")},this))},value2input:function(a){this.$input.val(this.value2html(a)),this.$tpl.datetimepicker("update")},input2value:function(){return this.html2value(this.$input.val())},activate:function(){a.fn.editabletypes.text.prototype.activate.call(this)},autosubmit:function(){}}),b.defaults=a.extend({},a.fn.editabletypes.datetime.defaults,{tpl:'<div class="input-append date"><input type="text"/><span class="add-on"><i class="icon-th"></i></span></div>',inputclass:"input-medium",datetimepicker:{todayHighlight:!1,autoclose:!0}}),a.fn.editabletypes.datetimefield=b}(window.jQuery),!function(a){function b(){return new Date(Date.UTC.apply(Date,arguments))}var c=function(b,c){var d=this;this.element=a(b),this.container=c.container||"body",this.language=c.language||this.element.data("date-language")||"en",this.language=this.language in e?this.language:"en",this.isRTL=e[this.language].rtl||!1,this.formatType=c.formatType||this.element.data("format-type")||"standard",this.format=f.parseFormat(c.format||this.element.data("date-format")||e[this.language].format||f.getDefaultFormat(this.formatType,"input"),this.formatType),this.isInline=!1,this.isVisible=!1,this.isInput=this.element.is("input"),this.fontAwesome=c.fontAwesome||this.element.data("font-awesome")||!1,this.bootcssVer=c.bootcssVer||(this.isInput?this.element.is(".form-control")?3:2:this.bootcssVer=this.element.is(".input-group")?3:2),this.component=this.element.is(".date")?3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-calendar, .input-group-addon .glyphicon-calendar, .input-group-addon .fa-calendar, .input-group-addon .fa-clock-o").parent():this.element.find(".add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar .fa-calendar .fa-clock-o").parent():!1,this.componentReset=this.element.is(".date")?3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-remove .fa-times").parent():this.element.find(".add-on .icon-remove .fa-times").parent():!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.linkField=c.linkField||this.element.data("link-field")||!1,this.linkFormat=f.parseFormat(c.linkFormat||this.element.data("link-format")||f.getDefaultFormat(this.formatType,"link"),this.formatType),this.minuteStep=c.minuteStep||this.element.data("minute-step")||5,this.pickerPosition=c.pickerPosition||this.element.data("picker-position")||"bottom-right",this.showMeridian=c.showMeridian||this.element.data("show-meridian")||!1,this.initialDate=c.initialDate||new Date,this.zIndex=c.zIndex||this.element.data("z-index")||void 0,this.icons={leftArrow:this.fontAwesome?"fa-arrow-left":3===this.bootcssVer?"glyphicon-arrow-left":"icon-arrow-left",rightArrow:this.fontAwesome?"fa-arrow-right":3===this.bootcssVer?"glyphicon-arrow-right":"icon-arrow-right"},this.icontype=this.fontAwesome?"fa":"glyphicon",this._attachEvents(),this.formatViewType="datetime","formatViewType"in c?this.formatViewType=c.formatViewType:"formatViewType"in this.element.data()&&(this.formatViewType=this.element.data("formatViewType")),this.minView=0,"minView"in c?this.minView=c.minView:"minView"in this.element.data()&&(this.minView=this.element.data("min-view")),this.minView=f.convertViewMode(this.minView),this.maxView=f.modes.length-1,"maxView"in c?this.maxView=c.maxView:"maxView"in this.element.data()&&(this.maxView=this.element.data("max-view")),this.maxView=f.convertViewMode(this.maxView),this.wheelViewModeNavigation=!1,"wheelViewModeNavigation"in c?this.wheelViewModeNavigation=c.wheelViewModeNavigation:"wheelViewModeNavigation"in this.element.data()&&(this.wheelViewModeNavigation=this.element.data("view-mode-wheel-navigation")),this.wheelViewModeNavigationInverseDirection=!1,"wheelViewModeNavigationInverseDirection"in c?this.wheelViewModeNavigationInverseDirection=c.wheelViewModeNavigationInverseDirection:"wheelViewModeNavigationInverseDirection"in this.element.data()&&(this.wheelViewModeNavigationInverseDirection=this.element.data("view-mode-wheel-navigation-inverse-dir")),this.wheelViewModeNavigationDelay=100,"wheelViewModeNavigationDelay"in c?this.wheelViewModeNavigationDelay=c.wheelViewModeNavigationDelay:"wheelViewModeNavigationDelay"in this.element.data()&&(this.wheelViewModeNavigationDelay=this.element.data("view-mode-wheel-navigation-delay")),this.startViewMode=2,"startView"in c?this.startViewMode=c.startView:"startView"in this.element.data()&&(this.startViewMode=this.element.data("start-view")),this.startViewMode=f.convertViewMode(this.startViewMode),this.viewMode=this.startViewMode,this.viewSelect=this.minView,"viewSelect"in c?this.viewSelect=c.viewSelect:"viewSelect"in this.element.data()&&(this.viewSelect=this.element.data("view-select")),this.viewSelect=f.convertViewMode(this.viewSelect),this.forceParse=!0,"forceParse"in c?this.forceParse=c.forceParse:"dateForceParse"in this.element.data()&&(this.forceParse=this.element.data("date-force-parse"));for(var g=3===this.bootcssVer?f.templateV3:f.template;-1!==g.indexOf("{iconType}");)g=g.replace("{iconType}",this.icontype);for(;-1!==g.indexOf("{leftArrow}");)g=g.replace("{leftArrow}",this.icons.leftArrow);for(;-1!==g.indexOf("{rightArrow}");)g=g.replace("{rightArrow}",this.icons.rightArrow);if(this.picker=a(g).appendTo(this.isInline?this.element:this.container).on({click:a.proxy(this.click,this),mousedown:a.proxy(this.mousedown,this)}),this.wheelViewModeNavigation&&(a.fn.mousewheel?this.picker.on({mousewheel:a.proxy(this.mousewheel,this)}):console.log("Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option")),this.isInline?this.picker.addClass("datetimepicker-inline"):this.picker.addClass("datetimepicker-dropdown-"+this.pickerPosition+" dropdown-menu"),this.isRTL){this.picker.addClass("datetimepicker-rtl");var h=3===this.bootcssVer?".prev span, .next span":".prev i, .next i";this.picker.find(h).toggleClass(this.icons.leftArrow+" "+this.icons.rightArrow)}a(document).on("mousedown",function(b){0===a(b.target).closest(".datetimepicker").length&&d.hide()}),this.autoclose=!1,"autoclose"in c?this.autoclose=c.autoclose:"dateAutoclose"in this.element.data()&&(this.autoclose=this.element.data("date-autoclose")),this.keyboardNavigation=!0,"keyboardNavigation"in c?this.keyboardNavigation=c.keyboardNavigation:"dateKeyboardNavigation"in this.element.data()&&(this.keyboardNavigation=this.element.data("date-keyboard-navigation")),this.todayBtn=c.todayBtn||this.element.data("date-today-btn")||!1,this.todayHighlight=c.todayHighlight||this.element.data("date-today-highlight")||!1,this.weekStart=(c.weekStart||this.element.data("date-weekstart")||e[this.language].weekStart||0)%7,this.weekEnd=(this.weekStart+6)%7,this.startDate=-(1/0),this.endDate=1/0,this.daysOfWeekDisabled=[],this.setStartDate(c.startDate||this.element.data("date-startdate")),this.setEndDate(c.endDate||this.element.data("date-enddate")),this.setDaysOfWeekDisabled(c.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled")),this.setMinutesDisabled(c.minutesDisabled||this.element.data("date-minute-disabled")),this.setHoursDisabled(c.hoursDisabled||this.element.data("date-hour-disabled")),this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.isInline&&this.show()};c.prototype={constructor:c,_events:[],_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{focus:a.proxy(this.show,this),keyup:a.proxy(this.update,this),keydown:a.proxy(this.keydown,this)}],[this.component,{click:a.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:a.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:a.proxy(this.show,this)}]];for(var b,c,d=0;d<this._events.length;d++)b=this._events[d][0],c=this._events[d][1],b.on(c)},_detachEvents:function(){for(var a,b,c=0;c<this._events.length;c++)a=this._events[c][0],b=this._events[c][1],a.off(b);this._events=[]},show:function(b){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.forceParse&&this.update(),this.place(),a(window).on("resize",a.proxy(this.place,this)),b&&(b.stopPropagation(),b.preventDefault()),this.isVisible=!0,this.element.trigger({type:"show",date:this.date})},hide:function(b){this.isVisible&&(this.isInline||(this.picker.hide(),a(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||a(document).off("mousedown",this.hide),this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this.isVisible=!1,this.element.trigger({type:"hide",date:this.date})))},remove:function(){this._detachEvents(),this.picker.remove(),delete this.picker,delete this.element.data().datetimepicker},getDate:function(){var a=this.getUTCDate();return new Date(a.getTime()+6e4*a.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(a){this.setUTCDate(new Date(a.getTime()-6e4*a.getTimezoneOffset()))},setUTCDate:function(a){a>=this.startDate&&a<=this.endDate?(this.date=a,this.setValue(),this.viewDate=this.date,this.fill()):this.element.trigger({type:"outOfRange",date:a,startDate:this.startDate,endDate:this.endDate})},setFormat:function(a){this.format=f.parseFormat(a,this.formatType);var b;this.isInput?b=this.element:this.component&&(b=this.element.find("input")),b&&b.val()&&this.setValue()},setValue:function(){var b=this.getFormattedDate();this.isInput?this.element.val(b):(this.component&&this.element.find("input").val(b),this.element.data("date",b)),this.linkField&&a("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},getFormattedDate:function(a){return void 0==a&&(a=this.format),f.formatDate(this.date,a,this.language,this.formatType)},setStartDate:function(a){this.startDate=a||-(1/0),this.startDate!==-(1/0)&&(this.startDate=f.parseDate(this.startDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setEndDate:function(a){this.endDate=a||1/0,this.endDate!==1/0&&(this.endDate=f.parseDate(this.endDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(b){this.daysOfWeekDisabled=b||[],a.isArray(this.daysOfWeekDisabled)||(this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)),this.daysOfWeekDisabled=a.map(this.daysOfWeekDisabled,function(a){return parseInt(a,10)}),this.update(),this.updateNavArrows()},setMinutesDisabled:function(b){this.minutesDisabled=b||[],a.isArray(this.minutesDisabled)||(this.minutesDisabled=this.minutesDisabled.split(/,\s*/)),this.minutesDisabled=a.map(this.minutesDisabled,function(a){return parseInt(a,10)}),this.update(),this.updateNavArrows()},setHoursDisabled:function(b){this.hoursDisabled=b||[],a.isArray(this.hoursDisabled)||(this.hoursDisabled=this.hoursDisabled.split(/,\s*/)),this.hoursDisabled=a.map(this.hoursDisabled,function(a){return parseInt(a,10)}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){if(!this.zIndex){var b=0;a("div").each(function(){var c=parseInt(a(this).css("zIndex"),10);c>b&&(b=c)}),this.zIndex=b+10}var c,d,e,f;f=this.container instanceof a?this.container.offset():a(this.container).offset(),this.component?(c=this.component.offset(),e=c.left,("bottom-left"==this.pickerPosition||"top-left"==this.pickerPosition)&&(e+=this.component.outerWidth()-this.picker.outerWidth())):(c=this.element.offset(),e=c.left),e+220>document.body.clientWidth&&(e=document.body.clientWidth-220),d="top-left"==this.pickerPosition||"top-right"==this.pickerPosition?c.top-this.picker.outerHeight():c.top+this.height,d-=f.top,e-=f.left,d+=document.body.scrollTop,this.picker.css({top:d,left:e,zIndex:this.zIndex})}},update:function(){var a,b=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(a=arguments[0],b=!0):(a=(this.isInput?this.element.val():this.element.find("input").val())||this.element.data("date")||this.initialDate,("string"==typeof a||a instanceof String)&&(a=a.replace(/^\s+|\s+$/g,""))),a||(a=new Date,b=!1),this.date=f.parseDate(a,this.format,this.language,this.formatType),b&&this.setValue(),this.date<this.startDate?this.viewDate=new Date(this.startDate):this.date>this.endDate?this.viewDate=new Date(this.endDate):this.viewDate=new Date(this.date),this.fill()},fillDow:function(){for(var a=this.weekStart,b="<tr>";a<this.weekStart+7;)b+='<th class="dow">'+e[this.language].daysMin[a++%7]+"</th>";b+="</tr>",this.picker.find(".datetimepicker-days thead").append(b)},fillMonths:function(){for(var a="",b=0;12>b;)a+='<span class="month">'+e[this.language].monthsShort[b++]+"</span>";this.picker.find(".datetimepicker-months td").html(a)},fill:function(){if(null!=this.date&&null!=this.viewDate){var c=new Date(this.viewDate),d=c.getUTCFullYear(),g=c.getUTCMonth(),h=c.getUTCDate(),i=c.getUTCHours(),j=c.getUTCMinutes(),k=this.startDate!==-(1/0)?this.startDate.getUTCFullYear():-(1/0),l=this.startDate!==-(1/0)?this.startDate.getUTCMonth()+1:-(1/0),m=this.endDate!==1/0?this.endDate.getUTCFullYear():1/0,n=this.endDate!==1/0?this.endDate.getUTCMonth()+1:1/0,o=new b(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),p=new Date;if(this.picker.find(".datetimepicker-days thead th:eq(1)").text(e[this.language].months[g]+" "+d),"time"==this.formatViewType){var q=this.getFormattedDate();this.picker.find(".datetimepicker-hours thead th:eq(1)").text(q),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(q)}else this.picker.find(".datetimepicker-hours thead th:eq(1)").text(h+" "+e[this.language].months[g]+" "+d),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(h+" "+e[this.language].months[g]+" "+d);this.picker.find("tfoot th.today").text(e[this.language].today).toggle(this.todayBtn!==!1),this.updateNavArrows(),this.fillMonths();var r=b(d,g-1,28,0,0,0,0),s=f.getDaysInMonth(r.getUTCFullYear(),r.getUTCMonth());r.setUTCDate(s),r.setUTCDate(s-(r.getUTCDay()-this.weekStart+7)%7);var t=new Date(r);t.setUTCDate(t.getUTCDate()+42),t=t.valueOf();for(var u,v=[];r.valueOf()<t;)r.getUTCDay()==this.weekStart&&v.push("<tr>"),u="",r.getUTCFullYear()<d||r.getUTCFullYear()==d&&r.getUTCMonth()<g?u+=" old":(r.getUTCFullYear()>d||r.getUTCFullYear()==d&&r.getUTCMonth()>g)&&(u+=" new"),this.todayHighlight&&r.getUTCFullYear()==p.getFullYear()&&r.getUTCMonth()==p.getMonth()&&r.getUTCDate()==p.getDate()&&(u+=" today"),r.valueOf()==o&&(u+=" active"),(r.valueOf()+864e5<=this.startDate||r.valueOf()>this.endDate||-1!==a.inArray(r.getUTCDay(),this.daysOfWeekDisabled))&&(u+=" disabled"),v.push('<td class="day'+u+'">'+r.getUTCDate()+"</td>"),r.getUTCDay()==this.weekEnd&&v.push("</tr>"),r.setUTCDate(r.getUTCDate()+1);this.picker.find(".datetimepicker-days tbody").empty().append(v.join("")),v=[];for(var w="",x="",y="",z=this.hoursDisabled||[],A=0;24>A;A++)if(-1===z.indexOf(A)){var B=b(d,g,h,A);u="",B.valueOf()+36e5<=this.startDate||B.valueOf()>this.endDate?u+=" disabled":i==A&&(u+=" active"),this.showMeridian&&2==e[this.language].meridiem.length?(x=12>A?e[this.language].meridiem[0]:e[this.language].meridiem[1],x!=y&&(""!=y&&v.push("</fieldset>"),v.push('<fieldset class="hour"><legend>'+x.toUpperCase()+"</legend>")),y=x,w=A%12?A%12:12,v.push('<span class="hour'+u+" hour_"+(12>A?"am":"pm")+'">'+w+"</span>"),23==A&&v.push("</fieldset>")):(w=A+":00",v.push('<span class="hour'+u+'">'+w+"</span>"))}this.picker.find(".datetimepicker-hours td").html(v.join("")),v=[],w="",x="",y="";for(var C=this.minutesDisabled||[],A=0;60>A;A+=this.minuteStep)if(-1===C.indexOf(A)){var B=b(d,g,h,i,A,0);u="",B.valueOf()<this.startDate||B.valueOf()>this.endDate?u+=" disabled":Math.floor(j/this.minuteStep)==Math.floor(A/this.minuteStep)&&(u+=" active"),this.showMeridian&&2==e[this.language].meridiem.length?(x=12>i?e[this.language].meridiem[0]:e[this.language].meridiem[1],x!=y&&(""!=y&&v.push("</fieldset>"),v.push('<fieldset class="minute"><legend>'+x.toUpperCase()+"</legend>")),y=x,w=i%12?i%12:12,v.push('<span class="minute'+u+'">'+w+":"+(10>A?"0"+A:A)+"</span>"),59==A&&v.push("</fieldset>")):(w=A+":00",v.push('<span class="minute'+u+'">'+i+":"+(10>A?"0"+A:A)+"</span>"))}this.picker.find(".datetimepicker-minutes td").html(v.join(""));var D=this.date.getUTCFullYear(),E=this.picker.find(".datetimepicker-months").find("th:eq(1)").text(d).end().find("span").removeClass("active");
D==d&&E.eq(this.date.getUTCMonth()+2).addClass("active"),(k>d||d>m)&&E.addClass("disabled"),d==k&&E.slice(0,l+1).addClass("disabled"),d==m&&E.slice(n).addClass("disabled"),v="",d=10*parseInt(d/10,10);var F=this.picker.find(".datetimepicker-years").find("th:eq(1)").text(d+"-"+(d+9)).end().find("td");d-=1;for(var A=-1;11>A;A++)v+='<span class="year'+(-1==A||10==A?" old":"")+(D==d?" active":"")+(k>d||d>m?" disabled":"")+'">'+d+"</span>",d+=1;F.html(v),this.place()}},updateNavArrows:function(){var a=new Date(this.viewDate),b=a.getUTCFullYear(),c=a.getUTCMonth(),d=a.getUTCDate(),e=a.getUTCHours();switch(this.viewMode){case 0:this.startDate!==-(1/0)&&b<=this.startDate.getUTCFullYear()&&c<=this.startDate.getUTCMonth()&&d<=this.startDate.getUTCDate()&&e<=this.startDate.getUTCHours()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&b>=this.endDate.getUTCFullYear()&&c>=this.endDate.getUTCMonth()&&d>=this.endDate.getUTCDate()&&e>=this.endDate.getUTCHours()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:this.startDate!==-(1/0)&&b<=this.startDate.getUTCFullYear()&&c<=this.startDate.getUTCMonth()&&d<=this.startDate.getUTCDate()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&b>=this.endDate.getUTCFullYear()&&c>=this.endDate.getUTCMonth()&&d>=this.endDate.getUTCDate()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 2:this.startDate!==-(1/0)&&b<=this.startDate.getUTCFullYear()&&c<=this.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&b>=this.endDate.getUTCFullYear()&&c>=this.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 3:case 4:this.startDate!==-(1/0)&&b<=this.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&b>=this.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},mousewheel:function(b){if(b.preventDefault(),b.stopPropagation(),!this.wheelPause){this.wheelPause=!0;var c=b.originalEvent,d=c.wheelDelta,e=d>0?1:0===d?0:-1;this.wheelViewModeNavigationInverseDirection&&(e=-e),this.showMode(e),setTimeout(a.proxy(function(){this.wheelPause=!1},this),this.wheelViewModeNavigationDelay)}},click:function(c){c.stopPropagation(),c.preventDefault();var d=a(c.target).closest("span, td, th, legend");if(d.is("."+this.icontype)&&(d=a(d).parent().closest("span, td, th, legend")),1==d.length){if(d.is(".disabled"))return void this.element.trigger({type:"outOfRange",date:this.viewDate,startDate:this.startDate,endDate:this.endDate});switch(d[0].nodeName.toLowerCase()){case"th":switch(d[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var e=f.modes[this.viewMode].navStep*("prev"==d[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,e);break;case 1:this.viewDate=this.moveDate(this.viewDate,e);break;case 2:this.viewDate=this.moveMonth(this.viewDate,e);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,e)}this.fill(),this.element.trigger({type:d[0].className+":"+this.convertViewModeText(this.viewMode),date:this.viewDate,startDate:this.startDate,endDate:this.endDate});break;case"today":var g=new Date;g=b(g.getFullYear(),g.getMonth(),g.getDate(),g.getHours(),g.getMinutes(),g.getSeconds(),0),g<this.startDate?g=this.startDate:g>this.endDate&&(g=this.endDate),this.viewMode=this.startViewMode,this.showMode(0),this._setDate(g),this.fill(),this.autoclose&&this.hide()}break;case"span":if(!d.is(".disabled")){var h=this.viewDate.getUTCFullYear(),i=this.viewDate.getUTCMonth(),j=this.viewDate.getUTCDate(),k=this.viewDate.getUTCHours(),l=this.viewDate.getUTCMinutes(),m=this.viewDate.getUTCSeconds();if(d.is(".month")?(this.viewDate.setUTCDate(1),i=d.parent().find("span").index(d),j=this.viewDate.getUTCDate(),this.viewDate.setUTCMonth(i),this.element.trigger({type:"changeMonth",date:this.viewDate}),this.viewSelect>=3&&this._setDate(b(h,i,j,k,l,m,0))):d.is(".year")?(this.viewDate.setUTCDate(1),h=parseInt(d.text(),10)||0,this.viewDate.setUTCFullYear(h),this.element.trigger({type:"changeYear",date:this.viewDate}),this.viewSelect>=4&&this._setDate(b(h,i,j,k,l,m,0))):d.is(".hour")?(k=parseInt(d.text(),10)||0,(d.hasClass("hour_am")||d.hasClass("hour_pm"))&&(12==k&&d.hasClass("hour_am")?k=0:12!=k&&d.hasClass("hour_pm")&&(k+=12)),this.viewDate.setUTCHours(k),this.element.trigger({type:"changeHour",date:this.viewDate}),this.viewSelect>=1&&this._setDate(b(h,i,j,k,l,m,0))):d.is(".minute")&&(l=parseInt(d.text().substr(d.text().indexOf(":")+1),10)||0,this.viewDate.setUTCMinutes(l),this.element.trigger({type:"changeMinute",date:this.viewDate}),this.viewSelect>=0&&this._setDate(b(h,i,j,k,l,m,0))),0!=this.viewMode){var n=this.viewMode;this.showMode(-1),this.fill(),n==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide()}break;case"td":if(d.is(".day")&&!d.is(".disabled")){var j=parseInt(d.text(),10)||1,h=this.viewDate.getUTCFullYear(),i=this.viewDate.getUTCMonth(),k=this.viewDate.getUTCHours(),l=this.viewDate.getUTCMinutes(),m=this.viewDate.getUTCSeconds();d.is(".old")?0===i?(i=11,h-=1):i-=1:d.is(".new")&&(11==i?(i=0,h+=1):i+=1),this.viewDate.setUTCFullYear(h),this.viewDate.setUTCMonth(i,j),this.element.trigger({type:"changeDay",date:this.viewDate}),this.viewSelect>=2&&this._setDate(b(h,i,j,k,l,m,0))}var n=this.viewMode;this.showMode(-1),this.fill(),n==this.viewMode&&this.autoclose&&this.hide()}}},_setDate:function(a,b){b&&"date"!=b||(this.date=a),b&&"view"!=b||(this.viewDate=a),this.fill(),this.setValue();var c;this.isInput?c=this.element:this.component&&(c=this.element.find("input")),c&&(c.change(),this.autoclose&&(!b||"date"==b)),this.element.trigger({type:"changeDate",date:this.date})},moveMinute:function(a,b){if(!b)return a;var c=new Date(a.valueOf());return c.setUTCMinutes(c.getUTCMinutes()+b*this.minuteStep),c},moveHour:function(a,b){if(!b)return a;var c=new Date(a.valueOf());return c.setUTCHours(c.getUTCHours()+b),c},moveDate:function(a,b){if(!b)return a;var c=new Date(a.valueOf());return c.setUTCDate(c.getUTCDate()+b),c},moveMonth:function(a,b){if(!b)return a;var c,d,e=new Date(a.valueOf()),f=e.getUTCDate(),g=e.getUTCMonth(),h=Math.abs(b);if(b=b>0?1:-1,1==h)d=-1==b?function(){return e.getUTCMonth()==g}:function(){return e.getUTCMonth()!=c},c=g+b,e.setUTCMonth(c),(0>c||c>11)&&(c=(c+12)%12);else{for(var i=0;h>i;i++)e=this.moveMonth(e,b);c=e.getUTCMonth(),e.setUTCDate(f),d=function(){return c!=e.getUTCMonth()}}for(;d();)e.setUTCDate(--f),e.setUTCMonth(c);return e},moveYear:function(a,b){return this.moveMonth(a,12*b)},dateWithinRange:function(a){return a>=this.startDate&&a<=this.endDate},keydown:function(a){if(this.picker.is(":not(:visible)"))return void(27==a.keyCode&&this.show());var b,c,d,e=!1;switch(a.keyCode){case 27:this.hide(),a.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;b=37==a.keyCode?-1:1,viewMode=this.viewMode,a.ctrlKey?viewMode+=2:a.shiftKey&&(viewMode+=1),4==viewMode?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):3==viewMode?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):2==viewMode?(c=this.moveDate(this.date,b),d=this.moveDate(this.viewDate,b)):1==viewMode?(c=this.moveHour(this.date,b),d=this.moveHour(this.viewDate,b)):0==viewMode&&(c=this.moveMinute(this.date,b),d=this.moveMinute(this.viewDate,b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 38:case 40:if(!this.keyboardNavigation)break;b=38==a.keyCode?-1:1,viewMode=this.viewMode,a.ctrlKey?viewMode+=2:a.shiftKey&&(viewMode+=1),4==viewMode?(c=this.moveYear(this.date,b),d=this.moveYear(this.viewDate,b)):3==viewMode?(c=this.moveMonth(this.date,b),d=this.moveMonth(this.viewDate,b)):2==viewMode?(c=this.moveDate(this.date,7*b),d=this.moveDate(this.viewDate,7*b)):1==viewMode?this.showMeridian?(c=this.moveHour(this.date,6*b),d=this.moveHour(this.viewDate,6*b)):(c=this.moveHour(this.date,4*b),d=this.moveHour(this.viewDate,4*b)):0==viewMode&&(c=this.moveMinute(this.date,4*b),d=this.moveMinute(this.viewDate,4*b)),this.dateWithinRange(c)&&(this.date=c,this.viewDate=d,this.setValue(),this.update(),a.preventDefault(),e=!0);break;case 13:if(0!=this.viewMode){var f=this.viewMode;this.showMode(-1),this.fill(),f==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide();a.preventDefault();break;case 9:this.hide()}if(e){var g;this.isInput?g=this.element:this.component&&(g=this.element.find("input")),g&&g.change(),this.element.trigger({type:"changeDate",date:this.date})}},showMode:function(a){if(a){var b=Math.max(0,Math.min(f.modes.length-1,this.viewMode+a));b>=this.minView&&b<=this.maxView&&(this.element.trigger({type:"changeMode",date:this.viewDate,oldViewMode:this.viewMode,newViewMode:b}),this.viewMode=b)}this.picker.find(">div").hide().filter(".datetimepicker-"+f.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()},reset:function(a){this._setDate(null,"date")},convertViewModeText:function(a){switch(a){case 4:return"decade";case 3:return"year";case 2:return"month";case 1:return"day";case 0:return"hour"}}};var d=a.fn.datetimepicker;a.fn.datetimepicker=function(b){var d=Array.apply(null,arguments);d.shift();var e;return this.each(function(){var f=a(this),g=f.data("datetimepicker"),h="object"==typeof b&&b;return g||f.data("datetimepicker",g=new c(this,a.extend({},a.fn.datetimepicker.defaults,h))),"string"==typeof b&&"function"==typeof g[b]&&(e=g[b].apply(g,d),void 0!==e)?!1:void 0}),void 0!==e?e:this},a.fn.datetimepicker.defaults={},a.fn.datetimepicker.Constructor=c;var e=a.fn.datetimepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["am","pm"],suffix:["st","nd","rd","th"],today:"Today"}},f={modes:[{clsName:"minutes",navFnc:"Hours",navStep:1},{clsName:"hours",navFnc:"Date",navStep:1},{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},getDaysInMonth:function(a,b){return[31,f.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},getDefaultFormat:function(a,b){if("standard"==a)return"input"==b?"yyyy-mm-dd hh:ii":"yyyy-mm-dd hh:ii:ss";if("php"==a)return"input"==b?"Y-m-d H:i":"Y-m-d H:i:s";throw new Error("Invalid format type.")},validParts:function(a){if("standard"==a)return/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;if("php"==a)return/[dDjlNwzFmMnStyYaABgGhHis]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(a,b){var c=a.replace(this.validParts(b),"\x00").split("\x00"),d=a.match(this.validParts(b));if(!c||!c.length||!d||0==d.length)throw new Error("Invalid date format.");return{separators:c,parts:d}},parseDate:function(d,f,g,h){if(d instanceof Date){var i=new Date(d.valueOf()-6e4*d.getTimezoneOffset());return i.setMilliseconds(0),i}if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(d)&&(f=this.parseFormat("yyyy-mm-dd",h)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(d)&&(f=this.parseFormat("yyyy-mm-dd hh:ii",h)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(d)&&(f=this.parseFormat("yyyy-mm-dd hh:ii:ss",h)),/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(d)){var j,k,l=/([-+]\d+)([dmwy])/,m=d.match(/([-+]\d+)([dmwy])/g);d=new Date;for(var n=0;n<m.length;n++)switch(j=l.exec(m[n]),k=parseInt(j[1]),j[2]){case"d":d.setUTCDate(d.getUTCDate()+k);break;case"m":d=c.prototype.moveMonth.call(c.prototype,d,k);break;case"w":d.setUTCDate(d.getUTCDate()+7*k);break;case"y":d=c.prototype.moveYear.call(c.prototype,d,k)}return b(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),0)}var o,p,j,m=d&&d.toString().match(this.nonpunctuation)||[],d=new Date(0,0,0,0,0,0,0),q={},r=["hh","h","ii","i","ss","s","yyyy","yy","M","MM","m","mm","D","DD","d","dd","H","HH","p","P"],s={hh:function(a,b){return a.setUTCHours(b)},h:function(a,b){return a.setUTCHours(b)},HH:function(a,b){return a.setUTCHours(12==b?0:b)},H:function(a,b){return a.setUTCHours(12==b?0:b)},ii:function(a,b){return a.setUTCMinutes(b)},i:function(a,b){return a.setUTCMinutes(b)},ss:function(a,b){return a.setUTCSeconds(b)},s:function(a,b){return a.setUTCSeconds(b)},yyyy:function(a,b){return a.setUTCFullYear(b)},yy:function(a,b){return a.setUTCFullYear(2e3+b)},m:function(a,b){for(b-=1;0>b;)b+=12;for(b%=12,a.setUTCMonth(b);a.getUTCMonth()!=b;){if(isNaN(a.getUTCMonth()))return a;a.setUTCDate(a.getUTCDate()-1)}return a},d:function(a,b){return a.setUTCDate(b)},p:function(a,b){return a.setUTCHours(1==b?a.getUTCHours()+12:a.getUTCHours())}};if(s.M=s.MM=s.mm=s.m,s.dd=s.d,s.P=s.p,d=b(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds()),m.length==f.parts.length){for(var n=0,t=f.parts.length;t>n;n++){if(o=parseInt(m[n],10),j=f.parts[n],isNaN(o))switch(j){case"MM":p=a(e[g].months).filter(function(){var a=this.slice(0,m[n].length),b=m[n].slice(0,a.length);return a==b}),o=a.inArray(p[0],e[g].months)+1;break;case"M":p=a(e[g].monthsShort).filter(function(){var a=this.slice(0,m[n].length),b=m[n].slice(0,a.length);return a.toLowerCase()==b.toLowerCase()}),o=a.inArray(p[0],e[g].monthsShort)+1;break;case"p":case"P":o=a.inArray(m[n].toLowerCase(),e[g].meridiem)}q[j]=o}for(var u,n=0;n<r.length;n++)u=r[n],u in q&&!isNaN(q[u])&&s[u](d,q[u])}return d},formatDate:function(b,c,d,g){if(null==b)return"";var h;if("standard"==g)h={yy:b.getUTCFullYear().toString().substring(2),yyyy:b.getUTCFullYear(),m:b.getUTCMonth()+1,M:e[d].monthsShort[b.getUTCMonth()],MM:e[d].months[b.getUTCMonth()],d:b.getUTCDate(),D:e[d].daysShort[b.getUTCDay()],DD:e[d].days[b.getUTCDay()],p:2==e[d].meridiem.length?e[d].meridiem[b.getUTCHours()<12?0:1]:"",h:b.getUTCHours(),i:b.getUTCMinutes(),s:b.getUTCSeconds()},2==e[d].meridiem.length?h.H=h.h%12==0?12:h.h%12:h.H=h.h,h.HH=(h.H<10?"0":"")+h.H,h.P=h.p.toUpperCase(),h.hh=(h.h<10?"0":"")+h.h,h.ii=(h.i<10?"0":"")+h.i,h.ss=(h.s<10?"0":"")+h.s,h.dd=(h.d<10?"0":"")+h.d,h.mm=(h.m<10?"0":"")+h.m;else{if("php"!=g)throw new Error("Invalid format type.");h={y:b.getUTCFullYear().toString().substring(2),Y:b.getUTCFullYear(),F:e[d].months[b.getUTCMonth()],M:e[d].monthsShort[b.getUTCMonth()],n:b.getUTCMonth()+1,t:f.getDaysInMonth(b.getUTCFullYear(),b.getUTCMonth()),j:b.getUTCDate(),l:e[d].days[b.getUTCDay()],D:e[d].daysShort[b.getUTCDay()],w:b.getUTCDay(),N:0==b.getUTCDay()?7:b.getUTCDay(),S:b.getUTCDate()%10<=e[d].suffix.length?e[d].suffix[b.getUTCDate()%10-1]:"",a:2==e[d].meridiem.length?e[d].meridiem[b.getUTCHours()<12?0:1]:"",g:b.getUTCHours()%12==0?12:b.getUTCHours()%12,G:b.getUTCHours(),i:b.getUTCMinutes(),s:b.getUTCSeconds()},h.m=(h.n<10?"0":"")+h.n,h.d=(h.j<10?"0":"")+h.j,h.A=h.a.toString().toUpperCase(),h.h=(h.g<10?"0":"")+h.g,h.H=(h.G<10?"0":"")+h.G,h.i=(h.i<10?"0":"")+h.i,h.s=(h.s<10?"0":"")+h.s}for(var b=[],i=a.extend([],c.separators),j=0,k=c.parts.length;k>j;j++)i.length&&b.push(i.shift()),b.push(h[c.parts[j]]);return i.length&&b.push(i.shift()),b.join("")},convertViewMode:function(a){switch(a){case 4:case"decade":a=4;break;case 3:case"year":a=3;break;case 2:case"month":a=2;break;case 1:case"day":a=1;break;case 0:case"hour":a=0}return a},headTemplate:'<thead><tr><th class="prev"><i class="{leftArrow}"/></th><th colspan="5" class="switch"></th><th class="next"><i class="{rightArrow}"/></th></tr></thead>',headTemplateV3:'<thead><tr><th class="prev"><span class="{iconType} {leftArrow}"></span> </th><th colspan="5" class="switch"></th><th class="next"><span class="{iconType} {rightArrow}"></span> </th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};f.template='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+f.headTemplate+f.contTemplate+f.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+f.headTemplate+f.contTemplate+f.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+f.headTemplate+"<tbody></tbody>"+f.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+f.headTemplate+f.contTemplate+f.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+f.headTemplate+f.contTemplate+f.footTemplate+"</table></div></div>",f.templateV3='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+f.headTemplateV3+f.contTemplate+f.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+f.headTemplateV3+f.contTemplate+f.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+f.headTemplateV3+"<tbody></tbody>"+f.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+f.headTemplateV3+f.contTemplate+f.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+f.headTemplateV3+f.contTemplate+f.footTemplate+"</table></div></div>",a.fn.datetimepicker.DPGlobal=f,a.fn.datetimepicker.noConflict=function(){return a.fn.datetimepicker=d,this},a(document).on("focus.datetimepicker.data-api click.datetimepicker.data-api",'[data-provide="datetimepicker"]',function(b){var c=a(this);c.data("datetimepicker")||(b.preventDefault(),c.datetimepicker("show"))}),a(function(){a('[data-provide="datetimepicker-inline"]').datetimepicker()})}(window.jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.toggle"),f="object"==typeof b&&b;e||d.data("bs.toggle",e=new c(this,f)),"string"==typeof b&&e[b]&&e[b]()})}var c=function(b,c){this.$element=a(b),this.options=a.extend({},this.defaults(),c),this.render()};c.VERSION="3.0.0",c.DEFAULTS={on:"On",off:"Off",onstyle:"primary",offstyle:"default",size:"normal",style:""},c.prototype.defaults=function(){return{on:this.$element.attr("data-on")||c.DEFAULTS.on,off:this.$element.attr("data-off")||c.DEFAULTS.off,onstyle:this.$element.attr("data-onstyle")||c.DEFAULTS.onstyle,offstyle:this.$element.attr("data-offstyle")||c.DEFAULTS.offstyle,size:this.$element.attr("data-size")||c.DEFAULTS.size,style:this.$element.attr("data-style")||c.DEFAULTS.style}},c.prototype.render=function(){this._onstyle="btn-"+this.options.onstyle,this._offstyle="btn-"+this.options.offstyle;var b="large"===this.options.size?"btn-lg":"small"===this.options.size?"btn-sm":"mini"===this.options.size?"btn-xs":"",c=a('<label class="btn">').html(this.options.on).addClass(this._onstyle+" "+b),d=a('<label class="btn">').html(this.options.off).addClass(this._offstyle+" "+b+" active"),e=a('<span class="toggle-handle btn btn-default">').addClass(b),f=a('<div class="toggle-group">').append(c,d,e),g=a('<div class="toggle btn" data-toggle="toggle">').addClass(this.$element.prop("checked")?this._onstyle:this._offstyle+" off").addClass(b).addClass(this.options.style);this.$element.wrap(g),a.extend(this,{$toggle:this.$element.parent(),$toggleOn:c,$toggleOff:d,$toggleGroup:f}),this.$toggle.append(f);var h=Math.max(c.outerWidth(),d.outerWidth())+e.outerWidth()/2,i=Math.max(c.outerHeight(),d.outerHeight());c.addClass("toggle-on"),d.addClass("toggle-off"),this.$toggle.css({width:h,height:i}),this.update(!0),this.trigger(!0)},c.prototype.toggle=function(){this.$element.prop("checked")?this.off():this.on()},c.prototype.on=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._offstyle+" off").addClass(this._onstyle),this.$element.prop("checked",!0),void(a||this.trigger()))},c.prototype.off=function(a){return this.$element.prop("disabled")?!1:(this.$toggle.removeClass(this._onstyle).addClass(this._offstyle+" off"),this.$element.prop("checked",!1),void(a||this.trigger()))},c.prototype.enable=function(){this.$toggle.removeAttr("disabled"),this.$element.prop("disabled",!1)},c.prototype.disable=function(){this.$toggle.attr("disabled","disabled"),this.$element.prop("disabled",!0)},c.prototype.update=function(a){this.$element.prop("disabled")?this.disable():this.enable(),this.$element.prop("checked")?this.on(a):this.off(a)},c.prototype.trigger=function(b){this.$element.off("change.bs.toggle"),b||this.$element.change(),this.$element.on("change.bs.toggle",a.proxy(function(){this.update()},this))},c.prototype.destroy=function(){this.$element.off("change.bs.toggle"),this.$toggleGroup.remove(),this.$element.removeData("bs.toggle"),this.$element.unwrap()};var d=a.fn.bootstrapToggle;a.fn.bootstrapToggle=b,a.fn.bootstrapToggle.Constructor=c,a.fn.toggle.noConflict=function(){return a.fn.bootstrapToggle=d,this},a(function(){a("input[type=checkbox][data-toggle^=toggle]").bootstrapToggle()}),a(document).on("click.bs.toggle","div[data-toggle^=toggle]",function(b){var c=a(this).find("input[type=checkbox]");c.bootstrapToggle("toggle"),b.preventDefault()})}(jQuery),function(a){a.editors.List=a.editors.Base.extend({events:{'click [data-action="add"]:last':function(a){a.preventDefault(),this.addItem(null,!0)}},initialize:function(b){b=b||{};var c=a.editors;c.Base.prototype.initialize.call(this,b);var d=this.schema;if(!d)throw new Error("Missing required option 'schema'");this.template=b.template||this.constructor.template,this.Editor=function(){var a=d.itemType;return a?c.List[a]?c.List[a]:c[a]:c.Text}(),this.items=[]},render:function(){var a=this,b=this.value||[],c=Backbone.$,d=c(c.trim(this.template()));return this.$list=d.is("[data-items]")?d:d.find("[data-items]"),b.length?_.each(b,function(b){a.addItem(b)}):this.Editor.isAsync||this.addItem(),a.schema.maxCardinality&&a.items.length>=a.schema.maxCardinality&&d.find('button[data-action="add"]:last').hide(),this.setElement(d),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},addItem:function(b,c){var d=this,e=a.editors,f=new e.List.Item({list:this,form:this.form,schema:this.schema,value:b,Editor:this.Editor,key:this.key}).render(),g=function(){d.items.push(f),d.$list.append(f.el),d.schema.maxCardinality&&d.items.length>=d.schema.maxCardinality&&d.$el.find('button[data-action="add"]:last').hide(),f.editor.on("all",function(a){if("change"!==a){var b=_.toArray(arguments);b[0]="item:"+a,b.splice(1,0,d),e.List.prototype.trigger.apply(this,b)}},d),f.editor.on("change",function(){f.addEventTriggered||(f.addEventTriggered=!0,this.trigger("add",this,f.editor)),this.trigger("item:change",this,f.editor),this.trigger("change",this)},d),f.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},d),f.editor.on("blur",function(){if(this.hasFocus){var a=this;setTimeout(function(){_.find(a.items,function(a){return a.editor.hasFocus})||a.trigger("blur",a)},0)}},d),(c||b)&&(f.addEventTriggered=!0),c&&(d.trigger("add",d,f.editor),d.trigger("change",d))};return this.Editor.isAsync?f.editor.on("readyToAdd",g,this):(g(),f.editor.focus()),f},removeItem:function(a){var b=this.schema.confirmDelete;if(!b||confirm(b)){var c=_.indexOf(this.items,a);this.items[c].remove(),this.items.splice(c,1),a.addEventTriggered&&(this.trigger("remove",this,a.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem(),this.schema.maxCardinality&&this.items.length<this.schema.maxCardinality&&this.$el.find('button[data-action="add"]:last').show()}},getValue:function(){var a=_.map(this.items,function(a){return a.getValue()});return _.without(a,void 0,"")},setValue:function(a){this.value=a,this.render()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){if(this.hasFocus){var a=_.find(this.items,function(a){return a.editor.hasFocus});a&&a.editor.blur()}},remove:function(){_.invoke(this.items,"remove"),a.editors.Base.prototype.remove.call(this)},validate:function(){if(!this.validators)return null;var a=_.map(this.items,function(a){return a.validate()}),b=_.compact(a).length?!0:!1;if(!b)return null;var c={type:"list",message:"Some of the items in the list failed validation",errors:a};return c}},{template:_.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,a.templateSettings)}),a.editors.List.Item=a.editors.Base.extend({events:{'click [data-action="remove"]:last':function(a){a.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(a){13===a.keyCode&&a.preventDefault()}},initialize:function(b){this.list=b.list,this.schema=b.schema||this.list.schema,this.value=b.value,this.Editor=b.Editor||a.editors.Text,this.key=b.key,this.template=b.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=b.errorClassName||this.constructor.errorClassName,this.form=b.form},render:function(){var a=Backbone.$;this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form}).render();var b=a(a.trim(this.template()));return b.find("[data-editor]").append(this.editor.el),this.setElement(b),this},getValue:function(){return this.editor.getValue()},setValue:function(a){this.editor.setValue(a)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var a=this.getValue(),b=this.list.form?this.list.form.getValue():{},c=this.schema.validators,d=this.getValidator;if(!c)return null;var e=null;return _.every(c,function(c){return e=d(c)(a,b),e?!1:!0}),e?this.setError(e):this.clearError(),e?e:null},setError:function(a){this.$el.addClass(this.errorClassName),this.$el.attr("title",a.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{template:_.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,a.templateSettings),errorClassName:"error"}),a.editors.List.Modal=a.editors.Base.extend({events:{click:"openEditor"},initialize:function(b){if(b=b||{},a.editors.Base.prototype.initialize.call(this,b),!a.editors.List.Modal.ModalAdapter)throw new Error("A ModalAdapter is required");if(this.form=b.form,!b.form)throw new Error('Missing required option: "form"');this.template=b.template||this.constructor.template},render:function(){var a=this;return _.isEmpty(this.value)?this.openEditor():(this.renderSummary(),setTimeout(function(){a.trigger("readyToAdd")},0)),this.hasFocus&&this.trigger("blur",this),this},renderSummary:function(){this.$el.html($.trim(this.template({summary:this.getStringValue()})))},itemToString:function(b){var c=function(b){var c={key:b};return a.Field.prototype.createTitle.call(c)};b=b||{};var d=[];return _.each(this.nestedSchema,function(a,e){var f=a.title?a.title:c(e),g=b[e];(_.isUndefined(g)||_.isNull(g))&&(g=""),d.push(f+": "+g)}),d.join("<br />")},getStringValue:function(){var a=this.schema,b=this.getValue();return _.isEmpty(b)?"[Empty]":a.itemToString?a.itemToString(b):this.itemToString(b)},openEditor:function(){var b=this.form.constructor,c=this.modalForm=new b({schema:this.nestedSchema,data:this.value}),d=this.modal=new a.editors.List.Modal.ModalAdapter({content:c,animate:!0});d.open(),this.trigger("open",this),this.trigger("focus",this),d.on("cancel",this.onModalClosed,this),d.on("ok",_.bind(this.onModalSubmitted,this))},onModalSubmitted:function(){var a=this.modal,b=this.modalForm,c=!this.value,d=b.validate();return d?a.preventClose():(this.value=b.getValue(),this.renderSummary(),c&&this.trigger("readyToAdd"),this.trigger("change",this),void this.onModalClosed())},onModalClosed:function(){this.modal=null,this.modalForm=null,this.trigger("close",this),this.trigger("blur",this)},getValue:function(){return this.value},setValue:function(a){this.value=a},focus:function(){this.hasFocus||this.openEditor()},blur:function(){this.hasFocus&&this.modal&&this.modal.trigger("cancel")}},{template:_.template("      <div><%= summary %></div>    ",null,a.templateSettings),ModalAdapter:Backbone.BootstrapModal,isAsync:!0}),a.editors.List.Object=a.editors.List.Modal.extend({initialize:function(){a.editors.List.Modal.prototype.initialize.apply(this,arguments);var b=this.schema;if(!b.subSchema)throw new Error('Missing required option "schema.subSchema"');this.nestedSchema=b.subSchema}}),a.editors.List.NestedModel=a.editors.List.Modal.extend({initialize:function(){a.editors.List.Modal.prototype.initialize.apply(this,arguments);var b=this.schema;if(!b.model)throw new Error('Missing required option "schema.model"');var c=b.model.prototype.schema;this.nestedSchema=_.isFunction(c)?c():c},getStringValue:function(){var a=this.schema,b=this.getValue();return _.isEmpty(b)?null:a.itemToString?a.itemToString(b):new a.model(b).toString()}})}(Backbone.Form),function(a){a.template=_.template('    <form class="form-horizontal" role="form">      <div data-fieldsets></div>      <% if (submitButton) { %>        <button type="submit" class="btn"><%= submitButton %></button>      <% } %>    </form>  '),a.Fieldset.template=_.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  "),a.Field.template=_.template('    <div class="form-group field-<%= key %>">      <label class="col-sm-2 control-label" for="<%= editorId %>">        <% if (titleHTML){ %><%= titleHTML %>        <% } else { %><%- title %><% } %>      </label>      <div class="col-sm-10">        <span data-editor></span>        <p class="help-block" data-error></p>        <p class="help-block"><%= help %></p>      </div>    </div>  '),a.NestedField.template=_.template('    <div class="field-<%= key %>">      <div title="<% if (titleHTML){ %><%= titleHTML %><% } else { %><%- title %><% } %>" class="input-xlarge">        <span data-editor></span>        <div class="help-inline" data-error></div>      </div>      <div class="help-block"><%= help %></div>    </div>  '),a.editors.Base.prototype.className="form-control",a.Field.errorClassName="has-error",a.editors.List&&(a.editors.List.template=_.template('      <div class="bbf-list">        <div class="bbf-list-contents">          <ul class="list-unstyled clearfix" data-items></ul>        </div>        <div class="bbf-list-buttons">          <button type="button" class="btn btn-default bbf-add" data-action="add"><span class="glyphicon glyphicon-plus"></span> add value</button>        </div>      </div>    '),a.editors.List.Item.template=_.template('      <li class="clearfix">        <div class="input-group">          <div data-editor></div>          <span class="input-group-btn">            <button type="button" class="btn btn-default bbf-del" data-action="remove">&times;</button>          </span>        </div>      </li>    '),a.editors.List.Object.template=a.editors.List.NestedModel.template=_.template('      <div class="bbf-list-modal"><%= summary %></div>    '))}(Backbone.Form),!function(a){"use strict";var b=function(a){var b=arguments,c=!0,d=1;return a=a.replace(/%s/g,function(){var a=b[d++];return"undefined"==typeof a?(c=!1,""):a}),c?a:"";
},c=function(b,c,d,e){var f="";return a.each(b,function(a,b){return b[c]===e?(f=b[d],!1):!0}),f},d=function(b,c){var d=-1;return a.each(b,function(a,b){return b.field===c?(d=a,!1):!0}),d},e=function(){var b,c,d=a("<p/>").addClass("fixed-table-scroll-inner"),e=a("<div/>").addClass("fixed-table-scroll-outer");return e.append(d),a("body").append(e),b=d[0].offsetWidth,e.css("overflow","scroll"),c=d[0].offsetWidth,b===c&&(c=e[0].clientWidth),e.remove(),b-c},f=function(b,c,d,e){if("string"==typeof c){var f=c.split(".");f.length>1?(c=window,a.each(f,function(a,b){c=c[b]})):c=window[c]}return"object"==typeof c?c:"function"==typeof c?c.apply(b,d):e},g=function(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):a},h=function(b,c){this.options=c,this.$el=a(b),this.$el_=this.$el.clone(),this.timeoutId_=0,this.init()};h.DEFAULTS={classes:"table table-hover",height:void 0,undefinedText:"-",sortName:void 0,sortOrder:"asc",striped:!1,columns:[],data:[],method:"get",url:void 0,cache:!0,contentType:"application/json",dataType:"json",ajaxOptions:{},queryParams:function(a){return a},queryParamsType:"limit",responseHandler:function(a){return a},pagination:!1,sidePagination:"client",totalRows:0,pageNumber:1,pageSize:10,pageList:[10,25,50,100],search:!1,searchAlign:"right",selectItemName:"btSelectItem",showHeader:!0,showColumns:!1,showPaginationSwitch:!1,showRefresh:!1,showToggle:!1,buttonsAlign:"right",smartDisplay:!0,minimumCountColumns:1,idField:void 0,cardView:!1,trimOnSearch:!0,clickToSelect:!1,singleSelect:!1,toolbar:void 0,toolbarAlign:"left",checkboxHeader:!0,sortable:!0,maintainSelected:!1,searchTimeOut:500,iconSize:void 0,iconsPrefix:"glyphicon",icons:{paginationSwitchDown:"glyphicon-collapse-down icon-chevron-down",paginationSwitchUp:"glyphicon-collapse-up icon-chevron-up",refresh:"glyphicon-refresh icon-refresh",toggle:"glyphicon-list-alt icon-list-alt",columns:"glyphicon-th icon-th"},rowStyle:function(a,b){return{}},rowAttributes:function(a,b){return{}},onAll:function(a,b){return!1},onClickRow:function(a,b){return!1},onDblClickRow:function(a,b){return!1},onSort:function(a,b){return!1},onCheck:function(a){return!1},onUncheck:function(a){return!1},onCheckAll:function(){return!1},onUncheckAll:function(){return!1},onLoadSuccess:function(a){return!1},onLoadError:function(a){return!1},onColumnSwitch:function(a,b){return!1},onPageChange:function(a,b){return!1},onSearch:function(a){return!1},onPreBody:function(a){return!1},onPostBody:function(){return!1}},h.LOCALES=[],h.LOCALES["en-US"]={formatLoadingMessage:function(){return"Loading, please wait..."},formatRecordsPerPage:function(a){return b("%s records per page",a)},formatShowingRows:function(a,c,d){return b("Showing %s to %s of %s rows",a,c,d)},formatSearch:function(){return"Search"},formatNoMatches:function(){return"No matching records found"},formatPaginationSwitch:function(){return"Hide/Show pagination"},formatRefresh:function(){return"Refresh"},formatToggle:function(){return"Toggle"},formatColumns:function(){return"Columns"}},a.extend(h.DEFAULTS,h.LOCALES["en-US"]),h.COLUMN_DEFAULTS={radio:!1,checkbox:!1,checkboxEnabled:!0,field:void 0,title:void 0,"class":void 0,align:void 0,halign:void 0,valign:void 0,width:void 0,sortable:!1,order:"asc",visible:!0,switchable:!0,clickToSelect:!0,formatter:void 0,events:void 0,sorter:void 0,cellStyle:void 0,searchable:!0},h.EVENTS={"all.bs.table":"onAll","click-row.bs.table":"onClickRow","dbl-click-row.bs.table":"onDblClickRow","sort.bs.table":"onSort","check.bs.table":"onCheck","uncheck.bs.table":"onUncheck","check-all.bs.table":"onCheckAll","uncheck-all.bs.table":"onUncheckAll","load-success.bs.table":"onLoadSuccess","load-error.bs.table":"onLoadError","column-switch.bs.table":"onColumnSwitch","page-change.bs.table":"onPageChange","search.bs.table":"onSearch","pre-body.bs.table":"onPreBody","post-body.bs.table":"onPostBody"},h.prototype.init=function(){this.initContainer(),this.initTable(),this.initHeader(),this.initData(),this.initToolbar(),this.initPagination(),this.initBody(),this.initServer()},h.prototype.initContainer=function(){this.$container=a(['<div class="bootstrap-table">','<div class="fixed-table-toolbar"></div>','<div class="fixed-table-container">','<div class="fixed-table-header"><table></table></div>','<div class="fixed-table-body">','<div class="fixed-table-loading">',this.options.formatLoadingMessage(),"</div>","</div>",'<div class="fixed-table-pagination"></div>',"</div>","</div>"].join("")),this.$container.insertAfter(this.$el),this.$container.find(".fixed-table-body").append(this.$el),this.$container.after('<div class="clearfix"></div>'),this.$loading=this.$container.find(".fixed-table-loading"),this.$el.addClass(this.options.classes),this.options.striped&&this.$el.addClass("table-striped")},h.prototype.initTable=function(){var b=this,c=[],d=[];this.$header=this.$el.find("thead"),this.$header.length||(this.$header=a("<thead></thead>").appendTo(this.$el)),this.$header.find("tr").length||this.$header.append("<tr></tr>"),this.$header.find("th").each(function(){var b=a.extend({},{title:a(this).html(),"class":a(this).attr("class")},a(this).data());c.push(b)}),this.options.columns=a.extend([],c,this.options.columns),a.each(this.options.columns,function(c,d){b.options.columns[c]=a.extend({},h.COLUMN_DEFAULTS,{field:c},d)}),this.options.data.length||(this.$el.find("tbody tr").each(function(){var c={};c._id=a(this).attr("id"),c._class=a(this).attr("class"),a(this).find("td").each(function(d){var e=b.options.columns[d].field;c[e]=a(this).html(),c["_"+e+"_id"]=a(this).attr("id"),c["_"+e+"_class"]=a(this).attr("class")}),d.push(c)}),this.options.data=d)},h.prototype.initHeader=function(){var c=this,d=[],e=[];this.header={fields:[],styles:[],classes:[],formatters:[],events:[],sorters:[],cellStyles:[],clickToSelects:[],searchables:[]},a.each(this.options.columns,function(a,f){var g="",h="",i="",j="",k=b(' class="%s"',f["class"]);c.options.sortOrder||f.order;f.visible&&(h=b("text-align: %s; ",f.halign?f.halign:f.align),i=b("text-align: %s; ",f.align),j=b("vertical-align: %s; ",f.valign),j+=b("width: %spx; ",f.checkbox||f.radio?36:f.width),d.push(f),c.header.fields.push(f.field),c.header.styles.push(i+j),c.header.classes.push(k),c.header.formatters.push(f.formatter),c.header.events.push(f.events),c.header.sorters.push(f.sorter),c.header.cellStyles.push(f.cellStyle),c.header.clickToSelects.push(f.clickToSelect),c.header.searchables.push(f.searchable),e.push("<th",f.checkbox||f.radio?b(' class="bs-checkbox %s"',f["class"]||""):k,b(' style="%s"',h+j),">"),e.push(b('<div class="th-inner %s">',c.options.sortable&&f.sortable?"sortable":"")),g=f.title,c.options.sortName===f.field&&c.options.sortable&&f.sortable&&(g+=c.getCaretHtml()),f.checkbox&&(!c.options.singleSelect&&c.options.checkboxHeader&&(g='<input name="btSelectAll" type="checkbox" />'),c.header.stateField=f.field),f.radio&&(g="",c.header.stateField=f.field,c.options.singleSelect=!0),e.push(g),e.push("</div>"),e.push('<div class="fht-cell"></div>'),e.push("</th>"))}),this.$header.find("tr").html(e.join("")),this.$header.find("th").each(function(b){a(this).data(d[b])}),this.$container.off("click","th").on("click","th",function(b){c.options.sortable&&a(this).data().sortable&&c.onSort(b)}),!this.options.showHeader||this.options.cardView?(this.$header.hide(),this.$container.find(".fixed-table-header").hide(),this.$loading.css("top",0)):(this.$header.show(),this.$container.find(".fixed-table-header").show(),this.$loading.css("top","37px")),this.$selectAll=this.$header.find('[name="btSelectAll"]'),this.$container.off("click",'[name="btSelectAll"]').on("click",'[name="btSelectAll"]',function(){var b=a(this).prop("checked");c[b?"checkAll":"uncheckAll"]()})},h.prototype.initData=function(a,b){"append"===b?this.data=this.data.concat(a):"prepend"===b?this.data=a.concat(this.data):this.data=a||this.options.data,this.options.data=this.data,"server"!==this.options.sidePagination&&this.initSort()},h.prototype.initSort=function(){var b=this,c=this.options.sortName,d="desc"===this.options.sortOrder?-1:1,e=a.inArray(this.options.sortName,this.header.fields);-1!==e&&this.data.sort(function(g,h){var i=g[c],j=h[c],k=f(b.header,b.header.sorters[e],[i,j]);return void 0!==k?d*k:(a.isNumeric(i)&&(i=parseFloat(i)),a.isNumeric(j)&&(j=parseFloat(j)),(void 0===i||null===i)&&(i=""),(void 0===j||null===j)&&(j=""),a.isNumeric(i)&&a.isNumeric(j)?(i=parseFloat(i),j=parseFloat(j),j>i?-1*d:d):i===j?0:("string"!=typeof i&&(i=i.toString()),-1===i.localeCompare(j)?-1*d:d))})},h.prototype.onSort=function(b){var c=a(b.currentTarget),d=this.$header.find("th").eq(c.index());return this.$header.add(this.$header_).find("span.order").remove(),this.options.sortName===c.data("field")?this.options.sortOrder="asc"===this.options.sortOrder?"desc":"asc":(this.options.sortName=c.data("field"),this.options.sortOrder="asc"===c.data("order")?"desc":"asc"),this.trigger("sort",this.options.sortName,this.options.sortOrder),c.add(d).data("order",this.options.sortOrder).find(".th-inner").append(this.getCaretHtml()),"server"===this.options.sidePagination?void this.initServer():(this.initSort(),void this.initBody())},h.prototype.initToolbar=function(){var c,d,e=this,g=[],h=0,i=0;this.$toolbar=this.$container.find(".fixed-table-toolbar").html(""),"string"==typeof this.options.toolbar&&a(b('<div class="bars pull-%s"></div>',this.options.toolbarAlign)).appendTo(this.$toolbar).append(a(this.options.toolbar)),g=[b('<div class="columns columns-%s btn-group pull-%s">',this.options.buttonsAlign,this.options.buttonsAlign)],"string"==typeof this.options.icons&&(this.options.icons=f(null,this.options.icons)),this.options.showPaginationSwitch&&g.push(b('<button class="btn btn-default" type="button" name="paginationSwitch" title="%s">',this.options.formatPaginationSwitch()),b('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.paginationSwitchDown),"</button>"),this.options.showRefresh&&g.push(b('<button class="btn btn-default'+(void 0==this.options.iconSize?"":" btn-"+this.options.iconSize)+'" type="button" name="refresh" title="%s">',this.options.formatRefresh()),b('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.refresh),"</button>"),this.options.showToggle&&g.push(b('<button class="btn btn-default'+(void 0==this.options.iconSize?"":" btn-"+this.options.iconSize)+'" type="button" name="toggle" title="%s">',this.options.formatToggle()),b('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.toggle),"</button>"),this.options.showColumns&&(g.push(b('<div class="keep-open btn-group" title="%s">',this.options.formatColumns()),'<button type="button" class="btn btn-default'+(void 0==this.options.iconSize?"":" btn-"+this.options.iconSize)+' dropdown-toggle" data-toggle="dropdown">',b('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.columns),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">'),a.each(this.options.columns,function(a,c){if(!c.radio&&!c.checkbox){var d=c.visible?' checked="checked"':"";c.switchable&&(g.push(b('<li><label><input type="checkbox" data-field="%s" value="%s"%s> %s</label></li>',c.field,a,d,c.title)),i++)}}),g.push("</ul>","</div>")),g.push("</div>"),(this.showToolbar||g.length>2)&&this.$toolbar.append(g.join("")),this.options.showPaginationSwitch&&this.$toolbar.find('button[name="paginationSwitch"]').off("click").on("click",a.proxy(this.togglePagination,this)),this.options.showRefresh&&this.$toolbar.find('button[name="refresh"]').off("click").on("click",a.proxy(this.refresh,this)),this.options.showToggle&&this.$toolbar.find('button[name="toggle"]').off("click").on("click",function(){e.options.cardView=!e.options.cardView,e.initHeader(),e.initBody()}),this.options.showColumns&&(c=this.$toolbar.find(".keep-open"),i<=this.options.minimumCountColumns&&c.find("input").prop("disabled",!0),c.find("li").off("click").on("click",function(a){a.stopImmediatePropagation()}),c.find("input").off("click").on("click",function(){var b=a(this);e.toggleColumn(b.val(),b.prop("checked"),!1),e.trigger("column-switch",a(this).data("field"),b.prop("checked"))})),this.options.search&&(g=[],g.push('<div class="pull-'+this.options.searchAlign+' search">',b('<input class="form-control'+(void 0==this.options.iconSize?"":" input-"+this.options.iconSize)+'" type="text" placeholder="%s">',this.options.formatSearch()),"</div>"),this.$toolbar.append(g.join("")),d=this.$toolbar.find(".search input"),d.off("keyup").on("keyup",function(a){clearTimeout(h),h=setTimeout(function(){e.onSearch(a)},e.options.searchTimeOut)}))},h.prototype.onSearch=function(b){var c=a.trim(a(b.currentTarget).val());this.options.trimOnSearch&&a(b.currentTarget).val(c),c!==this.searchText&&(this.searchText=c,this.options.pageNumber=1,this.initSearch(),this.updatePagination(),this.trigger("search",c))},h.prototype.initSearch=function(){var b=this;if("server"!==this.options.sidePagination){var c=this.searchText&&this.searchText.toLowerCase(),d=a.isEmptyObject(this.filterColumns)?null:this.filterColumns;this.data=d?a.grep(this.options.data,function(a,b){for(var c in d)if(a[c]!==d[c])return!1;return!0}):this.options.data,this.data=c?a.grep(this.data,function(d,e){for(var g in d){g=a.isNumeric(g)?parseInt(g,10):g;var h=d[g];h=f(b.header,b.header.formatters[a.inArray(g,b.header.fields)],[h,d,e],h);var i=a.inArray(g,b.header.fields);if(-1!==i&&b.header.searchables[i]&&("string"==typeof h||"number"==typeof h)&&-1!==(h+"").toLowerCase().indexOf(c))return!0}return!1}):this.data}},h.prototype.initPagination=function(){if(this.$pagination=this.$container.find(".fixed-table-pagination"),!this.options.pagination)return void this.$pagination.hide();this.$pagination.show();var c,d,e,f,g,h,i,j,k,l=this,m=[],n=this.getData();"server"!==this.options.sidePagination&&(this.options.totalRows=n.length),this.totalPages=0,this.options.totalRows&&(this.totalPages=~~((this.options.totalRows-1)/this.options.pageSize)+1,this.options.totalPages=this.totalPages),this.totalPages>0&&this.options.pageNumber>this.totalPages&&(this.options.pageNumber=this.totalPages),this.pageFrom=(this.options.pageNumber-1)*this.options.pageSize+1,this.pageTo=this.options.pageNumber*this.options.pageSize,this.pageTo>this.options.totalRows&&(this.pageTo=this.options.totalRows),m.push('<div class="pull-left pagination-detail">','<span class="pagination-info">',this.options.formatShowingRows(this.pageFrom,this.pageTo,this.options.totalRows),"</span>"),m.push('<span class="page-list">');var o=['<span class="btn-group dropup">','<button type="button" class="btn btn-default '+(void 0==this.options.iconSize?"":" btn-"+this.options.iconSize)+' dropdown-toggle" data-toggle="dropdown">','<span class="page-size">',this.options.pageSize,"</span>",' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">'],p=this.options.pageList;if("string"==typeof this.options.pageList){var q=this.options.pageList.replace("[","").replace("]","").replace(/ /g,"").split(",");p=[],a.each(q,function(a,b){p.push(+b)})}for(a.each(p,function(a,c){if(!l.options.smartDisplay||0===a||p[a-1]<=l.options.totalRows){var d=c===l.options.pageSize?' class="active"':"";o.push(b('<li%s><a href="javascript:void(0)">%s</a></li>',d,c))}}),o.push("</ul></span>"),m.push(this.options.formatRecordsPerPage(o.join(""))),m.push("</span>"),m.push("</div>",'<div class="pull-right pagination">','<ul class="pagination'+(void 0==this.options.iconSize?"":" pagination-"+this.options.iconSize)+'">','<li class="page-first"><a href="javascript:void(0)">&lt;&lt;</a></li>','<li class="page-pre"><a href="javascript:void(0)">&lt;</a></li>'),this.totalPages<5?(d=1,e=this.totalPages):(d=this.options.pageNumber-2,e=d+4,1>d&&(d=1,e=5),e>this.totalPages&&(e=this.totalPages,d=e-4)),c=d;e>=c;c++)m.push('<li class="page-number'+(c===this.options.pageNumber?" active disabled":"")+'">','<a href="javascript:void(0)">',c,"</a>","</li>");m.push('<li class="page-next"><a href="javascript:void(0)">&gt;</a></li>','<li class="page-last"><a href="javascript:void(0)">&gt;&gt;</a></li>',"</ul>","</div>"),this.$pagination.html(m.join("")),f=this.$pagination.find(".page-list a"),g=this.$pagination.find(".page-first"),h=this.$pagination.find(".page-pre"),i=this.$pagination.find(".page-next"),j=this.$pagination.find(".page-last"),k=this.$pagination.find(".page-number"),this.options.pageNumber<=1&&(g.addClass("disabled"),h.addClass("disabled")),this.options.pageNumber>=this.totalPages&&(i.addClass("disabled"),j.addClass("disabled")),this.options.smartDisplay&&(this.totalPages<=1&&this.$pagination.find("div.pagination").hide(),(this.options.pageList.length<2||this.options.totalRows<=this.options.pageList[0])&&this.$pagination.find("span.page-list").hide(),this.$pagination[this.getData().length?"show":"hide"]()),f.off("click").on("click",a.proxy(this.onPageListChange,this)),g.off("click").on("click",a.proxy(this.onPageFirst,this)),h.off("click").on("click",a.proxy(this.onPagePre,this)),i.off("click").on("click",a.proxy(this.onPageNext,this)),j.off("click").on("click",a.proxy(this.onPageLast,this)),k.off("click").on("click",a.proxy(this.onPageNumber,this))},h.prototype.updatePagination=function(b){b&&a(b.currentTarget).hasClass("disabled")||(this.options.maintainSelected||this.resetRows(),this.initPagination(),"server"===this.options.sidePagination?this.initServer():this.initBody(),this.trigger("page-change",this.options.pageNumber,this.options.pageSize))},h.prototype.onPageListChange=function(b){var c=a(b.currentTarget);c.parent().addClass("active").siblings().removeClass("active"),this.options.pageSize=+c.text(),this.$toolbar.find(".page-size").text(this.options.pageSize),this.updatePagination(b)},h.prototype.onPageFirst=function(a){this.options.pageNumber=1,this.updatePagination(a)},h.prototype.onPagePre=function(a){this.options.pageNumber--,this.updatePagination(a)},h.prototype.onPageNext=function(a){this.options.pageNumber++,this.updatePagination(a)},h.prototype.onPageLast=function(a){this.options.pageNumber=this.totalPages,this.updatePagination(a)},h.prototype.onPageNumber=function(b){this.options.pageNumber!==+a(b.currentTarget).text()&&(this.options.pageNumber=+a(b.currentTarget).text(),this.updatePagination(b))},h.prototype.initBody=function(e){var h=this,i=[],j=this.getData();this.trigger("pre-body",j),this.$body=this.$el.find("tbody"),this.$body.length||(this.$body=a("<tbody></tbody>").appendTo(this.$el)),this.options.pagination&&"server"!==this.options.sidePagination||(this.pageFrom=1,this.pageTo=j.length);for(var k=this.pageFrom-1;k<this.pageTo;k++){var l=j[k],m={},n=[],o={},p=[];if(m=f(this.options,this.options.rowStyle,[l,k],m),m&&m.css)for(var q in m.css)n.push(q+": "+m.css[q]);if(o=f(this.options,this.options.rowAttributes,[l,k],o))for(var q in o)p.push(b('%s="%s"',q,g(o[q])));i.push("<tr",b(" %s",p.join(" ")),b(' id="%s"',a.isArray(l)?void 0:l._id),b(' class="%s"',m.classes||(a.isArray(l)?void 0:l._class)),b(' data-index="%s"',k),">"),this.options.cardView&&i.push(b('<td colspan="%s">',this.header.fields.length)),a.each(this.header.fields,function(a,e){var g="",j=l[e],o="",p={},q="",r=h.header.classes[a],s=h.options.columns[d(h.options.columns,e)];if(m=b('style="%s"',n.concat(h.header.styles[a]).join("; ")),j=f(h.header,h.header.formatters[a],[j,l,k],j),l["_"+e+"_id"]&&(q=b(' id="%s"',l["_"+e+"_id"])),l["_"+e+"_class"]&&(r=b(' class="%s"',l["_"+e+"_class"])),p=f(h.header,h.header.cellStyles[a],[j,l,k],p),p.classes&&(r=b(' class="%s"',p.classes)),p.css){var t=[];for(var u in p.css)t.push(u+": "+p.css[u]);m=b('style="%s"',t.concat(h.header.styles[a]).join("; "))}if(s.checkbox||s.radio){if(h.options.cardView)return!0;o=s.checkbox?"checkbox":o,o=s.radio?"radio":o,g=['<td class="bs-checkbox">',"<input"+b(' data-index="%s"',k)+b(' name="%s"',h.options.selectItemName)+b(' type="%s"',o)+b(' value="%s"',l[h.options.idField])+b(' checked="%s"',j===!0||j&&j.checked?"checked":void 0)+b(' disabled="%s"',!s.checkboxEnabled||j&&j.disabled?"disabled":void 0)+" />","</td>"].join("")}else j="undefined"==typeof j||null===j?h.options.undefinedText:j,g=h.options.cardView?['<div class="card-view">',h.options.showHeader?b('<span class="title" %s>%s</span>',m,c(h.options.columns,"field","title",e)):"",b('<span class="value">%s</span>',j),"</div>"].join(""):[b("<td%s %s %s>",q,r,m),j,"</td>"].join(""),h.options.cardView&&h.options.smartDisplay&&""===j&&(g="");i.push(g)}),this.options.cardView&&i.push("</td>"),i.push("</tr>")}i.length||i.push('<tr class="no-records-found">',b('<td colspan="%s">%s</td>',this.header.fields.length,this.options.formatNoMatches()),"</tr>"),this.$body.html(i.join("")),e||this.scrollTo(0),this.$body.find("> tr > td").off("click").on("click",function(){var c=a(this).parent();h.trigger("click-row",h.data[c.data("index")],c),h.options.clickToSelect&&h.header.clickToSelects[c.children().index(a(this))]&&c.find(b('[name="%s"]',h.options.selectItemName))[0].click()}),this.$body.find("tr").off("dblclick").on("dblclick",function(){h.trigger("dbl-click-row",h.data[a(this).data("index")],a(this))}),this.$selectItem=this.$body.find(b('[name="%s"]',this.options.selectItemName)),this.$selectItem.off("click").on("click",function(b){b.stopImmediatePropagation();var c=a(this).prop("checked"),d=h.data[a(this).data("index")];d[h.header.stateField]=c,h.trigger(c?"check":"uncheck",d),h.options.singleSelect&&(h.$selectItem.not(this).each(function(){h.data[a(this).data("index")][h.header.stateField]=!1}),h.$selectItem.filter(":checked").not(this).prop("checked",!1)),h.updateSelected()}),a.each(this.header.events,function(b,c){if(c){"string"==typeof c&&(c=f(null,c));for(var d in c)h.$body.find("tr").each(function(){var e=a(this),f=e.find(h.options.cardView?".card-view":"td").eq(b),g=d.indexOf(" "),i=d.substring(0,g),j=d.substring(g+1),k=c[d];f.find(j).off(i).on(i,function(a){var c=e.data("index"),d=h.data[c],f=d[h.header.fields[b]];k.apply(this,[a,f,d,c])})})}}),this.updateSelected(),this.resetView(),this.trigger("post-body")},h.prototype.initServer=function(b,c){var d=this,e={},g={pageSize:this.options.pageSize,pageNumber:this.options.pageNumber,searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder};this.options.url&&("limit"===this.options.queryParamsType&&(g={search:g.searchText,sort:g.sortName,order:g.sortOrder},this.options.pagination&&(g.limit=this.options.pageSize,g.offset=this.options.pageSize*(this.options.pageNumber-1))),e=f(this.options,this.options.queryParams,[g],e),a.extend(e,c||{}),e!==!1&&(b||this.$loading.show(),a.ajax(a.extend({},f(null,this.options.ajaxOptions),{type:this.options.method,url:this.options.url,data:"application/json"===this.options.contentType&&"post"===this.options.method?JSON.stringify(e):e,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function(a){a=f(d.options,d.options.responseHandler,[a],a),d.load(a),d.trigger("load-success",a)},error:function(a){d.trigger("load-error",a.status)},complete:function(){b||d.$loading.hide()}}))))},h.prototype.getCaretHtml=function(){return['<span class="order'+("desc"===this.options.sortOrder?"":" dropup")+'">','<span class="caret" style="margin: 10px 5px;"></span>',"</span>"].join("")},h.prototype.updateSelected=function(){var b=this.$selectItem.filter(":enabled").length===this.$selectItem.filter(":enabled").filter(":checked").length;this.$selectAll.add(this.$selectAll_).prop("checked",b),this.$selectItem.each(function(){a(this).parents("tr")[a(this).prop("checked")?"addClass":"removeClass"]("selected")})},h.prototype.updateRows=function(b){var c=this;this.$selectItem.each(function(){c.data[a(this).data("index")][c.header.stateField]=b})},h.prototype.resetRows=function(){var b=this;a.each(this.data,function(a,c){b.$selectAll.prop("checked",!1),b.$selectItem.prop("checked",!1),c[b.header.stateField]=!1})},h.prototype.trigger=function(b){var c=Array.prototype.slice.call(arguments,1);b+=".bs.table",this.options[h.EVENTS[b]].apply(this.options,c),this.$el.trigger(a.Event(b),c),this.options.onAll(b,c),this.$el.trigger(a.Event("all.bs.table"),[b,c])},h.prototype.resetHeader=function(){var b=this,c=this.$container.find(".fixed-table-header"),d=this.$container.find(".fixed-table-body"),f=this.$el.width()>d.width()?e():0;return this.$el.is(":hidden")?(clearTimeout(this.timeoutId_),void(this.timeoutId_=setTimeout(a.proxy(this.resetHeader,this),100))):(this.$header_=this.$header.clone(!0,!0),this.$selectAll_=this.$header_.find('[name="btSelectAll"]'),void setTimeout(function(){c.css({height:"37px","border-bottom":"1px solid #dddddd","margin-right":f}).find("table").css("width",b.$el.css("width")).html("").attr("class",b.$el.attr("class")).append(b.$header_),b.$header.find("th").each(function(c){b.$header_.find("th").eq(c).data(a(this).data())}),b.$body.find("tr:first-child:not(.no-records-found) > *").each(function(c){b.$header_.find("div.fht-cell").eq(c).width(a(this).innerWidth())}),b.$el.css("margin-top",-b.$header.height()),d.off("scroll").on("scroll",function(){c.scrollLeft(a(this).scrollLeft())})}))},h.prototype.toggleColumn=function(a,c,d){if(-1!==a&&(this.options.columns[a].visible=c,this.initHeader(),this.initSearch(),this.initPagination(),this.initBody(),this.options.showColumns)){var e=this.$toolbar.find(".keep-open input").prop("disabled",!1);d&&e.filter(b('[value="%s"]',a)).prop("checked",c),e.filter(":checked").length<=this.options.minimumCountColumns&&e.filter(":checked").prop("disabled",!0)}},h.prototype.resetView=function(a){var b=this;this.header;if(a&&a.height&&(this.options.height=a.height),this.$selectAll.prop("checked",this.$selectItem.length>0&&this.$selectItem.length===this.$selectItem.filter(":checked").length),this.options.height){var c=+this.$toolbar.children().outerHeight(!0),d=+this.$pagination.children().outerHeight(!0),e=this.options.height-c-d;this.$container.find(".fixed-table-container").css("height",e+"px")}return this.options.cardView?(b.$el.css("margin-top","0"),void b.$container.find(".fixed-table-container").css("padding-bottom","0")):(this.options.showHeader&&this.options.height&&this.resetHeader(),void(this.options.height&&this.options.showHeader&&this.$container.find(".fixed-table-container").css("padding-bottom","37px")))},h.prototype.getData=function(){return this.searchText||!a.isEmptyObject(this.filterColumns)?this.data:this.options.data},h.prototype.load=function(a){"server"===this.options.sidePagination&&(this.options.totalRows=a.total,a=a.rows),this.initData(a),this.initSearch(),this.initPagination(),this.initBody()},h.prototype.append=function(a){this.initData(a,"append"),this.initSearch(),this.initPagination(),this.initBody(!0)},h.prototype.prepend=function(a){this.initData(a,"prepend"),this.initSearch(),this.initPagination(),this.initBody(!0)},h.prototype.remove=function(b){var c,d,e=this.options.data.length;if(b.hasOwnProperty("field")&&b.hasOwnProperty("values")){for(c=e-1;c>=0;c--){if(d=this.options.data[c],!d.hasOwnProperty(b.field))return;-1!==a.inArray(d[b.field],b.values)&&this.options.data.splice(c,1)}e!==this.options.data.length&&(this.initSearch(),this.initPagination(),this.initBody(!0))}},h.prototype.update=function(b){var c,d,e=this.data.length;if(b.hasOwnProperty("field")&&b.hasOwnProperty("data")){for(c=e-1;c>=0;c--){if(d=this.data[c],!d.hasOwnProperty(b.field))return;if(d[b.field]===b.data[b.field]){a.extend(this.data[c],b.data);break}}this.initBody(!0)}},h.prototype.insertRow=function(a){a.hasOwnProperty("index")&&a.hasOwnProperty("row")&&(this.data.splice(a.index,0,a.row),this.initBody(!0))},h.prototype.updateRow=function(b){b.hasOwnProperty("index")&&b.hasOwnProperty("row")&&(a.extend(this.data[b.index],b.row),this.initBody(!0))},h.prototype.mergeCells=function(b){var c,d,e=b.index,f=a.inArray(b.field,this.header.fields),g=b.rowspan||1,h=b.colspan||1,i=this.$body.find("tr"),j=i.eq(e).find("td").eq(f);if(!(0>e||0>f||e>=this.data.length)){for(c=e;e+g>c;c++)for(d=f;f+h>d;d++)i.eq(c).find("td").eq(d).hide();j.attr("rowspan",g).attr("colspan",h).show()}},h.prototype.getOptions=function(){return this.options},h.prototype.getSelections=function(){var b=this;return a.grep(this.data,function(a){return a[b.header.stateField]})},h.prototype.checkAll=function(){this.checkAll_(!0)},h.prototype.uncheckAll=function(){this.checkAll_(!1)},h.prototype.checkAll_=function(a){this.$selectItem.filter(":enabled").prop("checked",a),this.updateRows(a),this.updateSelected(),this.trigger(a?"check-all":"uncheck-all")},h.prototype.check=function(a){this.check_(!0,a)},h.prototype.uncheck=function(a){this.check_(!1,a)},h.prototype.check_=function(a,c){this.$selectItem.filter(b('[data-index="%s"]',c)).prop("checked",a),this.data[c][this.header.stateField]=a,this.updateSelected()},h.prototype.destroy=function(){this.$el.insertBefore(this.$container),a(this.options.toolbar).insertBefore(this.$el),this.$container.next().remove(),this.$container.remove(),this.$el.html(this.$el_.html()).css("margin-top","0").attr("class",this.$el_.attr("class")||"")},h.prototype.showLoading=function(){this.$loading.show()},h.prototype.hideLoading=function(){this.$loading.hide()},h.prototype.togglePagination=function(){this.options.pagination=!this.options.pagination;var a=this.$toolbar.find('button[name="paginationSwitch"] i');this.options.pagination?a.attr("class",this.options.iconsPrefix+" "+this.options.icons.paginationSwitchDown):a.attr("class",this.options.iconsPrefix+" "+this.options.icons.paginationSwitchUp),this.updatePagination()},h.prototype.refresh=function(a){a&&a.url&&(this.options.url=a.url,this.options.pageNumber=1),this.initServer(a&&a.silent,a&&a.query)},h.prototype.showColumn=function(a){this.toggleColumn(d(this.options.columns,a),!0,!0)},h.prototype.hideColumn=function(a){this.toggleColumn(d(this.options.columns,a),!1,!0)},h.prototype.filterBy=function(b){this.filterColumns=a.isEmptyObject(b)?{}:b,this.options.pageNumber=1,this.initSearch(),this.updatePagination()},h.prototype.scrollTo=function(a){var b=this.$container.find(".fixed-table-body");"string"==typeof a&&(a="bottom"===a?b[0].scrollHeight:0),"number"==typeof a&&b.scrollTop(a)},h.prototype.selectPage=function(a){a>0&&a<=this.options.totalPages&&(this.options.pageNumber=a,this.updatePagination())},h.prototype.prevPage=function(){this.options.pageNumber>1&&(this.options.pageNumber--,this.updatePagination())},h.prototype.nextPage=function(){this.options.pageNumber<this.options.totalPages&&(this.options.pageNumber++,this.updatePagination())},h.prototype.toggleView=function(){this.options.cardView=!this.options.cardView,this.initHeader(),this.initBody()};var i=["getOptions","getSelections","getData","load","append","prepend","remove","insertRow","updateRow","mergeCells","checkAll","uncheckAll","check","uncheck","refresh","resetView","destroy","showLoading","hideLoading","showColumn","hideColumn","filterBy","scrollTo","selectPage","prevPage","nextPage","togglePagination","toggleView","update"];a.fn.bootstrapTable=function(b,c){var d;return this.each(function(){var e=a(this),f=e.data("bootstrap.table"),g=a.extend({},h.DEFAULTS,e.data(),"object"==typeof b&&b);if("string"==typeof b){if(a.inArray(b,i)<0)throw"Unknown method: "+b;if(!f)return;d=f[b](c),"destroy"===b&&e.removeData("bootstrap.table")}f||e.data("bootstrap.table",f=new h(this,g))}),"undefined"==typeof d?this:d},a.fn.bootstrapTable.Constructor=h,a.fn.bootstrapTable.defaults=h.DEFAULTS,a.fn.bootstrapTable.columnDefaults=h.COLUMN_DEFAULTS,a.fn.bootstrapTable.locales=h.LOCALES,a.fn.bootstrapTable.methods=i,a(function(){a('[data-toggle="table"]').bootstrapTable()})}(jQuery),!function(a){"use strict";a.extend(a.fn.bootstrapTable.defaults,{editable:!0,onEditableInit:function(){return!1}}),a.extend(a.fn.bootstrapTable.Constructor.EVENTS,{"editable-init.bs.table":"onEditableInit"});var b=a.fn.bootstrapTable.Constructor,c=b.prototype.initTable,d=b.prototype.initBody;
b.prototype.initTable=function(){var b=this;c.apply(this,Array.prototype.slice.apply(arguments)),this.options.editable&&a.each(this.options.columns,function(a,c){if(c.editable){var d=c.formatter;c.formatter=function(a,e,f){var g=d?d(a,e,f):a;return['<a href="javascript:void(0)"',' data-name="'+c.field+'"',' data-pk="'+e[b.options.idField]+'"',">"+g+"</a>"].join("")}}})},b.prototype.initBody=function(){var b=this;d.apply(this,Array.prototype.slice.apply(arguments)),this.options.editable&&(a.each(this.options.columns,function(c,d){if(d.editable){var e=b.getData();b.$body.find('a[data-name="'+d.field+'"]').each(function(){if("function"==typeof d.editable){var b=e[a(this).parents("tr[data-index]").data("index")];a(this).editable(d.editable(b,d.field))}else a(this).editable(d.editable)}).off("save").on("save",function(c,f){var g=e[a(this).parents("tr[data-index]").data("index")];b.options.dataSetter?b.options.dataSetter(g,d.field,f.newValue):g[d.field]=f.newValue})}}),this.trigger("editable-init"))}}(jQuery),function(a){var b={type:null,showLangSelect:!0,selectize:!1,create:!0},c=function(a,b,c,d,e,f){var g=parseInt(a,10);return isNaN(g)?!1:b||0!=g?!c&&0>g?!1:!d&&g>0?!1:void 0!=e&&g>e?!1:void 0!=f&&f>g?!1:!0:!1},d=function(b){return a.isNumeric(b)},e={"http://www.w3.org/2000/01/rdf-schema#Literal":{label:"Plain Literal"},"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource":{label:"Reference"},"http://www.w3.org/2001/XMLSchema#integer":{label:"Integer",verify:function(a){return c(a,!0,!0,!0)}},"http://www.w3.org/2001/XMLSchema#decimal":{label:"Decimal",verify:d},"http://www.w3.org/2001/XMLSchema#double":{label:"Double",verify:d},"http://www.w3.org/2001/XMLSchema#float":{label:"Float",verify:d},"http://www.w3.org/2001/XMLSchema#nonPositiveInteger":{label:"Non-Positive Integer",verify:function(a){return c(a,!0,!0,!1)}},"http://www.w3.org/2001/XMLSchema#negativeInteger":{label:"Negative Integer",verify:function(a){return c(a,!1,!0,!1)}},"http://www.w3.org/2001/XMLSchema#long":{label:"Long",verify:function(a){return c(a,!0,!0,!0)}},"http://www.w3.org/2001/XMLSchema#int":{label:"Int",verify:function(a){return c(a,!0,!0,!0,2147483647,-2147483648)}},"http://www.w3.org/2001/XMLSchema#short":{label:"Short",verify:function(a){return c(a,!0,!0,!0,32767,-32768)}},"http://www.w3.org/2001/XMLSchema#byte":{label:"Byte",verify:function(a){return c(a,!0,!0,!0,127,-128)}},"http://www.w3.org/2001/XMLSchema#nonNegativeInteger":{label:"Non-Negative Integer",verify:function(a){return c(a,!0,!1,!0)}},"http://www.w3.org/2001/XMLSchema#unsignedLong":{label:"Unsigned Long",verify:function(a){return c(a,!0,!1,!0)}},"http://www.w3.org/2001/XMLSchema#unsignedInt":{label:"Unsigned Int",verify:function(a){return c(a,!0,!1,!0,4294967295)}},"http://www.w3.org/2001/XMLSchema#unsignedShort":{label:"Unsigned Short",verify:function(a){return c(a,!0,!1,!0,65535)}},"http://www.w3.org/2001/XMLSchema#unsignedByte":{label:"Unsigned Byte",verify:function(a){return c(a,!0,!0,!0,255)}},"http://www.w3.org/2001/XMLSchema#positiveInteger":{label:"Positive Integer",verify:function(a){return c(a,!1,!1,!0)}},"http://www.w3.org/2001/XMLSchema#boolean":{label:"Boolean",setup:function(a,b){b?(a.bootstrapToggle&&a.bootstrapToggle("destroy"),a.attr("type","text")):(a.bootstrapToggle&&a.bootstrapToggle({on:"True",off:"False"}),a.attr("type","checkbox"))},getValue:function(a){return a.is(":checked")?"true":"false"},setValue:function(a,b){1===parseInt(b)||"string"==typeof b&&"true"===b.toLowerCase()?a.bootstrapToggle("on"):a.bootstrapToggle("off")}},"http://www.w3.org/2001/XMLSchema#string":{label:"String"},"http://www.w3.org/2001/XMLSchema#hexBinary":{label:"Hex Binary"},"http://www.w3.org/2001/XMLSchema#dateTime":{label:"Datetime",setup:function(a,b){b?a.datetimepicker("remove"):a.datetimepicker({format:"yyyy-mm-ddThh:ii:ssZ",weekStart:1})}},"http://www.w3.org/2001/XMLSchema#date":{label:"Date",setup:function(a,b){b?a.datetimepicker("remove"):a.datetimepicker({format:"yyyy-mm-dd",weekStart:1})}}},f=function(c,d){var f=this;f.mainElement=c,f.options=a.extend({},b,d),f.currentType=f.options.type||"http://www.w3.org/2000/01/rdf-schema#Literal",f.mainElement.on("input",function(){f.checkHashSign(),f.verifyInput(),f.change()}),f.container=a(document.createElement("div")).addClass("rdfNodeEditor"),f.inputContainer=a(document.createElement("div")).addClass("rdfNodeInputContainer");var g=a(c).addClass("form-control");g.after(f.container),f.inputContainer.append(g),f.container.append(f.inputContainer),f.options.choices&&("object"==typeof f.options.choices?f.selectizeSetup(f.options.choices):"function"==typeof f.options.choices&&f.options.choices(function(a){f.selectizeSetup(a)}),f.updateView(!1)),f.typeContainer=a(document.createElement("div")).addClass("rdfNodeTypeContainer"),f.typeContainer.css("vertical-align","top"),f.typeElement=a(document.createElement("select")).addClass("form-control");for(t in e)f.typeElement.append(a(document.createElement("option")).attr("value",t).text(e[t].label));f.typeContainer.append(f.typeElement),f.container.append(f.typeContainer);var h=function(){f.lastType=f.currentType,f.currentType=f.options.selectize?f.typeElement[0].selectize.getValue():f.typeElement.val(),f.verifyFct=e[f.currentType].verify,f.updateEditor(),f.verifyInput(),f.change()};f.options.selectize?(f.typeElement.selectize({onChange:h}),f.typeElement[0].selectize.setValue(this.currentType)):f.typeElement.change(h),f.options.type&&(f.typeElement.val(f.options.type),f.typeContainer.hide()),f.languageElement=a(document.createElement("input")).addClass("form-control").attr("placeholder","Language"),f.languageContainer=a(document.createElement("div")).addClass("rdfNodelanguageContainer"),f.languageContainer.css("vertical-align","top"),f.languageContainer.append(f.languageElement),f.container.append(f.languageContainer),"http://www.w3.org/2000/01/rdf-schema#Literal"===f.currentType&&f.options.showLangSelect||f.languageContainer.hide(),f.languageElement.on("input",function(){f.lang=f.languageElement.val(),f.verifyInput(),f.change()}),f.updateEditor(!0)};f.prototype.change=function(){a(this).trigger("changed",this)},f.prototype.selectizeSetup=function(b){var c=this,d=b;c.resourceContainer||(c.resourceSelect=a(document.createElement("select")),c.resourceContainer=a(document.createElement("div")).addClass("rdfResourceContainer"),c.resourceContainer.append(c.resourceSelect),c.inputContainer.append(c.resourceContainer)),c.resourceSelectize||(c.resourceSelect.selectize({valueField:"value",searchField:"label",sortField:"label",create:c.options.create?function(a,b){var c=new RDFE.RdfNode("uri",a);c.label=a,this.options[a]=c,b(c)}:!1,createOnBlur:!0,onChange:function(a){c.mainElement.val(a),c.change()},render:{item:function(a,b){return"<div>"+b(a.label||a.value)+"</div>"},option:function(a,b){return a.label?"<div>"+b(a.label)+" <small>("+b(a.value)+")</small></div>":"<div>"+b(a.value)+"</div>"}}}),c.resourceSelectize=a(c.resourceSelect)[0].selectize),c.resourceSelectize.clearOptions(),c.resourceSelectize.addOption(d)};var g=function(){var b=["http://www.w3.org/2000/01/rdf-schema#Literal","http://www.w3.org/2001/XMLSchema#string"];return function(c,d){return c===d||a.inArray(c,b)>=0&&a.inArray(d,b)>=0}}();f.prototype.updateEditor=function(a){var b=this;g(b.options.type,b.currentType)?b.typeContainer.hide():b.typeContainer.css("display","table-cell"),b.options.showLangSelect&&"http://www.w3.org/2000/01/rdf-schema#Literal"===b.currentType?b.languageContainer.css("display","table-cell"):b.languageContainer.hide(),(a||b.lastType!==b.currentType)&&(b.lastType&&e[b.lastType].setup&&e[b.lastType].setup(b.mainElement,!0),e[b.currentType].setup&&e[b.currentType].setup(b.mainElement),b.updateView("http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!==b.currentType))},f.prototype.getValue=function(){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"===this.currentType?new RDFE.RdfNode("uri",RDFE.Utils.trim(RDFE.Utils.trim(this.mainElement.val(),"<"),">")):new RDFE.RdfNode("literal",e[this.currentType].getValue?e[this.currentType].getValue(this.mainElement):this.mainElement.val(),"http://www.w3.org/2000/01/rdf-schema#Literal"!==this.currentType?this.currentType:void 0,this.lang?this.lang:void 0)},f.prototype.setValue=function(a,b){var c=this;if(a){var a=RDFE.RdfNode.fromStoreNode(a);c.lastType=c.currentType,"uri"===a.type||c.startsWithHashSign()?(c.currentType="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",b?(c.selectizeSetup(b),c.updateView(!1)):c.updateView(!0)):(c.updateView(!0),c.currentType=a.datatype||"http://www.w3.org/2000/01/rdf-schema#Literal","http://www.w3.org/2001/XMLSchema#boolean"!==c.options.type||"0"!==a.value&&"1"!==a.value&&"true"!==a.value.toLowerCase()&&"false"!==a.value.toLowerCase()||(c.currentType="http://www.w3.org/2001/XMLSchema#boolean")),c.lang=a.language,-1!==a.value.indexOf("\n")&&c.transformToTextarea(),c.mainElement.val(a.value),c.resourceSelect&&(c.resourceSelect[0].selectize.addOption(a),c.resourceSelect[0].selectize.setValue(a.value)),e[c.currentType]&&e[c.currentType].setValue&&e[c.currentType].setValue(c.mainElement,c.mainElement.val()),c.languageElement.val(c.lang),c.typeElement.val(c.currentType),c.options.selectize&&c.typeElement[0].selectize.setValue(c.currentType),c.updateEditor(c.lastType!==c.currentType),c.lastType=c.currentType}},f.prototype.updateView=function(a){var b=this;a?(b.inputContainer.css("width",null),b.mainElement.show(),b.resourceContainer&&b.resourceContainer.hide()):b.resourceContainer?(b.inputContainer.css("width","50%"),b.resourceContainer.show(),b.mainElement.hide()):(b.inputContainer.css("width",null),b.mainElement.show())},f.prototype.isValid=function(a){return this.verifyFct?this.verifyFct(this.mainElement.val()):!0},f.prototype.startsWithHashSign=function(){var b=this;if(b.options.startHashSignAsResource===!0){var c=RDFE.Utils.trim(a(b.mainElement).val());return c.length>=1&&"#"===c.charAt(0)}return!1},f.prototype.checkHashSign=function(){var a=this;if(a.startsWithHashSign()){var b=a.options.selectize?a.typeElement[0].selectize.getValue():a.typeElement.val();"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!==b&&(a.options.selectize?(a.typeElement[0].selectize.setValue("http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"),a.typeElement[0].selectize.onChange()):(a.typeElement.val("http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"),a.typeElement.change()))}},f.prototype.verifyInput=function(){var b=this,c=a(b.mainElement).val(),d=!0;c.length>0&&(d=b.verifyFct?b.verifyFct(c):!0),d?b.mainElement.removeClass("has-error"):b.mainElement.addClass("has-error")},f.prototype.isLiteralType=function(a){return e.hasOwnProperty(a)&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!=a},f.prototype.setEditFocus=function(){this.mainElement.focus()},f.prototype.blur=function(){this.mainElement.blur()},f.prototype.getElement=function(){return this.container},f.prototype.transformToTextarea=function(){var b=this;if("INPUT"===b.mainElement.prop("tagName")&&"text"===b.mainElement.prop("type")){var c=document.createElement("textarea");c.id=b.mainElement.prop("id"),c.name=b.mainElement.prop("name"),c.value=b.mainElement.val(),a(c).addClass(b.mainElement.prop("class")),b.mainElement.replaceWith(c),b.mainElement=a(c)}},a.fn.rdfNodeEditor=function(a){var b=this.data("rdfNodeEditor");return b||(b=new f(this,a),this.data("rdfNodeEditor",b)),b}}(jQuery),function(a){"use strict";var b=function(a){this.init("rdfnode",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.filter("input"),this.setClass(),this.$input.rdfNodeEditor(this.options.rdfnode.config)},activate:function(){this.$input.rdfNodeEditor().setEditFocus()},value2html:function(b,c){return b?void a(c).text(b.toString()):void a(c).empty()},html2value:function(a){return null},input2value:function(){return this.$input.rdfNodeEditor().getValue()},value2input:function(a){var b;if(this.options&&this.options.rdfnode){var c=this.options.rdfnode,d=c.ontologyManager;if(d){var e=d.ontologyPropertyByURI(c.predicate),f=e.getRange();d.ontologyClassByURI(f)&&(b=c.document.itemsByRange(f))}}this.$input.rdfNodeEditor().setValue(a,b)}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{rdfnode:{},tpl:'<input type="text">'}),a.fn.editabletypes.rdfnode=b}(window.jQuery),function(a){var b=function(b,c){var d=this;d.options=a.extend({},c),d.options.ontoManager=d.options.ontoManager||new RDFE.OntologyManager,d.mainElem=b,a(d.options.ontoManager).on("changed",function(a,b){d.sel.addOption(b.allOntologies())}),a(d.mainElem).selectize({valueField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:d.options.ontoManager.ontologies,onChange:function(b){a(d).trigger("changed",d.options.ontoManager.ontologyByURI(b))},createOntology:function(a,b){return d.options.ontoManager.ontologyByURI(d.options.ontoManager.ontologyDetermine(a),b)},create:function(b,c){var e=this,f=d.options.ontoManager.ontologyDetermine(b);f||(f=d.options.ontoManager.prefixes[b]||b),d.options.ontoManager.parseOntologyFile(f,{success:function(){c(e.settings.createOntology(b,!0))},error:function(d){d&&d.message&&a.growl({message:d.message},{type:"danger"}),c(e.settings.createOntology(b,!0))}})},render:{item:function(a,b){return"<div>"+b(a.title||a.label||a.prefix||a.URI)+"</div>"},option:function(a,b){return"<div>"+b(a.title||a.label||a.prefix||a.URI)+"<br/><small>("+b(a.URI)+")</small></div>"},option_create:function(a,b){var c=d.options.ontoManager.prefixes[a.input]||a.input;return c!=a.input?'<div class="create">Load <strong>'+b(a.input)+"</strong> <small>("+b(c)+")</small>&hellip;</div>":'<div class="create">Load <strong>'+b(c)+"</strong>&hellip;</div>"}}}),d.sel=a(d.mainElem)[0].selectize};b.prototype.selectedOntologyURI=function(){return this.sel.getValue()},b.prototype.selectedOntology=function(){return this.sel.options[this.selectedOntologyURI()]},b.prototype.on=function(b,c){a(this).on(b,c)},a.fn.ontoBox=function(a){var c=this.data("ontoBox");return c||(c=new b(this,a),this.data("ontoBox",c)),c}}(jQuery),function(a){var b=function(c,d){var e=this;e.options=a.extend({},b.defaults,d),e.options.ontoManager=e.options.ontoManager||new RDFE.OntologyManager,e.mainElem=c,a(e.options.ontoManager).on("changed",function(a,b,c){e.updateOptions()}),a(e.mainElem).selectize({valueField:"URI",searchField:["title","label","prefix","curi","URI"],sortField:["prefix","URI"],options:e.propertyList(),onChange:function(b){a(e).trigger("changed",e.sel.options[b])},createProperty:function(a,b){return e.options.ontoManager.ontologyPropertyByURI(e.options.ontoManager.uriDenormalize(a),b)},create:function(a,b){var c=this;a=RDFE.Utils.trim(RDFE.Utils.trim(a,"<"),">"),"a"===a&&(a="http://www.w3.org/1999/02/22-rdf-syntax-ns#type");var d=this.settings.createProperty(a);if(d)b(d);else{var f=e.options.ontoManager.ontologyDetermine(a);f||(f=e.options.ontoManager.prefixes[a]||a),e.options.ontoManager.parseOntologyFile(f,{success:function(){b(c.settings.createProperty(a,!0))},error:function(d){var g=d&&d.message?d.message:"Error loading ontology";console.log(g),bootbox.confirm(g+". Do you want to create new property?",function(d){if(d){var g=e.options.ontoManager.ontologyByURI(f);if(!g){var g=e.options.ontoManager.ontologyByURI(f);g||(g=new RDFE.Ontology(e.options.ontoManager,f)),b(c.settings.createProperty(a,!0))}}else c.unlock()})}})}},render:{item:function(a,b){var c=a.title||a.label||a.curi||a.name;return c=a.curi&&a.curi!=c?b(c)+" <small>("+b(a.curi)+")</small>":b(c),"<div>"+c+"</div>"},option:function(a,b){return"<div>"+b(a.title||a.label||a.curi||a.name)+"<br/><small>("+b(a.URI)+")</small></div>"},option_create:function(a,b){var c=a.input;return c=RDFE.Utils.trim(RDFE.Utils.trim(c,"<"),">"),c=e.options.ontoManager.uriDenormalize(c),c!=a.input?'<div class="create">Add <strong>'+b(a.input)+"</strong> <small>("+b(c)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+b(c)+"</strong>&hellip;</div>"}}}),e.sel=a(e.mainElem)[0].selectize};b.defaults={ontoManager:null,ontology:null},b.prototype.setOntology=function(a){this.options.ontology=a,this.updateOptions()},b.prototype.propertyList=function(){var a;return a=this.options.ontology?this.options.ontology.allProperties():this.options.ontoManager.allProperties()},b.prototype.updateOptions=function(){var a=this.propertyList();this.sel.clearOptions(),this.sel.addOption(a)},b.prototype.setPropertyURI=function(a){if(a){var b=this.options.ontoManager.uriDenormalize(a);b=RDFE.Utils.trim(RDFE.Utils.trim(b,"<"),">"),this.sel.options[b]||this.sel.addOption(this.options.ontoManager.ontologyPropertyByURI(b,!0)),this.sel.setValue(b)}else this.sel.setValue(null)},b.prototype.selectedURI=function(){return this.sel.getValue()},b.prototype.selectedProperty=function(){return this.sel.options[this.selectedURI()]},b.prototype.on=function(b,c){return a(this).on(b,c),this},a.fn.propertyBox=function(a){var c=this.data("propertyBox");return c||(c=new b(this,a),this.data("propertyBox",c)),c}}(jQuery),function(a){"use strict";var b=function(a){this.init("rdfnode",a,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput),a.extend(b.prototype,{render:function(){this.$input=this.$tpl.filter("select"),this.setClass(),this.$input.propertyBox(this.options.propertyBox),this.$input.propertyBox().sel.$control.css("min-width","250px")},activate:function(){},value2html:function(b,c){return b?void a(c).text(b.toString()):void a(c).empty()},html2value:function(a){return null},input2value:function(){return this.$input.propertyBox().selectedURI()},value2input:function(a){this.$input.propertyBox().setPropertyURI(a)}}),b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{propertyBox:{},tpl:"<select></select>"}),a.fn.editabletypes.propertyBox=b}(window.jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.TripleView=function(){var b=function(a,b,c){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.editor=c};return b.prototype.render=function(b,c){var d=this,e=d.doc.config.options.maxLabelLength,f=function(a){return"Literal"==a.interfaceName?"http://www.w3.org/2001/XMLSchema#dateTime"==a.datatype?new Date(a.nominalValue).toString():RDFE.Utils.strAbbreviate(a.nominalValue,e):RDFE.Utils.uriAbbreviate(a.toString(),e)},g=function(b,c,e){var f=e;if("predicate"===c&&(f=d.doc.store.rdf.createNamedNode(e)),e.toStoreNode)f=e.toStoreNode(d.doc.store);else if("object"!=c||"NamedNode"==b.object.interfaceName)f=d.doc.store.rdf.createNamedNode(e);else if("http://www.w3.org/2001/XMLSchema#dateTime"==b.object.datatype){var g=new Date(e);f=d.doc.store.rdf.createLiteral(g.toISOString(),b.object.language,b.object.datatype)}else f=d.doc.store.rdf.createLiteral(e,b.object.language,b.object.datatype);var h=d.doc.store.rdf.createTriple(b.subject,b.predicate,b.object);h[c]=f,d.doc.updateTriple(b,h,function(a){},function(b){a(d).trigger("rdf-editor-error",{message:"Failed to update triple in document: "+b})})};d.doc.listProperties(function(e){d.doc.store.graph(d.doc.graph,function(e,h){if(e){b.empty();var i=a(document.createElement("table")).addClass("table");b.append(i);for(var j=h.toArray(),k=0;k<j.length;k+=1)j[k].id=k;i.data("maxindex",k),i.bootstrapTable({striped:!0,sortName:"s",pagination:!0,search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:j,dataSetter:g,columns:[{field:"subject",title:RDFE.Utils.namingSchemaLabel("s",d.namingSchema),align:"left",sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{config:d.doc.config.options,type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"},value:a.subject}},formatter:f},{field:"predicate",title:RDFE.Utils.namingSchemaLabel("p",d.namingSchema),align:"left",sortable:!0,editable:function(a){return{mode:"inline",type:"propertyBox",propertyBox:{ontoManager:d.ontologyManager},value:a.predicate.nominalValue}},formatter:f},{field:"object",title:RDFE.Utils.namingSchemaLabel("o",d.namingSchema),align:"left",sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{config:d.doc.config.options,predicate:a.predicate.toString(),document:d.doc,ontologyManager:d.ontologyManager},value:a.object}},formatter:f},{field:"actions",title:'<button class="add btn btn-default" title="Add a new statement to the document"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,editable:!1,formatter:function(a,b,c){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(b,c,e,f){var g=e;d.doc.deleteTriple(g,function(){i.bootstrapTable("remove",{field:"id",values:[e.id]})},function(){a(d).trigger("rdf-editor-error",{type:"triple-delete-failed",message:"Failed to delete "+RDFE.Utils.namingSchemaLabel("spo",d.namingSchema,!1,!0)+"."})})}}}]}),a(i).find(".add").on("click",function(a){d.editor.editTriple()}),d.tripleTable=i,c&&c()}else a(d).trigger("rdf-editor-error","Failed to query "+RDFE.Utils.namingSchemaLabel("spo",d.namingSchema,!0,!0)+" from document.")})})},b.prototype.addTriple=function(b){var c=this.tripleTable.data("maxindex");this.tripleTable.bootstrapTable("append",a.extend(b,{id:c})),this.tripleTable.data("maxindex",c+1)},b}()}(jQuery),Backbone.Form.editors.Rdfnode=Backbone.Form.editors.Base.extend({tagName:"input",events:{change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)},keyup:function(a,b){13==a.keyCode&&a.shiftKey&&(console.log("shift+enter"),this.editor&&this.editor.transformToTextarea(),a.stopPropagation()),this.trigger("keyup",this)}},initialize:function(a){Backbone.Form.editors.Base.prototype.initialize.call(this,a)},render:function(){var a=this;return this.$el.attr("type","text"),this.$el.rdfNodeEditor(this.schema.rdfnode),a.editor=this.$el.rdfNodeEditor(),a.setElement(a.editor.getElement()),$(this.editor).on("change",function(){a.trigger("change",this)}),this.setValue(this.value),this},getValue:function(){return this.editor.getValue()},setValue:function(a){this.editor.setValue(a)},focus:function(){this.hasFocus||this.editor.setEditFocus()},blur:function(){this.hasFocus&&this.editor.blur()}}),Backbone.Form.editors.NestedRdf=Backbone.Form.editors.Object.extend({initialize:function(a){if(Backbone.Form.editors.Base.prototype.initialize.call(this,a),!this.form)throw new Error('Missing required option "form"');if(!a.schema.model)throw new Error('Missing required "schema.model" option for NestedRdf editor')},render:function(){var a=this.form.constructor,b=this.value,c=(this.key,this.schema.model),d=b?b:new c;return this.nestedForm=new a({model:d,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var a=this.nestedForm.getValue();if(this.nestedForm.model.defaults){var b=!1;for(var c in a)if(a[c])for(var d=0;d<a[c].length;d++)if(a[c][d].value){b=!0;break}b&&(a=_.extend({},this.nestedForm.model.defaults,a))}return{uri:this.nestedForm.model.uri,values:a}}}),window.RDFE||(window.RDFE={}),RDFE.EntityModel=Backbone.Model.extend({setEntity:function(a,b){this.doc=a,this.uri=b,this.individualsCache={}},addValue:function(a,b){var c=this.get(a)||[];c.push(b),this.set(a,c)},getIndividuals:function(a,b){var c=this;if(this.individualsCache[a])return void b(this.individualsCache[a]);var d=[],e=this.doc.ontologyManager.ontologyClassByURI(a);if(a&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!==a?"http://www.w3.org/2000/01/rdf-schema#Class"===a?d=this.doc.ontologyManager.ontologyClasses:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"===a?d=this.doc.ontologyManager.ontologyProperties:e&&(d=e.getIndividuals(!0)):d=this.doc.ontologyManager.individuals,d=_.map(_.values(d),function(a){var b=new RDFE.RdfNode("uri",a.URI);return b.label=a.label||a.name,b}),c.doc.listEntities(a,function(a){$.merge(d,a)}),e)for(var f=e.getSubClasses(!0),g=0,h=f.length;h>g;g++)c.doc.listEntities(f[g].URI,function(a){$.merge(d,a)});this.individualsCache[a]=d,b(d)},maxCardinalityForProperty:function(a){for(var b=0;b<this.types.length;b++){var c=this.types[b].maxCardinalityForProperty(a);if(c)return c}return null},restrictionsForProperty:function(a){for(var b=0;b<this.types.length;b++){var c=this.types[b].restrictions[a];if(c)return c}return null},isAggregateProperty:function(a){for(var b=0;b<this.types.length;b++)if(this.types[b].isAggregateProperty(a))return!0;return!1},addSchemaEntryForProperty:function(a){var b,c,d=this,e=a.URI?a:d.doc.ontologyManager.ontologyProperties[a]||{URI:a},f=this.restrictionsForProperty(a);f&&(b=f.hasCustomLabel,c=f.hasCustomComment);var g=RDFE.Utils.createTitle(b||e.label||e.title||RDFE.Utils.uri2name(e.URI)),h={titleHTML:'<span title="{0}">{1}</span>'.format(RDFE.Utils.escapeXml(e.URI),g),title:g,maxCardinality:d.maxCardinalityForProperty(e.URI),editorAttrs:{title:RDFE.coalesce(c,e.comment,e.description)}};if(d.isAggregateProperty(e.URI)){var i=e.getRange?d.doc.ontologyManager.ontologyClassByURI(e.getRange()):null;i?(h.type="List",h.itemType="NestedRdf",h.model=RDFE.EntityModel.extend({defaults:{"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":[new RDFE.RdfNode("uri",e.getRange())]},initialize:function(a){RDFE.EntityModel.prototype.initialize.call(this,a),this.doc=d.doc,this.buildSchemaFromTypes([i])},individualsCache:d.individualsCache}),h.editorAttrs.style="height:auto;"):(console.log("Caution: invalid range on aggregate: ",e),h.type="List",h.itemType="Rdfnode",h.rdfnode={type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",create:!0})}else{h.type="List",h.itemType="Rdfnode",h.rdfnode={};var j=_.result(e,"getRange");e["class"]==d.doc.ontologyManager.uriDenormalize("owl:DatatypeProperty")?h.rdfnode.type=j:e["class"]==d.doc.ontologyManager.uriDenormalize("owl:ObjectProperty")?(h.rdfnode.type="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",h.rdfnode.choices=function(a){d.getIndividuals(j,a)},h.rdfnode.create=!0):j&&("http://www.w3.org/2000/01/rdf-schema#Literal"==j||j.startsWith("http://www.w3.org/2001/XMLSchema#")?h.rdfnode.type=j:(h.rdfnode.type="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",h.rdfnode.choices=function(a){d.getIndividuals(j,a)},h.rdfnode.create=!0))}d.schema[e.URI]=h},buildSchemaFromTypes:function(a){var b=this;b.schema={},b.fields=[],b.lens=null,b.types=a;for(var c=0,d=a.length;d>c;c++){var e=a[c].getFresnelLens();if(e&&e.showProperties.length){b.lens=e;break}}e?b.fields=_.without(e.showProperties,b.doc.ontologyManager.uriDenormalize("fresnel:allProperties")):b.fields=[b.doc.ontologyManager.uriDenormalize("rdf:type")];for(var c=0;c<b.fields.length;c++)b.addSchemaEntryForProperty(b.fields[c])},docToModel:function(a,b){var c=this;c.schema={},c.fields=[],this.doc.getEntity(c.uri,function(b){c.types=_.compact(_.map(b.types,c.doc.ontologyManager.ontologyClassByURI,c.doc.ontologyManager)),c.fields=[],c.lens=null;if(0===c.types.length)for(var d in b.properties){var e=c.doc.ontologyManager.ontologyPropertyByURI(d);e&&e.domain&&(c.types=_.union(c.types,e.domain))}for(var f=0,g=c.types.length;g>f;f++){var h=c.types[f].getFresnelLens();if(h&&h.showProperties.length>0){c.lens=h;break}}if(h&&(c.fields=_.clone(h.showProperties)),h){var i=c.fields.indexOf(c.doc.ontologyManager.uriDenormalize("fresnel:allProperties"));if(i>=0){c.allowAddProperty=!0;var j=[];for(d in b.properties)_.contains(c.fields,d)||_.contains(h.hideProperties,d)||j.push(d);c.fields.splice.apply(c.fields,[i,1].concat(j))}}else{c.allowAddProperty=!0;for(var d in b.properties)_.contains(c.fields,d)||("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===d?c.fields.unshift(d):c.fields.push(d))}for(var f=0;f<c.fields.length;f++)c.addSchemaEntryForProperty(c.fields[f]);for(var d in b.properties)for(var k=c.isAggregateProperty(d),l=b.properties[d],f=0;f<l.length;f++)if(k){var m=new RDFE.EntityModel;m.setEntity(c.doc,l[f].value),m.individualsCache=c.individualsCache,m.docToModel(function(){c.addValue(d,m)})}else c.addValue(d,l[f]);a&&a()})},modelToDoc:function(){function a(c,d,e){var f=[];if(!c||0===c.length){for(var g="",h=0,i=e.config.options.labelProps.length;i>h;h++)if(d[e.config.options.labelProps[h]]){g=d[e.config.options.labelProps[h]];break}g=(g||"subres")+"_"+b,c=e.buildEntityUri(g),b++}var j=e.store.rdf.createNamedNode(c);for(prop in d){var k=e.store.rdf.createNamedNode(prop),l=d[prop];l.constructor!==Array&&(l=[l]);for(var m=0;m<l.length;m++){var n=l[m];if(n.values){var o=a(n.uri,n.values,e);o.length>0&&(f.push(e.store.rdf.createTriple(j,k,o[0].subject)),Array.prototype.push.apply(f,o))}else{var p=l[m].toStoreNode(e.store);p&&p.nominalValue.length>0&&f.push(e.store.rdf.createTriple(j,k,p))}}}return f}var b=1;return function(c,d){var e=this;b=1;for(var f=a(this.uri,e.attributes,e.doc),g=[],h=0;h<f.length;h++)_.indexOf(g,f[h].subject.nominalValue)<0&&g.push(f[h].subject.nominalValue);var i=function(a){a>=g.length?e.doc.addTriples(f,c,d):e.doc.deleteBySubject(g[a],function(){i(a+1)},d)};i(0)}}()}),function(a){window.RDFE||(window.RDFE={}),RDFE.EntityEditor=function(){var b=function(a,b){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b},c=Backbone.Form.extend({template:_.template('<form class="form-horizontal clearfix" role="form">  <a href="#" class="btn btn-default btn-xs pull-right addProp">Add <%= RDFE.Utils.namingSchemaLabel("p", this.namingSchema) %></a>  <div data-fieldsets></div>  <% if (submitButton) { %>    <button type="submit" class="btn"><%= submitButton %></button>  <% } %></form>'),render:function(){var b=this;return b.namingSchema=b.model.doc.config.options[b.model.doc.config.options.namingSchema],Backbone.Form.prototype.render.call(this),b.model.allowAddProperty||this.$el.find(".addProp").hide(),this.$el.find("> a.addProp").click(function(c){c.preventDefault();var d=a(document.createElement("select")),e=a(document.createElement("button")).addClass("btn").addClass("btn-default").text("Add"),f=a(document.createElement("button")).addClass("btn").addClass("btn-default").text("Cancel"),g=a(document.createElement("div")).append(a(document.createElement("span")).text("New "+RDFE.Utils.namingSchemaLabel("p",b.namingSchema)+":")).append(d).append(e).append(f);d=d.propertyBox({ontoManager:b.model.doc.ontologyManager}),f.click(function(a){a.preventDefault(),g.remove()}),e.click(function(a){if(a.preventDefault(),d.selectedURI()){console.log("Adding new property",d.selectedURI(),"to form",b),b.commit(),b.model.addSchemaEntryForProperty(d.selectedProperty()),b.model.fields.push(d.selectedURI()),b.fieldsets=void 0,b.initialize(b.options),g.remove();var c=b.$el.parent();b.$el.remove(),b.render(),console.log(c,b.$el),c.append(b.$el)}else console.log("No prop selected")}),b.$el.prepend(g)}),this}});return b.prototype.template=_.template('<div class="panel panel-default">        <div class="panel-heading clearfix">          <h3 class="panel-title pull-left">Editing <a href="<%= entityUri %>"><span class="entity-label"><%= entityLabel %><span></a> <span class="entity-types"></span></h3>          <div class="btn-group pull-right" role="group">            <button type="button" class="btn btn-primary btn-sm" id="okBtn">Apply</button>            <button type="button" class="btn btn-default btn-sm" id="cnclBtn">Cancel</button>          </div>        </div>        <div class="panel-body" id="entityFormContainer">        </div>      </div>'),b.prototype.render=function(b,d,e){var f=this,g=new RDFE.EntityModel;g.setEntity(this.doc,d),g.docToModel(function(){var h=new c({model:g});h.render(),b.empty(),b.append(f.template({entityUri:d,entityLabel:RDFE.Utils.uri2name(d)})),f.doc.getEntity(d,function(a){
b.find(".entity-types").html(f.ontologyManager.typesToLabel(a.types,!0)),b.find(".entity-label").html(a.label)}),b.find("#entityFormContainer").append(h.el),b.find(".toggle.btn").css("width","100%");var i=b.find("button#cnclBtn"),j=b.find("button#saveBtn"),k=b.find("button#okBtn");i.click(function(){e()});var l=function(b){h.commit(),g.modelToDoc(function(){a(f).trigger("rdf-editor-success",{type:"editor-form-save-done",message:"Locally saved details of "+d}),b&&b()},function(b){a(f).trigger("rdf-editor-error",{type:"editor-form-save-failed",message:b})})};j.click(function(){l()}),k.click(function(){l(e)})},function(b){a(f).trigger("rdf-editor-error",{type:"editor-form-creation-failed",message:b})})},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.EntityView=function(){var b=function(a,b,c,d){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.editor=c,this.editFct=d.editFct},c=function(a,b,c){return'<span title="'+b.uri+'">'+b.label+"</span>"},d=function(a,b,c){return b.types&&b.types.length?b.types:"<em>none</em>"},e=function(a,b){return{label:a.label,types:b.typesToLabel(a.types),uri:a.uri||a.value}};return b.prototype.render=function(b,f){var g=this,h=function(a,b,c){return['<a class="edit ml10" href="javascript:void(0)" title="Edit this '+RDFE.Utils.namingSchemaLabel("spo",g.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove this '+RDFE.Utils.namingSchemaLabel("spo",g.namingSchema,!1,!0)+' from the document">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")};g.doc.listEntities(g.editor.config.options.entityTypesFiler,function(i){g.entityTable=null,b.empty();var j=a(document.createElement("table")).addClass("table");b.append(j);for(var k=[],l=0;l<i.length;l++)k.push(e(i[l],g.ontologyManager));var m=function(b){g.doc.deleteEntity(b,function(){j.bootstrapTable("remove",{field:"uri",values:[b]}),a(g).trigger("rdf-editor-success",{type:"entity-delete-done",uri:b,message:"Successfully deleted entity "+b+"."})},function(b){a(g).trigger("rdf-editor-error",{type:"entity-delete-failed",message:b})})};j.bootstrapTable({striped:!0,sortName:"label",pagination:!0,search:!0,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:k,idField:"uri",columns:[{field:"label",title:RDFE.Utils.namingSchemaLabel("s",g.namingSchema)+" Name",aligh:"left",sortable:!0,formatter:c},{field:"types",title:"Entity Types",aligh:"left","class":"small-column",sortable:!0,formatter:d},{field:"actions",title:'<button class="add btn btn-default" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("spo",g.namingSchema,!1,!0)+' to the document"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,formatter:h,events:{"click .edit":function(a,b,c,d){g.editFct(c.uri)},"click .remove":function(a,b,c,d){m(c.uri)}}}]}),a(j).find(".add").on("click",function(a){g.editor.createNewEntityEditor()}),g.entityTable=j,f&&f()},function(b){a(g).trigger("rdf-editor-error",{type:"entity-list-failed",message:b})})},b.prototype.addEntity=function(a){this.entityTable.bootstrapTable("append",a)},b.prototype.updateEntity=function(a){var b=this;b.doc.getEntity(a,function(a){b.entityTable.bootstrapTable("update",{field:"uri",data:e(a,b.ontologyManager)})})},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.SubjectEditor=function(){var b=function(a,b,c){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.subject=c},c=function(a){return"Literal"==a.interfaceName?"http://www.w3.org/2001/XMLSchema#dateTime"==a.datatype?new Date(a.nominalValue).toString():a.nominalValue:a.toString()};return b.prototype.template=_.template('       <div class="panel panel-default">         <div class="panel-heading clearfix">           <form class="form-inline">             <div class="form-group" style="width: 80%;">               <label>Selected <%= RDFE.Utils.namingSchemaLabel("s", this.namingSchema) %> </label>               <input name="subject" class="form-control" style="width: 85%;" disabled="disabled" />             </div>             <div class="btn-group pull-right" role="group">               <button type="button" class="btn btn-default btn-sm" id="backButton">Back</button>             </div>           </form>         </div>         <div class="panel-body" id="subjectTable">         </div>         <div class="panel-body" id="subjectForm" style="display: none;">       </div>'),b.prototype.render=function(b,d,e,f){var g=this,h=function(c,d){var f,h,i,j=function(a){var b=g.ontologyManager.ontologyByURI(a.currentTarget.selectedOntologyURI());i.clearOptions(),i.addOption(b?b.classesAsArray():g.ontologyManager.allClasses())};c.html('<div class="panel panel-default">  <div class="panel-heading">    <h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("s",g.namingSchema)+'</h3>  </div>  <div class="panel-body">    <div class="form-horizontal">       <div class="form-group">         <label for="ontology" class="col-sm-2 control-label">Ontology</label>         <div class="col-sm-10">           <select name="ontology" id="ontology" class="form-control" />         </div>       </div>       <div class="form-group">         <label for="class" class="col-sm-2 control-label">Type</label>         <div class="col-sm-10">           <select name="class" id="class" class="form-control" />         </div>       </div>       <div class="form-group">          <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",g.namingSchema)+(g.doc.config.options.entityUriTmpl?" Name":" URI")+'</label>          <div class="col-sm-10">            <input name="subject" id="subject" class="form-control" />          </div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a>           <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a>         </div>       </div>     </div>  </div></div>\n'),f=a("#ontology").ontoBox({ontoManager:g.ontologyManager}),f.on("changed",j),f.sel.focus(),h=a("#class").selectize({create:!0,valueField:"URI",labelField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:g.ontologyManager.allClasses(),create:function(a,b){b(g.ontologyManager.ontologyClassByURI(g.ontologyManager.uriDenormalize(a),!0))},render:{item:function(a,b){var c=a.title||a.label||name.curi||a.name;return c=a.curi&&a.curi!=c?b(c)+" <small>("+b(a.curi)+")</small>":b(c),"<div>"+c+"</div>"},option:function(a,b){return"<div>"+b(a.title||a.label||name.curi||a.name)+"<br/><small>("+b(a.URI)+")</small></div>"},option_create:function(a,b){var c=g.ontologyManager.uriDenormalize(a.input);return c!==a.input?'<div class="create">Add <strong>'+b(a.input)+"</strong> <small>("+b(c)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+b(c)+"</strong>&hellip;</div>"}}}),i=h[0].selectize,c.find("a.triple-action-new-cancel").click(function(a){a.preventDefault(),d()});var k=function(){var f=c.find('input[name="subject"]').val(),h=null,i=c.find("#class")[0].selectize.getValue();g.doc.config.options.entityUriTmpl&&(h=f,f=null),g.doc.addEntity(f,h,i,function(f){a(g).trigger("rdf-editor-success",{type:"entity-insert-success",message:"Successfully created new entity."}),g.doc.getSubject(f.uri,function(a){b.subjectView.addSubject(a),g.subject=a,g.render(b,c,e,d)})},function(){a(g).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new triple to store."})})};c.find("a.triple-action-new-save").click(function(a){a.preventDefault(),k()}),c.find("input#subject").keypress(function(a){13===a.which&&k()})},i=function(b,d){k.bootstrapTable({striped:!0,sortName:"subject",pagination:!0,search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:[],dataSetter:j,columns:[{field:"predicate",title:RDFE.Utils.namingSchemaLabel("p",g.namingSchema),sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{config:g.doc.config.options,type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"},value:a.predicate}},formatter:c},{field:"object",title:RDFE.Utils.namingSchemaLabel("o",g.namingSchema),sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{config:g.doc.config.options,predicate:a.predicate.toString(),document:g.doc,ontologyManager:g.ontologyManager},value:a.object}},formatter:c},{field:"actions",title:'<button class="add btn btn-default" title="Add Relation" style="display: none;"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,editable:!1,formatter:function(a,b,c){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(b,c,d,e){g.doc.deleteTriple(d,function(){k.bootstrapTable("remove",{field:"id",values:[d.id]})},function(){a(g).trigger("rdf-editor-error",{type:"triple-delete-failed",message:"Failed to delete triple."})})}}}]}),g.subjectTable=k,g.subjectTableContainer=b.find("#subjectTable"),g.subjectFormContainer=b.find("#subjectForm"),g.addButton=a(k).find(".add"),g.addButton.click(function(){g.createNewRelationEditor()}),g.renderData(),e&&g.createNewRelationEditor()},j=function(b,c,d){var e=d;if("subject"===c&&(e=g.doc.store.rdf.createNamedNode(d)),d.toStoreNode)e=d.toStoreNode(g.doc.store);else if("object"!=c||"NamedNode"==b.object.interfaceName)e=g.doc.store.rdf.createNamedNode(d);else if("http://www.w3.org/2001/XMLSchema#dateTime"==b.object.datatype){var f=new Date(d);e=g.doc.store.rdf.createLiteral(f.toISOString(),b.object.language,b.object.datatype)}else e=g.doc.store.rdf.createLiteral(d,b.object.language,b.object.datatype);var h=g.doc.store.rdf.createTriple(b.subject,b.subject,b.object);h[c]=e,g.doc.updateTriple(b,h,function(a){},function(b){a(g).trigger("rdf-editor-error",{message:"Failed to update triple in document: "+b})})};if(d.empty(),g.subject){d.append(g.template(g.subject));var k=a(document.createElement("table")).addClass("table");d.find("#subjectTable").append(k);var l=d.find("button#backButton");l.click(function(){f()});var m=d.find('input[name="subject"]');m.val(g.subject.uri),i(d,f)}else h(d,f)},b.prototype.renderData=function(){for(var a=this,b=a.subject?a.subject.items:[],c=0;c<b.length;c++)b[c].id=c;a.subjectTable.data("maxindex",c),a.subjectTable.bootstrapTable("load",b),a.subject?a.addButton.show():a.addButton.hide()},b.prototype.addTriple=function(b){var c=this.subjectTable.data("maxindex");this.subjectTable.bootstrapTable("append",a.extend(b,{id:c})),this.subjectTable.data("maxindex",++c)},b.prototype.createNewRelationEditor=function(){var b=this;b.subjectTableContainer.hide(),b.subjectFormContainer.html('<div class="panel panel-default">   <div class="panel-heading"><h3 class="panel-title">Add Relation</h3></div>   <div class="panel-body">     <form class="form-horizontal">       <div class="form-group">         <label for="predicate" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("p",b.namingSchema)+'</label>         <div class="col-sm-10"><select name="predicate" class="form-control"></select></div>       </div>       <div class="form-group">         <label for="object" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("o",b.namingSchema)+'</label>         <div class="col-sm-10"><input name="object" class="form-control" /></div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <button type="button" class="btn btn-default subject-action subject-action-new-cancel">Cancel</button>           <button type="button" class="btn btn-primary subject-action subject-action-new-save">OK</button>         </div>       </div>     </form>   </div> </div>').show();var c=b.subjectFormContainer.find('input[name="object"]').rdfNodeEditor(b.doc.config.options);c.setValue(new RDFE.RdfNode("literal","",null,""));var d=b.subjectFormContainer.find('select[name="predicate"]').propertyBox({ontoManager:b.ontologyManager}).on("changed",function(a,d){var e,f,g=c.getValue(),h=d.getRange();c.isLiteralType(h)?e=new RDFE.RdfNode("literal",g.value,h,g.language):b.ontologyManager.ontologyClassByURI(h)?(e=new RDFE.RdfNode("uri",g.value),f=b.doc.itemsByRange(h)):e=new RDFE.RdfNode("literal",g.value,null,""),c.setValue(e,f)});b.subjectFormContainer.find("button.subject-action-new-cancel").click(function(a){b.subjectFormContainer.hide(),b.subjectTableContainer.show()}),b.subjectFormContainer.find("button.subject-action-new-save").click(function(e){var f=b.subject.uri,g=d.selectedURI(),h=c.getValue(),i=b.doc.store.rdf.createTriple(b.doc.store.rdf.createNamedNode(f),b.doc.store.rdf.createNamedNode(g),h.toStoreNode(b.doc.store));b.doc.addTriples([i],function(){b.subjectView||b.addTriple(i),a(b).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully added new statement."}),b.subjectFormContainer.hide(),b.subjectTableContainer.show()},function(){a(b).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new statement to store."})})})},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.SubjectView=function(){var b=function(a,b,c,d){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.editor=c,this.editFct=d.editFct},c=function(a,b,c){return"{0} (<small>{1}</small>)".format(RDFE.Utils.uri2name(b.uri),b.uri)},d=function(a,b){function c(a){return"{0} (<small>{1}</small>)".format(RDFE.Utils.uri2name(a),a)}return a=c(a),b=c(b),a>b?1:b>a?-1:0},e=function(a,b,c){return b.items.length};return b.prototype.render=function(b,f){var g=this;g.doc.listSubjects(function(h){var i=function(a,b,c){return['<a class="edit ml10" href="javascript:void(0)" title="Edit or add a new '+RDFE.Utils.namingSchemaLabel("p",g.namingSchema,!1,!0)+" name and "+RDFE.Utils.namingSchemaLabel("o",g.namingSchema,!1,!0)+" pairs associated with this "+RDFE.Utils.namingSchemaLabel("s",g.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove all '+RDFE.Utils.namingSchemaLabel("spo",g.namingSchema,!0,!0)+" associated with this "+RDFE.Utils.namingSchemaLabel("s",g.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")};g.subjects=h,g.subjectTable=null,b.empty();var j=a(document.createElement("table")).addClass("table");b.append(j),j.bootstrapTable({striped:!0,sortName:"uri",pagination:!0,search:!0,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:h,idField:"uri",columns:[{field:"uri",title:RDFE.Utils.namingSchemaLabel("s",g.namingSchema),sortable:!0,sorter:d,formatter:c},{field:"count",title:"Count",align:"right","class":"small-column",formatter:e},{field:"actions",title:'<button class="add btn btn-default" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("s",g.namingSchema,!1,!0)+'"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,formatter:i,events:{"click .edit":function(a,b,c,d){g.editFct(c)},"click .remove":function(b,c,d,e){g.doc.deleteBySubject(d.uri,function(){j.bootstrapTable("remove",{field:"uri",values:[d.uri]}),a(g).trigger("rdf-editor-success",{type:"subject-delete-done",uri:d.uri,message:"Successfully deleted attribute "+uri+"."})},function(b){a(g).trigger("rdf-editor-error",{type:"subject-delete-failed",message:b})})}}}]}),a(j).find(".add").on("click",function(a){g.editor.editSubject()}),g.subjectTable=j,f&&f()},function(b){a(g).trigger("rdf-editor-error",{type:"subject-list-failed",message:b})})},b.prototype.addSubject=function(a){var b=this;_.find(b.subjects,function(b){return b.uri===a.uri})||this.subjectTable.bootstrapTable("append",a)},b.prototype.updateSubject=function(a){var b=this;b.doc.getSubject(a,function(a){b.subjectTable.bootstrapTable("update",{field:"uri",data:a})})},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.PredicateEditor=function(){var b=function(a,b,c){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.predicate=c},c=function(a){return"Literal"==a.interfaceName?"http://www.w3.org/2001/XMLSchema#dateTime"==a.datatype?new Date(a.nominalValue).toString():a.nominalValue:a.toString()};return b.prototype.template=_.template('       <div class="panel panel-default">         <div class="panel-heading clearfix">           <form class="form-inline">             <div class="form-group" style="width: 80%;">               <label><%= RDFE.Utils.namingSchemaLabel("p", this.namingSchema) %> </label>               <select name="predicate" class="form-control" style="width: 85%;"></select>             </div>             <div class="btn-group pull-right" role="group">               <button type="button" class="btn btn-default btn-sm" id="backButton">Back</button>             </div>           </form>         </div>         <div class="panel-body" id="predicateTable">         </div>         <div class="panel-body" id="predicateForm" style="display: none;">       </div>'),b.prototype.render=function(b,d,e,f){var g=this,h=function(d,f){j.bootstrapTable({striped:!0,sortName:"subject",pagination:!0,search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:[],dataSetter:i,columns:[{field:"subject",title:RDFE.Utils.namingSchemaLabel("s",g.namingSchema),aligh:"left",sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{config:g.doc.config.options,type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"},value:a.subject}},formatter:c},{field:"object",title:RDFE.Utils.namingSchemaLabel("o",g.namingSchema),align:"left",sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{config:g.doc.config.options,predicate:g.predicate.uri,document:g.doc,ontologyManager:g.ontologyManager},value:a.object}},formatter:c},{field:"actions",title:'<button class="add btn btn-default" title="Add Relation" style="display: none;"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,editable:!1,formatter:function(a,b,c){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(b,c,d,e){g.doc.deleteTriple(d,function(){j.bootstrapTable("remove",{field:"id",values:[d.id]})},function(){a(g).trigger("rdf-editor-error",{type:"triple-delete-failed",message:"Failed to delete triple."})})}}}]}),g.predicateView=b.predicateView,g.predicateTable=j,g.predicateTableContainer=d.find("#predicateTable"),g.predicateFormContainer=d.find("#predicateForm"),g.addButton=a(j).find(".add"),g.addButton.click(function(){g.createNewRelationEditor()}),g.renderData(),e&&g.createNewRelationEditor()},i=function(b,c,d){var e=d;if("predicate"===c&&(e=g.doc.store.rdf.createNamedNode(d)),d.toStoreNode)e=d.toStoreNode(g.doc.store);else if("object"!=c||"NamedNode"==b.object.interfaceName)e=g.doc.store.rdf.createNamedNode(d);else if("http://www.w3.org/2001/XMLSchema#dateTime"==b.object.datatype){var f=new Date(d);e=g.doc.store.rdf.createLiteral(f.toISOString(),b.object.language,b.object.datatype)}else e=g.doc.store.rdf.createLiteral(d,b.object.language,b.object.datatype);var h=g.doc.store.rdf.createTriple(b.subject,b.predicate,b.object);h[c]=e,g.doc.updateTriple(b,h,function(a){},function(b){a(g).trigger("rdf-editor-error",{message:"Failed to update triple in document: "+b})})};d.empty(),d.append(g.template(g.predicate));var j=a(document.createElement("table")).addClass("table");d.find("#predicateTable").append(j);var k=d.find("button#backButton");k.click(function(){f()});var l=d.find('select[name="predicate"]').propertyBox({ontoManager:g.ontologyManager});g.predicate&&l.setPropertyURI(g.predicate.uri),l.sel.on("change",function(a){a&&g.doc.getPredicate(a,function(a){g.predicateView.addPredicate(a),g.predicate=a,g.renderData()})}),h(d,f)},b.prototype.renderData=function(){for(var a=this,b=a.predicate?a.predicate.items:[],c=0;c<b.length;c++)b[c].id=c;a.predicateTable.data("maxindex",c),a.predicateTable.bootstrapTable("load",b),a.predicate?a.addButton.show():a.addButton.hide()},b.prototype.addTriple=function(b){var c=this,d=c.predicateTable.data("maxindex");c.predicateTable.bootstrapTable("append",a.extend(b,{id:d})),c.predicateTable.data("maxindex",++d),c.predicateView.updatePredicate(c.predicate.uri)},b.prototype.createNewRelationEditor=function(){var b=this;b.predicateTableContainer.hide(),b.predicateFormContainer.html('<div class="panel panel-default">   <div class="panel-heading"><h3 class="panel-title">Add Relation</h3></div>   <div class="panel-body">     <form class="form-horizontal">       <div class="form-group">         <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",b.namingSchema)+'</label>         <div class="col-sm-10"><input name="subject" class="form-control" /></div>       </div>       <div class="form-group">         <label for="object" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("o",b.namingSchema)+'</label>         <div class="col-sm-10"><input name="object" class="form-control" /></div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <button type="button" class="btn btn-default predicate-action predicate-action-new-cancel">Cancel</button>           <button type="button" class="btn btn-primary predicate-action predicate-action-new-save">OK</button>         </div>       </div>     </form>   </div> </div>').show();var c,d,e=b.ontologyManager.ontologyProperties[b.predicate.uri],f=b.predicateFormContainer.find('input[name="object"]').rdfNodeEditor(b.doc.config.options),g=e.getRange();f.isLiteralType(g)?c=new RDFE.RdfNode("literal","",g,""):b.ontologyManager.ontologyClassByURI(g)?(c=new RDFE.RdfNode("uri",""),d=b.doc.itemsByRange(g)):c=new RDFE.RdfNode("literal","",null,""),f.setValue(c,d),b.predicateFormContainer.find("button.predicate-action-new-cancel").click(function(a){b.predicateFormContainer.hide(),b.predicateTableContainer.show()}),b.predicateFormContainer.find("button.predicate-action-new-save").click(function(c){var d=b.predicateFormContainer.find('input[name="subject"]').val();d=RDFE.Utils.trim(RDFE.Utils.trim(d,"<"),">");var e=b.predicate.uri,g=f.getValue(),h=b.doc.store.rdf.createTriple(b.doc.store.rdf.createNamedNode(d),b.doc.store.rdf.createNamedNode(e),g.toStoreNode(b.doc.store));b.doc.addTriples([h],function(){b.addTriple(h),a(b).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully added new statement."}),b.predicateFormContainer.hide(),b.predicateTableContainer.show()},function(){a(b).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new statement to store."})})})},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.PredicateView=function(){var b=function(a,b,c,d){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.editor=c,this.editFct=d.editFct},c=function(a,b,c){return"{0} (<small>{1}</small>)".format(RDFE.Utils.uri2name(b.uri),b.uri)},d=function(a,b){function c(a){return"{0} (<small>{1}</small>)".format(RDFE.Utils.uri2name(a),a)}return a=c(a),b=c(b),a>b?1:b>a?-1:0},e=function(a,b,c){return b.items.length};return b.prototype.render=function(b,f){var g=this;g.doc.listPredicates(function(h){var i=function(a,b,c){return['<a class="edit ml10" href="javascript:void(0)" title="Edit or add a new '+RDFE.Utils.namingSchemaLabel("s",g.namingSchema,!1,!0)+" and "+RDFE.Utils.namingSchemaLabel("o",g.namingSchema,!1,!0)+" pairs associated with this "+RDFE.Utils.namingSchemaLabel("p",g.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove all '+RDFE.Utils.namingSchemaLabel("spo",g.namingSchema,!0,!0)+" associated with this "+RDFE.Utils.namingSchemaLabel("p",g.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")};g.predicates=h,g.predicateTable=null,b.empty();var j=a(document.createElement("table")).addClass("table");b.append(j);var k=function(b){g.doc.deletePredicate(b.uri,function(){j.bootstrapTable("remove",{field:"uri",values:[b.uri]}),a(g).trigger("rdf-editor-success",{type:"predicate-delete-done",uri:b.uri,message:"Successfully deleted attribute "+uri+"."})},function(b){a(g).trigger("rdf-editor-error",{type:"predicate-delete-failed",message:b})})};j.bootstrapTable({striped:!0,sortName:"uri",pagination:!0,search:!0,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:h,idField:"uri",columns:[{field:"uri",title:RDFE.Utils.namingSchemaLabel("p",g.namingSchema),sortable:!0,sorter:d,formatter:c},{field:"count",title:"Count",align:"right","class":"small-column",formatter:e},{field:"actions",title:'<button class="add btn btn-default" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("p",g.namingSchema,!1,!0)+'"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,formatter:i,events:{"click .edit":function(a,b,c,d){g.editFct(c)},"click .remove":function(a,b,c,d){k(c)}}}]}),a(j).find(".add").on("click",function(a){g.editor.editPredicate()}),g.predicateTable=j,f&&f()},function(b){a(g).trigger("rdf-editor-error",{type:"predicate-list-failed",message:b})})},b.prototype.addPredicate=function(a){var b=this;_.find(b.predicates,function(b){return b.uri===a.uri})||(b.predicateTable.bootstrapTable("append",a),b.predicates.push(a))},b.prototype.updatePredicate=function(a){var b=this;b.doc.getPredicate(a,function(a){b.predicateTable.bootstrapTable("update",{field:"uri",data:a})})},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.ObjectEditor=function(){var b=function(a,b,c){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.object=c},c=function(a){return"Literal"==a.interfaceName?"http://www.w3.org/2001/XMLSchema#dateTime"==a.datatype?new Date(a.nominalValue).toString():a.nominalValue:a.toString()};return b.prototype.template=_.template('       <div class="panel panel-default">         <div class="panel-heading clearfix">           <div class="form-group">             <div class="col-sm-1">               <label for="object" class="control-label pull-right" style="padding-top: 5px"><%= RDFE.Utils.namingSchemaLabel("o", this.namingSchema) %> </label>             </div>             <div class="col-sm-10">               <input name="object" class="form-control" />             </div>             <div class="col-sm-1">               <button type="button" class="btn btn-default btn-sm pull-right" id="backButton">Back</button>             </div>           </div>         </div>         <div class="panel-body" id="objectTable">         </div>         <div class="panel-body" id="objectForm" style="display: none;">       </div>'),b.prototype.render=function(b,d,e,f){var g=this,h=function(d,f){j.bootstrapTable({striped:!0,sortName:"subject",pagination:!0,search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:[],dataSetter:i,columns:[{field:"subject",title:RDFE.Utils.namingSchemaLabel("s",g.namingSchema),aligh:"left",sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"},value:a.subject}},formatter:c},{field:"predicate",title:RDFE.Utils.namingSchemaLabel("p",g.namingSchema),align:"left",sortable:!0,editable:function(a){return{mode:"inline",type:"rdfnode",rdfnode:{type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"},value:a.predicate}},formatter:c},{field:"actions",title:'<button class="add btn btn-default" title="Add Relation" style="display: none;"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,editable:!1,formatter:function(a,b,c){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(b,c,d,e){g.doc.deleteTriple(d,function(){j.bootstrapTable("remove",{field:"id",values:[d.id]})},function(){a(g).trigger("rdf-editor-error",{type:"triple-delete-failed",message:"Failed to delete triple."})})}}}]}),g.objectView=b.objectView,g.objectTable=j,g.objectTableContainer=d.find("#objectTable"),g.objectFormContainer=d.find("#objectForm"),g.addButton=a(j).find(".add"),g.addButton.click(function(){g.createNewRelationEditor()}),g.renderData(),e&&g.createNewRelationEditor()},i=function(b,c,d){var e=d;"subject"===c?e=g.doc.store.rdf.createNamedNode(d):"predicate"===c&&(e=g.doc.store.rdf.createNamedNode(d));var f=g.doc.store.rdf.createTriple(b.subject,b.object,b.object);f[c]=e,g.doc.updateTriple(b,f,function(a){},function(b){a(g).trigger("rdf-editor-error",{message:"Failed to update triple in document: "+b})})};d.empty(),d.append(g.template(g.object));var j=a(document.createElement("table")).addClass("table");d.find("#objectTable").append(j);var k=d.find("button#backButton");k.click(function(){g.objectView.removeObject(g.object),f()});var l=d.find('input[name="object"]').rdfNodeEditor(g.doc.config.options);g.object&&l.setValue(g.object.object),a(l).on("changed",function(a,b){var c=b.getValue();if(c.value){"uri"==c.type&&(c.value=g.ontologyManager.uriDenormalize(c.value));var d=c.toStoreNode(g.doc.store);g.doc.getObject(d,function(a){g.objectView.removeObject(g.object),g.objectView.addObject(a),g.object=a,g.renderData()})}}),h(d,f)},b.prototype.renderData=function(){for(var a=this,b=a.object?a.object.items:[],c=0;c<b.length;c++)b[c].id=c;a.objectTable.data("maxindex",c),a.objectTable.bootstrapTable("load",b),a.object?a.addButton.show():a.addButton.hide()},b.prototype.addTriple=function(b){var c=this,d=c.objectTable.data("maxindex");c.objectTable.bootstrapTable("append",a.extend(b,{id:d})),c.objectTable.data("maxindex",++d),c.objectView.updateObject(c.object.object)},b.prototype.createNewRelationEditor=function(){var b=this;b.objectTableContainer.hide(),b.objectFormContainer.html('<div class="panel panel-default">   <div class="panel-heading"><h3 class="panel-title">Add Relation</h3></div>   <div class="panel-body">     <form class="form-horizontal">       <div class="form-group">         <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",b.namingSchema)+'</label>         <div class="col-sm-10"><input name="subject" class="form-control" /></div>       </div>       <div class="form-group">         <label for="predicate" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("p",b.namingSchema)+'</label>         <div class="col-sm-10"><select name="predicate" class="form-control"></select></div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <button type="button" class="btn btn-default object-action object-action-new-cancel">Cancel</button>           <button type="button" class="btn btn-primary object-action object-action-new-save">OK</button>         </div>       </div>     </form>   </div> </div>').show(),b.predicateEditor=b.objectFormContainer.find('select[name="predicate"]').propertyBox({ontoManager:b.ontologyManager}),b.objectFormContainer.find("button.object-action-new-cancel").click(function(a){b.objectFormContainer.hide(),b.objectTableContainer.show()}),b.objectFormContainer.find("button.object-action-new-save").click(function(c){var d=b.objectFormContainer.find('input[name="subject"]').val();
d=RDFE.Utils.trim(RDFE.Utils.trim(d,"<"),">");var e=b.predicateEditor.selectedURI();e=RDFE.Utils.trim(RDFE.Utils.trim(e,"<"),">");var f=b.doc.store.rdf.createTriple(b.doc.store.rdf.createNamedNode(d),b.doc.store.rdf.createNamedNode(e),b.object.object);b.doc.addTriples([f],function(){b.addTriple(f),a(b).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully added new statement."}),b.objectFormContainer.hide(),b.objectTableContainer.show()},function(){a(b).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new statement to store."})})})},b}()}(jQuery),function(a){window.RDFE||(window.RDFE={}),RDFE.ObjectView=function(){var b=function(a,b,c,d){this.doc=a,this.namingSchema=a.config.options[a.config.options.namingSchema],this.ontologyManager=b,this.editor=c,this.editFct=d.editFct},c=function(a,b,c){return b.label},d=function(a,b,c){return b.type},e=function(a,b,c){return b.items.length};return b.prototype.render=function(b,f){var g=this;g.doc.listObjects(function(h){var i=function(a,b,c){return['<a class="edit ml10" href="javascript:void(0)" title="Edit or add a new '+RDFE.Utils.namingSchemaLabel("s",g.namingSchema,!1,!0)+" and "+RDFE.Utils.namingSchemaLabel("p",g.namingSchema,!1,!0)+" pairs associated with this "+RDFE.Utils.namingSchemaLabel("o",g.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove all '+RDFE.Utils.namingSchemaLabel("spo",g.namingSchema,!0,!0)+" associated with this "+RDFE.Utils.namingSchemaLabel("o",g.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")};g.objects=h,g.objectsTable=null,b.empty();var j=a(document.createElement("table")).addClass("table");b.append(j);var k=function(b){g.doc.deleteObject(b.object,function(){j.bootstrapTable("remove",{field:"id",values:[b.id]}),a(g).trigger("rdf-editor-success",{type:"object-delete-done",uri:b.id,message:"Successfully deleted attribute "+b.id+"."})},function(b){a(g).trigger("rdf-editor-error",{type:"object-delete-failed",message:b})})};j.bootstrapTable({striped:!0,sortName:"label",pagination:!0,search:!0,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:h,idField:"id",columns:[{field:"label",title:RDFE.Utils.namingSchemaLabel("o",g.namingSchema),sortable:!0,formatter:c},{field:"type",title:"Type",sortable:!0,formatter:d},{field:"count",title:"Count",align:"right","class":"small-column",formatter:e},{field:"actions",title:'<button class="add btn btn-default" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("o",g.namingSchema,!1,!0)+'"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle","class":"small-column",clickToSelect:!1,formatter:i,events:{"click .edit":function(a,b,c,d){g.editFct(c)},"click .remove":function(a,b,c,d){k(c)}}}]}),a(j).find(".add").on("click",function(a){g.editor.editObject()}),g.objectsTable=j,f&&f()},function(b){a(g).trigger("rdf-editor-error",{type:"object-list-failed",message:b})})},b.prototype.addObject=function(a){var b=this;_.find(b.objects,function(b){return b.id===a.id})||(b.objectsTable.bootstrapTable("append",a),b.objects.push(a))},b.prototype.updateObject=function(a){var b=this;b.doc.getObject(a,function(a){b.objectsTable.bootstrapTable("update",{field:"id",data:a})})},b.prototype.removeObject=function(a){var b=this;a&&0===a.items.length&&b.objectsTable.bootstrapTable("remove",{field:"id",values:[a.id]})},b}()}(jQuery),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0==this.indexOf(a)}),window.RDFE||(window.RDFE={}),RDFE.Editor=function(a,b,c){var d=this,c=$.extend({initOntologyManager:!0},c);d.ontologyManager=new RDFE.OntologyManager(a.options),c.initOntologyManager===!0&&d.ontologyManager.init(),d.doc=new RDFE.Document(d.ontologyManager,a,b),d.config=a,d.namingSchema=a.options[a.options.namingSchema],$(d.doc).on("docChanged",function(a,b){d.docChanged()})},RDFE.Editor.prototype.render=function(a){this.container=a,this.container.empty(),this.listContainer=$(document.createElement("div")).appendTo(this.container),this.formContainer=$(document.createElement("div")).appendTo(this.container),this.toggleView(this.config.options.defaultView)},RDFE.Editor.prototype.docChanged=function(){var a=this;a.doc.store.graph(a.doc.graph,function(a,b){var c="<![CDATA["+b.toNT()+"]]>";$("body").find('script[type="text/turtle"][id="document"]').text(c)})},RDFE.Editor.prototype.currentView=function(){return this._currentView},RDFE.Editor.prototype.toggleView=function(a){a!==this._currentView&&("entities"===a?(this.config.options.useEntityEditor===!0?this.createEntityList():this.createSubjectList(),this._currentView="entities"):"predicates"===a?(this.createPredicateList(),this._currentView="predicates"):"values"===a?(this.createObjectList(),this._currentView="values"):(this.createTripleList(),this._currentView="triples"))},RDFE.Editor.prototype.updateView=function(){var a=this;"entities"===a._currentView?a.config.options.useEntityEditor===!0?a.createEntityList():a.createSubjectList():"predicates"===a._currentView?a.createPredicateList():"values"===a._currentView?a.createObjectList():a.createTripleList()},RDFE.Editor.prototype.createTripleList=function(){var a=this;$(a).trigger("rdf-editor-start",{id:"render-triple-list",message:"Loading Triples..."}),a.tripleView||(a.tripleView=new RDFE.TripleView(a.doc,a.ontologyManager,a),$(a.tripleView).on("rdf-editor-error",function(b,c){$(a).trigger("rdf-editor-error",c)}).on("rdf-editor-success",function(b,c){$(a).trigger("rdf-editor-success",c)})),a.formContainer.hide(),a.listContainer.empty().show(),a.tripleView.render(a.listContainer,function(){$(a).trigger("rdf-editor-done",{id:"render-triple-list"})})},RDFE.Editor.prototype.editTriple=function(a,b,c){var d=this;if(!d.doc)return!1;d.listContainer.hide(),d.formContainer.html('<div class="panel panel-default">  <div class="panel-heading"><h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("spo",d.namingSchema)+'</h3></div>  <div class="panel-body">    <form class="form-horizontal">      <div class="form-group"><label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",d.namingSchema)+'</label>        <div class="col-sm-10"><input name="subject" class="form-control" /></div>      </div>      <div class="form-group"><label for="predicate" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("p",d.namingSchema)+'</label>        <div class="col-sm-10"><select name="predicate" class="form-control"></select></div>      </div>      <div class="form-group"><label for="object" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("o",d.namingSchema)+'</label>        <div class="col-sm-10"><input name="object" class="form-control" /></div>      </div>      <div class="form-group">        <div class="col-sm-10 col-sm-offset-2">          <a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a>          <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a>        </div>      </div>    </form>  </div></div>').show(),a&&d.formContainer.find('input[name="subject"]').val(a);var e=d.formContainer.find('input[name="object"]').rdfNodeEditor(d.config.options);c&&e.setValue(new RDFE.RdfNode("literal",c,null,""));var f=d.formContainer.find('select[name="predicate"]').propertyBox({ontoManager:d.ontologyManager}).on("changed",function(a,b){var c,f,g=e.getValue(),h=b?b.getRange():null;e.isLiteralType(h)?c=new RDFE.RdfNode("literal",g.value,h,g.language):d.ontologyManager.ontologyClassByURI(h)?(c=new RDFE.RdfNode("uri",RDFE.Utils.trim(RDFE.Utils.trim(g.value,"<"),">")),f=d.doc.itemsByRange(h)):c=new RDFE.RdfNode("literal",g.value,null,""),e.setValue(c,f)});b&&f.setPropertyURI(b),d.formContainer.find("a.triple-action-new-cancel").click(function(a){a.preventDefault(),d.createTripleList()}),d.formContainer.find("a.triple-action-new-save").click(function(a){a.preventDefault();var b=d.formContainer.find('input[name="subject"]').val();b=RDFE.Utils.trim(RDFE.Utils.trim(b,"<"),">");var c=f.selectedURI();c=RDFE.Utils.trim(RDFE.Utils.trim(c,"<"),">");var g=e.getValue();"uri"==g.type&&(g.value=d.ontologyManager.uriDenormalize(g.value));var h=d.doc.store.rdf.createTriple(d.doc.store.rdf.createNamedNode(b),d.doc.store.rdf.createNamedNode(c),g.toStoreNode(d.doc.store));d.doc.addTriples([h],function(){d.tripleView&&d.tripleView.addTriple(h),$(d).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully added new triple."}),d.createTripleList()},function(){$(d).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new triple to store."})})})},RDFE.Editor.prototype.createNewEntityEditor=function(a){var b,c,d,e=this,f=function(a){var b=e.ontologyManager.ontologyByURI(a.currentTarget.selectedOntologyURI());d.clearOptions(),d.addOption(b?b.classesAsArray():e.ontologyManager.allClasses())};if(!e.doc)return!1;if(e.listContainer.hide(),e.formContainer.show(),a){var g=e.ontologyManager.ontologyClassByURI(a),h=g?g.label:RDFE.Utils.uri2name(a);e.formContainer.html('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("s",e.namingSchema)+'</h3></div><div class="panel-body"><div class="form-horizontal">   <div class="form-group">     <label for="class" class="col-sm-2 control-label">Type</label>     <div class="col-sm-10">       <p class="form-control-static" title="'+a+'">'+h+'</p>    </div>   </div>   <div class="form-group">      <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",e.namingSchema)+' URI</label>      <div class="col-sm-10">        <input name="subject" id="subject" class="form-control" />      </div>   </div>   <div class="form-group">     <div class="col-sm-10 col-sm-offset-2">       <a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a>       <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a>     </div>   </div> </div></div></div>\n'),e.formContainer.find("input#subject").focus()}else e.formContainer.html('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("s",e.namingSchema)+'</h3></div><div class="panel-body"><div class="form-horizontal">   <div class="form-group">     <label for="ontology" class="col-sm-2 control-label">Ontology</label>     <div class="col-sm-10">       <select name="ontology" id="ontology" class="form-control" />     </div>   </div>   <div class="form-group">     <label for="class" class="col-sm-2 control-label">Type</label>     <div class="col-sm-10">       <select name="class" id="class" class="form-control" />     </div>   </div>   <div class="form-group">      <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",e.namingSchema)+' URI</label>      <div class="col-sm-10">        <input name="subject" id="subject" class="form-control" />      </div>   </div>   <div class="form-group">     <div class="col-sm-10 col-sm-offset-2">       <a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a>       <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a>     </div>   </div> </div></div></div>\n'),b=$("#ontology").ontoBox({ontoManager:e.ontologyManager}),b.on("changed",f),b.sel.focus(),c=$("#class").selectize({create:!0,valueField:"URI",labelField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:e.ontologyManager.allClasses(),create:function(a,b){b(e.ontologyManager.ontologyClassByURI(e.ontologyManager.uriDenormalize(a),!0))},render:{item:function(a,b){var c=a.title||a.label||name.curi||a.name;return c=a.curi&&a.curi!=c?b(c)+" <small>("+b(a.curi)+")</small>":b(c),"<div>"+c+"</div>"},option:function(a,b){return"<div>"+b(a.title||a.label||name.curi||a.name)+"<br/><small>("+b(a.URI)+")</small></div>"},option_create:function(a,b){var c=e.ontologyManager.uriDenormalize(a.input);return c!=a.input?'<div class="create">Add <strong>'+b(a.input)+"</strong> <small>("+b(c)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+b(c)+"</strong>&hellip;</div>"}}}),d=c[0].selectize;e.config.options.entityUriTmpl&&e.formContainer.find('label[for="subject"]').text(RDFE.Utils.namingSchemaLabel("s",e.namingSchema)+" Name"),e.formContainer.find("a.triple-action-new-cancel").click(function(a){a.preventDefault(),e.listContainer.show(),e.formContainer.hide()});var i=function(){var b=e.formContainer.find('input[name="subject"]').val(),c=null,d=a||e.formContainer.find("#class")[0].selectize.getValue();b=RDFE.Utils.trim(RDFE.Utils.trim(b,"<"),">"),e.config.options.entityUriTmpl&&(c=b,b=null),e.doc.addEntity(b,c,d,function(a){e.entityView&&e.entityView.addEntity(a),$(e).trigger("rdf-editor-success",{type:"entity-insert-success",message:"Successfully created new entity."}),e.editEntity(a.uri)},function(){$(e).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new triple to store."})})};e.formContainer.find("a.triple-action-new-save").click(function(a){a.preventDefault(),i()}),e.formContainer.find("input#subject").keypress(function(a){13===a.which&&i()})},RDFE.Editor.prototype.createEntityList=function(){var a=this;$(a).trigger("rdf-editor-start",{id:"render-entity-list",message:"Loading Entities..."}),a.entityView||(a.entityView=new RDFE.EntityView(a.doc,a.ontologyManager,a,{editFct:function(b){a.editEntity.call(a,b)}}),$(a.entityView).on("rdf-editor-error",function(b){$(a).trigger("rdf-editor-error",d)}).on("rdf-editor-success",function(b,c){$(a).trigger("rdf-editor-success",c)})),a.formContainer.hide(),a.listContainer.empty().show(),a.entityView.render(a.listContainer,function(){$(a).trigger("rdf-editor-done",{id:"render-entity-list"})})},RDFE.Editor.prototype.editEntity=function(a){var b=this;b.entityEditor||(b.entityEditor=new RDFE.EntityEditor(b.doc,b.ontologyManager),$(b.entityEditor).on("rdf-editor-error",function(a){$(b).trigger("rdf-editor-error",d)}).on("rdf-editor-success",function(a,c){$(b).trigger("rdf-editor-success",c)})),b.listContainer.hide(),b.formContainer.show(),b.entityEditor.render(b.formContainer,a,function(){b.formContainer.hide(),b.listContainer.show(),b.entityView.updateEntity(a)})},RDFE.Editor.prototype.createSubjectList=function(){var a=this;$(a).trigger("rdf-editor-start",{id:"render-entity-list",message:"Loading Subjects..."}),a.subjectView||(a.subjectView=new RDFE.SubjectView(a.doc,a.ontologyManager,a,{editFct:function(b){a.editSubject.call(a,b)}}),$(a.subjectView).on("rdf-editor-error",function(b){$(a).trigger("rdf-editor-error",d)}).on("rdf-editor-success",function(b,c){$(a).trigger("rdf-editor-success",c)})),a.formContainer.hide(),a.listContainer.empty().show(),a.subjectView.render(a.listContainer,function(){$(a).trigger("rdf-editor-done",{id:"render-subject-list"})})},RDFE.Editor.prototype.editSubject=function(a,b){var c=this;c.subjectEditor||(c.subjectEditor=new RDFE.SubjectEditor(c.doc,c.ontologyManager),$(c.subjectEditor).on("rdf-editor-error",function(a){$(c).trigger("rdf-editor-error",d)}).on("rdf-editor-success",function(a,b){$(c).trigger("rdf-editor-success",b)})),"string"==typeof a&&(a=c.doc.newSubject(a)),c.listContainer.hide(),c.formContainer.show(),c.subjectEditor.subject=a,c.subjectEditor.render(c,c.formContainer,b,function(){c.formContainer.hide(),c.listContainer.show(),a&&a.uri&&c.subjectView.updateSubject(a.uri)})},RDFE.Editor.prototype.createPredicateList=function(){var a=this;$(a).trigger("rdf-editor-start",{id:"render-entity-list",message:"Loading Predicates..."}),a.predicateView||(a.predicateView=new RDFE.PredicateView(a.doc,a.ontologyManager,a,{editFct:function(b){a.editPredicate.call(a,b)}}),$(a.predicateView).on("rdf-editor-error",function(b,c){$(a).trigger("rdf-editor-error",c)}).on("rdf-editor-success",function(b,c){$(a).trigger("rdf-editor-success",c)})),a.formContainer.hide(),a.listContainer.empty().show(),a.predicateView.render(a.listContainer,function(){$(a).trigger("rdf-editor-done",{id:"render-predicate-list"})})},RDFE.Editor.prototype.editPredicate=function(a,b){var c=this;c.predicateEditor||(c.predicateEditor=new RDFE.PredicateEditor(c.doc,c.ontologyManager),$(c.predicateEditor).on("rdf-editor-error",function(a,b){$(c).trigger("rdf-editor-error",b)}).on("rdf-editor-success",function(a,b){$(c).trigger("rdf-editor-success",b)})),c.listContainer.hide(),c.formContainer.show(),"string"==typeof a&&(a=c.doc.newPredicate(a)),a&&c.ontologyManager.ontologyPropertyByURI(a.uri,!0),c.predicateEditor.predicate=a,c.predicateEditor.render(c,c.formContainer,b,function(){c.formContainer.hide(),c.listContainer.show(),a&&a.uri&&c.predicateView.updatePredicate(a.uri)})},RDFE.Editor.prototype.createObjectList=function(){var a=this;$(a).trigger("rdf-editor-start",{id:"render-entity-list",message:"Loading Objects..."}),a.objectView||(a.objectView=new RDFE.ObjectView(a.doc,a.ontologyManager,a,{editFct:function(b){a.editObject.call(a,b)}}),$(a.objectView).on("rdf-editor-error",function(b,c){$(a).trigger("rdf-editor-error",c)}).on("rdf-editor-success",function(b,c){$(a).trigger("rdf-editor-success",c)})),a.formContainer.hide(),a.listContainer.empty().show(),a.objectView.render(a.listContainer,function(){$(a).trigger("rdf-editor-done",{id:"render-predicate-list"})})},RDFE.Editor.prototype.editObject=function(a,b){var c=this;c.objectEditor||(c.objectEditor=new RDFE.ObjectEditor(c.doc,c.ontologyManager),$(c.objectEditor).on("rdf-editor-error",function(a,b){$(c).trigger("rdf-editor-error",b)}).on("rdf-editor-success",function(a,b){$(c).trigger("rdf-editor-success",b)})),"string"==typeof a&&(a=c.doc.newObject(a)),c.listContainer.hide(),c.formContainer.show(),c.objectEditor.object=a,c.objectEditor.render(c,c.formContainer,b,function(){c.formContainer.hide(),c.listContainer.show(),a&&c.objectView.updateObject(a)})},function(a){window.RDFE||(window.RDFE={}),RDFE.OntologyView=function(){var b=function(b,c){c=a.extend({},c),this.ontologyManager=b,this.ontologies=this.ontologyManager.allOntologies()};return b.prototype.render=function(b){var c=this;a(c.ontologyManager).on("changed",function(a,b){c.addOntologies(b.allOntologies())}),c.table=null,c.tableContainer=null,c.formContainer=null,b.empty();var d=a(document.createElement("div"));b.append(d);var e=a(document.createElement("table")).addClass("table");d.append(e);var f=a(document.createElement("div"));b.append(f);var g=function(b,d,e){e=a.trim(e),b.prefix!==e&&(delete c.ontologyManager.prefixes[b.prefix],delete RDFE.prefixes[b.prefix],b.prefix=e,c.ontologyManager.prefixes[b.prefix]=b.URI,RDFE.prefixes[b.prefix]=b.URI)},h=c.ontologyManager.allOntologies();e.bootstrapTable({striped:!0,sortName:"prefix",showHeader:!1,classes:"table-hover table-condensed",height:157,data:h,idField:"uri",dataSetter:g,columns:[{field:"prefix",title:"Prefix",editable:function(b){return{mode:"inline",type:"text",value:b.prefix,emptytext:"empty",validate:function(b){var d=a.trim(b);return""==d?"This field is required":c.ontologyManager.ontologyByPrefix(d)?"This prefix is used":void 0}}},formatter:function(a,b,c){return b.prefix?b.prefix:""}},{field:"uri",title:"URI",formatter:function(a,b,c){return['<span title="Ontology {0} - {1} classes, {2} properties">'.format(b.URI,b.classesLength(),b.propertiesLength()),"{0} - {1}/{2}".format(b.URI,b.classesLength(),b.propertiesLength()),"</span>"].join("")}},{field:"actions",title:"",align:"center",valign:"middle",clickToSelect:!1,formatter:function(a,b,c){return['<a class="refresh ml10" href="javascript:void(0)" title="Refresh ontology">','  <i class="glyphicon glyphicon-refresh"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove ontology">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .refresh":function(b,d,e,f){var g=a("#ontology-loading");if(!g.is(":visible")){g.show();var h={success:function(){a(c.ontologyManager).trigger("loadingFinished",[c.ontologyManager]),g.hide()},error:function(b){a(c.ontologyManager).trigger("loadingFailed",[c.ontologyManager]),a.growl({message:b.message},{type:"danger"}),g.hide()},ioType:"http"};c.ontologyManager.parseOntologyFile(e.URI,h)}},"click .remove":function(a,b,d,e){c.ontologyManager.ontologyRemove(d.URI),c.table.bootstrapTable("remove",{field:"URI",values:[d.URI]})}}}]}),c.table=e,c.tableContainer=d,c.formContainer=f,f.html('<div class="panel panel-default" style="border: 0; padding: 0; margin-bottom: 0;">   <div class="panel-body" style="padding-top: 10px; padding-bottom: 0;"><div class="form-horizontal">     <div class="form-group">       <label for="ontology" class="col-sm-2 control-label">Prefix</label>       <div class="col-sm-10">         <input name="prefix" id="prefix" class="form-control" />       </div>     </div>     <div class="form-group">       <label for="class" class="col-sm-2 control-label">URI</label>       <div class="col-sm-10">         <input name="uri" id="uri" class="form-control" />       </div>     </div>     <div class="form-group">       <div class="col-sm-10 col-sm-offset-2">         <a href="#" class="btn btn-default cancel">Cancel</a>         <a href="#" class="btn btn-primary ok">OK</a>       </div>     </div>   </div> </div>\n'),f.find(".cancel").click(function(b){b.preventDefault();var d=a("#ontology-loading");d.is(":visible")||(c.formContainer.hide(),c.tableContainer.show())}),f.find(".ok").click(function(b){b.preventDefault();var d=a("#ontology-loading");if(!d.is(":visible")){var e=function(){c.formContainer.hide(),c.tableContainer.show(),d.hide()},f={success:function(){a(c.ontologyManager).trigger("loadingFinished",[c.ontologyManager]),e()},error:function(b){a(c.ontologyManager).trigger("loadingFailed",[c.ontologyManager]);var d=b&&b.message?b.message:"Error loading ontology";bootbox.confirm(d+". Do you want an empty ontology to be added?",function(a){if(a){var b=c.formContainer.find("#uri").val(),d=c.ontologyManager.ontologyByURI(b);if(!d){d=new RDFE.Ontology(c.ontologyManager,b);var e=c.formContainer.find("#prefix").val();e&&(d.prefix=e),c.addOntologies(c.ontologyManager.allOntologies())}}}),e()}},g=c.formContainer.find("#uri").val(),h=c.ontologyManager.ontologyByURI(g);if(h)return void bootbox.alert("This ontology is loaded. Please, use 'Refresh' action!");if(d.show(),!c.ontologyManager.prefixByOntology(g)){var i=c.formContainer.find("#prefix").val();c.ontologyManager.prefixes[i]=g}c.ontologyManager.parseOntologyFile(c.formContainer.find("#uri").val(),f)}}),f.find("#prefix").blur(function(a){var b=RDFE.ontologyByPrefix(c.formContainer.find("#prefix").val());b&&c.formContainer.find("#uri").val(b)}),f.hide()},b.prototype.addOntologies=function(a){for(var b=0;b<a.length;b++)_.find(self.ontologies,function(c){return c.URI===a[b].URI})||this.table.bootstrapTable("append",a[b]);self.ontologies=a},b.prototype.editor=function(a){var b=this;b.formContainer.find("#prefix").val(""),b.formContainer.find("#uri").val(""),b.tableContainer.hide(),b.formContainer.show()},b}()}(jQuery),function(a){VAL=function(a){this.config=jQuery.extend({host:"http://linkeddata.uriburner.com",valApi:"/val/api",loginLink:"/val/authenticate.vsp",logoutLink:"/val/logout.vsp"},a)},VAL.prototype.installed=function(b){a.get(this.config.host+this.config.logoutLink).done(function(){b(!0)}).fail(function(){b(!1)})},VAL.prototype.profile=function(b){var c=this;a.get(this.config.host+this.config.valApi+"/profile").done(function(a){c.config.valInstalled=!1;var d=new rdfstore.Store;d.registerDefaultProfileNamespaces(),d.load("text/turtle",a,function(a,e){c.config.valInstalled=!0,a?d.execute("select ?uri ?name ?img ?nick where { [] foaf:topic ?uri . ?uri a foaf:Agent . optional { ?uri foaf:name ?name . } . optional { ?uri foaf:nick ?nick . } . optional { ?uri foaf:img ?img . } . }",function(a,e){if(console.log(e),a&&e.length>0){var f={uri:e[0].uri.value};e[0].name&&(f.name=e[0].name.value),e[0].img&&(f.image=e[0].img.value),e[0].nick&&(f.nick=e[0].nick.value),d.execute("select ?storage where { <"+f.uri+"> <http://www.w3.org/ns/pim/space#storage> ?storage . }",function(a,e){if(a)for(var g=0;g<e.length;g++)e[g].storage&&(f.storage=f.storage||[]).push({uri:e[g].storage.value});d.execute("select ?namedGraph ?sparqlEndpoint where { <"+f.uri+"> <http://www.openlinksw.com/schemas/cert#hasDBStorage> ?namedGraph . ?namedGraph <http://rdfs.org/ns/void#sparqlEndpoint> ?sparqlEndpoint . }",function(a,d){if(a)for(var e=0;e<d.length;e++)d[e].namedGraph&&d[e].sparqlEndpoint&&(f.storage=f.storage||[]).push({uri:d[e].namedGraph.value,sparqlEndpoint:d[e].sparqlEndpoint.value});c.profileData=f,b(!0,f)})})}else b(!1,"Failed to query the user profile.")}):b(!1,"Failed to load the profile contents.")})}).fail(function(a,d,e){c.config.valInstalled=404!==a.status,b(!1)})}}(jQuery),function(){"use strict";function a(){var a=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(b){}if(a)try{window.localStorage&&(v=window.localStorage,y="localStorage",B=v.jStorage_update)}catch(e){}else if("globalStorage"in window)try{window.globalStorage&&(v="localhost"==window.location.hostname?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],y="globalStorage",B=v.jStorage_update)}catch(f){}else{if(w=document.createElement("link"),!w.addBehavior)return void(w=null);w.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(w);try{w.load("jStorage")}catch(g){w.setAttribute("jStorage","{}"),w.save("jStorage"),w.load("jStorage")}var i="{}";try{i=w.getAttribute("jStorage")}catch(j){}try{B=w.getAttribute("jStorage_update")}catch(m){}v.jStorage=i,y="userDataBehavior"}h(),k(),c(),l(),"addEventListener"in window&&window.addEventListener("pageshow",function(a){a.persisted&&d()},!1)}function b(){var a="{}";if("userDataBehavior"==y){w.load("jStorage");try{a=w.getAttribute("jStorage")}catch(b){}try{B=w.getAttribute("jStorage_update")}catch(c){}v.jStorage=a}h(),k(),l()}function c(){"localStorage"==y||"globalStorage"==y?"addEventListener"in window?window.addEventListener("storage",d,!1):document.attachEvent("onstorage",d):"userDataBehavior"==y&&setInterval(d,1e3)}function d(){var a;clearTimeout(A),A=setTimeout(function(){if("localStorage"==y||"globalStorage"==y)a=v.jStorage_update;else if("userDataBehavior"==y){w.load("jStorage");try{a=w.getAttribute("jStorage_update")}catch(b){}}a&&a!=B&&(B=a,e())},25)}function e(){var a,c=s.parse(s.stringify(u.__jstorage_meta.CRC32));b(),a=s.parse(s.stringify(u.__jstorage_meta.CRC32));var d,e=[],g=[];for(d in c)if(c.hasOwnProperty(d)){if(!a[d]){g.push(d);continue}c[d]!=a[d]&&"2."==String(c[d]).substr(0,2)&&e.push(d)}for(d in a)a.hasOwnProperty(d)&&(c[d]||e.push(d));f(e,"updated"),f(g,"deleted")}function f(a,b){a=[].concat(a||[]);var c,d,e,f;if("flushed"==b){a=[];for(var g in z)z.hasOwnProperty(g)&&a.push(g);b="deleted"}for(c=0,e=a.length;e>c;c++){if(z[a[c]])for(d=0,f=z[a[c]].length;f>d;d++)z[a[c]][d](a[c],b);if(z["*"])for(d=0,f=z["*"].length;f>d;d++)z["*"][d](a[c],b)}}function g(){var a=(+new Date).toString();if("localStorage"==y||"globalStorage"==y)try{v.jStorage_update=a}catch(b){y=!1}else"userDataBehavior"==y&&(w.setAttribute("jStorage_update",a),w.save("jStorage"));d()}function h(){if(v.jStorage)try{u=s.parse(String(v.jStorage))}catch(a){v.jStorage="{}"}else v.jStorage="{}";x=v.jStorage?String(v.jStorage).length:0,u.__jstorage_meta||(u.__jstorage_meta={}),u.__jstorage_meta.CRC32||(u.__jstorage_meta.CRC32={})}function i(){n();try{v.jStorage=s.stringify(u),w&&(w.setAttribute("jStorage",v.jStorage),w.save("jStorage")),x=v.jStorage?String(v.jStorage).length:0}catch(a){}}function j(a){if("string"!=typeof a&&"number"!=typeof a)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==a)throw new TypeError("Reserved key name");return!0}function k(){var a,b,c,d,e=1/0,h=!1,j=[];if(clearTimeout(t),u.__jstorage_meta&&"object"==typeof u.__jstorage_meta.TTL){a=+new Date,c=u.__jstorage_meta.TTL,d=u.__jstorage_meta.CRC32;for(b in c)c.hasOwnProperty(b)&&(c[b]<=a?(delete c[b],delete d[b],delete u[b],h=!0,j.push(b)):c[b]<e&&(e=c[b]));e!=1/0&&(t=setTimeout(k,Math.min(e-a,2147483647))),h&&(i(),g(),f(j,"deleted"))}}function l(){var a,b;if(u.__jstorage_meta.PubSub){var c,d=D,e=[];for(a=b=u.__jstorage_meta.PubSub.length-1;a>=0;a--)c=u.__jstorage_meta.PubSub[a],c[0]>D&&(d=c[0],e.unshift(c));for(a=e.length-1;a>=0;a--)m(e[a][1],e[a][2]);D=d}}function m(a,b){if(C[a])for(var c=0,d=C[a].length;d>c;c++)try{C[a][c](a,s.parse(s.stringify(b)))}catch(e){}}function n(){if(u.__jstorage_meta.PubSub){for(var a=+new Date-2e3,b=0,c=u.__jstorage_meta.PubSub.length;c>b;b++)if(u.__jstorage_meta.PubSub[b][0]<=a){u.__jstorage_meta.PubSub.splice(b,u.__jstorage_meta.PubSub.length-b);break}u.__jstorage_meta.PubSub.length||delete u.__jstorage_meta.PubSub}}function o(a,b){u.__jstorage_meta||(u.__jstorage_meta={}),u.__jstorage_meta.PubSub||(u.__jstorage_meta.PubSub=[]),u.__jstorage_meta.PubSub.unshift([+new Date,a,b]),i(),g()}function p(a,b){for(var c,d=a.length,e=b^d,f=0;d>=4;)c=255&a.charCodeAt(f)|(255&a.charCodeAt(++f))<<8|(255&a.charCodeAt(++f))<<16|(255&a.charCodeAt(++f))<<24,c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16),c^=c>>>24,c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16),e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16)^c,d-=4,++f;switch(d){case 3:e^=(255&a.charCodeAt(f+2))<<16;case 2:e^=(255&a.charCodeAt(f+1))<<8;case 1:e^=255&a.charCodeAt(f),e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16)}return e^=e>>>13,e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16),e^=e>>>15,e>>>0}var q="0.4.12",r=window.jQuery||window.$||(window.$={}),s={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(a){return String(a).evalJSON()}||r.parseJSON||r.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||r.toJSON};if("function"!=typeof s.parse||"function"!=typeof s.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var t,u={__jstorage_meta:{CRC32:{}}},v={jStorage:"{}"},w=null,x=0,y=!1,z={},A=!1,B=0,C={},D=+new Date,E={isXML:function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?"HTML"!==b.nodeName:!1},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(c){}}return!1},decode:function(a){var b,c="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b};return c?(b=c.call("DOMParser"in window&&new DOMParser||window,a,"text/xml"),this.isXML(b)?b:!1):!1}};r.jStorage={version:q,set:function(a,b,c){if(j(a),c=c||{},"undefined"==typeof b)return this.deleteKey(a),b;if(E.isXML(b))b={_is_xml:!0,xml:E.encode(b)};else{if("function"==typeof b)return void 0;b&&"object"==typeof b&&(b=s.parse(s.stringify(b)))}return u[a]=b,u.__jstorage_meta.CRC32[a]="2."+p(s.stringify(b),2538058380),this.setTTL(a,c.TTL||0),f(a,"updated"),b},get:function(a,b){return j(a),a in u?u[a]&&"object"==typeof u[a]&&u[a]._is_xml?E.decode(u[a].xml):u[a]:"undefined"==typeof b?null:b},deleteKey:function(a){return j(a),a in u?(delete u[a],"object"==typeof u.__jstorage_meta.TTL&&a in u.__jstorage_meta.TTL&&delete u.__jstorage_meta.TTL[a],delete u.__jstorage_meta.CRC32[a],i(),g(),f(a,"deleted"),!0):!1},setTTL:function(a,b){var c=+new Date;return j(a),b=Number(b)||0,a in u?(u.__jstorage_meta.TTL||(u.__jstorage_meta.TTL={}),b>0?u.__jstorage_meta.TTL[a]=c+b:delete u.__jstorage_meta.TTL[a],i(),k(),g(),!0):!1},getTTL:function(a){var b,c=+new Date;return j(a),a in u&&u.__jstorage_meta.TTL&&u.__jstorage_meta.TTL[a]?(b=u.__jstorage_meta.TTL[a]-c,
b||0):0},flush:function(){return u={__jstorage_meta:{CRC32:{}}},i(),g(),f(null,"flushed"),!0},storageObj:function(){function a(){}return a.prototype=u,new a},index:function(){var a,b=[];for(a in u)u.hasOwnProperty(a)&&"__jstorage_meta"!=a&&b.push(a);return b},storageSize:function(){return x},currentBackend:function(){return y},storageAvailable:function(){return!!y},listenKeyChange:function(a,b){j(a),z[a]||(z[a]=[]),z[a].push(b)},stopListening:function(a,b){if(j(a),z[a]){if(!b)return void delete z[a];for(var c=z[a].length-1;c>=0;c--)z[a][c]==b&&z[a].splice(c,1)}},subscribe:function(a,b){if(a=(a||"").toString(),!a)throw new TypeError("Channel not defined");C[a]||(C[a]=[]),C[a].push(b)},publish:function(a,b){if(a=(a||"").toString(),!a)throw new TypeError("Channel not defined");o(a,b)},reInit:function(){b()},noConflict:function(a){return delete window.$.jStorage,a&&(window.jStorage=this),this}},a()}(),!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):a.bootbox=b(a.jQuery)}(this,function a(b,c){"use strict";function d(a){var b=q[o.locale];return b?b[a]:q.en[a]}function e(a,c,d){a.stopPropagation(),a.preventDefault();var e=b.isFunction(d)&&d(a)===!1;e||c.modal("hide")}function f(a){var b,c=0;for(b in a)c++;return c}function g(a,c){var d=0;b.each(a,function(a,b){c(a,b,d++)})}function h(a){var c,d;if("object"!=typeof a)throw new Error("Please supply an object of options");if(!a.message)throw new Error("Please specify a message");return a=b.extend({},o,a),a.buttons||(a.buttons={}),a.backdrop=a.backdrop?"static":!1,c=a.buttons,d=f(c),g(c,function(a,e,f){if(b.isFunction(e)&&(e=c[a]={callback:e}),"object"!==b.type(e))throw new Error("button with key "+a+" must be an object");e.label||(e.label=a),e.className||(e.className=2>=d&&f===d-1?"btn-primary":"btn-default")}),a}function i(a,b){var c=a.length,d={};if(1>c||c>2)throw new Error("Invalid argument length");return 2===c||"string"==typeof a[0]?(d[b[0]]=a[0],d[b[1]]=a[1]):d=a[0],d}function j(a,c,d){return b.extend(!0,{},a,i(c,d))}function k(a,b,c,d){var e={className:"bootbox-"+a,buttons:l.apply(null,b)};return m(j(e,d,c),b)}function l(){for(var a={},b=0,c=arguments.length;c>b;b++){var e=arguments[b],f=e.toLowerCase(),g=e.toUpperCase();a[f]={label:d(g)}}return a}function m(a,b){var d={};return g(b,function(a,b){d[b]=!0}),g(a.buttons,function(a){if(d[a]===c)throw new Error("button key "+a+" is not allowed (options are "+b.join("\n")+")")}),a}var n={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},o={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0,container:"body"},p={};p.alert=function(){var a;if(a=k("alert",["ok"],["message","callback"],arguments),a.callback&&!b.isFunction(a.callback))throw new Error("alert requires callback property to be a function when provided");return a.buttons.ok.callback=a.onEscape=function(){return b.isFunction(a.callback)?a.callback():!0},p.dialog(a)},p.confirm=function(){var a;if(a=k("confirm",["cancel","confirm"],["message","callback"],arguments),a.buttons.cancel.callback=a.onEscape=function(){return a.callback(!1)},a.buttons.confirm.callback=function(){return a.callback(!0)},!b.isFunction(a.callback))throw new Error("confirm requires a callback");return p.dialog(a)},p.prompt=function(){var a,d,e,f,h,i,k;if(f=b(n.form),d={className:"bootbox-prompt",buttons:l("cancel","confirm"),value:"",inputType:"text"},a=m(j(d,arguments,["title","callback"]),["cancel","confirm"]),i=a.show===c?!0:a.show,a.message=f,a.buttons.cancel.callback=a.onEscape=function(){return a.callback(null)},a.buttons.confirm.callback=function(){var c;switch(a.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":c=h.val();break;case"checkbox":var d=h.find("input:checked");c=[],g(d,function(a,d){c.push(b(d).val())})}return a.callback(c)},a.show=!1,!a.title)throw new Error("prompt requires a title");if(!b.isFunction(a.callback))throw new Error("prompt requires a callback");if(!n.inputs[a.inputType])throw new Error("invalid prompt type");switch(h=b(n.inputs[a.inputType]),a.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":h.val(a.value);break;case"select":var o={};if(k=a.inputOptions||[],!k.length)throw new Error("prompt with select requires options");g(k,function(a,d){var e=h;if(d.value===c||d.text===c)throw new Error("given options in wrong format");d.group&&(o[d.group]||(o[d.group]=b("<optgroup/>").attr("label",d.group)),e=o[d.group]),e.append("<option value='"+d.value+"'>"+d.text+"</option>")}),g(o,function(a,b){h.append(b)}),h.val(a.value);break;case"checkbox":var q=b.isArray(a.value)?a.value:[a.value];if(k=a.inputOptions||[],!k.length)throw new Error("prompt with checkbox requires options");if(!k[0].value||!k[0].text)throw new Error("given options in wrong format");h=b("<div/>"),g(k,function(c,d){var e=b(n.inputs[a.inputType]);e.find("input").attr("value",d.value),e.find("label").append(d.text),g(q,function(a,b){b===d.value&&e.find("input").prop("checked",!0)}),h.append(e)})}return a.placeholder&&h.attr("placeholder",a.placeholder),a.pattern&&h.attr("pattern",a.pattern),f.append(h),f.on("submit",function(a){a.preventDefault(),a.stopPropagation(),e.find(".btn-primary").click()}),e=p.dialog(a),e.off("shown.bs.modal"),e.on("shown.bs.modal",function(){h.focus()}),i===!0&&e.modal("show"),e},p.dialog=function(a){a=h(a);var c=b(n.dialog),d=c.find(".modal-dialog"),f=c.find(".modal-body"),i=a.buttons,j="",k={onEscape:a.onEscape};if(g(i,function(a,b){j+="<button data-bb-handler='"+a+"' type='button' class='btn "+b.className+"'>"+b.label+"</button>",k[a]=b.callback}),f.find(".bootbox-body").html(a.message),a.animate===!0&&c.addClass("fade"),a.className&&c.addClass(a.className),"large"===a.size&&d.addClass("modal-lg"),"small"===a.size&&d.addClass("modal-sm"),a.title&&f.before(n.header),a.closeButton){var l=b(n.closeButton);a.title?c.find(".modal-header").prepend(l):l.css("margin-top","-10px").prependTo(f)}return a.title&&c.find(".modal-title").html(a.title),j.length&&(f.after(n.footer),c.find(".modal-footer").html(j)),c.on("hidden.bs.modal",function(a){a.target===this&&c.remove()}),c.on("shown.bs.modal",function(){c.find(".btn-primary:first").focus()}),c.on("escape.close.bb",function(a){k.onEscape&&e(a,c,k.onEscape)}),c.on("click",".modal-footer button",function(a){var d=b(this).data("bb-handler");e(a,c,k[d])}),c.on("click",".bootbox-close-button",function(a){e(a,c,k.onEscape)}),c.on("keyup",function(a){27===a.which&&c.trigger("escape.close.bb")}),b(a.container).append(c),c.modal({backdrop:a.backdrop,keyboard:!1,show:!1}),a.show&&c.modal("show"),c},p.setDefaults=function(){var a={};2===arguments.length?a[arguments[0]]=arguments[1]:a=arguments[0],b.extend(o,a)},p.hideAll=function(){return b(".bootbox").modal("hide"),p};var q={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"Zrušit",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"Εντάξει",CANCEL:"Ακύρωση",CONFIRM:"Επιβεβαίωση"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"אישור",CANCEL:"ביטול",CONFIRM:"אישור"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"キャンセル",CONFIRM:"確認"},lt:{OK:"Gerai",CANCEL:"Atšaukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprināt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},tr:{OK:"Tamam",CANCEL:"İptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return p.init=function(c){return a(c||b)},p}),function(a){a.deparam=function(b,c){var d={},e={"true":!0,"false":!1,"null":null};return a.each(b.replace(/\+/g," ").split("&"),function(b,f){var g,h=f.split("="),i=decodeURIComponent(h[0]),j=d,k=0,l=i.split("]["),m=l.length-1;if(/\[/.test(l[0])&&/\]$/.test(l[m])?(l[m]=l[m].replace(/\]$/,""),l=l.shift().split("[").concat(l),m=l.length-1):m=0,2===h.length)if(h=decodeURIComponent(h[1]),c&&(h=h&&!isNaN(h)?+h:"undefined"===h?void 0:void 0!==e[h]?e[h]:h),m)for(;m>=k;k++)i=""===l[k]?j.length:l[k],g=j[i]=m>k?j[i]||(l[k+1]&&isNaN(l[k+1])?{}:[]):h,j=g;else a.isArray(d[i])?d[i].push(h):d[i]=void 0!==d[i]?[d[i],h]:h;else i&&(d[i]=c?void 0:"")}),d}}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}),function(a){if("object"==typeof exports)a(require("jquery"),require("spin"));else if("function"==typeof define&&define.amd)define(["jquery","spin"],a);else{if(!window.Spinner)throw new Error("Spin.js not present");a(window.jQuery,window.Spinner)}}(function(a,b){a.fn.spin=function(c,d){return this.each(function(){var e=a(this),f=e.data();f.spinner&&(f.spinner.stop(),delete f.spinner),c!==!1&&(c=a.extend({color:d||e.css("color")},a.fn.spin.presets[c]||c),f.spinner=new b(c).spin(this))})},a.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}}),function(a,b,c,d){var e="growl",f={element:"body",type:"info",allow_dismiss:!0,placement:{from:"top",align:"right"},offset:20,spacing:10,z_index:1031,delay:5e3,timer:1e3,url_target:"_blank",mouse_over:!1,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onHide:null,onHidden:null,icon_type:"class",template:'<div data-growl="container" class="alert" role="alert"><button type="button" class="close" data-growl="dismiss"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><span data-growl="icon"></span><span data-growl="title"></span><span data-growl="message"></span><a href="#" data-growl="url"></a></div>'},g=function(b,c){f=a.extend(!0,{},f,c)},h=function(b){b?a('[data-growl="container"][data-growl-position="'+b+'"]').find('[data-growl="dismiss"]').trigger("click"):a('[data-growl="container"]').find('[data-growl="dismiss"]').trigger("click")},i=function(b,c,d){var c={content:{message:"object"==typeof c?c.message:c,title:c.title?c.title:null,icon:c.icon?c.icon:null,url:c.url?c.url:null}};d=a.extend(!0,{},c,d),this.settings=a.extend(!0,{},f,d),plugin=this,j(d,this.settings,plugin),this.$template=$template},j=function(b,c,d){var e={settings:c,$element:a(c.element),template:c.template};"number"==typeof c.offset&&(c.offset={x:c.offset,y:c.offset}),$template=k(e),l($template,e.settings),m($template,e.settings),n($template,e.settings,d)},k=function(b){var c=a(b.settings.template);return c.addClass("alert-"+b.settings.type),c.attr("data-growl-position",b.settings.placement.from+"-"+b.settings.placement.align),c.find('[data-growl="dismiss"]').css("display","none"),b.settings.allow_dismiss&&c.find('[data-growl="dismiss"]').css("display","inline-block"),c},l=function(a,b){a.find('[data-growl="dismiss"]').css({position:"absolute",top:"5px",right:"10px","z-index":b.z_index-1>=1?b.z_index-1:1}),b.content.icon&&("class"==b.icon_type.toLowerCase()?a.find('[data-growl="icon"]').addClass(b.content.icon):a.find('[data-growl="icon"]').is("img")?a.find('[data-growl="icon"]').attr("src",b.content.icon):a.find('[data-growl="icon"]').append('<img src="'+b.content.icon+'" />')),b.content.title&&a.find('[data-growl="title"]').html(b.content.title),b.content.message&&a.find('[data-growl="message"]').html(b.content.message),b.content.url&&(a.find('[data-growl="url"]').attr("href",b.content.url).attr("target",b.url_target),a.find('[data-growl="url"]').css({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","z-index":b.z_index-2>=1?b.z_index-2:1}))},m=function(b,c){var d=c.offset.y,e={position:"body"===c.element?"fixed":"absolute",margin:0,"z-index":c.z_index,display:"inline-block"},f=!1;switch(a('[data-growl-position="'+c.placement.from+"-"+c.placement.align+'"]').each(function(){return d=Math.max(d,parseInt(a(this).css(c.placement.from))+a(this).outerHeight()+c.spacing)}),e[c.placement.from]=d+"px",b.css(e),c.onShow&&c.onShow(event),a(c.element).append(b),c.placement.align){case"center":b.css({left:"50%",marginLeft:-(b.outerWidth()/2)+"px"});break;case"left":b.css("left",c.offset.x+"px");break;case"right":b.css("right",c.offset.x+"px")}b.addClass("growl-animated"),b.one("webkitAnimationStart oanimationstart MSAnimationStart animationstart",function(a){f=!0}),b.one("webkitAnimationEnd oanimationend MSAnimationEnd animationend",function(a){c.onShown&&c.onShown(a)}),setTimeout(function(){f||c.onShown&&c.onShown(event)},600)},n=function(a,b,c){if(a.addClass(b.animate.enter),a.find('[data-growl="dismiss"]').on("click",function(){c.close()}),a.on("mouseover",function(b){a.addClass("hovering")}).on("mouseout",function(){a.removeClass("hovering")}),b.delay>=1){a.data("growl-delay",b.delay);var d=setInterval(function(){var e=parseInt(a.data("growl-delay"))-b.timer;(!a.hasClass("hovering")&&"pause"==b.mouse_over||"pause"!=b.mouse_over)&&a.data("growl-delay",e),0>=e&&(clearInterval(d),c.close())},b.timer)}};i.prototype={update:function(a,b){switch(a){case"icon":"class"==this.settings.icon_type.toLowerCase()?(this.$template.find('[data-growl="icon"]').removeClass(this.settings.content.icon),this.$template.find('[data-growl="icon"]').addClass(b)):this.$template.find('[data-growl="icon"]').is("img")?this.$template.find('[data-growl="icon"]'):this.$template.find('[data-growl="icon"]').find("img").attr().attr("src",b);break;case"url":this.$template.find('[data-growl="url"]').attr("href",b);break;case"type":this.$template.removeClass("alert-"+this.settings.type),this.$template.addClass("alert-"+b);break;default:this.$template.find('[data-growl="'+a+'"]').html(b)}return this},close:function(){var b=this.$template,c=this.settings,d=b.css(c.placement.from),e=!1;return c.onHide&&c.onHide(event),b.addClass(this.settings.animate.exit),b.nextAll('[data-growl-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]').each(function(){a(this).css(c.placement.from,d),d=parseInt(d)+c.spacing+a(this).outerHeight()}),b.one("webkitAnimationStart oanimationstart MSAnimationStart animationstart",function(a){e=!0}),b.one("webkitAnimationEnd oanimationend MSAnimationEnd animationend",function(b){a(this).remove(),c.onHidden&&c.onHidden(b)}),setTimeout(function(){e||(b.remove(),c.onHidden&&c.onHidden(event))},100),this}},a.growl=function(a,b){if(0==a&&"closeAll"==b.command)return h(b.position),!1;if(0==a)return g(this,b),!1;var c=new i(this,a,b);return c}}(jQuery,window,document);